"use strict";function CCache(){this.tenants=ko.observableArray([]),this.selectedTenantId=ko.observable(0),this.selectedTenant=ko.computed(function(){return _.find(this.tenants(),function(e){return e.Id===this.selectedTenantId()}.bind(this))||{Name:""}},this),CoreSettings.dbSettingsChanged.subscribe(function(){CoreSettings.dbSettingsChanged()&&Ajax.send(Settings.ServerModuleName,"GetTenants")})}var _=require("underscore"),ko=require("knockout"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js"),App=require("%PathToCoreWebclientModule%/js/App.js"),CoreSettings=require("%PathToCoreWebclientModule%/js/Settings.js"),Settings=require("modules/%ModuleName%/js/Settings.js");CCache.prototype.init=function(e){App.subscribeEvent("ReceiveAjaxResponse::after",this.onAjaxResponse.bind(this));var t=e["%ModuleName%"];this.parseTenants(t?t.Tenants:[])},CCache.prototype.onAjaxResponse=function(e){if(e.Response.Module===Settings.ServerModuleName&&"CreateTables"===e.Response.Method&&Ajax.send(Settings.ServerModuleName,"GetTenants"),e.Response.Module===Settings.ServerModuleName&&"GetTenants"===e.Response.Method){var t=Types.pString(e.Request.Parameters.Search),s=Types.pInt(e.Request.Parameters.Offset);""===t&&0===s&&this.parseTenants(e.Response.Result)}},CCache.prototype.setSelectedTenant=function(e){_.find(this.tenants(),function(t){return t.Id===e})&&this.selectedTenantId(e)},CCache.prototype.parseTenants=function(e){var t=this.selectedTenantId(),s=!1,n=e&&_.isArray(e.Items)?e.Items:[],a=[];_.each(n,function(e){var n={Name:e.Name,Id:Types.pInt(e.Id)};n.Id===t&&(s=!0),a.push(n)}),s||this.selectedTenantId(a.length>0?a[0].Id:0),this.tenants(a)},module.exports=new CCache;