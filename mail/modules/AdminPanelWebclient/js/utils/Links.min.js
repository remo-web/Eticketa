"use strict";function IsPageParam(e){return sPagePref===e.substr(0,1)&&/^[1-9][\d]*$/.test(e.substr(sPagePref.length))}function IsSearchParam(e){return sSrchPref===e.substr(0,sSrchPref.length)}var _=require("underscore"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),EntitiesTabs=require("modules/%ModuleName%/js/EntitiesTabs.js"),Settings=require("modules/%ModuleName%/js/Settings.js"),sSrchPref="s.",sPagePref="p.",Links={};Links.get=function(e,s,r,t,n){var i=[Settings.HashModuleName],a=!0;return s=s||[],_.each(EntitiesTabs.getData(),function(r){a&&(Types.isPositiveNumber(s[r.Type])?"User"===r.Type&&"MailingList"===e||i.push(r.ScreenHash.substr(0,1)+s[r.Type]):e===r.Type&&i.push(r.ScreenHash),e===r.Type&&(a=!1))}),Types.isPositiveNumber(t)&&t>1&&i.push(sPagePref+t),Types.isNonEmptyString(n)&&i.push(sSrchPref+n),Types.isNonEmptyString(r)&&i.push(r),i},Links.parse=function(e){var s=0,r={},t="",n=1,i="",a="";return _.each(EntitiesTabs.getData(),function(u){e[s]&&u.ScreenHash===e[s]&&(t=u.Type,s++),e[s]&&u.ScreenHash.substr(0,1)===e[s].substr(0,1)&&Types.pInt(e[s].substr(1))>0&&(r[u.Type]=Types.pInt(e[s].substr(1)),t=u.Type,s++),e.length>s&&IsPageParam(a=Types.pString(e[s]))&&((n=Types.pInt(a.substr(sPagePref.length)))<=0&&(n=1),s++),e.length>s&&IsSearchParam(a=Types.pString(e[s]))&&(i=a.substr(sSrchPref.length),s++)}),{Entities:r,CurrentType:t,Last:Types.isNonEmptyString(e[s])?e[s]:"",Page:n,Search:i}},module.exports=Links;