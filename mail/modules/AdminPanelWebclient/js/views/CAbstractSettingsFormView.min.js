"use strict";function CAbstractSettingsFormView(t,e){this.sServerModule=t||"Core",this.sUpdateSettingsMethod=e||"UpdateSettings",this.isSaving=ko.observable(!1),this.visible=ko.observable(!0),this.sSavedState="",this.bShown=!1,this.aSettingsSections=[]}var _=require("underscore"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),Popups=require("%PathToCoreWebclientModule%/js/Popups.js"),ConfirmPopup=require("%PathToCoreWebclientModule%/js/popups/ConfirmPopup.js");CAbstractSettingsFormView.prototype.ViewTemplate="",CAbstractSettingsFormView.prototype.addSettingsSection=function(t){this.aSettingsSections.push(t)},CAbstractSettingsFormView.prototype.onRoute=function(t){var e=!this.bShown;this.bShown=!0,e&&_.isFunction(this.onShow)&&this.onShow(),this.revert(),_.isFunction(this.onRouteChild)&&this.onRouteChild(t),_.each(this.aSettingsSections,function(e){_.isFunction(e.onShow)&&e.onShow(t)})},CAbstractSettingsFormView.prototype.hide=function(t,e){var i=this.getCurrentState()!==this.sSavedState;_.each(this.aSettingsSections,function(t){_.isFunction(t.getCurrentState)&&(i=i||t.getCurrentState()!==t.sSavedState)}),i?Popups.showPopup(ConfirmPopup,[TextUtils.i18n("COREWEBCLIENT/CONFIRM_DISCARD_CHANGES"),_.bind(function(i){i?(this.bShown=!1,t(),this.revert()):_.isFunction(e)&&e()},this)]):(this.bShown=!1,t())},CAbstractSettingsFormView.prototype.getCurrentValues=function(){return[]},CAbstractSettingsFormView.prototype.getCurrentState=function(){return this.getCurrentValues().join(":")},CAbstractSettingsFormView.prototype.updateSavedState=function(){this.sSavedState=this.getCurrentState()},CAbstractSettingsFormView.prototype.revertGlobalValues=function(){},CAbstractSettingsFormView.prototype.revert=function(){_.each(this.aSettingsSections,function(t){_.isFunction(t.revert)&&t.revert()}),this.revertGlobalValues(),this.updateSavedState()},CAbstractSettingsFormView.prototype.getParametersForSave=function(){return{}},CAbstractSettingsFormView.prototype.save=function(){_.isFunction(this.validateBeforeSave)&&!this.validateBeforeSave()||(this.isSaving(!0),Ajax.send(this.sServerModule,this.sUpdateSettingsMethod,this.getParametersForSave(),this.onResponse,this))},CAbstractSettingsFormView.prototype.applySavedValues=function(t){},CAbstractSettingsFormView.prototype.onResponse=function(t,e){if(this.isSaving(!1),t.Result){var i=e.Parameters;this.updateSavedState(),this.applySavedValues(i),Screens.showReport(TextUtils.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))}else Api.showErrorByCode(t,TextUtils.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},CAbstractSettingsFormView.prototype.setAccessLevel=function(t,e){},module.exports=CAbstractSettingsFormView;