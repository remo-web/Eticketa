"use strict";function CCommonSettingsPaneView(){CAbstractSettingsFormView.call(this),this.type=ko.observable("User"),this.id=ko.observable(0),this.entityCreateView=ko.computed(function(){var t=EntitiesTabs.getEditView(this.type());return t&&(_.isFunction(t.updateSavedState)||(t.updateSavedState=this.updateSavedState.bind(this)),_.isFunction(t.setRequestEntityDataFunction)&&t.setRequestEntityDataFunction(this.requestEntityData.bind(this))),t},this),this.entityCreateView.subscribe(function(){this.updateSavedState()},this),this.entityData=ko.computed(function(){return EntitiesTabs.getEntityData(this.type())},this),this.allowSave=ko.computed(function(){return!!this.entityData()&&!!this.entityData().UpdateRequest},this),this.allowDelete=ko.computed(function(){var t=this.entityData(),e=this.entityCreateView()&&_.isFunction(this.entityCreateView().id)?this.entityCreateView().id():0,i=t?t.Type:"",s="User"===i&&e===App.getUserId()||"Tenant"===i&&e===App.getTenantId();return!(!t||!t.DeleteRequest||s)},this),this.updateSavedState()}var _=require("underscore"),ko=require("knockout"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js"),App=require("%PathToCoreWebclientModule%/js/App.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),EntitiesTabs=require("modules/%ModuleName%/js/EntitiesTabs.js"),CAbstractSettingsFormView=require("modules/%ModuleName%/js/views/CAbstractSettingsFormView.js");_.extendOwn(CCommonSettingsPaneView.prototype,CAbstractSettingsFormView.prototype),CCommonSettingsPaneView.prototype.ViewTemplate="%ModuleName%_CommonSettingsPaneView",CCommonSettingsPaneView.prototype.getCurrentValues=function(){return this.entityCreateView()?this.entityCreateView().getCurrentValues():[]},CCommonSettingsPaneView.prototype.revertGlobalValues=function(){this.entityCreateView()&&this.entityCreateView().clearFields(),this.updateSavedState()},CCommonSettingsPaneView.prototype.save=function(t){this.entityData().UpdateRequest&&this.entityCreateView()&&Types.isPositiveNumber(this.id())&&(!_.isFunction(this.entityCreateView().isValidSaveData)||this.entityCreateView().isValidSaveData())&&Ajax.send(this.entityData().ServerModuleName,this.entityData().UpdateRequest,this.entityCreateView()?this.entityCreateView().getParametersForSave():{},function(e){e.Result?_.isFunction(this.entityCreateView().showAdvancedReport)?this.entityCreateView().showAdvancedReport(this.entityData().ReportSuccessUpdate,e):Screens.showReport(this.entityData().ReportSuccessUpdate):Screens.showError(this.entityData().ErrorUpdate),t&&_.isFunction(t.currentEntitiesView)&&_.isFunction(t.currentEntitiesView().requestEntities)&&t.currentEntitiesView().requestEntities(),this.updateSavedState()},this)},CCommonSettingsPaneView.prototype.requestEntityData=function(){Types.isPositiveNumber(this.id())&&Ajax.send(this.entityData().ServerModuleName,this.entityData().GetRequest,{Type:this.type(),Id:this.id()},function(t,e){this.id()===e.Parameters.Id&&(this.entityCreateView()&&this.entityCreateView().parse(this.id(),t.Result||{}),this.updateSavedState())},this)},CCommonSettingsPaneView.prototype.setAccessLevel=function(t,e){this.visible(""!==t),this.type(t),this.id(Types.pInt(e)),Types.isPositiveNumber(this.id())?this.requestEntityData():this.updateSavedState()},CCommonSettingsPaneView.prototype.onRoute=function(t,e){_.isFunction(this.entityCreateView().onRoute)&&this.entityCreateView().onRoute(t,e),App.broadcastEvent("CCommonSettingsPaneView::onRoute::after",{View:this.entityCreateView(),Id:this.id()})},module.exports=new CCommonSettingsPaneView;