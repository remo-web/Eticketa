"use strict";function CDbAdminSettingsView(){CAbstractSettingsFormView.call(this,Settings.ServerModuleName),this.sFakePass="xxxxxxxxxx",this.dbLogin=ko.observable(Settings.DbLogin),this.dbPassword=ko.observable(this.sFakePass),this.dbName=ko.observable(Settings.DbName),this.dbHost=ko.observable(Settings.DbHost),this.startError=ko.observable(""),this.setStartError()}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),Settings=require("%PathToCoreWebclientModule%/js/Settings.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),CAbstractSettingsFormView=require("modules/%ModuleName%/js/views/CAbstractSettingsFormView.js"),Popups=require("%PathToCoreWebclientModule%/js/Popups.js"),AlertPopup=require("%PathToCoreWebclientModule%/js/popups/AlertPopup.js"),ConfirmPopup=require("%PathToCoreWebclientModule%/js/popups/ConfirmPopup.js");_.extendOwn(CDbAdminSettingsView.prototype,CAbstractSettingsFormView.prototype),CDbAdminSettingsView.prototype.ViewTemplate="%ModuleName%_DbAdminSettingsView",CDbAdminSettingsView.prototype.setStartError=function(){this.startError(""===Settings.DbLogin||""===Settings.DbName||""===Settings.DbHost?TextUtils.i18n("%MODULENAME%/ERROR_DB_ACCESS"):"")},CDbAdminSettingsView.prototype.getStartError=function(){return this.startError},CDbAdminSettingsView.prototype.getCurrentValues=function(){return[this.dbLogin(),this.dbPassword(),this.dbName(),this.dbHost()]},CDbAdminSettingsView.prototype.revertGlobalValues=function(){this.dbLogin(Settings.DbLogin),this.dbPassword(this.sFakePass),this.dbName(Settings.DbName),this.dbHost(Settings.DbHost)},CDbAdminSettingsView.prototype.getParametersForSave=function(){return this.dbPassword()===this.sFakePass?{DbLogin:$.trim(this.dbLogin()),DbName:$.trim(this.dbName()),DbHost:$.trim(this.dbHost())}:{DbLogin:$.trim(this.dbLogin()),DbPassword:$.trim(this.dbPassword()),DbName:$.trim(this.dbName()),DbHost:$.trim(this.dbHost())}},CDbAdminSettingsView.prototype.applySavedValues=function(t){Settings.StoreAuthTokenInDB&&Popups.showPopup(AlertPopup,[TextUtils.i18n("%MODULENAME%/INFO_AUTHTOKEN_DB_STORED")]),Settings.updateDb(t.DbLogin,t.DbName,t.DbHost),this.setStartError()},CDbAdminSettingsView.prototype.setAccessLevel=function(t,e){this.visible(""===t)},CDbAdminSettingsView.prototype.testConnection=function(){Ajax.send("TestDbConnection",this.getParametersForSave(),function(t){t.Result?Screens.showReport(TextUtils.i18n("%MODULENAME%/REPORT_DB_CONNECT_SUCCESSFUL")):Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_DB_CONNECT_FAILED"))},this)},CDbAdminSettingsView.prototype.createTables=function(){var t=function(){Ajax.send("CreateTables",null,function(t){t.Result?Screens.showReport(TextUtils.i18n("%MODULENAME%/REPORT_CREATE_TABLES_SUCCESSFUL")):Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_CREATE_TABLES_FAILED"))})};this.sSavedState!==this.getCurrentState()?Popups.showPopup(ConfirmPopup,[TextUtils.i18n("%MODULENAME%/CONFIRM_SAVE_CHANGES_BEFORE_CREATE_TABLES"),_.bind(function(e){if(e){var s=this.isSaving.subscribe(function(e){e||(t(),s.dispose())},this);this.save()}},this)]):t()},CDbAdminSettingsView.prototype.updateConfig=function(){Ajax.send("UpdateConfig",null,function(t){t.Result?Screens.showReport(TextUtils.i18n("%MODULENAME%/REPORT_UPDATE_CONFIG_SUCCESSFUL")):Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_UPDATE_CONFIG_FAILED"))})},module.exports=new CDbAdminSettingsView;