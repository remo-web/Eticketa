"use strict";function CSecurityAdminSettingsView(){CAbstractSettingsFormView.call(this,Settings.ServerModuleName),this.aLanguages=Settings.LanguageList,this.login=ko.observable(Settings.AdminLogin),this.pass=ko.observable(""),this.newPass=ko.observable(""),this.confirmPass=ko.observable(""),this.selectedLanguage=ko.observable(Settings.AdminLanguage),this.passFocused=ko.observable(!1),this.newPassFocused=ko.observable(!1),this.startError=ko.observable(""),this.setStartError()}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),Settings=require("%PathToCoreWebclientModule%/js/Settings.js"),CAbstractSettingsFormView=require("modules/%ModuleName%/js/views/CAbstractSettingsFormView.js");_.extendOwn(CSecurityAdminSettingsView.prototype,CAbstractSettingsFormView.prototype),CSecurityAdminSettingsView.prototype.ViewTemplate="%ModuleName%_SecurityAdminSettingsView",CSecurityAdminSettingsView.prototype.setStartError=function(){var e=[];Settings.AdminHasPassword||e.push(TextUtils.i18n("%MODULENAME%/ERROR_ADMIN_EMPTY_PASSWORD")),Settings.SaltNotEmpty||e.push(TextUtils.i18n("%MODULENAME%/ERROR_SALT_EMPTY")),this.startError(e.join("<br /><br />"))},CSecurityAdminSettingsView.prototype.getStartError=function(){return this.startError},CSecurityAdminSettingsView.prototype.getCurrentValues=function(){return[this.login(),this.pass(),this.newPass(),this.confirmPass(),this.selectedLanguage()]},CSecurityAdminSettingsView.prototype.revertGlobalValues=function(){this.login(Settings.AdminLogin),this.pass(""),this.newPass(""),this.confirmPass(""),this.selectedLanguage(Settings.AdminLanguage)},CSecurityAdminSettingsView.prototype.getParametersForSave=function(){var e={AdminLogin:$.trim(this.login()),Password:$.trim(this.pass()),NewPassword:$.trim(this.newPass())};return this.selectedLanguage()!==Settings.AdminLanguage&&(e.AdminLanguage=this.selectedLanguage()),e},CSecurityAdminSettingsView.prototype.applySavedValues=function(e){this.selectedLanguage()!==Settings.AdminLanguage&&window.location.reload(),Settings.updateSecurity(e.AdminLogin,Settings.AdminHasPassword||""!==e.NewPassword),this.setStartError()},CSecurityAdminSettingsView.prototype.setAccessLevel=function(e,t){this.visible(""===e)},CSecurityAdminSettingsView.prototype.validateBeforeSave=function(){var e=$.trim(this.pass()),t=$.trim(this.newPass()),s=$.trim(this.confirmPass());return Settings.AdminHasPassword&&""===e&&""!==t?(Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_CURRENT_PASSWORD_EMPTY")),this.passFocused(!0),!1):""!==e&&""===t?(Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_NEW_PASSWORD_EMPTY")),this.newPassFocused(!0),!1):""===e||t===s||(Screens.showError(TextUtils.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")),this.newPassFocused(!0),!1)},CSecurityAdminSettingsView.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result){var s=t.Parameters;this.pass(""),this.newPass(""),this.confirmPass(""),this.updateSavedState(),this.applySavedValues(s),Screens.showReport(TextUtils.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))}else Api.showErrorByCode(e,TextUtils.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},module.exports=new CSecurityAdminSettingsView;