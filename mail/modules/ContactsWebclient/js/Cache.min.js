"use strict";function CContactsCache(){this.oContacts={},this.oResponseHandlers={},this.aRequestedEmails=[],this.aVcardAttachments=[],this.oNewContactParams=null}var $=require("jquery"),_=require("underscore"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),CContactModel=require("modules/%ModuleName%/js/models/CContactModel.js");CContactsCache.prototype.clearInfoAboutEmail=function(t){this.oContacts[t]=void 0},CContactsCache.prototype.getContactsByEmails=function(t,e){var a=[],s=[],n=Math.random().toString();_.each(t,_.bind(function(t){var e=this.oContacts[t];void 0!==e?a[t]=e:-1===_.indexOf(this.aRequestedEmails,t)&&s.push(t)},this)),$.isFunction(e)&&e(a),s.length>0&&(this.oResponseHandlers[n]=e,this.aRequestedEmails=_.union(this.aRequestedEmails,s),Ajax.send("GetContactsByEmails",{Storage:"all",Emails:s,HandlerId:n},this.onGetContactsByEmailsResponse,this))},CContactsCache.prototype.onGetContactsByEmailsResponse=function(t,e){var a=e.Parameters,s=this.oResponseHandlers[a.HandlerId],n=t.Result,o=a.Emails,i={};n&&_.each(n,_.bind(function(t){var e=new CContactModel;e&&(e.parse(t),this.oContacts[e.email()]=e)},this)),this.aRequestedEmails=_.difference(this.aRequestedEmails,o),_.each(o,_.bind(function(t){this.oContacts[t]||(this.oContacts[t]=null),i[t]=this.oContacts[t]},this)),$.isFunction(s)&&s(i),delete this.oResponseHandlers[a.HandlerId]},CContactsCache.prototype.addVcard=function(t){this.aVcardAttachments.push(t)},CContactsCache.prototype.getVcard=function(t){return _.find(this.aVcardAttachments,function(e){return e.file()===t})},CContactsCache.prototype.markVcardsExistentByFile=function(t){_.each(this.aVcardAttachments,function(e){e.file()===t&&e.exists(!0)})},CContactsCache.prototype.markVcardsNonexistentByUid=function(t){_.each(this.aVcardAttachments,function(e){-1!==_.indexOf(t,e.uid())&&e.exists(!1)})},CContactsCache.prototype.saveNewContactParams=function(t){this.oNewContactParams=t},CContactsCache.prototype.getNewContactParams=function(){var t=this.oNewContactParams;return this.oNewContactParams=null,t},module.exports=new CContactsCache;