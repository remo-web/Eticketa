"use strict";function Callback(e,t,a,r,l){var n={Search:e.term,Storage:r,SortField:Enums.ContactSortField.Frequency,SortOrder:1,WithGroups:l||!1,WithoutTeamContactsDuplicates:!0};Ajax.send("GetContacts",n,function(e){var r=[];e&&e.Result&&e.Result.List&&(r=_.map(e.Result.List,function(e){var t=e.ViewEmail,r="";return e.FullName&&0<$.trim(e.FullName).length&&(e.ForSharedToAll?t=e.FullName:e.IsGroup?(r='"'+e.FullName+'" ('+e.ViewEmail+")",t=e.ViewEmail):t='"'+e.FullName+'" <'+e.ViewEmail+">"),e&&e.ViewEmail&&e.ViewEmail!==a?{label:r||t,value:t,name:e.FullName,email:e.ViewEmail,frequency:e.Frequency,id:e.UUID,team:"team"===e.Storage,sharedToAll:"shared"===e.Storage}:null}),r=_.sortBy(_.compact(r),function(e){return-e.frequency})),t(r)})}function PhoneCallback(e,t){var a=$.trim(e.term),r={Search:a,SortField:Enums.ContactSortField.Frequency,SortOrder:1};""!==a&&Ajax.send("GetContacts",r,function(e){var a=[];e&&e.Result&&e.Result.List&&(_.each(e.Result.List,function(e){_.each(e.Phones,function(t,r){a.push({label:""!==e.FullName?e.FullName+" <"+e.ViewEmail+"> "+t:e.ViewEmail+" "+t,value:t,frequency:e.Frequency})})}),a=_.sortBy(_.compact(a),function(e){return-e.frequency})),t(a)})}function DeleteHandler(e){Ajax.send("UpdateContact",{Contact:{UUID:e.id,Frequency:-1}})}function RequestUserByPhone(e,t,a){oParameters={Search:e,SortField:Enums.ContactSortField.Frequency,SortOrder:1},Ajax.send("GetContacts",oParameters,function(r){var l=r.Result,n="",u=Types.isNonEmptyArray(l.List)?l.List[0]:null;u&&u.Phones&&$.each(u.Phones,function(t,a){var r=/[()\s_\-]/g;if(e.replace(r,"")===a.replace(r,""))return n=""===u.FullName?u.ViewEmail+" "+a:u.FullName+" "+a,!1}),t.call(a,n)})}var _=require("underscore"),$=require("jquery"),AddressUtils=require("%PathToCoreWebclientModule%/js/utils/Address.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js");module.exports={callback:Callback,phoneCallback:PhoneCallback,deleteHandler:DeleteHandler,requestUserByPhone:RequestUserByPhone};