"use strict";function CCreateContactPopup(){CAbstractPopup.call(this),this.displayName=ko.observable(""),this.email=ko.observable(""),this.phone=ko.observable(""),this.address=ko.observable(""),this.skype=ko.observable(""),this.facebook=ko.observable(""),this.focusDisplayName=ko.observable(!1),this.loading=ko.observable(!1),this.fCallback=function(){}}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),Routing=require("%PathToCoreWebclientModule%/js/Routing.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),CAbstractPopup=require("%PathToCoreWebclientModule%/js/popups/CAbstractPopup.js"),LinksUtils=require("modules/%ModuleName%/js/utils/Links.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),ContactsCache=require("modules/%ModuleName%/js/Cache.js"),HeaderItemView=require("modules/%ModuleName%/js/views/HeaderItemView.js");_.extendOwn(CCreateContactPopup.prototype,CAbstractPopup.prototype),CCreateContactPopup.prototype.PopupTemplate="%ModuleName%_CreateContactPopup",CCreateContactPopup.prototype.onOpen=function(e,t,o){this.displayName()===e&&this.email()===t||(this.displayName(e),this.email(t),this.phone(""),this.address(""),this.skype(""),this.facebook("")),this.fCallback=$.isFunction(o)?o:function(){}},CCreateContactPopup.prototype.onSaveClick=function(){if(this.canBeSave()){if(!this.loading()){var e={PrimaryEmail:Enums.ContactsPrimaryEmail.Personal,FullName:this.displayName(),PersonalEmail:this.email(),PersonalPhone:this.phone(),PersonalAddress:this.address(),Skype:this.skype(),Facebook:this.facebook(),Storage:"personal"};this.loading(!0),Ajax.send("CreateContact",{Contact:e},this.onCreateContactResponse,this)}}else Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_EMAIL_OR_NAME_BLANK"))},CCreateContactPopup.prototype.cancelPopup=function(){this.loading(!1),this.closePopup()},CCreateContactPopup.prototype.onCreateContactResponse=function(e,t){var o=t.Parameters;this.loading(!1),e.Result?(Screens.showReport(TextUtils.i18n("%MODULENAME%/REPORT_CONTACT_SUCCESSFULLY_ADDED")),ContactsCache.clearInfoAboutEmail(o.Contact.PersonalEmail),ContactsCache.getContactsByEmails([o.Contact.PersonalEmail],this.fCallback),this.closePopup(),HeaderItemView.isCurrent()||HeaderItemView.recivedAnim(!0)):Api.showErrorByCode(e,TextUtils.i18n("%MODULENAME%/ERROR_CREATE_CONTACT"))},CCreateContactPopup.prototype.canBeSave=function(){return""!==this.displayName()||""!==this.email()},CCreateContactPopup.prototype.goToContacts=function(){ContactsCache.saveNewContactParams({displayName:this.displayName(),email:this.email(),phone:this.phone(),address:this.address(),skype:this.skype(),facebook:this.facebook()}),this.closePopup(),Routing.replaceHash(LinksUtils.getContacts("personal","","",1,"","create-contact"))},module.exports=new CCreateContactPopup;