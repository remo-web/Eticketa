"use strict";function InitCustomTooltip(t,i){var o=TextUtils.encodeHtml(_.isFunction(i)?i():TextUtils.i18n(i)),e=$(t),s=e.find("span.dropdown"),n=!1,r=function(){var t=$(this);t.hasClass("expand")||(clearTimeout(CustomTooltip.iHideTimer),n=!0,clearTimeout(CustomTooltip.iTimer),CustomTooltip.iTimer=setTimeout(function(){n&&(t.hasClass("expand")?(n=!1,clearTimeout(CustomTooltip.iTimer),CustomTooltip.hide()):CustomTooltip.show(o,t))},100))},u=function(){clearTimeout(CustomTooltip.iHideTimer),CustomTooltip.iHideTimer=setTimeout(function(){n=!1,clearTimeout(CustomTooltip.iTimer),CustomTooltip.hide()},10)},h=function(){},l=function(){e.unbind("mouseover",r),e.unbind("mouseout",u),e.unbind("click",u),s.unbind("mouseover",u),s.unbind("mouseout",h),""!==o&&(e.bind("mouseover",r),e.bind("mouseout",u),e.bind("click",u),s.bind("mouseover",u),s.bind("mouseout",h))},p=null;l(),_.isFunction(i)&&_.isFunction(i.subscribe)&&null===p&&(p=i.subscribe(function(t){o=t,l()}))}var $=require("jquery"),ko=require("knockout"),_=require("underscore"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),CustomTooltip={_$Region:null,_$ArrowTop:null,_$Text:null,_$ArrowBottom:null,_iArrowBorderLeft:0,_iArrowMarginLeft:0,_iLeftShift:0,_bInitialized:!1,_bShown:!1,iHideTimer:0,iTimer:0,init:function(){this._bInitialized||(this._$Region=$('<span class="custom_tooltip"></span>').appendTo("body").hide(),this._$ArrowTop=$('<span class="custom_tooltip_arrow top"></span>').appendTo(this._$Region),this._$Text=$('<span class="custom_tooltip_text"></span>').appendTo(this._$Region),this._$ArrowBottom=$('<span class="custom_tooltip_arrow bottom_arrow"></span>').appendTo(this._$Region),this._iArrowMarginLeft=Types.pInt(this._$ArrowTop.css("margin-left")),this._iArrowBorderLeft=Types.pInt(this._$ArrowTop.css("border-left-width")),this._iLeftShift=Types.pInt(this._$Region.css("margin-left"))+this._iArrowMarginLeft+this._iArrowBorderLeft,this._bInitialized=!0),this._$ArrowTop.show(),this._$ArrowBottom.hide(),this._$ArrowTop.css({"margin-left":this._iArrowMarginLeft+"px"}),this._$ArrowBottom.css({"margin-left":this._iArrowMarginLeft+"px"})},show:function(t,i){this.init();var o=i.offset(),e=i.width(),s=e<70?e/2:e/4,n=Types.pInt(i.css("padding-left")),r=$("body"),u=o.top+i.outerHeight()-$("html").scrollTop();this._$Text.html(t),this._bShown=!0,this._$Region.stop().fadeIn(260,_.bind(function(){this._bShown||this._$Region.hide()},this)).css({top:u,left:o.left+n+s-this._iLeftShift,right:"auto"}),r.outerHeight()<this._$Region.outerHeight()+this._$Region.offset().top&&(this._$ArrowTop.hide(),this._$ArrowBottom.show(),this._$Region.css({top:u-this._$Region.outerHeight()-i.outerHeight()})),setTimeout(function(){r.width()<this._$Region.outerWidth(!0)+this._$Region.offset().left&&(this._$Region.css({left:"auto",right:0}),this._$ArrowTop.css({"margin-left":s+o.left-this._$Region.offset().left-this._iArrowBorderLeft+"px"}),this._$ArrowBottom.css({"margin-left":s+o.left-this._$Region.offset().left-this._iArrowBorderLeft+Types.pInt(this._$Region.css("margin-right"))+"px"}))}.bind(this),1)},hide:function(){this._bInitialized&&(this._bShown=!1,this._$Region.hide())}};ko.bindingHandlers.customTooltip={update:function(t,i){InitCustomTooltip(t,i())}},module.exports={init:InitCustomTooltip};