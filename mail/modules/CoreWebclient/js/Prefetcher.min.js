"use strict";var _=require("underscore"),$=require("jquery"),moment=require("moment-timezone"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js"),App=require("%PathToCoreWebclientModule%/js/App.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),Storage=require("%PathToCoreWebclientModule%/js/Storage.js"),Settings=require("%PathToCoreWebclientModule%/js/Settings.js"),ModulesPrefetchers=ModulesManager.getModulesPrefetchers(),Prefetcher={},bServerInitializationsDone=!1;Prefetcher.start=function(){App.getUserRole()===Enums.UserRole.Anonymous||App.isNewTab()||Ajax.hasInternetConnectionProblem()||Ajax.hasOpenedRequests()||Prefetcher.prefetchAll()},Prefetcher.prefetchAll=function(){var e=this.doServerInitializations();_.each(ModulesPrefetchers,function(r){e||(Settings.AllowPrefetch&&$.isFunction(r.startAll)?e=r.startAll():$.isFunction(r.startMin)&&(e=r.startMin()))})},Prefetcher.doServerInitializations=function(){return!(App.getUserRole()===Enums.UserRole.Anonymous||App.isNewTab()||App.isPublic()||bServerInitializationsDone)&&(Ajax.send("Core","DoServerInitializations",{}),bServerInitializationsDone=!0,!0)},Ajax.registerOnAllRequestsClosedHandler(function(){Prefetcher.start()});