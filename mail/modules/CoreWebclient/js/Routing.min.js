"use strict";function CRouting(){this.currentHash=ko.observable(this.getHashFromHref()),this.previousHash=ko.observable(this.getHashFromHref())}var _=require("underscore"),ko=require("knockout"),hasher=require("hasher"),UrlUtils=require("%PathToCoreWebclientModule%/js/utils/Url.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js");CRouting.prototype.init=function(){hasher.initialized.removeAll(),hasher.changed.removeAll(),hasher.initialized.add(this.parseRouting,this),hasher.changed.add(this.parseRouting,this),hasher.init(),hasher.initialized.removeAll()},CRouting.prototype.finalize=function(){hasher.dispose()},CRouting.prototype.setHashFromString=function(t){var i=location.hash===t;return i||(location.hash=t),i},CRouting.prototype.replaceHashWithoutMessageUid=function(t){if("string"==typeof t&&""!==t){var i=location.hash.replace("/msg"+t,"");this.replaceHashFromString(i)}},CRouting.prototype.replaceHashFromString=function(t){location.hash!==t&&location.replace(UrlUtils.getAppPath()+window.location.search+t)},CRouting.prototype.setHash=function(t){return this.setHashFromString(this.buildHashFromArray(t))},CRouting.prototype.replaceHash=function(t){this.replaceHashFromString(this.buildHashFromArray(t))},CRouting.prototype.replaceHashDirectly=function(t){hasher.stop(),this.replaceHashFromString(this.buildHashFromArray(t)),this.currentHash(location.hash.replace(/^#/,"")),hasher.init()},CRouting.prototype.setPreviousHash=function(){var t=this.previousHash(),i=t.split(/[-|\/]/);this.currentHash()===t&&(t=i.length>0&&i[0]!==t?i[0]:""),location.hash=t},CRouting.prototype.stopListening=function(){hasher.stop()},CRouting.prototype.startListening=function(){hasher.init()},CRouting.prototype.buildHashFromArray=function(t){var i=0,e=0,r="";if(_.isArray(t))for(e=t.length;i<e;i++)t[i]=encodeURIComponent(t[i]);else t=[encodeURIComponent(t.toString())];return""!==(r=t.join("/"))&&(r="#"+r),r},CRouting.prototype.getHashFromHref=function(){var t=location.href.indexOf("#"),i="";return-1!==t&&(i=location.href.substr(t+1)),i},CRouting.prototype.goDirectly=function(t,i){hasher.stop(),this.setHash(t),this.parseRouting(i),hasher.init()},CRouting.prototype.historyBackWithoutParsing=function(t){hasher.stop(),location.hash=this.currentHash(),hasher.init()},CRouting.prototype.getScreenFromHash=function(){var t=this.getHashFromHref().split("/");return decodeURIComponent(t.shift())},CRouting.prototype.parseRouting=function(t){var i=require("%PathToCoreWebclientModule%/js/App.js"),e=_.bind(this.chooseScreen,this,t),r=_.bind(this.historyBackWithoutParsing,this,t),o=_.isFunction(Screens.getCurrentScreen)?Screens.getCurrentScreen():null;o&&_.isFunction(o.hasUnsavedChanges)&&o.hasUnsavedChanges()?i.askDiscardChanges(e,r,o):_.isFunction(e)&&e()},CRouting.prototype.chooseScreen=function(t){var i=this.getHashFromHref(),e=_.map(i.split("/"),function(t){return decodeURIComponent(t)});this.previousHash(this.currentHash()),this.currentHash(i),t=_.isArray(t)?t:[],Screens.route(e.concat(t))};var Routing=new CRouting;module.exports={init:_.bind(Routing.init,Routing),buildHashFromArray:_.bind(Routing.buildHashFromArray,Routing),replaceHashWithoutMessageUid:_.bind(Routing.replaceHashWithoutMessageUid,Routing),setHash:_.bind(Routing.setHash,Routing),replaceHash:_.bind(Routing.replaceHash,Routing),finalize:_.bind(Routing.finalize,Routing),currentHash:Routing.currentHash,replaceHashDirectly:_.bind(Routing.replaceHashDirectly,Routing),setPreviousHash:_.bind(Routing.setPreviousHash,Routing),stopListening:_.bind(Routing.stopListening,Routing),startListening:_.bind(Routing.startListening,Routing),goDirectly:_.bind(Routing.goDirectly,Routing),getCurrentHashArray:function(){return Routing.currentHash().split("/")},getAppUrlWithHash:function(t){return UrlUtils.getAppPath()+Routing.buildHashFromArray(t)}};