"use strict";function deferredUpdate(n,e,t,i){!n.__interval&&e?(n.__state=!0,i(n,!0),n.__interval=window.setInterval(function(){n.__state||(i(n,!1),window.clearInterval(n.__interval),n.__interval=null)},t)):e||(n.__state=!1)}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Browser=require("%PathToCoreWebclientModule%/js/Browser.js");ko.bindingHandlers.i18n={init:function(n,e){var t=e(),i=t.key,o=t.type||"text",s=TextUtils.i18n(i);if(""!==s)switch(o){case"html":$(n).html(s);break;case"placeholder":$(n).attr({placeholder:s});break;case"text":default:$(n).text(s)}}},ko.bindingHandlers.dropdown={update:function(n,e,t,i){var o,s,a,l=$(n),r=_.defaults(e(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",scrollToTopContainer:".scroll-inner",passClick:!0,trueValue:!0}),d="function"==typeof r.control?r.control():r.control,c=l.find(".control"),u=l.find(".dropdown"),p=l.find(".dropdown_helper"),f=l.find(".dropdown_arrow"),h=l.find(".dropdown_arrow.bottom_arrow"),g=l.hasClass("right"),b=$(document),m=!1,w=function(){$.isFunction(r.callback)&&r.callback.call(i,!!l.hasClass(r.expand)&&r.trueValue,l)},v=function(n){n.stopPropagation()},k=function(n){void 0===n&&(n=!l.hasClass(r.expand)),!n&&l.hasClass(r.expand)&&r.scrollToTopContainer&&l.find(r.scrollToTopContainer).scrollTop(0),l.toggleClass(r.expand,n),h.length>0&&l.hasClass(r.expand)&&u.css({top:l.position().top-p.height()+"px",left:l.position().left+"px",width:"auto"})},C=function(n){(o=p.offset())&&(s=o.left+10,(a=$(window).width()-(s+p.outerWidth(!0)))>0&&(a=0),g||(p.css("left",n||a+"px"),f.css("left",n||Math.abs(a?a+Types.pInt(f.css("margin-left")):0)+"px")))},y=function(n){$(n.originalEvent.originalTarget).parents(".dropdown").length>0||l.hasClass(r.disabled)||m||(k(),_.defer(function(){w()}),l.hasClass(r.expand)&&(r.close&&r.close.subscribe&&r.close(!0),_.defer(function(){b.on("click.dropdown",function(n){!r.passClick&&2===n.button||m||(b.unbind("click.dropdown"),r.close&&r.close.subscribe&&r.close(!1),k(!1),w(),C(0)),m=!1})}),C()))};l.off(),c.off(),r.passClick||(l.find(r.container).on("click",v),l.on("click",v),c.on("click",v)),k(!1),r.close&&r.close.subscribe&&r.close.subscribe(function(n){n||(b.unbind("click.dropdown"),k(!1)),w()}),l.on("mousedown",function(n,e){m=$(n.target).hasClass("customscroll-scrollbar")||$(n.target.parentElement).hasClass("customscroll-scrollbar")}),l.on("click",function(n){d||y(n)}),c.on("click",function(n){d&&y(n)}),C(0)}},ko.bindingHandlers.initDom={init:function(n,e){var t=e();t&&t($(n))}},ko.bindingHandlers.command={init:function(n,e,t,i){var o=$(n),s=e();if(!s||!s.enabled||!s.canExecute)throw new Error("You are not using command function");o.addClass("command"),ko.bindingHandlers[o.is("form")?"submit":"click"].init.apply(i,arguments)},update:function(n,e){var t=!0,i=$(n),o=e();t=o.enabled(),i.toggleClass("command-not-enabled",!t),t&&(t=o.canExecute(),i.toggleClass("unavailable",!t)),i.toggleClass("command-disabled disable disabled",!t),i.toggleClass("enable",t)}},ko.bindingHandlers.checkstate={update:function(n,e,t,i,o){var s=n.oOptions||null,a=n.jqElement||null,l=n.oIconIE||null,r=e(),d=r.state;void 0!==r.state&&(a||(n.jqElement=a=$(n)),s||(n.oOptions=s=_.defaults(r,{activeClass:"process",duration:800})),deferredUpdate(a,d,s.duration,function(e,t){if(Browser.ie9AndBelow)if(l||(n.oIconIE=l=a.find(".icon")),!l.__intervalIE&&t){var i=0,o="";l.__intervalIE=setInterval(function(){o="0px -"+20*i+"px",i=i<7?i+1:0,l.css({"background-position":o})},1e3/12)}else l.css({"background-position":"0px 0px"}),clearInterval(l.__intervalIE),l.__intervalIE=null;else e.toggleClass(s.activeClass,t)}))}},ko.bindingHandlers.heightAdjust={update:function(n,e,t){var i=n.jqElement||null,o=0,s=e().location,a=e().delay||400;i||(n.jqElement=i=$(n)),_.delay(function(){_.each(e().elements,function(n){var e=n();e&&(o+=e.is(":visible")?e.outerHeight():0)}),"top"===s||void 0===s?i.css({"padding-top":o,"margin-top":-o}):"bottom"===s&&i.css({"padding-bottom":o,"margin-bottom":-o})},a)}},ko.bindingHandlers.minHeightAdjust={update:function(n,e,t){var i=$(n),o=e(),s=o.adjustElement||$("body"),a=o.minHeight||0;o.removeTrigger&&s.css("min-height","inherit"),o.trigger&&_.delay(function(){s.css({"min-height":i.outerHeight(!0)+a})},100)}},ko.bindingHandlers.listWithMoreButton={init:function(n,e){var t=$(n);t.resize(function(){var n=t.find("span.hotkey"),e=t.find("span.item"),i=t.find("span.more_hints").show(),o=t.width(),s=i.width(),a=!0;_.each(n,function(n,t){var i=$(n),l=i.width();i&&!i.hasClass("not-display")&&(a&&s+l<o?(i.show(),$(e[t]).hide(),s+=l):(a=!1,i.hide(),$(e[t]).show()))}),a&&i.hide()})}},ko.bindingHandlers.onEnter={init:function(n,e,t,i){$(n).on("keydown",function(t){if(t.keyCode===Enums.Key.Enter){$(n).trigger("change");var o=e().call(i);if("boolean"==typeof o)return o}})}},ko.bindingHandlers.onFocusSelect={init:function(n,e,t,i){$(n).on("focus",function(e){n.select()})}},ko.bindingHandlers.watchWidth={init:function(n,e){var t=!1;t||e().subscribe(function(){e()($(n).outerWidth()),t=!0},this)}},ko.bindingHandlers.columnCalc={init:function(n,e){var t=$(n),i=e().prop,o=null,s=0;void 0!==(o=t.find(e().itemSelector))[0]&&(s=1>=(s=o.outerWidth(!0))?1:s,i&&$(window).bind("resize",function(){var n=t.width();i(0<n?Math.floor(n/s):1)}))}},ko.bindingHandlers.adjustHeightToContent={init:function(n,e,t,i,o){var s=$(n),a=null,l=null,r=null;_.delay(_.bind(function(){var n=s.find(".title .text");n.length>0&&(a=$(_.max(n,function(n){return n.offsetWidth})),l=a.parent(),r=l.find(".icon"),s.css("min-width",Types.pInt(l.css("margin-left"))+Types.pInt(l.css("padding-left"))+Types.pInt(r.width())+Types.pInt(r.css("margin-left"))+Types.pInt(r.css("margin-right"))+Types.pInt(r.css("padding-left"))+Types.pInt(r.css("padding-right"))+Types.pInt(a.width())+Types.pInt(a.css("margin-left"))+Types.pInt(a.css("padding-left"))+10))},this),1)}},module.exports={};