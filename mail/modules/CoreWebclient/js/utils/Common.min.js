"use strict";var _=require("underscore"),$=require("jquery"),ko=require("knockout"),moment=require("moment"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),UserSettings=require("%PathToCoreWebclientModule%/js/Settings.js"),Utils={};require("jquery.easing"),Utils.createCommand=function(e,t,n){var o=t?function(){return!(!o.canExecute||!o.canExecute())&&t.apply(e,Array.prototype.slice.call(arguments))}:function(){};return o.enabled=ko.observable(!0),$.isFunction(n)?o.canExecute=ko.computed(function(){return o.enabled()&&n.call(e)}):(void 0===n&&(n=!0),o.canExecute=ko.computed(function(){return o.enabled()&&!!n})),o},Utils.isTextFieldFocused=function(){var e=document&&document.activeElement?document.activeElement:null,t=e?e.tagName:null,n=e&&e.type?e.type.toLowerCase():null,o=e?e.contentEditable:null;return"INPUT"===t&&("text"===n||"password"===n||"email"===n||"search"===n)||"TEXTAREA"===t||"IFRAME"===t||"true"===o},Utils.calmEvent=function(e){e&&(e.stop&&e.stop(),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.cancelBubble=!0,e.returnValue=!1)},Utils.removeSelection=function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},Utils.desktopNotify=function(){var e=[];return function(t){var n=require("%PathToCoreWebclientModule%/js/AppTab.js");if(t&&UserSettings.AllowDesktopNotifications&&window.Notification&&!n.focused())switch(t.action){case"show":if("denied"!==window.Notification.permission){var o,i={body:t.body||"",dir:t.dir||"auto",lang:t.lang||"",tag:t.tag||Math.floor(900*Math.random()+100),icon:t.icon||!1},a=function(){(o=new window.Notification(t.title,i)).onclick=function(e){t.callback&&t.callback(),o.close()},t.timeout&&setTimeout(function(){o.close()},t.timeout),e.push(o)};"granted"===window.Notification.permission?a():"default"===window.Notification.permission&&window.Notification.requestPermission(function(e){"granted"===e&&a()})}break;case"hide":_.each(e,function(n,o){t.tag===n.tag&&(n.close(),e.splice(o,1))});break;case"hideAll":_.each(e,function(e){e.close()}),e.length=0}}}(),Utils.getFileExtension=function(e){var t="",n=e.lastIndexOf(".");return n>-1&&(t=e.substr(n+1)),t},Utils.draggableItems=function(){return $('<div class="draggable"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},Utils.uiDropHelperAnim=function(e,t){var n=0,o=0,i=0,a=0,r=0,s=0,l=t.helper.clone().appendTo("#pSevenHidden"),u=$(e.target).find(".animGoal"),c=null;(c=(u=$(u[0]?u[0]:e.target))&&u[0]?u.offset():null)&&(n=window.Math.round(c.left),o=window.Math.round(c.top),r=u.width(),s=u.height(),i=n,0<r&&(i+=window.Math.round(r/2)),a=o,0<s&&(a+=window.Math.round(s/2)),l.animate({left:i+"px",top:a+"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){$(this).remove()}))},Utils.validateFileOrFolderName=function(e){return""!==(e=$.trim(e))&&!/["\/\\*?<>|:]/.test(e)},Utils.getFileNameWithoutExtension=function(e){var t=e,n=e.lastIndexOf(".");return n>-1&&(t=e.substr(0,n)),t},Utils.defaultOptionsAfterRender=function(e,t){t&&void 0!==t.disable&&ko.applyBindingsToNode(e,{disable:!!t.disable},t)},Utils.getDateFormatForMoment=function(e){var t="MM/DD/YYYY";switch(e){case"MM/DD/YYYY":t="MM/DD/YYYY";break;case"DD/MM/YYYY":t="DD/MM/YYYY";break;case"DD Month YYYY":t="DD MMMM YYYY"}return t},Utils.log=UserSettings.AllowClientDebug?(window.auroraLogs=[],function(){var e=[];e.unshift(moment().format("DD.MM, HH:mm:ss")),_.each(arguments,function(t){e.push(t)}),window.auroraLogs.length>100&&window.auroraLogs.shift(),window.auroraLogs.push(e)}):function(){},Utils.getHash=function(e){for(var t=0,n=0,o=e.length;n<o;)t=(t<<5)-t+e.charCodeAt(n++)<<0;return Types.pString(t)},Utils.destroyObjectWithObservables=function(e,t){var n=e[t];for(var o in n)n[o]&&_.isFunction(n[o].dispose)&&n[o].dispose(),delete n[o];delete e[t]},module.exports=Utils;