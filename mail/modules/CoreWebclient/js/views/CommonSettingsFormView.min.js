"use strict";function CCommonSettingsFormView(){CAbstractSettingsFormView.call(this),this.bAdmin=App.getUserRole()===Enums.UserRole.SuperAdmin,this.bMobile=App.isMobile(),this.aThemes=UserSettings.ThemeList,this.aMobileThemes=UserSettings.MobileThemeList,this.aLanguages=_.clone(UserSettings.LanguageList),this.aDateFormats=SettingsUtils.getDateFormatsForSelector(),this.bAdmin&&this.aLanguages.unshift({value:"autodetect",name:TextUtils.i18n("%MODULENAME%/LABEL_AUTODETECT")}),this.aRefreshIntervals=[{name:TextUtils.i18n("%MODULENAME%/LABEL_REFRESH_OFF"),value:0},{name:TextUtils.i18n("%MODULENAME%/LABEL_MINUTES_PLURAL",{COUNT:1},null,1),value:1},{name:TextUtils.i18n("%MODULENAME%/LABEL_MINUTES_PLURAL",{COUNT:3},null,3),value:3},{name:TextUtils.i18n("%MODULENAME%/LABEL_MINUTES_PLURAL",{COUNT:5},null,5),value:5},{name:TextUtils.i18n("%MODULENAME%/LABEL_MINUTES_PLURAL",{COUNT:10},null,10),value:10},{name:TextUtils.i18n("%MODULENAME%/LABEL_MINUTES_PLURAL",{COUNT:15},null,15),value:15},{name:TextUtils.i18n("%MODULENAME%/LABEL_MINUTES_PLURAL",{COUNT:20},null,20),value:20},{name:TextUtils.i18n("%MODULENAME%/LABEL_MINUTES_PLURAL",{COUNT:30},null,30),value:30}],this.siteName=ko.observable(UserSettings.SiteName),this.selectedTheme=ko.observable(this.getGlobalTheme(this.aThemes,UserSettings.Theme)),this.selectedMobileTheme=ko.observable(this.getGlobalTheme(this.aMobileThemes,UserSettings.MobileTheme)),this.selectedLanguage=ko.observable(this.getGlobalLanguage()),this.autoRefreshInterval=ko.observable(this.getGlobalAutoRefreshIntervalMinutes()),this.timeFormat=ko.observable(UserSettings.timeFormat()),this.selectedDateFormat=ko.observable(UserSettings.dateFormat()),this.desktopNotifications=ko.observable(UserSettings.AllowDesktopNotifications),this.allowChangeDateFormat=ko.computed(function(){return!this.bAdmin&&UserSettings.UserSelectsDateFormat},this),this.isDesktopNotificationsEnable=ko.observable(window.Notification&&"denied"!==window.Notification.permission),this.desktopNotifications.subscribe(function(e){var t=this;e&&"default"===window.Notification.permission&&window.Notification.requestPermission(function(e){"denied"===e&&(t.desktopNotifications(!1),t.isDesktopNotificationsEnable(!1))})},this)}var CAbstractSettingsFormView,_=require("underscore"),ko=require("knockout"),SettingsUtils=require("%PathToCoreWebclientModule%/js/utils/Settings.js"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),App=require("%PathToCoreWebclientModule%/js/App.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),UserSettings=require("%PathToCoreWebclientModule%/js/Settings.js"),Enums=window.Enums;CAbstractSettingsFormView=App.getUserRole()===Enums.UserRole.SuperAdmin?ModulesManager.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"):ModulesManager.run("SettingsWebclient","getAbstractSettingsFormViewClass"),_.extendOwn(CCommonSettingsFormView.prototype,CAbstractSettingsFormView.prototype),CCommonSettingsFormView.prototype.ViewTemplate="CoreWebclient_CommonSettingsFormView",CCommonSettingsFormView.prototype.getCurrentValues=function(){return[this.siteName(),this.selectedTheme(),this.selectedMobileTheme(),this.selectedLanguage(),this.autoRefreshInterval(),this.timeFormat(),this.selectedDateFormat(),this.desktopNotifications()]},CCommonSettingsFormView.prototype.getGlobalLanguage=function(){var e=this.bAdmin?UserSettings.AutodetectLanguage?"autodetect":UserSettings.CommonLanguage:UserSettings.Language,t=_.find(this.aLanguages,function(t){return t.value===e});return t||(t=_.find(this.aLanguages,function(e){return"English"===e.value})),t?t.value:this.aLanguages.length>0?this.aLanguages[0].value:""},CCommonSettingsFormView.prototype.getGlobalTheme=function(e,t){var i=_.find(e,function(e){return e===t});return i||(i=_.find(e,function(e){return"Default"===e})),i||(e.length>0?e[0]:"")},CCommonSettingsFormView.prototype.getGlobalAutoRefreshIntervalMinutes=function(){var e=_.find(this.aRefreshIntervals,function(e){return e.value===UserSettings.AutoRefreshIntervalMinutes});return e||(e=_.find(this.aRefreshIntervals,function(e){return 0===e.value})),e?e.value:this.aRefreshIntervals.length>0?this.aRefreshIntervals[0].value:0},CCommonSettingsFormView.prototype.revertGlobalValues=function(){this.siteName(UserSettings.SiteName),this.selectedTheme(this.getGlobalTheme(this.aThemes,UserSettings.Theme)),this.selectedMobileTheme(this.getGlobalTheme(this.aMobileThemes,UserSettings.MobileTheme)),this.selectedLanguage(this.getGlobalLanguage()),this.autoRefreshInterval(this.getGlobalAutoRefreshIntervalMinutes()),this.timeFormat(UserSettings.timeFormat()),this.selectedDateFormat(UserSettings.dateFormat()),this.desktopNotifications(UserSettings.AllowDesktopNotifications)},CCommonSettingsFormView.prototype.getParametersForSave=function(){var e={Theme:this.selectedTheme(),MobileTheme:this.selectedMobileTheme(),TimeFormat:this.timeFormat()};return this.bAdmin?(e.SiteName=this.siteName(),"autodetect"===this.selectedLanguage()?e.AutodetectLanguage=!0:(e.AutodetectLanguage=!1,e.Language=this.selectedLanguage())):(e.AutoRefreshIntervalMinutes=Types.pInt(this.autoRefreshInterval()),e.AllowDesktopNotifications=this.desktopNotifications(),e.Language=this.selectedLanguage(),this.allowChangeDateFormat()&&(e.DateFormat=this.selectedDateFormat())),e},CCommonSettingsFormView.prototype.applySavedValues=function(e){e.Theme!==UserSettings.Theme&&!this.bMobile||e.MobileTheme!==UserSettings.MobileTheme&&this.bMobile||e.Language!==UserSettings.Language&&!this.bAdmin?window.location.reload():UserSettings.update(e.SiteName,e.AutoRefreshIntervalMinutes,e.Theme,e.MobileTheme,e.Language,e.TimeFormat,e.DateFormat,e.AllowDesktopNotifications)},CCommonSettingsFormView.prototype.setAccessLevel=function(e,t){this.visible(""===e)},module.exports=new CCommonSettingsFormView;