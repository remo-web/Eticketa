"use strict";function CAliasesPerUserAdminSettingsView(){CAbstractSettingsFormView.call(this,Settings.ServerModuleName),this.iUserId=0,this.iRequestedUserId=0,this.domain=ko.observable(""),this.domains=ko.computed(function(){return _.map(Cache.domains(),function(e){return e.Name})},this),this.aliasName=ko.observable(""),this.aliases=ko.observableArray([]),this.selectedAliases=ko.observableArray([])}var _=require("underscore"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),CAbstractSettingsFormView=ModulesManager.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"),Cache=ModulesManager.run("MailDomains","getMailDomainsCache"),Settings=require("modules/%ModuleName%/js/Settings.js");_.extendOwn(CAliasesPerUserAdminSettingsView.prototype,CAbstractSettingsFormView.prototype),CAliasesPerUserAdminSettingsView.prototype.ViewTemplate="%ModuleName%_AliasesPerUserAdminSettingsView",CAliasesPerUserAdminSettingsView.prototype.onRouteChild=function(){this.aliasName(""),this.selectedAliases([]),this.requestNewData()},CAliasesPerUserAdminSettingsView.prototype.addNewAlias=function(){""!==this.aliasName()?Ajax.send(Settings.ServerModuleName,"AddNewAlias",{UserId:this.iUserId,AliasName:this.aliasName(),AliasDomain:this.domain()},function(e){e.Result?(this.aliasName(""),this.requestAliases()):Api.showErrorByCode(e,TextUtils.i18n("%MODULENAME%/ERROR_ADD_NEW_ALIAS"))},this):Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_EMPTY_ALIAS"))},CAliasesPerUserAdminSettingsView.prototype.deleteAliases=function(){0!==this.selectedAliases().length?Ajax.send(Settings.ServerModuleName,"DeleteAliases",{UserId:this.iUserId,Aliases:this.selectedAliases()},function(e){e.Result?(this.selectedAliases([]),this.requestAliases()):Api.showErrorByCode(e,TextUtils.i18n("%MODULENAME%/ERROR_DELETE_ALIASES_PLURAL",{},null,this.selectedAliases().length))},this):Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_EMPTY_ALIASES"))},CAliasesPerUserAdminSettingsView.prototype.requestNewData=function(){this.bShown&&this.iRequestedUserId!==this.iUserId&&this.requestAliases()},CAliasesPerUserAdminSettingsView.prototype.requestAliases=function(){this.iRequestedUserId=this.iUserId,this.aliases([]),Ajax.send(Settings.ServerModuleName,"GetAliases",{UserId:this.iUserId},function(e){e.Result&&(this.aliases(e.Result.Aliases),this.domain(e.Result.Domain))},this)},CAliasesPerUserAdminSettingsView.prototype.setAccessLevel=function(e,s){this.visible("User"===e),this.iUserId!==s&&(this.iUserId=s,this.requestNewData())},module.exports=new CAliasesPerUserAdminSettingsView;