"use strict";function CTwoFactorAuthSettingsFormView(){CAbstractSettingsFormView.call(this,Settings.ServerModuleName),this.isEnabledTwoFactorAuth=ko.observable(Settings.EnableTwoFactorAuth()),this.isPasswordVerified=ko.observable(!1),this.isShowSecret=ko.observable(!1),this.isValidatingPin=ko.observable(!1),this.QRCodeSrc=ko.observable(""),this.secret=ko.observable(""),this.pin=ko.observable("")}var _=require("underscore"),ko=require("knockout"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),CAbstractSettingsFormView=ModulesManager.run("SettingsWebclient","getAbstractSettingsFormViewClass"),Settings=require("modules/%ModuleName%/js/Settings.js"),Popups=require("%PathToCoreWebclientModule%/js/Popups.js"),ConfirmPasswordPopup=require("modules/%ModuleName%/js/popups/ConfirmPasswordPopup.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js");_.extendOwn(CTwoFactorAuthSettingsFormView.prototype,CAbstractSettingsFormView.prototype),CTwoFactorAuthSettingsFormView.prototype.ViewTemplate="%ModuleName%_TwoFactorAuthSettingsFormView",CTwoFactorAuthSettingsFormView.prototype.confirmePassword=function(){Popups.showPopup(ConfirmPasswordPopup,[_.bind(this.onConfirmePassword,this),"EnableTwoFactorAuth"])},CTwoFactorAuthSettingsFormView.prototype.onConfirmePassword=function(e){e&&e.Result&&e.Result.Secret&&e.Result.QRcode&&(this.QRCodeSrc(e.Result.QRcode),this.secret(e.Result.Secret),this.isShowSecret(!0))},CTwoFactorAuthSettingsFormView.prototype.validatePin=function(){this.isValidatingPin(!0),Ajax.send("TwoFactorAuth","TwoFactorAuthSave",{Pin:this.pin(),Secret:this.secret()},this.onValidatingPinResponse,this)},CTwoFactorAuthSettingsFormView.prototype.onValidatingPinResponse=function(e){this.isValidatingPin(!1),e&&e.Result?(this.QRCodeSrc(""),this.secret(""),this.pin(""),this.isShowSecret(!1),this.isEnabledTwoFactorAuth(!0)):Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_WRONG_PIN"))},CTwoFactorAuthSettingsFormView.prototype.disable=function(){Popups.showPopup(ConfirmPasswordPopup,[_.bind(function(){this.QRCodeSrc(""),this.secret(""),this.pin(""),this.isShowSecret(!1),this.isEnabledTwoFactorAuth(!1)},this),"DisableTwoFactorAuth"])},module.exports=new CTwoFactorAuthSettingsFormView;