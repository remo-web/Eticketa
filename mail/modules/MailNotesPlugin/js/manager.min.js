"use strict";module.exports=function(e){function i(e){var i=e().sNamespaceFolder,s=e().sDelimiter;u=""!==i?i+s+r:r;var a=e().getFolderByFullName(u);a&&(a.displayName=t.observable(o.i18n("%MODULENAME%/LABEL_FOLDER_NOTES")),a.usedAs=t.observable(o.i18n("%MODULENAME%/LABEL_USED_AS_NOTES")))}var s=require("underscore"),t=require("knockout"),o=require("%PathToCoreWebclientModule%/js/utils/Text.js"),a=require("%PathToCoreWebclientModule%/js/App.js"),r="Notes",u=r;return a.isUserNormalOrTenant()?{start:function(e){$("html").addClass("MailNotesPlugin"),a.subscribeEvent("MailWebclient::ConstructView::before",function(a){if("CMailView"===a.Name){var r=a.MailCache.folderList,l=t.computed(function(){return a.MailCache.folderList().currentFolder()}),n=new(require("modules/%ModuleName%/js/views/CMessagePaneView.js"))(a.MailCache,s.bind(a.View.routeMessageView,a.View));i(r),r.subscribe(function(){i(r)}),l.subscribe(function(){var i=l()?l().fullName():"";i===u?(a.View.setCustomPreviewPane("%ModuleName%",n),a.View.setCustomBigButton("%ModuleName%",function(){e.run("MailWebclient","setCustomRouting",[i,1,"","","","create-note"])},o.i18n("%MODULENAME%/ACTION_NEW_NOTE")),a.View.resetDisabledTools("%ModuleName%",["spam","move","mark"])):(a.View.removeCustomPreviewPane("%ModuleName%"),a.View.removeCustomBigButton("%ModuleName%"),a.View.resetDisabledTools("%ModuleName%",[]))})}}),a.subscribeEvent("MailWebclient::ConstructView::after",function(e){if("CMessageListView"===e.Name&&e.MailCache){var i=t.computed(function(){return e.MailCache.folderList().currentFolder()});i.subscribe(function(){(i()?i().fullName():"")===u?e.View.customMessageItemViewTemplate("%ModuleName%_MessageItemView"):e.View.customMessageItemViewTemplate("")})}}),a.subscribeEvent("MailWebclient::MessageDblClick::before",s.bind(function(e){e.Message&&e.Message.folder()===u&&(e.Cancel=!0)},this))}}:null};