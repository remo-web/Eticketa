"use strict";module.exports=function(e){var t=require("jquery"),r=require("%PathToCoreWebclientModule%/js/utils/Text.js"),i=require("%PathToCoreWebclientModule%/js/utils/Url.js"),s=require("%PathToCoreWebclientModule%/js/Ajax.js"),n=require("%PathToCoreWebclientModule%/js/Api.js"),o=require("%PathToCoreWebclientModule%/js/App.js");return o.isUserNormalOrTenant()?{start:function(e){o.subscribeEvent("MailWebclient::AddMoreSectionCommand",function(e){e({Text:r.i18n("%MODULENAME%/ACTION_DOWNLOAD_PDF"),CssClass:"pdf",Handler:function(){if(this.currentMessage()){var e=this.currentMessage().getDomText();t("img[data-x-src-cid]",e).each(function(){!function(e){try{var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),e.src=t.toDataURL("image/png")}catch(e){}}(this)}),s.send("%ModuleName%","GeneratePdfFile",{FileName:this.subject(),Html:e.html()},function(e){e.Result&&e.Result.Actions&&e.Result.Actions.download?i.downloadByUrl(e.Result.Actions.download.url):n.showErrorByCode(e,r.i18n("%MODULENAME%/ERROR_CREATING_PDF"))},this)}}})})}}:null};