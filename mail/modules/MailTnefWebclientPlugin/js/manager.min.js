"use strict";module.exports=function(e){var i=require("%PathToCoreWebclientModule%/js/App.js");if(i.isUserNormalOrTenant()){var s=require("underscore"),t=require("knockout"),n=require("%PathToCoreWebclientModule%/js/utils/Text.js"),a=require("%PathToCoreWebclientModule%/js/utils/Types.js"),l=require("%PathToCoreWebclientModule%/js/Ajax.js");return{start:function(e){i.subscribeEvent("MailWebclient::ParseFile::after",function(e){if(e&&s.isFunction(e.addAction)&&"dat"===e.extension()){e.mailtnefSubFilesLoaded=t.observable(!1),e.mailtnefSubFilesLoading=t.observable(!1),e.mailtnefExpandFile=function(){this.mailtnefSubFilesLoaded()||this.mailtnefSubFilesLoading()?this.subFilesExpanded(!0):(this.mailtnefSubFilesLoading(!0),l.send("%ModuleName%","ExpandFile",{Hash:this.hash()},function(i){this.mailtnefSubFilesLoading(!1),i.Result&&(this.subFiles([]),a.isNonEmptyArray(i.Result)&&s.each(i.Result,s.bind(function(i){var s=e.getNewInstance();s.parse(i),this.subFiles.push(s)},this)),this.mailtnefSubFilesLoaded(!0),this.subFilesExpanded(!0))},this))};var i={Text:t.computed(function(){return this.subFilesExpanded()?n.i18n("COREWEBCLIENT/ACTION_COLLAPSE_FILE"):this.mailtnefSubFilesLoading()?n.i18n("COREWEBCLIENT/INFO_LOADING"):n.i18n("COREWEBCLIENT/ACTION_EXPAND_FILE")},e),Handler:s.bind(function(){this.mailtnefSubFilesLoading()||(this.subFilesExpanded()?this.subFilesExpanded(!1):this.mailtnefExpandFile())},e)};e.addAction("expand",!0,i),e.removeAction("view")}})}}}return null};