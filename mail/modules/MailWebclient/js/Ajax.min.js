"use strict";var _=require("underscore"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js"),Settings=require("modules/%ModuleName%/js/Settings.js");Ajax.registerAbortRequestHandler(Settings.ServerModuleName,function(e,s){var t=e.Parameters,r=s.Parameters;switch(e.Method){case"MoveMessages":case"DeleteMessages":return"GetMessage"===s.Method||"GetMessages"===s.Method&&r.Folder===t.Folder;case"GetMessages":case"SetMessagesSeen":case"SetMessageFlagged":return"GetMessages"===s.Method&&r.Folder===t.Folder;case"SetAllMessagesSeen":return("GetMessages"===s.Method||"GetMessages"===s.Method)&&r.Folder===t.Folder;case"ClearFolder":return"GetRelevantFoldersInformation"===s.Method||"GetMessages"===s.Method&&r.Folder===t.Folder;case"GetRelevantFoldersInformation":return"GetRelevantFoldersInformation"===s.Method&&t.AccountID===r.AccountID;case"GetMessagesFlags":return"GetMessagesFlags"===s.Method}return!1}),module.exports={getOpenedRequest:function(e){Ajax.getOpenedRequest("Mail",e)},hasOpenedRequests:function(e){Ajax.hasOpenedRequests("Mail",e)},registerOnAllRequestsClosedHandler:Ajax.registerOnAllRequestsClosedHandler,send:function(e,s,t,r){var o=require("modules/%ModuleName%/js/Cache.js"),a="GetMessagesBodies"===e?1e5:void 0;s&&!s.AccountID&&(s.AccountID=o.currentAccountId()),Ajax.send(Settings.ServerModuleName,e,s,function(e,s){if(!e.Result&&4002===e.ErrorCode){var o=require("modules/%ModuleName%/js/AccountList.js"),a=Types.pInt(s.Parameters.AccountID);o.getAccount(a).passwordMightBeIncorrect(!0)}_.isFunction(t)&&t.apply(r,[e,s])},null,a)}};