"use strict";function GetMessagesLimitToStore(){return 8*Settings.MailsPerPage+700}function CMessagesDictionary(){this.oMessages={},setInterval(this.checkAndClear.bind(this),6e4*CHECK_AND_CLEAR_DICT_EVERY_MINUTES)}var CHECK_AND_CLEAR_DICT_EVERY_MINUTES=30,DESTROY_NOT_USED_LAST_HOURS=4,_=require("underscore"),moment=require("moment"),Utils=require("%PathToCoreWebclientModule%/js/utils/Common.js"),Settings=require("modules/%ModuleName%/js/Settings.js"),MailCache=null;CMessagesDictionary.prototype.get=function(e){var s=JSON.stringify(e);return this.oMessages[s]},CMessagesDictionary.prototype.set=function(e,s){var t=JSON.stringify(e);this.oMessages[t]=s},CMessagesDictionary.prototype.requireMailCache=function(){null===MailCache&&(MailCache=require("modules/%ModuleName%/js/Cache.js"))},CMessagesDictionary.prototype.checkAndClear=function(){this.requireMailCache();var e=MailCache.getCurrentFolder();if(!e&&MailCache.folderList()&&(e=MailCache.folderList().inboxFolder()),e&&!(moment().diff(e.oRelevantInformationLastMoment)>6e4*CHECK_AND_CLEAR_DICT_EVERY_MINUTES)){var s=_.size(this.oMessages),t=moment().add(-DESTROY_NOT_USED_LAST_HOURS,"hours").unix(),i=GetMessagesLimitToStore();s>i&&(Utils.log("checkAndClear",s,Settings.MailsPerPage,i),_.each(MailCache.messages(),function(e){e.updateLastAccessTime()}),MailCache.currentMessage()&&MailCache.currentMessage().updateLastAccessTime(),_.each(this.oMessages,function(e,s){0!==e.iLastAccessTime&&e.iLastAccessTime<t&&Utils.destroyObjectWithObservables(this.oMessages,s)}.bind(this)),Utils.log("checkAndClear",_.size(this.oMessages)))}},CMessagesDictionary.prototype.remove=function(e){var s=JSON.stringify(e);Utils.destroyObjectWithObservables(this.oMessages,s)},CMessagesDictionary.prototype.updateMomentDates=function(){_.each(this.oMessages,function(e){e.updateMomentDate()},this)},module.exports=new CMessagesDictionary;