"use strict";function AddQuotaSettingsView(e,s,t){e.AllowChangeMailQuotaOnMailServer&&s.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){require.ensure(["modules/%ModuleName%/js/views/settings/MailQuotaAdminSettingsFormView.js"],function(){e(require("modules/%ModuleName%/js/views/settings/MailQuotaAdminSettingsFormView.js"))},"admin-bundle")},e.HashModuleName+"-quota",t.i18n("%MODULENAME%/LABEL_SETTINGS_TAB")])}module.exports=function(e){require("modules/%ModuleName%/js/enums.js");var s=require("underscore"),t=require("knockout"),n=require("%PathToCoreWebclientModule%/js/utils/Text.js"),o=require("%PathToCoreWebclientModule%/js/App.js"),r=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),i=require("modules/%ModuleName%/js/Settings.js"),u=o.getUserRole()===Enums.UserRole.SuperAdmin,l=null,a=null,d=null;if(i.init(e),!r.isModuleAvailable(i.ServerModuleName))return null;if(l=require("modules/MailWebclient/js/AccountList.js"),u)return{start:function(e){e.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){require.ensure(["modules/%ModuleName%/js/views/settings/ServersAdminSettingsPaneView.js"],function(){e(require("modules/%ModuleName%/js/views/settings/ServersAdminSettingsPaneView.js"))},"admin-bundle")},i.HashModuleName+"-servers",n.i18n("%MODULENAME%/LABEL_SERVERS_SETTINGS_TAB")]),e.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){require.ensure(["modules/%ModuleName%/js/views/settings/MailAdminSettingsFormView.js"],function(){e(require("modules/%ModuleName%/js/views/settings/MailAdminSettingsFormView.js"))},"admin-bundle")},i.HashModuleName,n.i18n("%MODULENAME%/LABEL_SETTINGS_TAB")]),AddQuotaSettingsView(i,e,n)},getAccountList:function(){return l},disableEditDomainsInServer:function(){i.disableEditDomainsInServer()}};if(o.isUserNormalOrTenant()){var m=require("modules/%ModuleName%/js/Cache.js");if(m.init(),o.isNewTab()){var c=function(){if(null===a){var e=require("modules/%ModuleName%/js/views/CComposeView.js");a=new e}return a};return{start:function(){require("modules/%ModuleName%/js/koBindings.js")},getScreens:function(){var e={};return e[i.HashModuleName+"-view"]=function(){return require("modules/%ModuleName%/js/views/MessagePaneView.js")},e[i.HashModuleName+"-compose"]=function(){return c()},e},registerComposeToolbarController:function(e){c().registerToolbarController(e)},getComposeMessageWithData:function(){return require("modules/%ModuleName%/js/utils/Compose.js").composeMessageWithData},getComposeMessageToAddresses:function(){return require("modules/%ModuleName%/js/utils/Compose.js").composeMessageToAddresses},getComposeMessageWithAttachments:function(){return require("modules/%ModuleName%/js/utils/Compose.js").composeMessageWithAttachments},getSearchMessagesInCurrentFolder:function(){var e=window.opener&&window.opener.MainTabMailMethods;return!!e&&s.bind(e.searchMessagesInCurrentFolder,e)}}}var M={enableModule:t.observable(i.AllowAddAccounts||l.hasAccount()),getComposeMessageToAddresses:function(){return require("modules/%ModuleName%/js/utils/Compose.js").composeMessageToAddresses},getComposeMessageWithData:function(){return require("modules/%ModuleName%/js/utils/Compose.js").composeMessageWithData},getComposeMessageWithAttachments:function(){return require("modules/%ModuleName%/js/utils/Compose.js").composeMessageWithAttachments},getPrefetcher:function(){return require("modules/%ModuleName%/js/Prefetcher.js")},registerComposeToolbarController:function(e){require("modules/%ModuleName%/js/popups/ComposePopup.js").registerToolbarController(e)},getSearchMessagesInInbox:function(){return s.bind(m.searchMessagesInInbox,m)},getFolderHash:function(e){return m.getFolderHash(e)},getSearchMessagesInCurrentFolder:function(){return s.bind(m.searchMessagesInCurrentFolder,m)},getAllAccountsFullEmails:function(){return l.getAllFullEmails()},getAccountList:function(){return l},setCustomRouting:function(e,s,t,n,o,r){var u=require("%PathToCoreWebclientModule%/js/Routing.js"),l=require("modules/%ModuleName%/js/utils/Links.js");u.setHash(l.getMailbox(e,s,t,n,o,i.MessagesSortBy.DefaultSortBy,i.MessagesSortBy.DefaultSortOrder,r))}};return o.isMobile()||(M=s.extend(M,{start:function(e){var n=require("%PathToCoreWebclientModule%/js/utils/Text.js"),r=require("%PathToCoreWebclientModule%/js/Browser.js"),u=require("modules/%ModuleName%/js/utils/Mail.js");if(require("modules/%ModuleName%/js/koBindings.js"),require("modules/%ModuleName%/js/koBindingSearchHighlighter.js"),i.AllowAppRegisterMailto&&u.registerMailto(r.firefox),i.AllowAddAccounts||l.hasAccount()){e.run("SettingsWebclient","registerSettingsTab",[function(){return require("modules/%ModuleName%/js/views/settings/MailSettingsFormView.js")},i.HashModuleName,n.i18n("%MODULENAME%/LABEL_SETTINGS_TAB")]);var a=i.AllowMultiAccounts?n.i18n("%MODULENAME%/LABEL_ACCOUNTS_SETTINGS_TAB"):n.i18n("%MODULENAME%/LABEL_ACCOUNT_SETTINGS_TAB");e.run("SettingsWebclient","registerSettingsTab",[function(){return require("modules/%ModuleName%/js/views/settings/AccountsSettingsPaneView.js")},i.HashModuleName+"-accounts",a])}t.computed(function(){var e=s.filter(l.collection(),function(e){return e.useToAuthorize()}),t=s.map(e,function(e){return e.email()});i.userMailAccountsCount(e.length),i.mailAccountsEmails(t)},this),o.getUserRole()===Enums.UserRole.TenantAdmin&&AddQuotaSettingsView(i,e,n)},getScreens:function(){var e={};return e[i.HashModuleName]=function(){return new(require("modules/%ModuleName%/js/views/CMailView.js"))},e},getHeaderItem:function(){return null===d&&(d=require("modules/%ModuleName%/js/views/HeaderItemView.js")),{item:d,name:i.HashModuleName}},getMobileSyncSettingsView:function(){return require("modules/%ModuleName%/js/views/DefaultAccountHostsSettingsView.js")}})),M}return null};