"use strict";function CAccountModel(e){App=require("%PathToCoreWebclientModule%/js/App.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),this.id=ko.observable(Types.pInt(e.AccountID)),this.email=ko.observable(Types.pString(e.Email)),this.friendlyName=ko.observable(Types.pString(e.FriendlyName)),this.incomingLogin=ko.observable(Types.pString(e.IncomingLogin)),this.passwordMightBeIncorrect=ko.observable(!1),this.passwordMightBeIncorrect.subscribe(function(){this.passwordMightBeIncorrect()||(this.requireCache(),Cache.getFolderList(this.id()))},this),this.signature=ko.observable(Types.pString(e.Signature)),this.useSignature=ko.observable(!!e.UseSignature),this.serverId=ko.observable(Types.pInt(e.ServerId)),this.oServer=new CServerModel(e.Server),this.useToAuthorize=ko.observable(!!e.UseToAuthorize),this.canBeUsedToAuthorize=ko.observable(!!e.CanBeUsedToAuthorize),this.useThreading=ko.observable(!!e.UseThreading),this.useThreading.subscribe(function(){this.requireCache(),Cache.clearMessagesCache(this.id())},this),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder,this.isCurrent=ko.observable(!1),this.isEdited=ko.observable(!1),this.hash=ko.computed(function(){return Utils.getHash(this.id()+this.email())},this),this.fetchers=ko.observableArray([]),this.identities=ko.observable(null),this.allowAutoresponder=ko.observable(Types.pBool(e.AllowAutoresponder,!1)),this.autoresponder=ko.observable(null),this.allowForward=ko.observable(Types.pBool(e.AllowForward,!1)),this.forward=ko.observable(null),this.allowFilters=ko.observable(Types.pBool(e.AllowFilters,!1)),this.filters=ko.observable(null),this.quota=ko.observable(0),this.usedSpace=ko.observable(0),this.quotaRecieved=ko.observable(!1),this.fullEmail=ko.computed(function(){return AddressUtils.getFullEmail(this.friendlyName(),this.email())},this),this.bDefault=Settings.AllowDefaultAccountForUser&&this.email()===App.getUserPublicId(),this.aExtend=Types.pObject(e.Extend)}var _=require("underscore"),ko=require("knockout"),AddressUtils=require("%PathToCoreWebclientModule%/js/utils/Address.js"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Utils=require("%PathToCoreWebclientModule%/js/utils/Common.js"),Ajax=null,Api=require("%PathToCoreWebclientModule%/js/Api.js"),App=null,UserSettings=require("%PathToCoreWebclientModule%/js/Settings.js"),Popups=require("%PathToCoreWebclientModule%/js/Popups.js"),ConfirmPopup=require("%PathToCoreWebclientModule%/js/popups/ConfirmPopup.js"),CFiltersModel=require("modules/%ModuleName%/js/models/CFiltersModel.js"),CServerModel=require("modules/%ModuleName%/js/models/CServerModel.js"),AccountList=null,Cache=null,Settings=require("modules/%ModuleName%/js/Settings.js");CAccountModel.prototype.threadingIsAvailable=function(){return this.oServer.bEnableThreading&&this.useThreading()},CAccountModel.prototype.updateFromServer=function(e){this.email(Types.pString(e.Email)),this.friendlyName(Types.pString(e.FriendlyName)),this.incomingLogin(Types.pString(e.IncomingLogin)),this.serverId(Types.pInt(e.ServerId)),this.oServer=new CServerModel(e.Server),this.useToAuthorize(!!e.UseToAuthorize),this.useThreading(!!e.UseThreading),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder},CAccountModel.prototype.requireAccounts=function(){null===AccountList&&(AccountList=require("modules/%ModuleName%/js/AccountList.js"))},CAccountModel.prototype.requireCache=function(){null===Cache&&(Cache=require("modules/%ModuleName%/js/Cache.js"))},CAccountModel.prototype.onGetQuotaResponse=function(e,t){_.isArray(e.Result)&&1<e.Result.length&&(this.quota(Types.pInt(e.Result[1])),this.usedSpace(Types.pInt(e.Result[0])),this.requireCache(),Cache.quotaChangeTrigger(!Cache.quotaChangeTrigger())),this.quotaRecieved(!0)},CAccountModel.prototype.updateQuotaParams=function(){UserSettings.ShowQuotaBar&&Ajax.send("GetQuota",{AccountID:this.id()},this.onGetQuotaResponse,this)},CAccountModel.prototype.updateFriendlyName=function(e){this.friendlyName(e)},CAccountModel.prototype.changeAccount=function(){this.requireAccounts(),AccountList.changeCurrentAccount(this.id(),!0)},CAccountModel.prototype.getDefaultIdentity=function(){return _.find(this.identities()||[],function(e){return e.isDefault()})},CAccountModel.prototype.getFetchersIdentitiesEmails=function(){var e=this.identities()||[],t=[];return _.each(this.fetchers(),function(e){t.push(e.email())}),_.each(e,function(e){t.push(e.email())}),t},CAccountModel.prototype.remove=function(){var e=_.bind(this.confirmedRemove,this);this.bDefault||Popups.showPopup(ConfirmPopup,[TextUtils.i18n("%MODULENAME%/CONFIRM_REMOVE_ACCOUNT"),e,this.email()])},CAccountModel.prototype.confirmedRemove=function(e){e&&Ajax.send("DeleteAccount",{AccountID:this.id()},this.onAccountDeleteResponse,this)},CAccountModel.prototype.onAccountDeleteResponse=function(e,t){if(e.Result){var o=require("modules/%ModuleName%/js/utils/Compose.js");_.isFunction(o.closeComposePopup)&&o.closeComposePopup(),this.requireAccounts(),AccountList.deleteAccount(this.id())}else Api.showErrorByCode(e,TextUtils.i18n("%MODULENAME%/ERROR_REMOVE_ACCOUNT"))},CAccountModel.prototype.requestFilters=function(){Ajax.send("GetFilters",{AccountID:this.id()},this.onGetFiltersResponse,this)},CAccountModel.prototype.onGetFiltersResponse=function(e,t){var o=new CFiltersModel;e.Result&&o.parse(this.id(),e.Result),this.filters(o)},module.exports=CAccountModel;