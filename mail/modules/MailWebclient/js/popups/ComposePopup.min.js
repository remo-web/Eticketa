"use strict";function CComposePopup(){CAbstractPopup.call(this),CComposeView.call(this),this.minimized=ko.observable(!1),this.fPreventBackspace=function(e){var o=e.which===$.ui.keyCode.BACKSPACE,t="INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName,s="DIV"===e.target.tagName&&"true"===$(e.target).attr("contenteditable");!o||t||s||(e.preventDefault(),e.stopPropagation())},this.minimized.subscribe(function(){this.minimized()?this.preventBackspaceOff():this.shown()&&this.preventBackspaceOn()},this),this.minimizedTitle=ko.computed(function(){return this.subject()||TextUtils.i18n("%MODULENAME%/HEADING_MINIMIZED_NEW_MESSAGE")},this)}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Browser=require("%PathToCoreWebclientModule%/js/Browser.js"),Popups=require("%PathToCoreWebclientModule%/js/Popups.js"),CAbstractPopup=require("%PathToCoreWebclientModule%/js/popups/CAbstractPopup.js"),ConfirmAnotherMessageComposedPopup=require("modules/%ModuleName%/js/popups/ConfirmAnotherMessageComposedPopup.js"),CComposeView=require("modules/%ModuleName%/js/views/CComposeView.js");_.extendOwn(CComposePopup.prototype,CAbstractPopup.prototype),_.extendOwn(CComposePopup.prototype,CComposeView.prototype),CComposePopup.prototype.PopupTemplate="%ModuleName%_ComposePopup",CComposePopup.prototype.preventBackspaceOn=function(){$(document).on("keydown",this.fPreventBackspace)},CComposePopup.prototype.preventBackspaceOff=function(){$(document).off("keydown",this.fPreventBackspace)},CComposePopup.prototype.onClose=function(){this.preventBackspaceOff()},CComposePopup.prototype.onOpen=function(e){if(1===(e=e||[]).length&&"close"===e[0])this.closePopup();else{var o=3===e.length&&"drafts"===e[0]&&e[2]===this.draftUid(),t=this.minimized();this.maximize(),this.shown()||t?(e.length>0&&!o?this.hasUnsavedChanges()?(this.disableAutosave(!0),Popups.showPopup(ConfirmAnotherMessageComposedPopup,[_.bind(function(o){switch(o){case Enums.AnotherMessageComposedAnswer.Discard:this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.SaveAsDraft:this.hasUnsavedChanges()&&this.executeSave(!0,!1),this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.Cancel:}this.disableAutosave(!1)},this)])):this.onRoute(e):t||this.onRoute(e),this.oHtmlEditor.clearUndoRedo()):this.onRoute(e),this.preventBackspaceOn()}},CComposePopup.prototype.minimize=function(){this.minimized(!0),this.$popupDom.addClass("minimized")},CComposePopup.prototype.maximize=function(){this.minimized(!1),this.$popupDom.removeClass("minimized")},CComposePopup.prototype.saveAndClose=function(){this.hasUnsavedChanges()&&this.saveCommand(),this.closePopup()},CComposePopup.prototype.cancelPopup=function(){this.hasUnsavedChanges()?this.minimize():this.closePopup()},CComposePopup.prototype.onEscHandler=function(e){var o=this.oHtmlEditor.hasOpenedPopup(),t=!Browser.ie&&e.target&&"input"===e.target.tagName.toLowerCase()&&"file"===e.target.type.toLowerCase();t&&e.target.blur(),!Popups.hasOnlyOneOpenedPopup()||o||t||this.minimize(),o&&this.oHtmlEditor.closeAllPopups()},module.exports=new CComposePopup;