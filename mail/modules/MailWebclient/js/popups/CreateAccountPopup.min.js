"use strict";function CCreateAccountPopup(){CAbstractPopup.call(this),this.loading=ko.observable(!1),this.friendlyName=ko.observable(""),this.email=ko.observable(""),this.email.focused=ko.observable(!1),this.incomingLogin=ko.observable(""),this.incomingLogin.focused=ko.observable(!1),this.incomingPassword=ko.observable(""),this.incomingPassword.focused=ko.observable(!1),this.oServerPairPropertiesView=new CServerPairPropertiesView("acc_create"),this.email.focused.subscribe(function(){this.email.focused()||""!==$.trim(this.incomingLogin())||this.incomingLogin(this.email())},this),this.aRequiredFields=[this.email,this.incomingLogin,this.incomingPassword].concat(this.oServerPairPropertiesView.aRequiredFields)}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),ValidationUtils=require("%PathToCoreWebclientModule%/js/utils/Validation.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),CAbstractPopup=require("%PathToCoreWebclientModule%/js/popups/CAbstractPopup.js"),AccountList=require("modules/%ModuleName%/js/AccountList.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),CAccountModel=require("modules/%ModuleName%/js/models/CAccountModel.js"),CServerPairPropertiesView=require("modules/%ModuleName%/js/views/settings/CServerPairPropertiesView.js");_.extendOwn(CCreateAccountPopup.prototype,CAbstractPopup.prototype),CCreateAccountPopup.prototype.PopupTemplate="%ModuleName%_Settings_CreateAccountPopup",CCreateAccountPopup.prototype.init=function(){this.friendlyName(""),this.email(""),this.incomingLogin(""),this.incomingLogin.focused(!1),this.incomingPassword(""),this.oServerPairPropertiesView.fullInit()},CCreateAccountPopup.prototype.onOpen=function(e,i,t,o){this.fCallback=e,this.init(),this.friendlyName(i),this.email(t),this.incomingLogin(t),this.incomingPassword(o),this.focusFieldToEdit()},CCreateAccountPopup.prototype.focusFieldToEdit=function(){var e=_.find(this.aRequiredFields,function(e){return""===e()});e?e.focused(!0):this.aRequiredFields.length>0&&this.aRequiredFields[0].focused(!0)},CCreateAccountPopup.prototype.onClose=function(){this.init()},CCreateAccountPopup.prototype.save=function(){if(ValidationUtils.checkIfFieldsEmpty(this.aRequiredFields,TextUtils.i18n("%MODULENAME%/ERROR_REQUIRED_FIELDS_EMPTY"))){var e={FriendlyName:this.friendlyName(),Email:$.trim(this.email()),IncomingLogin:$.trim(this.incomingLogin()),IncomingPassword:$.trim(this.incomingPassword()),Server:this.oServerPairPropertiesView.getParametersForSave()};this.loading(!0),Ajax.send("CreateAccount",e,this.onAccountCreateResponse,this)}else this.loading(!1)},CCreateAccountPopup.prototype.onAccountCreateResponse=function(e,i){if(this.loading(!1),e.Result){var t=Types.pInt(e.Result.AccountID),o=new CAccountModel(e.Result);AccountList.addAccount(o),AccountList.populateIdentities(),AccountList.changeEditedAccount(t),1===AccountList.collection().length&&AccountList.changeCurrentAccount(t),this.fCallback&&this.fCallback(t),this.closePopup()}else Api.showErrorByCode(e,TextUtils.i18n("%MODULENAME%/ERROR_CREATE_ACCOUNT"))},module.exports=new CCreateAccountPopup;