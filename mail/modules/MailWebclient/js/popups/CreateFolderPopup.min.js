"use strict";function CCreateFolderPopup(){CAbstractPopup.call(this),this.isCreating=ko.observable(!1),MailCache.folderListLoading.subscribe(function(){!(-1!==MailCache.folderListLoading.indexOf(MailCache.editedFolderList().iAccountId))&&this.isCreating()&&($.isFunction(this.fCallback)&&this.fCallback(this.folderName(),this.parentFolder()),this.isCreating(!1),this.closePopup())},this),this.options=ko.observableArray([]),this.parentFolder=ko.observable(""),this.folderName=ko.observable(""),this.folderNameFocus=ko.observable(!1),this.fCallback=null,this.defaultOptionsAfterRender=Utils.defaultOptionsAfterRender}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Utils=require("%PathToCoreWebclientModule%/js/utils/Common.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),CAbstractPopup=require("%PathToCoreWebclientModule%/js/popups/CAbstractPopup.js"),AccountList=require("modules/%ModuleName%/js/AccountList.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),MailCache=require("modules/%ModuleName%/js/Cache.js");_.extendOwn(CCreateFolderPopup.prototype,CAbstractPopup.prototype),CCreateFolderPopup.prototype.PopupTemplate="%ModuleName%_Settings_CreateFolderPopup",CCreateFolderPopup.prototype.onOpen=function(e){this.options(MailCache.editedFolderList().getOptions(TextUtils.i18n("%MODULENAME%/LABEL_NO_PARENT_FOLDER"),!0,!1,!0)),this.fCallback=e,this.folderName(""),this.folderNameFocus(!0)},CCreateFolderPopup.prototype.create=function(){var e=""===this.parentFolder()?MailCache.editedFolderList().sNamespaceFolder:this.parentFolder(),t={AccountID:AccountList.editedId(),FolderNameInUtf8:this.folderName(),FolderParentFullNameRaw:e,Delimiter:MailCache.editedFolderList().sDelimiter};this.folderNameFocus(!1),this.isCreating(!0),Ajax.send("CreateFolder",t,this.onCreateFolderResponse,this)},CCreateFolderPopup.prototype.onCreateFolderResponse=function(e,t){e.Result?MailCache.getFolderList(AccountList.editedId()):(this.isCreating(!1),Api.showErrorByCode(e,TextUtils.i18n("%MODULENAME%/ERROR_CREATE_FOLDER")))},CCreateFolderPopup.prototype.cancelPopup=function(){this.isCreating()||($.isFunction(this.fCallback)&&this.fCallback("",""),this.closePopup())},module.exports=new CCreateFolderPopup;