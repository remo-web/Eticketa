"use strict";var _=require("underscore"),$=require("jquery"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),MessageUtils={};MessageUtils.showInlinePictures=function(t,e,i,r){var n=function(t){return _.find(e,function(e){return e.CID===t})};"string"!=typeof r&&(r=""),i.length>0&&($("[data-x-src-cid]",t).each(function(){var t=$(this).attr("data-x-src-cid"),e=n(t);e&&e.ViewLink.length>0&&$(this).attr("src",r+e.ViewLink)}),$("[data-x-style-cid]",t).each(function(){var t="",e=$(this).attr("data-x-style-cid-name"),i=$(this).attr("data-x-style-cid"),r=n(i);r&&r.ViewLink.length>0&&""!==e&&(t=""===(t=$.trim($(this).attr("style")))?"":";"===t.substr(-1)?t+" ":t+"; ",$(this).attr("style",t+e+": url('"+r.ViewLink+"')"))})),$("[data-x-src-location]",t).each(function(){var t=$(this).attr("data-x-src-location"),i=function(t){return _.find(e,function(e){return e.ContentLocation===t})}(t);i||(i=n(t)),i&&i.ViewLink.length>0&&$(this).attr("src",r+i.ViewLink)})},MessageUtils.showExternalPictures=function(t){$("[data-x-src]",t).each(function(){$(this).attr("src",$(this).attr("data-x-src")).removeAttr("data-x-src")}),$("[data-x-style-url]",t).each(function(){var t=$.trim($(this).attr("style"));t=""===t?"":";"===t.substr(-1)?t+" ":t+"; ",$(this).attr("style",t+$(this).attr("data-x-style-url")).removeAttr("data-x-style-url")})},MessageUtils.joinReplyPrefixesInSubject=function(t,e,i){var r=[e.toUpperCase()],n=[i.toUpperCase()],s=_.union(r,n).join("|"),a="",c=t.split(":"),o=[],u="";return _.each(c,function(t){if(0===u.length){var a=$.trim(t.toUpperCase()),c=-1!==_.indexOf(r,a),l=-1!==_.indexOf(n,a),h=1,f=o.length>0?o[o.length-1]:null;if(!c&&!l){var d=new window.RegExp("^\\s?("+s+")\\s?[\\[\\(]([\\d]+)[\\]\\)]$","gi").exec(a);d&&3===d.length&&(c=-1!==_.indexOf(r,d[1].toUpperCase()),l=-1!==_.indexOf(n,d[1].toUpperCase()),h=Types.pInt(d[2]))}c?f&&f.prefix===e?f.count+=h:o.push({prefix:e,count:h}):l?f&&f.prefix===i?f.count+=h:o.push({prefix:i,count:h}):u=t}else u+=":"+t}),_.each(o,function(t){1===t.count?a+=t.prefix+": ":a+=t.prefix+"["+t.count+"]: "}),a+=$.trim(u)},module.exports=MessageUtils;