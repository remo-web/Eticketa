!function(e){if("function"==typeof define&&define.amd)define(["knockout","jquery","jquery-ui/ui/widgets/sortable","jquery-ui/ui/widgets/draggable","jquery-ui/ui/widgets/droppable"],e);else if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var t=require("knockout"),n=require("jquery");require("jquery-ui/ui/widgets/sortable"),require("jquery-ui/ui/widgets/draggable"),require("jquery-ui/ui/widgets/droppable"),e(t,n)}else e(window.ko,window.jQuery)}(function(e,t){var n="ko_sortItem",o=e.utils.unwrapObservable,i=e.utils.domData.get,a=e.utils.domData.set,r=t.ui&&t.ui.version,s=r&&r.indexOf("1.6.")&&r.indexOf("1.7.")&&(r.indexOf("1.8.")||"1.8.24"===r),d=function(t,o){e.utils.arrayForEach(t,function(e){1===e.nodeType&&(a(e,n,o),a(e,"ko_parentList",i(e.parentNode,"ko_sortList")))})},l=function(t,n){var i,a={},r=o(t())||{};return r.data?(a[n]=r.data,a.name=r.template):a[n]=t(),e.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions","nodes"],function(t){r.hasOwnProperty(t)?a[t]=r[t]:e.bindingHandlers.sortable.hasOwnProperty(t)&&(a[t]=e.bindingHandlers.sortable[t])}),"foreach"===n&&(a.afterRender?(i=a.afterRender,a.afterRender=function(e,t){d.call(t,e,t),i.call(t,e,t)}):a.afterRender=d),a},u=function(e,t){var n=o(t);if(n)for(var i=0;i<e;i++)n[i]&&o(n[i]._destroy)&&e++;return e};e.bindingHandlers.sortable={init:function(r,d,c,p,f){var b,g,m=t(r),v=o(d())||{},h=l(d,"foreach"),y={};!function(n,o){var i,a;o?(a=document.getElementById(o))&&(i=new e.templateSources.domElement(a)).text(t.trim(i.text())):t(n).contents().each(function(){this&&1!==this.nodeType&&n.removeChild(this)})}(r,h.name),t.extend(!0,y,e.bindingHandlers.sortable),v.options&&y.options&&(e.utils.extend(y.options,v.options),delete v.options),e.utils.extend(y,v),y.connectClass&&(e.isObservable(y.allowDrop)||"function"==typeof y.allowDrop)?e.computed({read:function(){var t=o(y.allowDrop),n="function"==typeof t?t.call(this,h.foreach):t;e.utils.toggleDomNodeCssClass(r,y.connectClass,n)},disposeWhenNodeIsRemoved:r},this):e.utils.toggleDomNodeCssClass(r,y.connectClass,y.allowDrop),e.bindingHandlers.template.init(r,function(){return h},c,p,f),b=y.options.start,g=y.options.update,y.options.helper||(y.options.helper=function(e,n){return n.is("tr")&&n.children().each(function(){t(this).width(t(this).width())}),n});var D=setTimeout(function(){var d,l=y.options.receive;m.sortable(e.utils.extend(y.options,{start:function(t,n){var o=n.item[0];a(o,"ko_sourceIndex",e.utils.arrayIndexOf(n.item.parent().children(),o)),n.item.find("input:focus").change(),b&&b.apply(this,arguments)},receive:function(e,t){"function"==typeof l&&l.call(this,e,t),(d=i(t.item[0],"ko_dragItem"))&&(d.clone&&(d=d.clone()),y.dragged&&(d=y.dragged.call(this,d,e,t)||d))},update:function(r,l){var c,p,f,b,m,v=l.item[0],D=l.item.parent()[0],w=i(v,n)||d;if(w||t(v).remove(),d=null,w&&this===D||!s&&t.contains(this,D)){if(c=i(v,"ko_parentList"),f=i(v,"ko_sourceIndex"),p=i(v.parentNode,"ko_sortList"),b=e.utils.arrayIndexOf(l.item.parent().children(),v),h.includeDestroyed||(f=u(f,c),b=u(b,p)),(y.beforeMove||y.afterMove)&&(m={item:w,sourceParent:c,sourceParentNode:c&&l.sender||v.parentNode,sourceIndex:f,targetParent:p,targetIndex:b,cancelDrop:!1},y.beforeMove&&y.beforeMove.call(this,m,r,l)),c?t(c===p?this:l.sender||this).sortable("cancel"):t(v).remove(),m&&m.cancelDrop)return;if(y.hasOwnProperty("strategyMove")&&!1!==y.strategyMove){if(b>=0)if(c)if(c!==p)c.splice(f,1),p.splice(b,0,w),a(v,n,null),l.item.remove();else{var k=o(c);c.valueWillMutate&&c.valueWillMutate(),k.splice(f,1),k.splice(b,0,w),c.valueHasMutated&&c.valueHasMutated()}else p.splice(b,0,w),a(v,n,null),l.item.remove()}else b>=0&&(c&&(c.splice(f,1),e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),e.options&&e.options.deferUpdates&&e.tasks.runEarly()),p.splice(b,0,w)),a(v,n,null);e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),y.afterMove&&y.afterMove.call(this,m,r,l)}g&&g.apply(this,arguments)},connectWith:!!y.connectClass&&"."+y.connectClass})),void 0!==y.isEnabled&&e.computed({read:function(){m.sortable(o(y.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:r})},0);return e.utils.domNodeDisposal.addDisposeCallback(r,function(){(m.data("ui-sortable")||m.data("sortable"))&&m.sortable("destroy"),e.utils.toggleDomNodeCssClass(r,y.connectClass,!1),clearTimeout(D)}),{controlsDescendantBindings:!0}},update:function(t,n,o,i,r){var s=l(n,"foreach");a(t,"ko_sortList",s.foreach),e.bindingHandlers.template.update(t,function(){return s},o,i,r)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}},e.bindingHandlers.draggable={init:function(n,i,r,s,d){var u=o(i())||{},c=u.options||{},p=e.utils.extend({},e.bindingHandlers.draggable.options),f=l(i,"data"),b=u.connectClass||e.bindingHandlers.draggable.connectClass,g=void 0!==u.isEnabled?u.isEnabled:e.bindingHandlers.draggable.isEnabled;return u="data"in u?u.data:u,a(n,"ko_dragItem",u),e.utils.extend(p,c),p.connectToSortable=!!b&&"."+b,t(n).draggable(p),void 0!==g&&e.computed({read:function(){t(n).draggable(o(g)?"enable":"disable")},disposeWhenNodeIsRemoved:n}),e.utils.domNodeDisposal.addDisposeCallback(n,function(){t(n).draggable("destroy")}),e.bindingHandlers.template.init(n,function(){return f},r,s,d)},update:function(t,n,o,i,a){var r=l(n,"data");return e.bindingHandlers.template.update(t,function(){return r},o,i,a)},connectClass:e.bindingHandlers.sortable.connectClass,options:{helper:"clone"}},e.bindingHandlers.droppable={init:function(a,r,s,d,l){var u=o(r())||{},c=u.options||{},p=e.utils.extend({},e.bindingHandlers.droppable.options),f=void 0!==u.isEnabled?u.isEnabled:e.bindingHandlers.droppable.isEnabled;e.utils.extend(p,c),u="data"in u?u.data:r(),p.drop=function(e,t){var o=i(t.draggable[0],"ko_dragItem")||i(t.draggable[0],n);u(o)},t(a).droppable(p),void 0!==f&&e.computed({read:function(){t(a).droppable(o(f)?"enable":"disable")},disposeWhenNodeIsRemoved:a}),e.utils.domNodeDisposal.addDisposeCallback(a,function(){t(a).droppable("destroy")})},options:{accept:"*"}}});