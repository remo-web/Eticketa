"use strict";function CAccountFoldersPaneView(){this.bAllowTemplateFolders=Settings.AllowTemplateFolders,this.highlighted=ko.observable(!1).extend({autoResetToFalse:500}),this.collection=ko.observableArray(MailCache.editedFolderList().collection()),this.oCollSubscription=MailCache.editedFolderList().collection.subscribe(function(e){this.collection(e)},this),this.totalMessageCount=ko.observable(0),this.enableButtons=ko.computed(function(){return MailCache.editedFolderList().initialized()},this),MailCache.editedFolderList.subscribe(function(e){this.collection(e.collection()),this.setTotalMessageCount(),this.oCollSubscription.dispose(),this.oCollSubscription=e.collection.subscribe(function(e){this.collection(e)},this)},this),this.addNewFolderCommand=Utils.createCommand(this,this.addNewFolder,this.enableButtons),this.setSystemFoldersCommand=Utils.createCommand(this,this.setSystemFolders,this.enableButtons),this.showMovedWithMouseItem=ko.computed(function(){return!App.isMobile()},this),this.allowImportExport=ko.observable(ModulesManager.isModuleEnabled("ImportExportMailPlugin")),App.subscribeEvent("%ModuleName%::AttemptDeleteNonemptyFolder",_.bind(function(){this.highlighted(!0)},this)),App.broadcastEvent("%ModuleName%::ConstructView::after",{Name:"CAccountFoldersPaneView",View:this}),this.afterMove=_.debounce(_.bind(this.folderListOrderUpdate,this),3e3)}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Utils=require("%PathToCoreWebclientModule%/js/utils/Common.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),App=require("%PathToCoreWebclientModule%/js/App.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),Popups=require("%PathToCoreWebclientModule%/js/Popups.js"),CreateFolderPopup=require("modules/%ModuleName%/js/popups/CreateFolderPopup.js"),SetSystemFoldersPopup=require("modules/%ModuleName%/js/popups/SetSystemFoldersPopup.js"),ImportExportPopup=ModulesManager.run("ImportExportMailPlugin","getImportExportPopup"),AccountList=require("modules/%ModuleName%/js/AccountList.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),MailCache=require("modules/%ModuleName%/js/Cache.js"),Settings=require("modules/%ModuleName%/js/Settings.js");require("modules/%ModuleName%/js/vendors/knockout-sortable.js"),CAccountFoldersPaneView.prototype.ViewTemplate="%ModuleName%_Settings_AccountFoldersPaneView",CAccountFoldersPaneView.prototype.folderListOrderUpdate=function(){var e=MailCache.editedFolderList().repopulateLinedCollection(),o={AccountID:AccountList.editedId(),FolderList:_.compact(_.map(e,function(e){if(!e.bVirtual)return e.fullName()}))};Ajax.send("UpdateFoldersOrder",o,function(e){e.Result||(Api.showErrorByCode(e,TextUtils.i18n("%MODULENAME%/ERROR_CHANGE_FOLDERS_ORDER")),MailCache.getFolderList(AccountList.editedId()))},this)},CAccountFoldersPaneView.prototype.hide=function(e){var o=AccountList.editedId();_.delay(function(){MailCache.getFolderList(o)},3e3),$.isFunction(e)&&e()},CAccountFoldersPaneView.prototype.show=function(){this.setTotalMessageCount()},CAccountFoldersPaneView.prototype.setTotalMessageCount=function(){var e=MailCache.editedFolderList();0===e.iAccountId?this.totalMessageCount(0):(this.totalMessageCount(e.getTotalMessageCount()),e.countsCompletelyFilled()||(e.countsCompletelyFilledSubscribtion&&(e.countsCompletelyFilledSubscribtion.dispose(),e.countsCompletelyFilledSubscribtion=null),e.countsCompletelyFilledSubscribtion=e.countsCompletelyFilled.subscribe(function(){e.countsCompletelyFilled()&&(this.totalMessageCount(e.getTotalMessageCount()),e.countsCompletelyFilledSubscribtion.dispose(),e.countsCompletelyFilledSubscribtion=null)},this)))},CAccountFoldersPaneView.prototype.addNewFolder=function(){Popups.showPopup(CreateFolderPopup)},CAccountFoldersPaneView.prototype.setSystemFolders=function(){Popups.showPopup(SetSystemFoldersPopup)},CAccountFoldersPaneView.prototype.importExport=function(){this.allowImportExport()&&Popups.showPopup(ImportExportPopup,[{}])},module.exports=new CAccountFoldersPaneView;