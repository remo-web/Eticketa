"use strict";function CAccountForwardSettingsFormView(){CAbstractSettingsFormView.call(this,Settings.ServerModuleName),this.enable=ko.observable(!1),this.email=ko.observable(""),this.email.focused=ko.observable(!1),AccountList.editedId.subscribe(function(){this.bShown&&this.populate()},this)}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),AddressUtils=require("%PathToCoreWebclientModule%/js/utils/Address.js"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),CAbstractSettingsFormView=ModulesManager.run("SettingsWebclient","getAbstractSettingsFormViewClass"),Popups=require("%PathToCoreWebclientModule%/js/Popups.js"),AlertPopup=require("%PathToCoreWebclientModule%/js/popups/AlertPopup.js"),AccountList=require("modules/%ModuleName%/js/AccountList.js"),Ajax=require("modules/%ModuleName%/js/Ajax.js"),Settings=require("modules/%ModuleName%/js/Settings.js"),CForwardModel=require("modules/%ModuleName%/js/models/CForwardModel.js");_.extendOwn(CAccountForwardSettingsFormView.prototype,CAbstractSettingsFormView.prototype),CAccountForwardSettingsFormView.prototype.ViewTemplate="%ModuleName%_Settings_AccountForwardSettingsFormView",CAccountForwardSettingsFormView.prototype.getCurrentValues=function(){return[this.enable(),this.email()]},CAccountForwardSettingsFormView.prototype.revert=function(){this.populate()},CAccountForwardSettingsFormView.prototype.getParametersForSave=function(){return{AccountID:AccountList.getEdited().id(),Enable:this.enable(),Email:$.trim(this.email())}},CAccountForwardSettingsFormView.prototype.applySavedValues=function(e){var t=AccountList.getEdited().forward();t&&(t.enable=e.Enable,t.email=e.Email)},CAccountForwardSettingsFormView.prototype.save=function(){var e=function(){this.isSaving(!0),this.updateSavedState(),Ajax.send("UpdateForward",this.getParametersForSave(),this.onResponse,this)}.bind(this),t=$.trim(this.email());this.enable()&&""===t?this.email.focused(!0):this.enable()&&""!==t?AddressUtils.isCorrectEmail(t)?e():Popups.showPopup(AlertPopup,[TextUtils.i18n("%MODULENAME%/ERROR_INPUT_CORRECT_EMAILS")+" "+t]):e()},CAccountForwardSettingsFormView.prototype.onResponse=function(e,t){if(this.isSaving(!1),!1===e.Result)Api.showErrorByCode(e,TextUtils.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"));else{var o=t.Parameters;this.applySavedValues(o),Screens.showReport(TextUtils.i18n("%MODULENAME%/REPORT_FORWARD_UPDATE_SUCCESS"))}},CAccountForwardSettingsFormView.prototype.populate=function(){var e=AccountList.getEdited(),t=e.forward()?e.forward():null;null!==t?(this.enable(t.enable),this.email(t.email)):Ajax.send("GetForward",{AccountID:e.id()},this.onGetForwardResponse,this),this.updateSavedState()},CAccountForwardSettingsFormView.prototype.onGetForwardResponse=function(e,t){if(e&&e.Result){var o=t.Parameters,r=Types.pInt(o.AccountID),s=AccountList.getAccount(r),i=new CForwardModel;s&&(i.parse(r,e.Result),s.forward(i),r===AccountList.editedId()&&this.populate())}},module.exports=new CAccountForwardSettingsFormView;