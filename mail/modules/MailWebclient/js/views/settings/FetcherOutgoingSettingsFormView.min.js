"use strict";function CFetcherOutgoingSettingsFormView(){CAbstractSettingsFormView.call(this,Settings.ServerModuleName),this.fetcher=ko.observable(null),this.idFetcher=ko.observable(null),this.isEnabled=ko.observable(!0),this.email=ko.observable(""),this.userName=ko.observable(""),this.isOutgoingEnabled=ko.observable(!1),this.focusEmail=ko.observable(!1),this.oOutgoing=new CServerPropertiesView(25,465,"fetcher_edit_outgoing",TextUtils.i18n("%MODULENAME%/LABEL_SMTP_SERVER")),this.outgoingUseAuth=ko.observable(!1),this.isAllEnabled=ko.computed(function(){return this.isEnabled()&&this.isOutgoingEnabled()},this),this.isAllEnabled.subscribe(function(){this.oOutgoing.isEnabled(this.isAllEnabled())},this),this.oOutgoing.isEnabled(this.isAllEnabled()),this.firstState=null}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Api=require("%PathToCoreWebclientModule%/js/Api.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),CoreAjax=require("%PathToCoreWebclientModule%/js/Ajax.js"),CAbstractSettingsFormView=ModulesManager.run("SettingsWebclient","getAbstractSettingsFormViewClass"),AccountList=require("modules/%ModuleName%/js/AccountList.js"),Settings=require("modules/%ModuleName%/js/Settings.js"),CServerPropertiesView=require("modules/%ModuleName%/js/views/CServerPropertiesView.js");_.extendOwn(CFetcherOutgoingSettingsFormView.prototype,CAbstractSettingsFormView.prototype),CFetcherOutgoingSettingsFormView.prototype.ViewTemplate="%ModuleName%_Settings_FetcherOutgoingSettingsFormView",CFetcherOutgoingSettingsFormView.prototype.onShow=function(e){this.fetcher(e&&e.FETCHER?e:null),this.populate()},CFetcherOutgoingSettingsFormView.prototype.getCurrentValues=function(){return[this.isOutgoingEnabled(),this.oOutgoing.server(),this.oOutgoing.port(),this.oOutgoing.ssl(),this.outgoingUseAuth(),this.userName(),this.email()]},CFetcherOutgoingSettingsFormView.prototype.getParametersForSave=function(){return this.fetcher()?{FetcherId:this.idFetcher(),IsOutgoingEnabled:this.isOutgoingEnabled(),Email:$.trim(this.email()),Name:this.userName(),OutgoingServer:this.oOutgoing.server(),OutgoingPort:this.oOutgoing.getIntPort(),OutgoingUseSsl:this.oOutgoing.ssl(),OutgoingUseAuth:this.outgoingUseAuth()}:{}},CFetcherOutgoingSettingsFormView.prototype.save=function(){this.isEnabled()&&(this.isEmptyRequiredFields()?Screens.showError(TextUtils.i18n("%MODULENAME%/ERROR_REQUIRED_FIELDS_EMPTY")):(this.isSaving(!0),this.updateSavedState(),CoreAjax.send(Settings.FetchersServerModuleName,"UpdateFetcherSmtpSettings",this.getParametersForSave(),this.onResponse,this)))},CFetcherOutgoingSettingsFormView.prototype.onResponse=function(e,t){this.isSaving(!1),e.Result?(AccountList.populateFetchers(),Screens.showReport(TextUtils.i18n("%MODULENAME%/REPORT_SUCCESSFULLY_SAVED"))):Api.showErrorByCode(e,TextUtils.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},CFetcherOutgoingSettingsFormView.prototype.populate=function(){var e=this.fetcher();e&&(this.fetcher(e),this.idFetcher(e.id()),this.isEnabled(e.isEnabled()),this.email(e.email()),this.userName(e.userName()),this.isOutgoingEnabled(e.isOutgoingEnabled()),this.oOutgoing.set(e.outgoingServer(),e.outgoingPort(),e.outgoingUseSsl()),this.outgoingUseAuth(e.outgoingUseAuth()),this.updateSavedState())},CFetcherOutgoingSettingsFormView.prototype.isEmptyRequiredFields=function(){if(this.isOutgoingEnabled()){if(this.outgoingUseAuth()&&this.isOutgoingEnabled()&&""===this.oOutgoing.server())return this.oOutgoing.server.focused(!0),!0;if(this.outgoingUseAuth()&&""===$.trim(this.email()))return this.focusEmail(!0),!0}return!1},module.exports=new CFetcherOutgoingSettingsFormView;