"use strict";function CMailQuotaAdminSettingsFormView(){CAbstractSettingsFormView.call(this,Settings.ServerModuleName,"UpdateEntitySpaceLimits"),this.bTenantAdmin=App.getUserRole()===Enums.UserRole.TenantAdmin,this.sEntityType="",this.iEntityId=0,this.tenantSpaceLimitMb=ko.observable(""),this.userSpaceLimitMb=ko.observable(""),this.allowChangeUserSpaceLimit=ko.observable(""),this.allocatedTenantSpaceMb=ko.observable("")}var _=require("underscore"),ko=require("knockout"),Types=require("%PathToCoreWebclientModule%/js/utils/Types.js"),Ajax=require("%PathToCoreWebclientModule%/js/Ajax.js"),App=require("%PathToCoreWebclientModule%/js/App.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),CAbstractSettingsFormView=ModulesManager.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"),Settings=require("modules/%ModuleName%/js/Settings.js");_.extendOwn(CMailQuotaAdminSettingsFormView.prototype,CAbstractSettingsFormView.prototype),CMailQuotaAdminSettingsFormView.prototype.ViewTemplate="%ModuleName%_Settings_MailQuotaAdminSettingsFormView",CMailQuotaAdminSettingsFormView.prototype.onRouteChild=function(){this.tenantSpaceLimitMb(""),this.userSpaceLimitMb(""),this.allowChangeUserSpaceLimit(!1),this.allocatedTenantSpaceMb(""),this.updateSavedState(),this.requestPerTenantSettings(),this.requestPerUserSettings()},CMailQuotaAdminSettingsFormView.prototype.requestPerTenantSettings=function(){"Tenant"===this.sEntityType&&Types.isPositiveNumber(this.iEntityId)&&Ajax.send(Settings.ServerModuleName,"GetEntitySpaceLimits",{Type:this.sEntityType,TenantId:this.iEntityId},function(t,e){t.Result&&e.Parameters.TenantId===this.iEntityId&&(this.tenantSpaceLimitMb(Types.pInt(t.Result.TenantSpaceLimitMb)),this.userSpaceLimitMb(Types.pInt(t.Result.UserSpaceLimitMb)),this.allowChangeUserSpaceLimit(Types.pBool(t.Result.AllowChangeUserSpaceLimit)),this.allocatedTenantSpaceMb(Types.pInt(t.Result.AllocatedSpaceMb)),this.updateSavedState())},this)},CMailQuotaAdminSettingsFormView.prototype.requestPerUserSettings=function(){"User"===this.sEntityType&&Types.isPositiveNumber(this.iEntityId)&&Ajax.send(Settings.ServerModuleName,"GetEntitySpaceLimits",{Type:this.sEntityType,UserId:this.iEntityId},function(t,e){t.Result&&e.Parameters.UserId===this.iEntityId&&(this.userSpaceLimitMb(Types.pInt(t.Result.UserSpaceLimitMb)),this.allowChangeUserSpaceLimit(Types.pBool(t.Result.AllowChangeUserSpaceLimit)),this.updateSavedState())},this)},CMailQuotaAdminSettingsFormView.prototype.getCurrentValues=function(){return[this.tenantSpaceLimitMb(),this.userSpaceLimitMb()]},CMailQuotaAdminSettingsFormView.prototype.getParametersForSave=function(){return"User"===this.sEntityType?{Type:"User",UserId:this.iEntityId,UserSpaceLimitMb:Types.pInt(this.userSpaceLimitMb())}:"Tenant"===this.sEntityType?{Type:"Tenant",TenantId:this.iEntityId,TenantSpaceLimitMb:Types.pInt(this.tenantSpaceLimitMb()),UserSpaceLimitMb:Types.pInt(this.userSpaceLimitMb())}:{}},CMailQuotaAdminSettingsFormView.prototype.setAccessLevel=function(t,e){this.visible("User"===t||"Tenant"===t),this.sEntityType=t,this.iEntityId=e},module.exports=new CMailQuotaAdminSettingsFormView;