"use strict";function IsPgpSupported(){return!(!window.crypto||!window.crypto.getRandomValues)}module.exports=function(e){var o=require("%PathToCoreWebclientModule%/js/utils/Common.js"),t=require("%PathToCoreWebclientModule%/js/App.js"),i=require("%PathToCoreWebclientModule%/js/Popups.js"),n=null;if(t.isUserNormalOrTenant()){var r=require("underscore"),s=require("%PathToCoreWebclientModule%/js/utils/Text.js"),u=require("modules/%ModuleName%/js/Settings.js");return u.init(e),{start:function(e){IsPgpSupported()&&(n=require("modules/%ModuleName%/js/popups/ImportKeyPopup.js"),t.subscribeEvent("MailWebclient::RegisterMessagePaneController",function(e){e(require("modules/%ModuleName%/js/views/MessageControlsView.js"),"BeforeMessageHeaders")}),t.isMobile()?e.run("MailMobileWebclient","registerComposeToolbarController",[require("modules/%ModuleName%/js/views/ComposeButtonsView.js")]):e.run("MailWebclient","registerComposeToolbarController",[require("modules/%ModuleName%/js/views/ComposeButtonsView.js")]),e.run("SettingsWebclient","registerSettingsTab",[function(){return require("modules/%ModuleName%/js/views/OpenPgpSettingsFormView.js")},u.HashModuleName,s.i18n("%MODULENAME%/LABEL_SETTINGS_TAB")]),t.subscribeEvent("MailWebclient::ParseFile::after",function(e){if(e&&r.isFunction(e.addAction)&&"asc"===o.getFileExtension(e.fileName())&&e.content&&e.content()){var t={Text:s.i18n("%MODULENAME%/ACTION_FILE_IMPORT_KEY"),Handler:function(){i.showPopup(n,[e.content()])}};e.addAction("import",!0,t),e.removeAction("view")}}),t.subscribeEvent("FilesWebclient::ParseFile::after",function(e){var t=e[0];if(t&&r.isFunction(t.addAction)&&"asc"===o.getFileExtension(t.fileName())&&t.content&&t.content()){var u={Text:s.i18n("%MODULENAME%/ACTION_FILE_IMPORT_KEY"),Handler:function(){i.showPopup(n,[t.content()])}};t.addAction("import",!0,u)}}))}}}return null};