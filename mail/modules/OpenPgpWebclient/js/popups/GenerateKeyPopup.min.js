"use strict";function CGenerateKeyPopup(){CAbstractPopup.call(this),this.emails=ko.observableArray([]),this.selectedEmail=ko.observable(""),this.password=ko.observable(""),this.keyLengthOptions=[2048,4096],this.selectedKeyLength=ko.observable(2048),this.process=ko.observable(!1),this.keysExistText=ko.observable("")}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),ModulesManager=require("%PathToCoreWebclientModule%/js/ModulesManager.js"),Screens=require("%PathToCoreWebclientModule%/js/Screens.js"),CAbstractPopup=require("%PathToCoreWebclientModule%/js/popups/CAbstractPopup.js"),ErrorsUtils=require("modules/%ModuleName%/js/utils/Errors.js"),Enums=require("modules/%ModuleName%/js/Enums.js"),OpenPgp=require("modules/%ModuleName%/js/OpenPgp.js");_.extendOwn(CGenerateKeyPopup.prototype,CAbstractPopup.prototype),CGenerateKeyPopup.prototype.PopupTemplate="%ModuleName%_GenerateKeyPopup",CGenerateKeyPopup.prototype.onOpen=function(){var e=ModulesManager.run("MailWebclient","getAllAccountsFullEmails")||[],s=[];_.each(e,function(e){var t=OpenPgp.findKeysByEmails([e],!0),o=OpenPgp.findKeysByEmails([e],!1);0===t.length&&0===o.length&&s.push(e)}),0===s.length&&this.keysExistText(TextUtils.i18n("%MODULENAME%/INFO_KEYS_EXIST_PLURAL",null,null,e.length)),this.emails(s),this.selectedEmail(""),this.password(""),this.selectedKeyLength(2048),this.process(!1)},CGenerateKeyPopup.prototype.generate=function(){if(0!==this.emails().length){var e=_.bind(function(){Screens.showReport(TextUtils.i18n("%MODULENAME%/REPORT_KEY_SUCCESSFULLY_GENERATED")),this.process(!1),this.closePopup()},this),s=_.bind(function(){ErrorsUtils.showPgpErrorByCode({},Enums.PgpAction.Generate),this.process(!1),this.closePopup()},this);this.process(!0),_.delay(_.bind(function(){OpenPgp.generateKey(this.selectedEmail(),$.trim(this.password()),this.selectedKeyLength(),e,s)},this))}},module.exports=new CGenerateKeyPopup;