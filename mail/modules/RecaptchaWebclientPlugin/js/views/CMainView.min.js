"use strict";function CMainView(e,t){this.sModuleName=e,this.bShown=!1,this.recaptchaPlace=ko.observable(null),this.recaptchaPlace.subscribe(function(){this.ShowRecaptcha()},this),this.iAuthErrorCount=ko.observable(0),this.bShowRecaptcha=ko.observable(!0),t&&(this.iAuthErrorCount($.cookie("auth-error")||0),this.iLimitCount=Settings?Settings.LimitCount:0,this.iAuthErrorCount()<this.iLimitCount&&this.bShowRecaptcha(!1),App.subscribeEvent("ReceiveAjaxResponse::after",_.bind(function(e){"StandardLoginFormWebclient"===e.Request.Module&&"Login"===e.Request.Method&&!1===e.Response.Result&&(this.iAuthErrorCount($.cookie("auth-error")||0),this.iAuthErrorCount()>=this.iLimitCount&&(this.bShowRecaptcha()?window.grecaptcha.reset(this.widgetId):this.bShowRecaptcha(!0)))},this))),App.subscribeEvent("AnonymousUserForm::PopulateFormSubmitParameters",_.bind(function(t){if(t.Module===e&&t.Parameters){var i=this.getParametersForSubmit();_.extend(t.Parameters,i)}},this)),window.grecaptcha?this.ShowRecaptcha():(window["ShowRecaptcha"+e]=this.ShowRecaptcha.bind(this),$.getScript("https://www.google.com/recaptcha/api.js?onload=ShowRecaptcha"+e+"&render=explicit"))}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),App=require("%PathToCoreWebclientModule%/js/App.js"),Settings=require("modules/%ModuleName%/js/Settings.js");CMainView.prototype.ViewTemplate="%ModuleName%_MainView",CMainView.prototype.ShowRecaptcha=function(){if(window.grecaptcha&&this.recaptchaPlace()){if(this.bShown)window.grecaptcha.reset(this.widgetId);else{var e=Settings?Settings.PublicKey:"";""===e&&(e="wrong-key"),this.recaptchaPlace().append('<div id="recaptcha-place-'+this.sModuleName+'"></div>'),this.widgetId=window.grecaptcha.render("recaptcha-place-"+this.sModuleName,{sitekey:e})}this.bShown=!0}},CMainView.prototype.getParametersForSubmit=function(){var e={};return e[Settings.ModuleName+"Token"]=window.grecaptcha.getResponse(this.widgetId),e},module.exports=CMainView;