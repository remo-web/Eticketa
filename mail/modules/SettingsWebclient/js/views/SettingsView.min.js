"use strict";function CSettingsView(){CAbstractScreenView.call(this,"%ModuleName%"),this.tabs=ko.observableArray([]),this.currentTab=ko.observable(null),App.subscribeEvent("OpenSettingTab",_.bind(function(e){this.changeTab(e.Name)},this)),App.broadcastEvent("%ModuleName%::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var _=require("underscore"),$=require("jquery"),ko=require("knockout"),App=require("%PathToCoreWebclientModule%/js/App.js"),Routing=require("%PathToCoreWebclientModule%/js/Routing.js"),CAbstractScreenView=require("%PathToCoreWebclientModule%/js/views/CAbstractScreenView.js"),Settings=require("modules/%ModuleName%/js/Settings.js"),$html=$("html");_.extendOwn(CSettingsView.prototype,CAbstractScreenView.prototype),CSettingsView.prototype.ViewTemplate="%ModuleName%_SettingsView",CSettingsView.prototype.ViewConstructorName="CSettingsView",CSettingsView.prototype.registerTab=function(e,t,i){var n=Settings.TabsOrder.length,s=e(),r=_.findWhere(this.tabs(),{name:t});_.isEmpty(s)||(s.SettingsTabName=t,s.SettingsTabTitle=i,r&&(_.isArray(r.sections)&&(_.each(r.sections,function(e){s.addSettingsSection(e)}),delete r.sections),r.view=s)),r||this.tabs.push({view:s,name:t}),this.tabs(_.sortBy(this.tabs(),function(e){var t=_.indexOf(Settings.TabsOrder,e.name);return-1!==t?t:n}))},CSettingsView.prototype.registerTabSection=function(e,t){var i=_.findWhere(this.tabs(),{name:t}),n=e();i?i.view.addSettingsSection(n):(this.registerTab(function(){return{visible:ko.observable(!1)}},t,""),(i=_.findWhere(this.tabs(),{name:t}))&&(_.isArray(i.sections)||(i.sections=[]),i.sections.push(n)))},CSettingsView.prototype.hasUnsavedChanges=function(){var e=this.currentTab();return e&&e.view&&_.isFunction(e.view.hasUnsavedChanges)&&e.view.hasUnsavedChanges()},CSettingsView.prototype.discardChanges=function(){var e=this.currentTab();e&&e.view&&_.isFunction(e.view.revert)&&e.view.revert()},CSettingsView.prototype.onShow=function(){$html.addClass("non-adjustable")},CSettingsView.prototype.onHide=function(){var e=this.currentTab();e&&_.isFunction(e.view.hide)&&e.view.hide(function(){},function(){}),$html.removeClass("non-adjustable")},CSettingsView.prototype.onRoute=function(e){var t=e.shift(),i=this.currentTab(),n=_.find(this.tabs(),function(e){return e.name===t}),s=function(){n&&(_.isFunction(n.view.showTab)&&n.view.showTab(e),this.currentTab(n),n.name!==t&&Routing.replaceHashDirectly([Settings.HashModuleName,n.name]))}.bind(this),r=_.bind(function(){i&&Routing.replaceHashDirectly([Settings.HashModuleName,i.name])},this),o=!0;i&&t===i.name?_.isFunction(i.view.showTab)&&i.view.showTab(e):(n&&n.view.visible&&!n.view.visible()&&(n=_.find(this.tabs(),function(e){return!e.view.visible||e.view.visible()})),n?i&&_.isFunction(i.view.hide)&&(i.view.hide(s,r),o=!1):i||(n=_.find(this.tabs(),function(e){return!e.view.visible||e.view.visible()})),o&&s())},CSettingsView.prototype.changeTab=function(e){Routing.setHash([Settings.HashModuleName,e])},CSettingsView.prototype.setAddHash=function(e){Routing.setHash(_.union([Settings.HashModuleName,this.currentTab()?this.currentTab().name:""],e))},module.exports=new CSettingsView;