"use strict";var _=require("underscore"),App=require("%PathToCoreWebclientModule%/js/App.js"),TextUtils=require("%PathToCoreWebclientModule%/js/utils/Text.js"),Settings=require("modules/%ModuleName%/js/Settings.js");module.exports=function(e){return Settings.init(e),{start:function(e){e.run("SettingsWebclient","registerSettingsTab",[function(){return require("modules/%ModuleName%/js/views/TwoFactorAuthSettingsFormView.js")},Settings.HashModuleName,TextUtils.i18n("%MODULENAME%/LABEL_SETTINGS_TAB")]),App.subscribeEvent("StandardLoginFormWebclient::ConstructView::after",function(e){var t=e.View,s=require("%PathToCoreWebclientModule%/js/Popups.js"),i=require("modules/%ModuleName%/js/popups/VerifyTokenPopup.js");if(t){var o=t.onSystemLoginResponse.bind(t);_.isFunction(o)||(o=t.onSystemLoginResponseBase.bind(t)),_.isFunction(o)||(o=function(){}),t.onSystemLoginResponse=function(e,t){e.Result&&e.Result.TwoFactorAuth&&e.Result.TwoFactorAuth.UserId?s.showPopup(i,[_.bind(this.onSystemLoginResponseBase,this),_.bind(function(){this.loading(!1)},this),e.Result.TwoFactorAuth.UserId]):o(e,t)}}})}}};