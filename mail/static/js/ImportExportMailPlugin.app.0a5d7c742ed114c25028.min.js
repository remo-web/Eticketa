(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"2ug6":function(e,t,s){"use strict";function i(e){c=s("IAk5"),d=s("UN2P"),this.id=n.observable(l.pInt(e.AccountID)),this.email=n.observable(l.pString(e.Email)),this.friendlyName=n.observable(l.pString(e.FriendlyName)),this.incomingLogin=n.observable(l.pString(e.IncomingLogin)),this.passwordMightBeIncorrect=n.observable(!1),this.passwordMightBeIncorrect.subscribe(function(){this.passwordMightBeIncorrect()||(this.requireCache(),v.getFolderList(this.id()))},this),this.signature=n.observable(l.pString(e.Signature)),this.useSignature=n.observable(!!e.UseSignature),this.serverId=n.observable(l.pInt(e.ServerId)),this.oServer=new b(e.Server),this.useToAuthorize=n.observable(!!e.UseToAuthorize),this.canBeUsedToAuthorize=n.observable(!!e.CanBeUsedToAuthorize),this.useThreading=n.observable(!!e.UseThreading),this.useThreading.subscribe(function(){this.requireCache(),v.clearMessagesCache(this.id())},this),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder,this.isCurrent=n.observable(!1),this.isEdited=n.observable(!1),this.hash=n.computed(function(){return h.getHash(this.id()+this.email())},this),this.fetchers=n.observableArray([]),this.identities=n.observable(null),this.allowAutoresponder=n.observable(l.pBool(e.AllowAutoresponder,!1)),this.autoresponder=n.observable(null),this.allowForward=n.observable(l.pBool(e.AllowForward,!1)),this.forward=n.observable(null),this.allowFilters=n.observable(l.pBool(e.AllowFilters,!1)),this.filters=n.observable(null),this.quota=n.observable(0),this.usedSpace=n.observable(0),this.quotaRecieved=n.observable(!1),this.fullEmail=n.computed(function(){return r.getFullEmail(this.friendlyName(),this.email())},this),this.bDefault=F.AllowDefaultAccountForUser&&this.email()===c.getUserPublicId(),this.aExtend=l.pObject(e.Extend)}var o=s("F/us"),n=s("0h2I"),r=s("Ol7c"),a=s("RN+F"),l=s("AFLV"),h=s("Yjhd"),d=null,u=s("JFZZ"),c=null,p=s("hPb3"),m=s("76Kh"),f=s("20Ah"),g=s("SbmC"),b=s("gAbd"),y=null,v=null,F=s("p2hp");i.prototype.threadingIsAvailable=function(){return this.oServer.bEnableThreading&&this.useThreading()},i.prototype.updateFromServer=function(e){this.email(l.pString(e.Email)),this.friendlyName(l.pString(e.FriendlyName)),this.incomingLogin(l.pString(e.IncomingLogin)),this.serverId(l.pInt(e.ServerId)),this.oServer=new b(e.Server),this.useToAuthorize(!!e.UseToAuthorize),this.useThreading(!!e.UseThreading),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder},i.prototype.requireAccounts=function(){null===y&&(y=s("jonm"))},i.prototype.requireCache=function(){null===v&&(v=s("4+IO"))},i.prototype.onGetQuotaResponse=function(e,t){o.isArray(e.Result)&&1<e.Result.length&&(this.quota(l.pInt(e.Result[1])),this.usedSpace(l.pInt(e.Result[0])),this.requireCache(),v.quotaChangeTrigger(!v.quotaChangeTrigger())),this.quotaRecieved(!0)},i.prototype.updateQuotaParams=function(){p.ShowQuotaBar&&d.send("GetQuota",{AccountID:this.id()},this.onGetQuotaResponse,this)},i.prototype.updateFriendlyName=function(e){this.friendlyName(e)},i.prototype.changeAccount=function(){this.requireAccounts(),y.changeCurrentAccount(this.id(),!0)},i.prototype.getDefaultIdentity=function(){return o.find(this.identities()||[],function(e){return e.isDefault()})},i.prototype.getFetchersIdentitiesEmails=function(){var e=this.identities()||[],t=[];return o.each(this.fetchers(),function(e){t.push(e.email())}),o.each(e,function(e){t.push(e.email())}),t},i.prototype.remove=function(){var e=o.bind(this.confirmedRemove,this);this.bDefault||m.showPopup(f,[a.i18n("MAILWEBCLIENT/CONFIRM_REMOVE_ACCOUNT"),e,this.email()])},i.prototype.confirmedRemove=function(e){e&&d.send("DeleteAccount",{AccountID:this.id()},this.onAccountDeleteResponse,this)},i.prototype.onAccountDeleteResponse=function(e,t){if(e.Result){var i=s("h1OO");o.isFunction(i.closeComposePopup)&&i.closeComposePopup(),this.requireAccounts(),y.deleteAccount(this.id())}else u.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_REMOVE_ACCOUNT"))},i.prototype.requestFilters=function(){d.send("GetFilters",{AccountID:this.id()},this.onGetFiltersResponse,this)},i.prototype.onGetFiltersResponse=function(e,t){var s=new g;e.Result&&s.parse(this.id(),e.Result),this.filters(s)},e.exports=i},"4+IO":function(e,t,s){"use strict";function i(){this.currentAccountId=F.currentId,this.currentAccountId.subscribe(function(e){var t=F.getAccount(e),s=this.oFolderListItems[e];t?(t.quotaRecieved(!1),this.messagesLoadingError(!1),s?this.folderList(s):(this.messagesLoading(!0),this.folderList(new S),this.messages([]),this.currentMessage(null),this.getFolderList(e))):this.folderList(new S)},this),this.editedAccountId=F.editedId,this.editedAccountId.subscribe(function(e){var t=this.oFolderListItems[e];t?this.editedFolderList(t):(this.editedFolderList(new S),this.currentAccountId()!==e&&this.getFolderList(e))},this),this.oFolderListItems={},this.quotaChangeTrigger=r.observable(!1),this.checkMailStarted=r.observable(!1),this.checkMailStartedAccountId=r.observable(0),this.folderList=r.observable(new S),this.folderListLoading=r.observableArray([]),this.editedFolderList=r.observable(new S),this.newMessagesCount=r.computed(function(){var e=this.folderList().inboxFolder();return e?e.unseenMessageCount():0},this),this.messages=r.observableArray([]),this.messages.subscribe(function(){this.messages().length>0&&this.messagesLoadingError(!1)},this),this.uidList=r.observable(new T),this.page=r.observable(1),this.messagesLoading=r.observable(!1),this.messagesLoadingError=r.observable(!1),this.currentMessage=r.observable(null),this.nextMessageUid=r.observable(""),this.prevMessageUid=r.observable(""),this.savingDraftUid=r.observable(""),this.editedDraftUid=r.observable(""),this.disableComposeAutosave=r.observable(!1),this.aResponseHandlers=[],this.iAutoCheckMailTimer=-1,this.waitForUnseenMessages=r.observable(!0),this.iSetMessagesSeenCount=0,c.subscribeEvent("ReceiveAjaxResponse::after",o.bind(function(e){!this.checkMailStarted()&&"Ping"===e.Response.Method&&"Core"===e.Response.Module&&e.Response.Result&&this.executeCheckMail()},this))}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("wd/R"),l=s("RN+F"),h=s("AFLV"),d=s("Yjhd"),u=s("JFZZ"),c=s("IAk5"),p=s("TKFr"),m=s("QaF5"),f=s("hPb3"),g=s("ZCBP"),b=s("76Kh"),y=s("20Ah"),v=s("4M/5"),F=s("jonm"),A=s("UN2P"),I=s("xzvH"),E=null,C=s("p2hp"),S=s("5aTH"),T=s("lPfU"),M=c.isNewTab()&&window.opener&&window.opener.MainTabMailMethods;i.prototype.requirePrefetcher=function(){E=s("cPXi")},i.prototype.init=function(){if(A.registerOnAllRequestsClosedHandler(function(){o.delay(function(){A.hasOpenedRequests()||(L.checkMailStarted(!1),L.folderListLoading.removeAll())},10),A.hasOpenedRequests()||L.savingDraftUid("")}),M){if(this.oFolderListItems=M.getFolderListItems(),this.uidList(M.getUidList()),window.name){var e=h.pInt(window.name);0===e&&(e=M.getComposedMessageAccountId(window.name)),0!==e&&this.currentAccountId(e)}this.currentAccountId.valueHasMutated(),this.initPrevNextSubscribes()}else this.currentAccountId.valueHasMutated(),this.initPrevNextSubscribes()},i.prototype.initPrevNextSubscribes=function(){this.bInThreadLevel=!1,this.currentMessage.subscribe(this.calcNextMessageUid,this),this.uidList.subscribe(this.calcNextMessageUid,this),this.currentMessage.subscribe(this.calcPrevMessageUid,this),this.uidList.subscribe(this.calcPrevMessageUid,this)},i.prototype.calcNextMessageUid=function(){var e="",t="",s=null,i=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!!M,n&&(i=s.getMessageByUid(this.currentMessage().threadParentUid()))&&(o.each(i.threadUids(),function(s,i,o){s===e&&i>0&&(t=o[i-1])}),h.isNonEmptyString(t)||(t=i.uid()))):(o.each(this.uidList().collection(),function(s,i,o){s===e&&i>0&&(t=o[i-1]||"")}),""===t&&M&&(this.requirePrefetcher(),E.prefetchNextPage(e)))),this.nextMessageUid(t)},i.prototype.calcPrevMessageUid=function(){var e=this.currentMessage()?this.currentMessage().uid():"",t="",s=null,i=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!0,n?(i=s.getMessageByUid(this.currentMessage().threadParentUid()))&&o.each(i.threadUids(),function(s,i,o){s===e&&i+1<o.length&&(t=o[i+1]||"")}):this.currentMessage().threadCount()>0&&(t=this.currentMessage().threadUids()[0])):(o.each(this.uidList().collection(),function(s,i,o){s===e&&i+1<o.length&&(t=o[i+1]||"")}),""===t&&M&&(this.requirePrefetcher(),E.prefetchPrevPage(e)))),this.prevMessageUid(t)},i.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()},i.prototype.getFolderByFullName=function(e,t){var s=this.oFolderListItems[e];return s?s.getFolderByFullName(t):null},i.prototype.checkCurrentFolderList=function(){var e=F.getCurrent(),t=e?this.oFolderListItems[e.id()]:null;!e||t||this.messagesLoading()||(this.messagesLoading(!0),this.messagesLoadingError(!1),this.getFolderList(e.id()))},i.prototype.getFolderList=function(e){F.getAccount(e)?(this.folderListLoading.push(e),A.send("GetFolders",{AccountID:e},this.onGetFoldersResponse,this)):e===this.currentAccountId()&&this.messagesLoading(!1)},i.prototype.markMessageReplied=function(e,t,s,i){var o=this.oFolderListItems[e],n=null;o&&(n=o.getFolderByFullName(t))&&n.markMessageReplied(s,i)},i.prototype.hideThreads=function(e){var t=F.getCurrent();t&&t.threadingIsAvailable()&&e.folder()===this.folderList().currentFolderFullName()&&!e.threadOpened()&&this.folderList().currentFolder().hideThreadMessages(e)},i.prototype.showOpenedThreads=function(e){this.messages(this.getMessagesWithThreads(e,this.uidList(),this.messages()))},i.prototype.useThreadingInCurrentList=function(e){e=e||this.uidList();var t=F.getCurrent(),s=this.folderList().currentFolder(),i=s&&s.withoutThreads(),o=""===e.search()&&""===e.filters();return t&&t.threadingIsAvailable()&&!i&&o},i.prototype.getMessagesWithThreads=function(e,t,s){var i=[],n=[],r=this.folderList().currentFolder();return r&&e===r.fullName()&&this.useThreadingInCurrentList(t)?(n=o.filter(s,function(e){return!e.threadPart()}),o.each(n,function(e){var t=[];i.push(e),e.threadCount()>0&&(e.threadOpened()&&(t=this.folderList().currentFolder().getThreadMessages(e),i=o.union(i,t)),r.computeThreadData(e))},this),i):s},i.prototype.setMessagesFromUidList=function(e,t,s){var i=e.getUidsForOffset(t),n=o.map(i,function(t){return I.get([e.iAccountId,e.sFullName,t])},this),r=n.length;return s&&(this.messages(this.getMessagesWithThreads(this.folderList().currentFolderFullName(),e,n)),t+r<e.resultCount()&&r<C.MailsPerPage&&(e.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&this.currentMessage(null)),i},i.prototype.getNamesOfFoldersToRefresh=function(){var e=this.oFolderListItems[this.currentAccountId()],t=e?e.getNamesOfFoldersToRefresh():[],s=F.getCurrentFetchersAndFiltersFolderNames();return t=o.uniq(o.compact(o.union(t,s)))},i.prototype.getUseListStatusIfPossibleValue=function(e){var t=this.oFolderListItems[this.currentAccountId()];return(t?t.getFoldersCount():0)<100||e>50},i.prototype.executeCheckMail=function(e){clearTimeout(this.iAutoCheckMailTimer);var t=this.currentAccountId(),s=this.getNamesOfFoldersToRefresh(),i=this.checkMailStarted()&&this.checkMailStartedAccountId()===t,o=null;c.getUserRole()!==Enums.UserRole.Anonymous&&(e||!A.hasOpenedRequests("GetRelevantFoldersInformation")||!i)&&s.length>0&&(o={AccountID:t,Folders:s,UseListStatusIfPossible:this.getUseListStatusIfPossibleValue(s.length)},this.checkMailStarted(!0),this.checkMailStartedAccountId(t),F.getAccount(t)&&A.send("GetRelevantFoldersInformation",o,this.onGetRelevantFoldersInformationResponse,this))},i.prototype.setAutocheckmailTimer=function(){clearTimeout(this.iAutoCheckMailTimer),!c.isNewTab()&&f.AutoRefreshIntervalMinutes>0&&(this.iAutoCheckMailTimer=setTimeout(function(){L.isSearchExecuting()||(L.checkMessageFlags(),L.executeCheckMail(!1))},60*f.AutoRefreshIntervalMinutes*1e3))},i.prototype.isSearchExecuting=function(){var e=A.getOpenedRequest("GetMessages"),t=e&&e.Parameters;return t&&""!==t.Search},i.prototype.checkMessageFlags=function(){var e=this.folderList().inboxFolder(),t=e?e.getFlaggedMessageUids():[],s={Folder:this.folderList().inboxFolderFullName(),Uids:t};t.length>0&&A.send("GetMessagesFlags",s,this.onGetMessagesFlagsResponse,this)},i.prototype.onGetMessagesFlagsResponse=function(e,t){var s=t.Parameters,i=this.oFolderListItems[s.AccountID],n=i?i.inboxFolder():null;n&&(e.Result&&o.each(e.Result,function(e,t){-1===o.indexOf(e,"\\flagged")&&n.setMessageUnflaggedByUid(t)}),n.removeFlaggedMessageListsFromCache(),this.requirePrefetcher(),E.prefetchStarredMessageList())},i.prototype.changeCurrentMessageList=function(e,t,s,i,o,n){this.requestCurrentMessageList(e,t,s,i,o,n,!0)},i.prototype.requestCurrentMessageList=function(e,t,s,i,o,n,r){var l=this.requestMessageList(e,t,s,i||"",o,n,!0,r||!1),h=60*f.AutoRefreshIntervalMinutes*1e3,d=l.Folder.oRelevantInformationLastMoment?a().diff(l.Folder.oRelevantInformationLastMoment):h+1;this.uidList(l.UidList),this.page(t),this.messagesLoading(l.RequestStarted),this.messagesLoadingError(!1),!l.RequestStarted&&h>0&&d>h&&this.executeCheckMail(!0)},i.prototype.requestMessageList=function(e,t,s,i,o,n,r,a,l){l=h.pBool(l,!1);var d=this.oFolderListItems[this.currentAccountId()],u=d?d.getFolderByFullName(e):null,c=u&&u.withoutThreads(),p=F.getCurrent(),m=p&&p.threadingIsAvailable()&&!c&&""===s&&""===i,f=u?u.getUidList(s,i,o,n):null,g=f&&-1===f.resultCount(),b=(t-1)*C.MailsPerPage,y={Folder:e,Offset:b,Limit:C.MailsPerPage,Search:s,Filters:i,SortBy:o,SortOrder:n,UseThreading:m},v=!1,I=!1,E=r?this.onCurrentGetMessagesResponse:this.onGetMessagesResponse,S=[];return u.type()===Enums.FolderTypes.Inbox&&""===i?y.InboxUidnext=u.sUidNext:y.InboxUidnext="",g&&f.iAccountId===this.uidList().iAccountId&&f.sFullName===this.uidList().sFullName&&f.search()===this.uidList().search()&&f.filters()===this.uidList().filters()&&f.sortBy()===this.uidList().sortBy()&&f.sortOrder()===this.uidList().sortOrder()&&(f=this.uidList()),f&&(S=this.setMessagesFromUidList(f,b,a),u.updateLastAccessTime(S)),f&&(I=g||b+S.length<f.resultCount()&&S.length<C.MailsPerPage,v=!l&&(u.hasChanges()||I)),v?A.send("GetMessages",y,E,this):this.waitForUnseenMessages(!1),{UidList:f,RequestStarted:v,DataExpected:I,Folder:u}},i.prototype.executeEmptyTrash=function(){var e=this.folderList().trashFolder();e&&e.emptyFolder()},i.prototype.executeEmptySpam=function(){var e=this.folderList().spamFolder();e&&e.emptyFolder()},i.prototype.onClearFolder=function(e){if(e&&e.selected()){this.messages.removeAll(),this.currentMessage(null);var t=e?e.getUidList(this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder()):null;t?this.uidList(t):this.uidList(new T),this.checkMailStarted(!1),this.setAutocheckmailTimer()}},i.prototype.getOpenedDraftUids=function(){var e=g.getOpenedWindows(),t=o.map(e,function(e){return e.SlaveTabMailMethods?e.SlaveTabMailMethods.getEditedDraftUid():""});return b.hasOpenedMinimizedPopups()&&t.push(this.editedDraftUid()),o.uniq(o.compact(t))},i.prototype.closeComposesWithDraftUids=function(e){var t=g.getOpenedWindows();if(o.each(t,function(t){t.SlaveTabMailMethods&&-1!==n.inArray(t.SlaveTabMailMethods.getEditedDraftUid(),e)&&t.close()}),-1!==n.inArray(this.editedDraftUid(),e)){var i=s("h1OO");o.isFunction(i.closeComposePopup)&&i.closeComposePopup()}},i.prototype.moveMessagesToFolder=function(e,t){if(t.length>0){var s=this.folderList().currentFolder(),i=s&&s.type()===Enums.FolderTypes.Drafts,r=i&&this.getOpenedDraftUids(),a=i&&o.find(t,o.bind(function(e){return-1!==n.inArray(e,r)},this)),h=this.folderList().getFolderByFullName(e),d={Folder:s?s.fullName():"",ToFolder:e,Uids:t.join(",")},u=null,c=o.bind(function(){this.uidList().filters()===Enums.FolderFilter.Unseen&&this.uidList().resultCount()>C.MailsPerPage&&this.waitForUnseenMessages(!0),u=s.markDeletedByUids(t),h.addMessagesCountsDiff(u.MinusDiff,u.UnseenMinusDiff),h.recivedAnim(!0),this.excludeDeletedMessages(),h.markHasChanges(),A.send("MoveMessages",d,this.onMoveMessagesResponse,this)},this);s&&h&&(a?(this.disableComposeAutosave(!0),b.showPopup(y,[l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGE_FOR_DELETE_IS_EDITED"),o.bind(function(e){e&&(this.closeComposesWithDraftUids(t),c()),this.disableComposeAutosave(!1)},this),"",l.i18n("MAILWEBCLIENT/ACTION_CLOSE_DELETE_DRAFT")])):c())}},i.prototype.copyMessagesToFolder=function(e,t){if(t.length>0){var s=this.folderList().currentFolder(),i=this.folderList().getFolderByFullName(e),o={Folder:s?s.fullName():"",ToFolder:e,Uids:t.join(",")};s&&i&&(i.recivedAnim(!0),i.markHasChanges(),A.send("CopyMessages",o,this.onCopyMessagesResponse,this))}},i.prototype.excludeDeletedMessages=function(){o.delay(o.bind(function(){var e=(this.page()-1)*C.MailsPerPage;this.setMessagesFromUidList(this.uidList(),e,!0)},this),500)},i.prototype.removeOneMessageFromCacheForFolder=function(e,t,s){var i=this.oFolderListItems[e],o=i?i.getFolderByFullName(t):null;o&&o.type()===Enums.FolderTypes.Drafts&&(this.currentMessage()&&this.currentMessage().folder()===t&&this.currentMessage().uid()===s&&this.currentMessage(null),o.markDeletedByUids([s]),o.commitDeleted([s]))},i.prototype.startMessagesLoadingWhenDraftSaving=function(e,t){var s=this.oFolderListItems[e],i=s?s.getFolderByFullName(t):null;i&&i.type()===Enums.FolderTypes.Drafts&&i.selected()&&this.messagesLoading(!0)},i.prototype.removeMessagesFromCacheForFolder=function(e,t){var s=this.oFolderListItems[e],i=s?s.getFolderByFullName(t):null,o=s?s.currentFolderFullName():null;i&&(i.markHasChanges(),this.currentAccountId()===e&&t===o&&this.requestCurrentMessageList(o,this.page(),this.uidList().search(),"",this.uidList().sortBy(),this.uidList().sortOrder(),!0))},i.prototype.deleteMessages=function(e){var t=this.folderList().currentFolder();t&&this.deleteMessagesFromFolder(t,e)},i.prototype.deleteMessagesFromFolder=function(e,t){var s={Folder:e.fullName(),Uids:t.join(",")};e.markDeletedByUids(t),this.excludeDeletedMessages(),A.send("DeleteMessages",s,this.onMoveMessagesResponse,this)},i.prototype.showExternalPictures=function(e){var t=[],s=null;this.currentMessage()&&(t=this.currentMessage().oFrom.aCollection,s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e&&t.length>0?s.alwaysShowExternalPicturesForSender(t[0].sEmail):s.showExternalPictures(this.currentMessage().uid()))},i.prototype.setCurrentMessage=function(e,t){var s=this.folderList().currentFolder(),i=null;!c.isNewTab()||s&&s.fullName()===t||(this.folderList().setCurrentFolder(t,""),s=this.folderList().currentFolder()),s&&e&&(i=I.get([s.iAccountId,s.fullName(),e])),i&&!i.deleted()?(this.currentMessage(i),this.currentMessage().seen()||this.executeGroupOperation("SetMessagesSeen",[this.currentMessage().uid()],"seen",!0),s.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this)):(this.currentMessage(null),c.isNewTab()&&s&&s.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this))},i.prototype.onCurrentMessageResponse=function(e,t,s){var i=this.currentMessage()?this.currentMessage().uid():"";null===e&&M&&s&&u.showErrorByCode(s,"",!0),null===e&&i===t?this.currentMessage(null):e&&i===t?this.currentMessage.valueHasMutated():c.isNewTab()&&e&&null===this.currentMessage()&&this.currentMessage(e)},i.prototype.getMessage=function(e,t,s,i){var o=this.folderList().getFolderByFullName(e);o&&o.getCompletelyFilledMessage(t,s,i)},i.prototype.executeGroupOperation=function(e,t,s,i){var o=this.folderList().currentFolder(),n={Folder:o?o.fullName():"",Uids:t.join(","),SetAction:i},r=(this.page()-1)*C.MailsPerPage,a=t.length,l=this.folderList().oStarredFolder?this.folderList().oStarredFolder.messageCount():0,h=o?o.getUidList("",Enums.FolderFilter.Flagged,C.MessagesSortBy.DefaultSortBy,C.MessagesSortBy.DefaultSortOrder):null,d="SetMessagesSeen"===e?this.onSetMessagesSeenResponse:function(){};o&&("SetMessagesSeen"===e&&this.iSetMessagesSeenCount++,A.send(e,n,d,this),o.executeGroupOperation(s,t,i),o.type()===Enums.FolderTypes.Inbox&&"flagged"===s&&(this.uidList().filters()===Enums.FolderFilter.Flagged?i||(this.uidList().deleteUids(t),this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(h.resultCount())):(o.removeFlaggedMessageListsFromCache(),""===this.uidList().search()&&this.folderList().oStarredFolder&&(i?this.folderList().oStarredFolder.messageCount(l+a):this.folderList().oStarredFolder.messageCount(l-a>0?l-a:0)))),"seen"===s&&o.removeUnseenMessageListsFromCache(),(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.setMessagesFromUidList(this.uidList(),r,!0))},i.prototype.onSetMessagesSeenResponse=function(e,t){this.iSetMessagesSeenCount--,this.iSetMessagesSeenCount<0&&(this.iSetMessagesSeenCount=0),this.folderList().currentFolder()&&0===this.iSetMessagesSeenCount&&(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.requestCurrentMessageList(this.folderList().currentFolder().fullName(),this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),!1)},i.prototype.onGetFoldersResponse=function(e,t){var s=t.Parameters,i=new S,n=s.AccountID,r=this.oFolderListItems[n],a=r?r.oNamedCollection:{};!1===e.Result?(u.showErrorByCode(e),s.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0))):(i.parse(n,e.Result,a),r&&i.oStarredFolder.messageCount(r.oStarredFolder.messageCount()),this.__oldFolderList=this.oFolderListItems[n],this.oFolderListItems[n]=i,this.__oldFolderList&&(this.__oldFolderList.destroyFolders(),d.destroyObjectWithObservables(this,"__oldFolderList")),setTimeout(o.bind(this.getAllFoldersRelevantInformation,this,n),2e3),this.currentAccountId()===n&&this.folderList(i),this.editedAccountId()===n&&this.editedFolderList(i)),this.folderListLoading.remove(n)},i.prototype.getAllFoldersRelevantInformation=function(e){var t=this.oFolderListItems[e],s=t?t.getFoldersWithoutCountInfo():[],i={AccountID:e,Folders:s,UseListStatusIfPossible:this.getUseListStatusIfPossibleValue(s.length)};s.length>0&&F.getAccount(e)&&A.send("GetRelevantFoldersInformation",i,this.onGetRelevantFoldersInformationResponse,this)},i.prototype.onGetRelevantFoldersInformationResponse=function(e,t){var s=!1,i=t.Parameters.AccountID,n=this.oFolderListItems[i],r=this.folderList().currentFolderFullName(),a=this.currentAccountId()===i;!1===e.Result?(u.showErrorByCode(e),A.hasOpenedRequests("GetRelevantFoldersInformation")&&(s=!0)):n&&(o.each(e.Result&&e.Result.Counts,function(e,t){if(o.isArray(e)&&e.length>3){var i=e[0],l=e[1],h=e[2],d=e[3],u=!1,c=!1,p=null;(p=n.getFolderByFullName(t))&&(c=a&&p.fullName()===r,u=p.setRelevantInformation(h,d,i,l,c),c&&u&&this.uidList().filters()!==Enums.FolderFilter.Unseen&&(this.requestCurrentMessageList(p.fullName(),this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),!1),s=!0))}},this),n.countsCompletelyFilled(!0)),this.checkMailStarted(s),this.checkMailStarted()||this.setAutocheckmailTimer()},i.prototype.showNotificationsForNewMessages=function(e){var t=this.folderList().currentFolderFullName(),s=0,i="",n={},r="",a=[];e.Result.New&&e.Result.New.length>0&&(s=e.Result.New.length,i=e.Result.New[0].Uid,n={action:"show",icon:"static/styles/images/logo_140x140.png",title:l.i18n("MAILWEBCLIENT/INFO_NEW_MESSAGES_PLURAL",{COUNT:s},null,s),timeout:5e3,callback:function(){window.focus(),m.setHash(v.getMailbox(t,1,i,"",""))}},1===s&&(h.isNonEmptyString(e.Result.New[0].Subject)&&a.push(l.i18n("MAILWEBCLIENT/LABEL_SUBJECT")+": "+e.Result.New[0].Subject),r=o.map(e.Result.New[0].From,function(e){return""!==e.DisplayName?e.DisplayName:e.Email}).join(", "),h.isNonEmptyString(r)&&a.push(l.i18n("MAILWEBCLIENT/LABEL_FROM")+": "+r),n.body=a.join("\r\n")),d.desktopNotify(n))},i.prototype.onCurrentGetMessagesResponse=function(e,t){this.checkMailStarted(!1),e.Result?(this.messagesLoadingError(!1),this.parseMessageList(e,t)):(u.showErrorByCode(e),!0!==this.messagesLoading()||0!==this.messages().length&&e.ErrorCode===Enums.Errors.NotDisplayedError||this.messagesLoadingError(!0),this.messagesLoading(!1),this.setAutocheckmailTimer())},i.prototype.onGetMessagesResponse=function(e,t){e&&e.Result?this.parseMessageList(e,t):d.log("onGetMessagesResponse, there was an error while getting message list",e,t)},i.prototype.parseMessageList=function(e,t){var s=e.Result,i=t.Parameters,n=i.AccountID,r=this.oFolderListItems[n],a=null,l=null,h=i.UseThreading,d=!1,u=this.currentAccountId()===n&&this.folderList().currentFolderFullName()===s.FolderName,c=u&&this.uidList().search()===s.Search&&this.uidList().filters()===s.Filters,p=this.page()===s.Offset/C.MailsPerPage+1,m=[];this.showNotificationsForNewMessages(e),!1!==s&&"Collection/MessageCollection"===s["@Object"]&&((a=r.getFolderByFullName(s.FolderName)).setRelevantInformation(s.UidNext.toString(),s.FolderHash,s.MessageCount,s.MessageUnseenCount,u&&!c),d=a.hasChanges(),a.removeAllMessageListsFromCacheIfHasChanges(),(l=a.getUidList(s.Search,s.Filters,t.Parameters.SortBy,t.Parameters.SortOrder)).setUidsAndCount(s),o.each(s["@Collection"],function(e){var t=a.parseAndCacheMessage(e,!1,h);m.push(t)},this),c&&(this.uidList(l),p&&(l.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&(this.messagesLoading(!1),this.waitForUnseenMessages(!1),this.setMessagesFromUidList(l,s.Offset,!0),this.messagesLoading()||this.setAutocheckmailTimer())),!d||!u||c&&p||this.uidList().filters()===Enums.FolderFilter.Unseen||this.requestCurrentMessageList(this.folderList().currentFolderFullName(),this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),!1),a.type()===Enums.FolderTypes.Inbox&&l.filters()===Enums.FolderFilter.Flagged&&""===l.search()&&this.folderList().oStarredFolder&&(this.folderList().oStarredFolder.messageCount(l.resultCount()),this.folderList().oStarredFolder.hasExtendedInfo(!0)))},i.prototype.increaseStarredCount=function(){this.folderList().oStarredFolder&&this.folderList().oStarredFolder.increaseCountIfHasNotInfo()},i.prototype.onMoveMessagesResponse=function(e,t){var s=e.Result,i=t.Parameters,n=i.Uids.split(","),r=this.folderList().getFolderByFullName(i.Folder),a=this.folderList().getFolderByFullName(i.ToFolder),d=a&&a.type()===Enums.FolderTypes.Trash,c=a&&a.type()===Enums.FolderTypes.Spam,p=null,f=d?l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),g=o.bind(function(e){e&&r&&this.deleteMessagesFromFolder(r,n)},this),v=this.folderList().currentFolder(),F=v?v.fullName():"",A=!1;if(!1===s?(r&&(p=r.revertDeleted(n)),a?(p&&a.addMessagesCountsDiff(-p.PlusDiff,-p.UnseenPlusDiff),e.ErrorCode===Enums.MailErrors.CannotMoveMessageQuota&&(d||c)?(h.isNonEmptyString(e.ErrorMessage)&&(f+=" ("+e.ErrorMessage+")"),b.showPopup(y,[f,g])):u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_MOVING_MESSAGES"))):u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_DELETING_MESSAGES")),A=!0):r&&(r.commitDeleted(n),o.each(n,function(e){m.replaceHashWithoutMessageUid(e)})),r&&F===r.fullName()||a&&F===a.fullName())switch(v.markHasChanges(),this.uidList().filters()){case Enums.FolderFilter.Flagged:break;case Enums.FolderFilter.Unseen:this.waitForUnseenMessages()&&this.requestCurrentMessageList(F,this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),A);break;default:this.requestCurrentMessageList(F,this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),A)}else r&&F!==r.fullName()?(this.requirePrefetcher(),E.startFolderPrefetch(r)):a&&F!==a.fullName()&&(this.requirePrefetcher(),E.startFolderPrefetch(a))},i.prototype.onCopyMessagesResponse=function(e,t){var s=e.Result,i=t.Parameters,o=this.folderList().getFolderByFullName(i.Folder),n=this.folderList().getFolderByFullName(i.ToFolder),r=this.folderList().currentFolder(),a=r.fullName();!1===s&&u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_COPYING_MESSAGES")),a===o.fullName()||n&&a===n.fullName()?(r.markHasChanges(),this.requestCurrentMessageList(a,this.page(),this.uidList().search(),"",this.uidList().sortBy(),this.uidList().sortOrder(),!1)):a!==o.fullName()?(this.requirePrefetcher(),E.startFolderPrefetch(o)):n&&a!==n.fullName()&&(this.requirePrefetcher(),E.startFolderPrefetch(n))},i.prototype.searchMessagesInCurrentFolder=function(e){var t=this.folderList().currentFolderFullName()||"INBOX",s=this.currentMessage()?this.currentMessage().uid():"",i=this.uidList().filters();m.setHash(v.getMailbox(t,1,s,e,i))},i.prototype.searchMessagesInInbox=function(e){m.setHash(v.getMailbox(this.folderList().inboxFolderFullName()||"INBOX",1,"",e,""))},i.prototype.getFolderHash=function(e){return m.buildHashFromArray(v.getMailbox(e,1,"","",""))},i.prototype.countMessages=function(e){var t=[],s=function(e){o.each(e.subfolders(),function(e,i){e.subscribed()&&(t.push(e.unseenMessageCount()),e.subfolders().length&&e.subscribed()&&s(e))},this)};e.expanded()||e.bNamespace?e.subfoldersMessagesCount(0):(s(e),e.subfoldersMessagesCount(o.reduce(t,function(e,t){return e+t},0)))},i.prototype.changeDatesInMessages=function(){I.updateMomentDates()},i.prototype.clearMessagesCache=function(e){var t=this.oFolderListItems[e];o.each(t.collection(),function(e){e.markHasChanges(),e.removeAllMessageListsFromCacheIfHasChanges()},this),e===this.currentAccountId()&&this.messages([])},i.prototype.getTemplateFolder=function(){var e=this.folderList(),t="",s=e.currentFolder()?e.currentFolder().fullName():"";return h.isNonEmptyArray(this.getCurrentTemplateFolders())&&(t=-1!==n.inArray(s,this.getCurrentTemplateFolders())?s:o.find(this.getCurrentTemplateFolders(),function(t){return!!e.oNamedCollection[t]})),"string"==typeof t?t:""},i.prototype.getCurrentTemplateFolders=function(){return C.AllowTemplateFolders?this.folderList().aTemplateFolders:[]},i.prototype.changeTemplateFolder=function(e,t){C.AllowTemplateFolders&&this.folderList().changeTemplateFolder(e,t)};var L=new i;p.registerDayOfMonthFunction(o.bind(L.changeDatesInMessages,L)),f.timeFormat.subscribe(L.changeDatesInMessages,L),f.dateFormat.subscribe(L.changeDatesInMessages,L),e.exports=L},"4M/5":function(e,t,s){"use strict";var i=s("F/us"),o=s("AFLV"),n=s("p2hp"),r={};r.getMailbox=function(e,t,i,r,a,l,h,d){var u=s("jonm").getCurrent(),c=[n.HashModuleName,u?u.hash():""];return t=o.pInt(t,1),i=o.pString(i),r=o.pString(r),a=o.pString(a),l=o.pString(l,n.MessagesSortBy.DefaultSortBy),h=o.pInt(h,n.MessagesSortBy.DefaultSortOrder),d=o.pString(d),o.isNonEmptyString(e)&&c.push(e),""!==a&&c.push("filter:"+a),""!==l&&n.MessagesSortBy.DefaultSortBy!==l&&c.push("sortby:"+l),n.MessagesSortBy.DefaultSortOrder!==h&&c.push("sortorder:"+h),1<t&&c.push("p"+t),""!==i&&c.push("msg"+i),""!==r&&c.push(r),""!==d&&c.push("custom:"+d),c},r.parseMailbox=function(e,t){var s=e.length>0&&"compose"===e[0]&&"to"===e[1],r=s?[]:e,a="",l="INBOX",h=1,d="",u="",c="",p=n.MessagesSortBy.DefaultSortBy,m=n.MessagesSortBy.DefaultSortOrder,f="",g="",b=0;return o.isNonEmptyArray(r)&&(a=o.pString(r[b]),b++),o.isNonEmptyArray(r)&&(l=o.pString(r[b]),b++,r.length>b&&((g=o.pString(r[b]))==="filter:"+Enums.FolderFilter.Flagged&&(c=Enums.FolderFilter.Flagged,b++),g==="filter:"+Enums.FolderFilter.Unseen&&(c=Enums.FolderFilter.Unseen,b++)),r.length>b&&"sortby:"===(g=o.pString(r[b])).substr(0,7)&&(n.MessagesSortBy.Allow&&(p=g.substr(7)),b++),r.length>b&&"sortorder:"===(g=o.pString(r[b])).substr(0,10)&&(n.MessagesSortBy.Allow&&(m=o.pEnum(o.pInt(g.substr(10)),Enums.SortOrder,n.MessagesSortBy.DefaultSortOrder)),b++),i.find(n.MessagesSortBy.List,function(e){return e.SortBy===p})||(p=n.MessagesSortBy.DefaultSortBy,m=n.MessagesSortBy.DefaultSortOrder),r.length>b&&function(e){return"p"===e.substr(0,1)&&/^[1-9][\d]*$/.test(e.substr(1))}(g=o.pString(r[b]))&&((h=o.pInt(g.substr(1)))<=0&&(h=1),b++),r.length>b&&function(e){return"msg"===e.substr(0,3)&&/^[1-9][\d]*$/.test(e.substr(3))}(g=o.pString(r[b]))&&(d=g.substr(3),b++),r.length>b&&"custom:"!==(g=o.pString(r[b])).substr(0,7)&&(u=g,b++),r.length>b&&"custom:"===(g=o.pString(r[b])).substr(0,7)&&(f=g.substr(7))),{MailtoCompose:s,AccountHash:a,Folder:""===l?t:l,Page:h,Uid:d,Search:u,Filters:c,SortBy:p,SortOrder:m,Custom:f}},r.getViewMessage=function(e,t){var i=s("jonm").getCurrent(),o=i?i.hash():"";return[n.HashModuleName+"-view",o,e,"msg"+t]},r.getCompose=function(){var e=s("jonm").getCurrent(),t=e?e.hash():"";return[n.HashModuleName+"-compose",t]},r.getComposeFromMessage=function(e,t,i){var o=s("jonm").getCurrent(),r=o?o.hash():"";return[n.HashModuleName+"-compose",r,e,t,i]},r.getComposeWithToField=function(e){var t=s("jonm").getCurrent(),i=t?t.hash():"";return[n.HashModuleName+"-compose",i,"to",e]},r.getComposeWithData=function(e){var t=s("jonm").getCurrent(),i=t?t.hash():"";return[n.HashModuleName+"-compose",i,"data",e]},r.getComposeWithObject=function(e,t){var i=s("jonm").getCurrent(),o=i?i.hash():"";return[n.HashModuleName+"-compose",o,e,t]},r.getComposeWithEmlObject=function(e,t,i){var o=s("jonm").getCurrent(),r=o?o.hash():"";return[n.HashModuleName+"-compose",r,Enums.ReplyType.ForwardAsAttach,e,t,i]},r.parseCompose=function(e){var t=e.length>0?e[0]:"",s=e.length>1?e[1]:"",i=(s===Enums.ReplyType.ForwardAsAttach||"attachments"===s||"data"===s)&&e.length>2?s===Enums.ReplyType.ForwardAsAttach?e[4]:e[2]:null,o="to"===s&&e.length>2?r.parseToAddr(e[2]):null,n=(s===Enums.ReplyType.Reply||s===Enums.ReplyType.ReplyAll||s===Enums.ReplyType.Resend||s===Enums.ReplyType.Forward||"drafts"===s||s===Enums.ReplyType.ForwardAsAttach)&&e.length>2;return{AccountHash:t,RouteType:s,ToAddr:o,Object:i,MessageFolderName:n?e[2]:"",MessageUid:n?e[3]:""}},r.parseToAddr=function(e){var t=o.pString(e),s=-1!==t.indexOf("mailto:"),n=[],r=[],a="",l="",h="",d="";return s&&(t=(n=t.replace(/^mailto:/,"").split("?"))[0],2===n.length&&(r=n[1].split("&"),i.each(r,function(e){var t=e.split("=");if(2===t.length)switch(t[0].toLowerCase()){case"subject":a=decodeURIComponent(t[1]);break;case"cc":l=decodeURIComponent(t[1]);break;case"bcc":h=decodeURIComponent(t[1]);break;case"body":d=decodeURIComponent(t[1])}}))),{to:t,hasMailto:s,subject:a,cc:l,bcc:h,body:d}},e.exports=r},"5H03":function(e,t,s){"use strict";function i(){r.call(this),this.fConfirmCallback=null,this.shown=!1}var o=s("F/us"),n=s("EVdn"),r=s("czxF");o.extendOwn(i.prototype,r.prototype),i.prototype.PopupTemplate="MailWebclient_ConfirmAnotherMessageComposedPopup",i.prototype.onOpen=function(e){this.fConfirmCallback=n.isFunction(e)?e:null,this.shown=!0},i.prototype.onClose=function(){this.shown=!1},i.prototype.onDiscardClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Discard),this.closePopup()},i.prototype.onSaveAsDraftClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.SaveAsDraft),this.closePopup()},i.prototype.cancelPopup=function(){this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Cancel),this.closePopup()},i.prototype.onEnterHandler=function(){this.onSaveAsDraftClick()},e.exports=new i},"5aTH":function(e,t,s){"use strict";function i(){this.iAccountId=0,this.initialized=n.observable(!1),this.bExpandFolders=!1,this.expandNames=n.observableArray([]),this.collection=n.observableArray([]),this.options=n.observableArray([]),this.sNamespaceFolder="",this.oStarredFolder=null,this.oNamedCollection={},this.aLinedCollection=[];var e=this,t=function(e){return function(t){t&&t.type(e)}},s=function(t){return{read:function(){return this.collection(),t()?t().fullName():""},write:function(e){t(this.getFolderByFullName(e))},owner:e}};this.currentFolder=n.observable(null),this.inboxFolder=n.observable(null),this.sentFolder=n.observable(null),this.draftsFolder=n.observable(null),this.spamFolder=n.observable(null),this.trashFolder=n.observable(null),this.aTemplateFolders=[],this.countsCompletelyFilled=n.observable(!1),this.inboxFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.sentFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.draftsFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.spamFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.trashFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.inboxFolder.subscribe(t(Enums.FolderTypes.Inbox)),this.sentFolder.subscribe(t(Enums.FolderTypes.Sent)),this.draftsFolder.subscribe(t(Enums.FolderTypes.Drafts)),this.spamFolder.subscribe(t(Enums.FolderTypes.Spam)),this.trashFolder.subscribe(t(Enums.FolderTypes.Trash)),this.inboxFolderFullName=n.computed(s(this.inboxFolder)),this.sentFolderFullName=n.computed(s(this.sentFolder)),this.draftsFolderFullName=n.computed(s(this.draftsFolder)),this.spamFolderFullName=n.computed(s(this.spamFolder)),this.trashFolderFullName=n.computed(s(this.trashFolder)),this.currentFolderFullName=n.computed(s(this.currentFolder)),this.currentFolderType=n.computed(function(){return this.currentFolder()?this.currentFolder().type():Enums.FolderTypes.User},this),this.sDelimiter=""}var o=s("F/us"),n=s("0h2I"),r=s("AFLV"),a=s("Yjhd"),l=s("gcBV"),h=s("p2hp"),d=s("qGK3");i.prototype.getFoldersCount=function(){return this.aLinedCollection.length},i.prototype.getTotalMessageCount=function(){var e=0;return o.each(this.oNamedCollection,function(t){e+=t.messageCount()},this),e},i.prototype.getFoldersWithoutCountInfo=function(){return o.compact(o.map(this.oNamedCollection,function(e,t){return e.canBeSelected()&&!e.hasExtendedInfo()?t:null}))},i.prototype.getNamesOfFoldersToRefresh=function(){var e=[this.inboxFolderFullName(),this.spamFolderFullName(),this.currentFolderFullName()];return o.each(this.oNamedCollection,function(t){t.isAlwaysRefresh()&&e.push(t.fullName())}),o.uniq(e)},i.prototype.setCurrentFolder=function(e,t){var s=this.getFolderByFullName(e);null!==s&&s.canBeSelected()||(s=this.inboxFolder()),null!==s&&(this.currentFolder()&&(this.currentFolder().selected(!1),this.oStarredFolder&&this.oStarredFolder.selected(!1)),this.currentFolder(s),t===Enums.FolderFilter.Flagged?this.oStarredFolder&&this.oStarredFolder.selected(!0):this.currentFolder().selected(!0))},i.prototype.getFolderByFullName=function(e){var t=this.oNamedCollection[e];return t||null},i.prototype.renameFolder=function(e,t,s){var i=this.oNamedCollection[e];i.fullName(t),i.fullNameHash(s),this.oNamedCollection[t]=i,delete this.oNamedCollection[e]},i.prototype.changeTemplateFolder=function(e,t){h.AllowTemplateFolders&&(t?this.aTemplateFolders.push(e):this.aTemplateFolders=o.without(this.aTemplateFolders,e))},i.prototype.parse=function(e,t,s){var i=r.pString(t.Namespace),o=t.Folders["@Collection"];i.length>0&&(this.sNamespaceFolder=i.substring(0,i.length-1)),this.iAccountId=e,this.initialized(!0),this.bExpandFolders=h.FoldersExpandedByDefault&&!l.hasData("folderAccordion"),l.hasData("folderAccordion")||l.setData("folderAccordion",[]),this.oNamedCollection={},this.aLinedCollection=[],this.collection(this.parseRecursively(o,s))},i.prototype.destroyFolders=function(){a.destroyObjectWithObservables(this,"oStarredFolder"),this.collection.removeAll(),this.aLinedCollection=[];for(var e in this.oNamedCollection)a.destroyObjectWithObservables(this.oNamedCollection,e)},i.prototype.parseRecursively=function(e,t,s,i){var n=[],a=0,h=0,u=null,c=null,p="",m=null,f=[];if(i=i||"",void 0===s&&(s=-1),s++,o.isArray(e)){for(h=e.length;a<h;a++){switch(p=r.pString(e[a].FullNameRaw),c=t[p],u=c||new d(this.iAccountId),m=u.parse(e[a],i,this.sNamespaceFolder),delete t[p],this.bExpandFolders&&null!==m&&(u.expanded(!0),this.expandNames().push(r.pString(e[a].Name))),u.setDisplayedLevel(s),u.type()){case Enums.FolderTypes.Inbox:this.inboxFolder(u),this.sDelimiter=u.sDelimiter;break;case Enums.FolderTypes.Sent:this.sentFolder(u);break;case Enums.FolderTypes.Drafts:this.draftsFolder(u);break;case Enums.FolderTypes.Trash:this.trashFolder(u);break;case Enums.FolderTypes.Spam:this.spamFolder(u);break;case Enums.FolderTypes.Template:this.aTemplateFolders.push(u.fullName())}this.oNamedCollection[u.fullName()]=u,this.aLinedCollection.push(u),n.push(u),null===m&&u.type()===Enums.FolderTypes.Inbox?(this.createStarredFolder(u.fullName(),s),this.oStarredFolder&&n.push(this.oStarredFolder)):null!==m&&(f=u.bNamespace&&u.type()===Enums.FolderTypes.Inbox?this.parseRecursively(m["@Collection"],t,s-1,u.fullName()):this.parseRecursively(m["@Collection"],t,s,u.fullName()),u.type()===Enums.FolderTypes.Inbox&&(this.createStarredFolder(u.fullName(),s),u.bNamespace?this.oStarredFolder&&f.unshift(this.oStarredFolder):this.oStarredFolder&&n.push(this.oStarredFolder)),u.subfolders(f))}this.bExpandFolders&&l.setData("folderAccordion",this.expandNames())}return n},i.prototype.createStarredFolder=function(e,t){this.oStarredFolder=new d(this.iAccountId),this.oStarredFolder.initStarredFolder(t,e)},i.prototype.repopulateLinedCollection=function(){function e(s){o.each(s,function(s){t.aLinedCollection.push(s),s.subfolders().length>0&&e(s.subfolders())})}var t=this;return this.aLinedCollection=[],e(this.collection()),this.aLinedCollection},i.prototype.getOptions=function(e,t,s,i,n){t=!!t,s=!!s,i=!!i,n=!!n;var r=[];return o.each(this.aLinedCollection,function(e){if(e&&!e.bVirtual&&(!s||Enums.FolderTypes.Inbox!==e.type())&&(!n||e.subscribed())){var o=new Array(e.getDisplayedLevel()+1).join("    ");r.push({name:e.name(),fullName:e.fullName(),displayName:o+e.name(),translatedDisplayName:o+e.displayName(),disable:!t&&e.isSystem()||!i&&!e.canBeSelected()})}}),""!==e&&r.unshift({name:e,fullName:"",displayName:e,translatedDisplayName:e,disable:!1}),r},e.exports=i},"5hOJ":function(e,t,s){"use strict";function i(){this.iTimeStampInUTC=0,this.oMoment=null}var o=s("wd/R"),n=s("RN+F"),r=s("Yjhd"),a=s("hPb3");i.prototype.parse=function(e){this.iTimeStampInUTC=e,this.oMoment=o.unix(this.iTimeStampInUTC)},i.prototype.setDate=function(e,t,s){this.oMoment=o([e,t,s])},i.prototype.getTimeFormat=function(){return a.timeFormat()===window.Enums.TimeFormat.F24?"HH:mm":"hh:mm A"},i.prototype.getFullDate=function(){return this.getDate()+" "+this.getTime()},i.prototype.getMidDate=function(){return this.getShortDate(!0)},i.prototype.getShortDate=function(e){var t="",s=null;return this.oMoment&&((s=o()).format("L")===this.oMoment.format("L")?t=this.oMoment.format(this.getTimeFormat()):(t=s.clone().subtract(1,"days").format("L")===this.oMoment.format("L")?n.i18n("COREWEBCLIENT/LABEL_YESTERDAY"):a.UserSelectsDateFormat?this.oMoment.format(r.getDateFormatForMoment(a.dateFormat())):s.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),e&&(t+=", "+this.oMoment.format(this.getTimeFormat())))),t},i.prototype.getDate=function(){var e="ddd, MMM D, YYYY";return a.UserSelectsDateFormat&&(e="ddd, "+r.getDateFormatForMoment(a.dateFormat())),this.oMoment?this.oMoment.format(e):""},i.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},i.prototype.getTimeStampInUTC=function(){return this.iTimeStampInUTC},e.exports=i},"Aai/":function(e,t,s){"use strict";function i(){p.call(this),this.zipFile=n.observable(null),this.status=n.observable(""),this.iAutoReloadTimer=-1,this.opened=n.observable(!1),this.options=n.observableArray([]),this.selectedFolder=n.observable(""),this.uploaderButton=n.observable(null),this.oJua=null,this.defaultOptionsAfterRender=r.defaultOptionsAfterRender,this.exportButtonText=n.observable(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_EXPORT")),this.importButtonText=n.observable(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_IMPORT")),this.processing=n.computed(function(){return"ready"!==this.status()&&"error"!==this.status()&&""!==this.status()},this),this.status.subscribe(function(e){"ready"===e?(this.opened()||this.openPopup({}),this.exportButtonText(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_DOWNLOAD_ZIP")),clearTimeout(this.iAutoReloadTimer)):"error"===e&&(d.showError(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ERROR_GENERATE_ZIP")),this.exportButtonText(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_EXPORT")),clearTimeout(this.iAutoReloadTimer))},this)}var o=s("F/us"),n=s("0h2I"),r=s("Yjhd"),a=s("RN+F"),l=s("o0Bx"),h=s("mjrp"),d=s("SQrT"),u=s("IAk5"),c=s("JFZZ"),p=s("czxF"),m=s("4+IO"),f=s("RGpW");o.extendOwn(i.prototype,p.prototype),i.prototype.PopupTemplate="ImportExportMailPlugin_ImportExportPopup",i.prototype.onOpen=function(){this.options(m.folderList().getOptions("",!0,!1,!1))},i.prototype.onShow=function(){this.opened(!0),this.initUploader()},i.prototype.onCancelClick=function(){this.opened(!1),this.closeCommand()},i.prototype.exportMail=function(){""===this.status()?(this.status("prepare"),l.send(f.ModuleName,"ExportMailPrepare",{},this.onExportMailResponse,this),this.setAutoReloadTimer()):"ready"===this.status()&&this.Download()},i.prototype.setAutoReloadTimer=function(){var e=this;clearTimeout(this.iAutoReloadTimer),this.iAutoReloadTimer=setTimeout(function(){e.Status()},1e4)},i.prototype.Status=function(){this.setAutoReloadTimer(),""!==this.status()&&l.send(f.ModuleName,"ExportMailStatus",{Zip:this.zipFile()},this.onStatusResponse,this)},i.prototype.onExportMailResponse=function(e){var t=e.Result;t&&"prepare"===this.status()&&t.Zip&&(this.zipFile(t.Zip),this.exportButtonText(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_GENERATING_ZIP")),l.send(f.ModuleName,"ExportMailGenerate",{AccountId:m.currentAccountId(),Folder:this.selectedFolder(),Zip:this.zipFile()}))},i.prototype.onStatusResponse=function(e){var t=e.Result;t&&t.Status&&this.status(t.Status)},i.prototype.Download=function(){"ready"===this.status()&&(this.status(""),this.exportButtonText(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_EXPORT")),window.location.href="?transfer-mail/export/"+this.zipFile())},i.prototype.initUploader=function(){var e=this;this.uploaderButton()&&null===this.oJua&&(this.oJua=new h({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.uploaderButton(),disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!0,hidden:o.extendOwn({Module:f.ModuleName,Method:"ImportMail",Parameters:function(){return JSON.stringify({AccountId:m.currentAccountId(),Folder:e.selectedFolder()})}},u.getCommonRequestParameters())}),this.oJua.bEnableButton=!0,this.oJua.on("onSelect",o.bind(this.onFileUploadSelect,this)).on("onStart",o.bind(this.onFileUploadStart,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)))},i.prototype.onFileUploadSelect=function(e,t){if(f.UploadSizeLimitMb>0&&t.Size/1048576>f.UploadSizeLimitMb)return d.showError(a.i18n("IMPORTEXPORTMAILPLUGIN/ERROR_SIZE_LIMIT",{SIZE:f.UploadSizeLimitMb})),!1},i.prototype.onFileUploadStart=function(){this.status("upload"),this.importButtonText(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_IMPORTING_ZIP"))},i.prototype.onFileUploadComplete=function(e,t,s){var i=!(t&&s&&s.Result);this.status(""),this.importButtonText(a.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_IMPORT")),i?c.showErrorByCode(s,a.i18n("IMPORTEXPORTMAILPLUGIN/UNKNOWN_ERROR")):d.showReport(a.i18n("IMPORTEXPORTMAILPLUGIN/INFO_UPLOAD_COMPLETED"))},e.exports=new i},Aqrs:function(e,t,s){"use strict";function i(e){this.iAccountId=e,this.enable=o.observable(!0).extend({reversible:!0}),this.field=o.observable("").extend({reversible:!0}),this.condition=o.observable("").extend({reversible:!0}),this.filter=o.observable("").extend({reversible:!0}),this.action=o.observable("").extend({reversible:!0}),this.folder=o.observable("").extend({reversible:!0})}var o=s("0h2I"),n=s("AFLV");i.prototype.parse=function(e){this.enable(!!e.Enable),this.field(n.pInt(e.Field)),this.condition(n.pInt(e.Condition)),this.filter(n.pString(e.Filter)),this.action(n.pInt(e.Action)),this.folder(n.pString(e.FolderFullName)),this.commit()},i.prototype.revert=function(){this.enable.revert(),this.field.revert(),this.condition.revert(),this.filter.revert(),this.action.revert(),this.folder.revert()},i.prototype.commit=function(){this.enable.commit(),this.field.commit(),this.condition.commit(),this.filter.commit(),this.action.commit(),this.folder.commit()},i.prototype.toString=function(){return[this.enable(),this.field(),this.condition(),this.filter(),this.action(),this.folder()].join(":")},e.exports=i},"Cq+9":function(e,t,s){"use strict";(function(t){function i(e,t,s){var i=new c,n=o.union(e.oTo.aCollection,e.oCc.aCollection,e.oBcc.aCollection),r=o.find(m.collection(),function(e){return e.id()===t},this),a=new u,l=new u;return a.sEmail=r.email(),l.sEmail=s?s.email():"",i.addCollection(n),i.excludeCollection(o.union(e.oFrom.aCollection,[a,l])),i.getFull()}var o=s("F/us"),n=s("RN+F"),r=s("AFLV"),a=s("JFZZ"),l=s("IAk5"),h=s("QaF5"),d=s("SQrT"),u=s("cyfa"),c=s("KARm"),p=s("zu1m"),m=s("jonm"),f=s("UN2P"),g=s("4+IO"),b=s("p2hp"),y=l.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,v={sReplyText:"",sReplyDraftUid:"",oPostponedMailData:null};v.setReplyData=function(e,t){this.sReplyText=e,this.sReplyDraftUid=t},v.send=function(e,t,s,i,o,a){var l=t.AccountID,u=m.getAccount(l),c=g.oFolderListItems[l],p="",b=c?c.sentFolderFullName():"",v=c?c.draftsFolderFullName():"",F=u?u.email():"",A=t.To.indexOf(F)>-1||t.Cc.indexOf(F)>-1||t.Bcc.indexOf(F)>-1;switch(u.bSaveRepliesToCurrFolder&&!A&&r.isNonEmptyArray(t.DraftInfo,3)&&(b=t.DraftInfo[2]),t.Method=e,t.ShowReport=s,e){case"SendMessage":p=n.i18n("COREWEBCLIENT/INFO_SENDING"),t.SentFolder=b,""!==t.DraftUid&&(t.DraftFolder=v,y?(y.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),y.replaceHashWithoutMessageUid(t.DraftUid)):(g.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),h.replaceHashWithoutMessageUid(t.DraftUid)));break;case"SaveMessage":p=n.i18n("MAILWEBCLIENT/INFO_SAVING"),void 0===t.DraftFolder&&(t.DraftFolder=v),g.savingDraftUid(t.DraftUid),y?(y.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),y.replaceHashWithoutMessageUid(t.DraftUid)):(g.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),h.replaceHashWithoutMessageUid(t.DraftUid))}s&&d.showLoading(p),a?this.postponedMailData={Parameters:t,SendMessageResponseHandler:i,SendMessageResponseContext:o}:f.send(e,t,i,o)},v.sendPostponedMail=function(e){var t=this.postponedMailData,s=t.Parameters,i=s.AccountID,o=g.oFolderListItems[i],n=o?o.draftsFolderFullName():"";""!==e&&(s.DraftUid=e,s.DraftFolder=n,y?(y.removeOneMessageFromCacheForFolder(s.AccountID,s.DraftFolder,s.DraftUid),y.replaceHashWithoutMessageUid(s.DraftUid)):(g.removeOneMessageFromCacheForFolder(s.AccountID,s.DraftFolder,s.DraftUid),h.replaceHashWithoutMessageUid(s.DraftUid))),this.postponedMailData&&(f.send(s.Method,s,t.SendMessageResponseHandler,t.SendMessageResponseContext),this.postponedMailData=null)},v.sendReplyMessage=function(e,t,s,i,o,n){var r=null,a=g.currentMessage(),l=[],h=null;a&&(l=a.oTo.aCollection.concat(a.oCc.aCollection),h=this.getFirstFetcherOrIdentityByRecipientsOrDefault(l,a.accountId()),(r=this.getReplyDataFromMessage(a,Enums.ReplyType.ReplyAll,a.accountId(),h,!1,t,s)).AccountID=a.accountId(),h&&(r.FetcherID=h&&h.FETCHER?h.id():"",r.IdentityID=h&&!h.FETCHER?h.id():""),r.Bcc="",r.Importance=Enums.Importance.Normal,r.SendReadingConfirmation=!1,r.IsQuickReply=!0,r.IsHtml=!0,r.Attachments=this.convertAttachmentsForSending(r.Attachments),this.send(e,r,!1,i,o,n))},v.convertAttachmentsForSending=function(e){var t={};return o.each(e,function(e){t[e.tempName()]=[e.fileName(),e.linked()?e.cid():"",e.inline()?"1":"0",e.linked()?"1":"0",e.contentLocation()]}),t},v.onSendOrSaveMessageResponse=function(e,s,i){var r,l,h,u=s.Parameters,c=!!e.Result;switch(i||d.hideLoading(),s.Method){case"SaveMessage":g.savingDraftUid(""),c?(u.ShowReport&&!i&&(-1!==t.inArray(s.Parameters.DraftFolder,g.getCurrentTemplateFolders())?d.showReport(n.i18n("MAILWEBCLIENT/REPORT_TEMPLATE_SAVED")):d.showReport(n.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SAVED"))),e.Result.NewUid||(b.AllowAutosaveInDrafts=!1)):u.ShowReport&&(-1!==t.inArray(s.Parameters.DraftFolder,g.getCurrentTemplateFolders())?a.showErrorByCode(e,n.i18n("MAILWEBCLIENT/ERROR_TEMPLATE_SAVING")):a.showErrorByCode(e,n.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SAVING")));break;case"SendMessage":c?(u.IsQuickReply?d.showReport(n.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):y?y.showReport(n.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):d.showReport(n.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")),o.isArray(u.DraftInfo)&&3===u.DraftInfo.length&&(h=u.DraftInfo[0],l=u.DraftInfo[1],r=u.DraftInfo[2],g.markMessageReplied(u.AccountID,r,l,h))):a.showErrorByCode(e,n.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SENDING")),u.SentFolder&&(y?y.removeMessagesFromCacheForFolder(u.AccountID,u.SentFolder):g.removeMessagesFromCacheForFolder(u.AccountID,u.SentFolder))}return u.DraftFolder&&!i&&(y?y.removeMessagesFromCacheForFolder(u.AccountID,u.DraftFolder):g.removeMessagesFromCacheForFolder(u.AccountID,u.DraftFolder)),{Method:s.Method,Result:c,NewUid:e.Result?e.Result.NewUid:""}},v.getReplyDataFromMessage=function(e,t,s,r,a,l,h){var d={DraftInfo:[],DraftUid:"",To:"",Cc:"",Bcc:"",Subject:"",Attachments:[],InReplyTo:e.messageId(),References:this.getReplyReferences(e)},u=[],c=e.oReplyTo.getFull(),p=e.oTo.getFull();switch((""===c||e.oFrom.getFirstEmail()===e.oReplyTo.getFirstEmail()&&""===e.oReplyTo.getFirstName())&&(c=e.oFrom.getFull()),l&&""!==l||(l=this.sReplyText,this.sReplyText=""),"forward"===t?d.Text=l+this.getForwardMessageBody(e,s,r):"resend"===t?(d.Text=e.getConvertedHtml(),d.Cc=e.cc(),d.Bcc=e.bcc()):d.Text=l+function(e,t,s,i){var o=n.i18n("MAILWEBCLIENT/TEXT_REPLY_MESSAGE",{DATE:e.oDateModel.getDate(),TIME:e.oDateModel.getTime(),SENDER:n.encodeHtml(e.oFrom.getFull())});return"<br /><br />"+this.getSignatureText(t,s,i)+'<br /><br /><div data-anchor="reply-title">'+o+"</div><blockquote>"+e.getConvertedHtml()+"</blockquote>"}.call(this,e,s,r,a),h?d.DraftUid=h:(d.DraftUid=this.sReplyDraftUid,this.sReplyDraftUid=""),t){case Enums.ReplyType.Reply:d.DraftInfo=[Enums.ReplyType.Reply,e.uid(),e.folder()],d.To=c,d.Subject=this.getReplySubject(e.subject(),!0),u=o.filter(e.attachments(),function(e){return e.linked()});break;case Enums.ReplyType.ReplyAll:d.DraftInfo=[Enums.ReplyType.ReplyAll,e.uid(),e.folder()],d.To=c,d.Cc=i(e,s,r),d.Subject=this.getReplySubject(e.subject(),!0),u=o.filter(e.attachments(),function(e){return e.linked()});break;case Enums.ReplyType.Resend:d.DraftInfo=[Enums.ReplyType.Resend,e.uid(),e.folder(),e.cc(),e.bcc()],d.To=p,d.Subject=e.subject(),u=e.attachments();break;case Enums.ReplyType.ForwardAsAttach:case Enums.ReplyType.Forward:d.DraftInfo=[Enums.ReplyType.Forward,e.uid(),e.folder()],d.Subject=this.getReplySubject(e.subject(),!1),u=e.attachments()}return o.each(u,function(e){if(e.getCopy){var t=e.getCopy();d.Attachments.push(t)}}),d},v.getReplyReferences=function(e){var t=e.references(),s=e.messageId();return-1===t.indexOf(s)&&(t+=" "+s),t},v.getClearSignature=function(e,t){var s=m.getAccount(e),i="";return t&&t.accountId()===e&&t.useSignature()?i=t.signature():s&&s.useSignature()&&(i=s.signature()),i},v.getSignatureText=function(e,t,s){var i=this.getClearSignature(e,t);return s?'<div data-anchor="signature">'+i+"</div>":"<div>"+i+"</div>"},v.getFirstFetcherOrIdentityByRecipientsOrDefault=function(e,t){var s=m.getAccount(t),i=this.getAccountFetchersIdentitiesList(s),n=[],r=null;return o.each(e,function(e){if(!r)switch((n=o.filter(i,function(t){return e.sEmail===t.email})).length){case 0:break;case 1:r=n[0];break;default:(r=o.find(n,function(t){return e.sEmail===t.email&&e.sName===t.name}))||(r=o.find(n,function(e){return e.isDefault}))||(r=n[0])}}),r||(r=o.find(i,function(e){return e.isDefault})),r&&r.result},v.getAccountFetchersIdentitiesList=function(e){var t=[];return e&&(o.each(e.fetchers(),function(e){t.push({email:e.email(),name:e.userName(),isDefault:!1,result:e})}),o.each(e.identities(),function(e){t.push({email:e.email(),name:e.friendlyName(),isDefault:e.isDefault(),result:e})})),t},v.getForwardMessageBody=function(e,t,s){var i=n.encodeHtml(e.oCc.getFull()),o=""!==i?n.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE_CCPART",{CCADDR:i}):"",r=n.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE",{FROMADDR:n.encodeHtml(e.oFrom.getFull()),TOADDR:n.encodeHtml(e.oTo.getFull()),CCPART:o,FULLDATE:e.oDateModel.getFullDate(),SUBJECT:n.encodeHtml(e.subject())});return"<br /><br />"+this.getSignatureText(t,s,!0)+'<br /><br /><div data-anchor="reply-title">'+r+"</div><br /><br />"+e.getConvertedHtml()},v.hasReplyAllCcAddrs=function(e){var t=e.accountId(),s=e.oTo.aCollection.concat(e.oCc.aCollection);return""!==i(e,t,this.getFirstFetcherOrIdentityByRecipientsOrDefault(s,e.accountId()))},v.getReplySubject=function(e,t){var s=n.i18n("MAILWEBCLIENT/TEXT_REPLY_PREFIX"),i=n.i18n("MAILWEBCLIENT/TEXT_FORWARD_PREFIX"),o=(t?s:i)+": "+e;return b.JoinReplyPrefixes&&(o=p.joinReplyPrefixesInSubject(o,s,i)),o},v.getHtmlFromText=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},e.exports=v}).call(this,s("EVdn"))},KARm:function(e,t,s){"use strict";function i(){this.aCollection=[]}var o=s("F/us"),n=s("cyfa");i.prototype.parse=function(e){var t=e?e["@Collection"]:[];this.aCollection=[],o.isArray(t)&&(this.aCollection=o.map(t,function(e){var t=new n;return t.parse(e),t}))},i.prototype.addCollection=function(e){o.each(e,function(e){o.find(this.aCollection,function(t){return e.sEmail===t.sEmail})||this.aCollection.push(e)},this)},i.prototype.excludeCollection=function(e){o.each(e,function(e){this.aCollection=o.filter(this.aCollection,function(t){return e.sEmail.toLowerCase()!==t.sEmail.toLowerCase()})},this)},i.prototype.getFirstEmail=function(){return this.aCollection.length>0?this.aCollection[0].getEmail():""},i.prototype.getFirstName=function(){return this.aCollection.length>0?this.aCollection[0].getName():""},i.prototype.getFirstDisplay=function(){return this.aCollection.length>0?this.aCollection[0].getDisplay():""},i.prototype.getDisplay=function(e,t){return o.map(this.aCollection,function(s){return e&&t===s.sEmail?e:s.getDisplay(e)}).join(", ")},i.prototype.getFull=function(){return o.map(this.aCollection,function(e){return e.getFull()}).join(", ")},i.prototype.getEmails=function(){return o.map(this.aCollection,function(e){return e.getEmail()})},e.exports=i},LlUn:function(e,t,s){"use strict";var i=s("RGpW");e.exports=function(e){return i.init(e),{getImportExportPopup:function(){return s("Aai/")}}}},MHRZ:function(e,t,s){"use strict";function i(){d.call(this),c.call(this),this.minimized=r.observable(!1),this.fPreventBackspace=function(e){var t=e.which===n.ui.keyCode.BACKSPACE,s="INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName,i="DIV"===e.target.tagName&&"true"===n(e.target).attr("contenteditable");!t||s||i||(e.preventDefault(),e.stopPropagation())},this.minimized.subscribe(function(){this.minimized()?this.preventBackspaceOff():this.shown()&&this.preventBackspaceOn()},this),this.minimizedTitle=r.computed(function(){return this.subject()||a.i18n("MAILWEBCLIENT/HEADING_MINIMIZED_NEW_MESSAGE")},this)}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("RN+F"),l=s("HLSX"),h=s("76Kh"),d=s("czxF"),u=s("5H03"),c=s("NTez");o.extendOwn(i.prototype,d.prototype),o.extendOwn(i.prototype,c.prototype),i.prototype.PopupTemplate="MailWebclient_ComposePopup",i.prototype.preventBackspaceOn=function(){n(document).on("keydown",this.fPreventBackspace)},i.prototype.preventBackspaceOff=function(){n(document).off("keydown",this.fPreventBackspace)},i.prototype.onClose=function(){this.preventBackspaceOff()},i.prototype.onOpen=function(e){if(1===(e=e||[]).length&&"close"===e[0])this.closePopup();else{var t=3===e.length&&"drafts"===e[0]&&e[2]===this.draftUid(),s=this.minimized();this.maximize(),this.shown()||s?(e.length>0&&!t?this.hasUnsavedChanges()?(this.disableAutosave(!0),h.showPopup(u,[o.bind(function(t){switch(t){case Enums.AnotherMessageComposedAnswer.Discard:this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.SaveAsDraft:this.hasUnsavedChanges()&&this.executeSave(!0,!1),this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.Cancel:}this.disableAutosave(!1)},this)])):this.onRoute(e):s||this.onRoute(e),this.oHtmlEditor.clearUndoRedo()):this.onRoute(e),this.preventBackspaceOn()}},i.prototype.minimize=function(){this.minimized(!0),this.$popupDom.addClass("minimized")},i.prototype.maximize=function(){this.minimized(!1),this.$popupDom.removeClass("minimized")},i.prototype.saveAndClose=function(){this.hasUnsavedChanges()&&this.saveCommand(),this.closePopup()},i.prototype.cancelPopup=function(){this.hasUnsavedChanges()?this.minimize():this.closePopup()},i.prototype.onEscHandler=function(e){var t=this.oHtmlEditor.hasOpenedPopup(),s=!l.ie&&e.target&&"input"===e.target.tagName.toLowerCase()&&"file"===e.target.type.toLowerCase();s&&e.target.blur(),!h.hasOnlyOneOpenedPopup()||t||s||this.minimize(),t&&this.oHtmlEditor.closeAllPopups()},e.exports=new i},NTez:function(e,t,s){"use strict";function i(){F.call(this,"MailWebclient"),this.browserTitle=r.computed(function(){return T.getEmail()+" - "+h.i18n("MAILWEBCLIENT/HEADING_COMPOSE_BROWSER_TAB")});var e=this;this.toAddrDom=r.observable(),this.toAddrDom.subscribe(function(){this.initInputosaurus(this.toAddrDom,this.toAddr,this.lockToAddr,"to")},this),this.ccAddrDom=r.observable(),this.ccAddrDom.subscribe(function(){this.initInputosaurus(this.ccAddrDom,this.ccAddr,this.lockCcAddr,"cc")},this),this.bccAddrDom=r.observable(),this.bccAddrDom.subscribe(function(){this.initInputosaurus(this.bccAddrDom,this.bccAddr,this.lockBccAddr,"bcc")},this),this.folderList=w.folderList,this.folderList.subscribe(function(){this.getMessageOnRoute()},this),this.bNewTab=c.isNewTab(),this.bDemo=y.IsDemo,this.sending=r.observable(!1),this.saving=r.observable(!1),this.oHtmlEditor=new O(!1,this),this.visibleBcc=r.observable(!1),this.visibleBcc.subscribe(function(){B.toggleClass("screen-compose-bcc",this.visibleCc()),o.defer(o.bind(function(){n(this.bccAddrDom()).inputosaurus("resizeInput")},this))},this),this.visibleCc=r.observable(!1),this.visibleCc.subscribe(function(){B.toggleClass("screen-compose-cc",this.visibleCc()),o.defer(o.bind(function(){n(this.ccAddrDom()).inputosaurus("resizeInput")},this))},this),this.sendReadingConfirmation=r.observable(!1).extend({reversible:!0}),this.composeUploaderButton=r.observable(null),this.composeUploaderButton.subscribe(function(){this.initUploader()},this),this.composeUploaderDropPlace=r.observable(null),this.composeUploaderBodyDragOver=r.observable(!1),this.composeUploaderDragOver=r.observable(!1),this.allowDragNDrop=r.observable(!1),this.uploaderBodyDragOver=r.computed(function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()},this),this.uploaderDragOver=r.computed(function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()},this),this.selectedImportance=r.observable(Enums.Importance.Normal).extend({reversible:!0}),this.senderAccountId=R.senderAccountId,this.senderList=R.senderList,this.visibleFrom=r.computed(function(){return this.senderList().length>1},this),this.selectedSender=R.selectedSender,this.selectedFetcherOrIdentity=R.selectedFetcherOrIdentity,this.selectedFetcherOrIdentity.subscribe(function(){this.oHtmlEditor.isEditing()||this.oHtmlEditor.clearUndoRedo()},this),this.signature=r.observable(""),this.prevSignature=r.observable(null),r.computed(function(){var e=S.getClearSignature(this.senderAccountId(),this.selectedFetcherOrIdentity());null===this.prevSignature()?(this.prevSignature(e),this.signature(e)):(this.prevSignature(this.signature()),this.signature(e),this.oHtmlEditor.changeSignatureContent(this.signature(),this.prevSignature()))},this),this.lockToAddr=r.observable(!1),this.toAddr=r.observable("").extend({reversible:!0}),this.toAddr.subscribe(function(){this.lockToAddr()||(n(this.toAddrDom()).val(this.toAddr()),n(this.toAddrDom()).inputosaurus("refresh"))},this),this.lockCcAddr=r.observable(!1),this.ccAddr=r.observable("").extend({reversible:!0}),this.ccAddr.subscribe(function(){this.lockCcAddr()||(n(this.ccAddrDom()).val(this.ccAddr()),n(this.ccAddrDom()).inputosaurus("refresh"))},this),this.lockBccAddr=r.observable(!1),this.bccAddr=r.observable("").extend({reversible:!0}),this.bccAddr.subscribe(function(){this.lockBccAddr()||(n(this.bccAddrDom()).val(this.bccAddr()),n(this.bccAddrDom()).inputosaurus("refresh"))},this),this.recipientEmails=r.computed(function(){var e=[this.toAddr(),this.ccAddr(),this.bccAddr()].join(",").split(","),t=[];return o.each(e,function(e){var s=n.trim(e),i=null;""!==s&&(i=a.getEmailParts(s)).email&&t.push(i.email)}),t},this),this.subject=r.observable("").extend({reversible:!0}),this.plainText=r.observable(!1),this.textBody=r.observable(""),this.textBody.subscribe(function(e){this.oHtmlEditor.setText(this.textBody(),this.plainText()),this.oHtmlEditor.commit()},this),this.focusedField=r.observable(),this.oHtmlEditor.textFocused.subscribe(function(e){this.oHtmlEditor.textFocused()&&this.focusedField("text")},this),this.subjectFocused=r.observable(!1),this.subjectFocused.subscribe(function(){this.subjectFocused()&&this.focusedField("subject")},this),this.templateUid=r.observable(""),this.templateFolderName=r.observable(w.getTemplateFolder()),this.draftUid=r.observable(""),this.draftUid.subscribe(function(){w.editedDraftUid(this.draftUid())},this),this.draftInfo=r.observableArray([]),this.routeType=r.observable(""),this.routeParams=r.observableArray([]),this.inReplyTo=r.observable(""),this.references=r.observable(""),this.bUploadStatus=!1,this.iUploadAttachmentsTimer=0,this.messageUploadAttachmentsStarted=r.observable(!1),this.messageUploadAttachmentsStarted.subscribe(function(t){window.clearTimeout(e.iUploadAttachmentsTimer),t?e.iUploadAttachmentsTimer=window.setTimeout(function(){e.bUploadStatus=!0,b.showLoading(h.i18n("MAILWEBCLIENT/INFO_ATTACHMENTS_LOADING"))},4e3):e.bUploadStatus?e.iUploadAttachmentsTimer=window.setTimeout(function(){e.bUploadStatus=!1,b.hideLoading()},1e3):b.hideLoading()},this),this.attachments=r.observableArray([]),this.attachmentsChanged=r.observable(!1),this.attachments.subscribe(function(){this.attachmentsChanged(!0)},this),this.notUploadedAttachments=r.computed(function(){return o.filter(this.attachments(),function(e){return!e.uploaded()})},this),this.allAttachmentsUploaded=r.computed(function(){return 0===this.notUploadedAttachments().length&&!this.messageUploadAttachmentsStarted()},this),this.notInlineAttachments=r.computed(function(){return o.filter(this.attachments(),function(e){return!e.linked()})},this),this.notInlineAttachments.subscribe(function(){B.toggleClass("screen-compose-attachments",this.notInlineAttachments().length>0)},this),this.allowStartSending=r.computed(function(){return!this.saving()},this),this.allowStartSending.subscribe(function(){this.allowStartSending()&&this.requiresPostponedSending()&&(S.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))},this),this.requiresPostponedSending=r.observable(!1),this.oJua=null,this.isDraftsCleared=r.observable(!1),this.backToListOnSendOrSave=r.observable(!1),this.composeShown=r.computed(function(){return!!this.opened&&this.opened()||!!this.shown&&this.shown()},this),this.toolbarControllers=r.observableArray([]),this.disableHeadersEdit=r.computed(function(){var e=!1;return o.each(this.toolbarControllers(),function(t){e=e||!!t.disableHeadersEdit&&t.disableHeadersEdit()}),e},this),r.computed(function(){var e=!1;o.each(this.toolbarControllers(),function(t){e=e||!!t.disableBodyEdit&&t.disableBodyEdit()}),this.oHtmlEditor.setDisableEdit(e)},this),this.draftFolderIsAvailable=r.computed(function(){return!!w.folderList().draftsFolder()},this),this.disableAutosave=r.observable(!1),N.AllowAutosaveInDrafts&&N.AutoSaveIntervalSeconds>0&&(this.iAutosaveInterval=-1,r.computed(function(){var e=this.draftFolderIsAvailable()&&this.composeShown()&&!this.sending()&&!this.saving()&&!this.disableAutosave()&&!w.disableComposeAutosave();o.each(this.toolbarControllers(),function(t){e=e&&!(t.disableAutosave&&t.disableAutosave())}),window.clearInterval(this.iAutosaveInterval),e&&(this.iAutosaveInterval=window.setInterval(o.bind(this.executeSave,this,!0),1e3*N.AutoSaveIntervalSeconds))},this)),this.backToListCommand=u.createCommand(this,this.executeBackToList),this.sendCommand=u.createCommand(this,this.executeSend,this.isEnableSending),this.saveCommand=u.createCommand(this,this.executeSaveCommand,this.isEnableSaving),this.visibleSaveTemplateControl=r.observable(!1),this.saveTemplateCommand=u.createCommand(this,this.executeTemplateSaveCommand,this.isEnableSaving),this.messageFields=r.observable(null),this.bottomPanel=r.observable(null),this.sHotkeysHintsViewTemplate=p.mobileDevice?"":"MailWebclient_Compose_HotkeysHintsView",this.sPopupButtonsViewTemplate=c.isNewTab()?"":"MailWebclient_Compose_PopupButtonsView",this.aHotkeys=[{value:"Ctrl+Enter",action:h.i18n("MAILWEBCLIENT/LABEL_SEND_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+S",action:h.i18n("MAILWEBCLIENT/LABEL_SAVE_HOTKEY"),visible:this.draftFolderIsAvailable},{value:"Ctrl+Z",action:h.i18n("MAILWEBCLIENT/LABEL_UNDO_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+Y",action:h.i18n("MAILWEBCLIENT/LABEL_REDO_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+K",action:h.i18n("MAILWEBCLIENT/LABEL_LINK_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+B",action:h.i18n("MAILWEBCLIENT/LABEL_BOLD_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+I",action:h.i18n("MAILWEBCLIENT/LABEL_ITALIC_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+U",action:h.i18n("MAILWEBCLIENT/LABEL_UNDERLINE_HOTKEY"),visible:r.observable(!0)}],this.bAllowFiles=!!E,this.ignoreHasUnsavedChanges=r.observable(!1),this.changedInPreviousWindow=r.observable(!1),this.hasUnsavedChanges=r.computed(function(){return!this.ignoreHasUnsavedChanges()&&this.isChanged()&&this.isEnableSaving()},this),this.saveAndCloseTooltip=r.computed(function(){return this.draftFolderIsAvailable()&&this.hasUnsavedChanges()?h.i18n("MAILWEBCLIENT/ACTION_SAVE_CLOSE"):h.i18n("MAILWEBCLIENT/ACTION_CLOSE")},this),this.splitterDom=r.observable(),this.headersCompressed=r.observable(!1),this.allowCcBccSwitchers=r.computed(function(){return!this.disableHeadersEdit()&&!this.headersCompressed()},this),this.registerOwnToolbarControllers(),c.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("Ol7c"),l=s("QFUI"),h=s("RN+F"),d=s("AFLV"),u=s("Yjhd"),c=s("IAk5"),p=s("HLSX"),m=s("mjrp"),f=s("OgeD"),g=s("QaF5"),b=s("SQrT"),y=s("hPb3"),v=s("ZCBP"),F=s("xcwT"),A=s("76Kh"),I=s("1grR"),E=f.run("FilesWebclient","getSelectFilesPopup"),C=s("4M/5"),S=s("Cq+9"),T=s("jonm"),M=s("o0Bx"),L=s("UN2P"),w=s("4+IO"),D=s("dKfC"),R=s("UvKh"),N=s("p2hp"),U=s("Nfk5"),P=s("XTZw"),O=s("a28q"),x=c.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,B=n("html");o.extendOwn(i.prototype,F.prototype),i.prototype.ViewTemplate=c.isNewTab()?"MailWebclient_ComposeScreenView":"MailWebclient_ComposeView",i.prototype.ViewConstructorName="CComposeView",i.prototype.isEnableSending=function(){var e=0===this.toAddr().length&&0===this.ccAddr().length&&0===this.bccAddr().length;return this.folderList()&&0!==this.folderList().iAccountId&&!this.sending()&&!e&&this.allAttachmentsUploaded()},i.prototype.isEnableSaving=function(){var e=this.folderList()&&0!==this.folderList().iAccountId;return this.composeShown()&&e&&!this.sending()&&!this.saving()},i.prototype.initInputosaurus=function(e,t,s,i){e()&&n(e()).length>0&&n(e()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:f.run("ContactsWebclient","getSuggestionsAutocompleteCallback",["all","",!0])||function(){},autoCompleteDeleteItem:f.run("ContactsWebclient","getSuggestionsAutocompleteDeleteHandler")||function(){},autoCompleteAppendTo:n(e()).closest("td"),change:o.bind(function(e){s(!0),this.setRecipient(t,e.target.value),s(!1)},this),copy:o.bind(function(e){this.inputosaurusBuffer=e},this),paste:o.bind(function(){var e=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",e},this),focus:o.bind(this.focusedField,this,i),mobileDevice:p.mobileDevice})},i.prototype.changeHeadersCompressed=function(){this.headersCompressed(!this.headersCompressed())},i.prototype.onBind=function(){f.run("SessionTimeoutWeblient","registerFunction",[o.bind(this.executeSave,this,!1)]),c.isMobile()||this.hotKeysBind()},i.prototype.hotKeysBind=function(){(this.$popupDom||this.$viewDom).on("keydown",n.proxy(function(e){if(e&&e.ctrlKey&&!e.altKey&&!e.shiftKey){var t=e.keyCode,s=this.composeShown()&&(!this.minimized||!this.minimized())&&e&&e.ctrlKey;s&&t===Enums.Key.s?(e.preventDefault(),e.returnValue=!1,this.isEnableSaving()&&this.saveCommand()):s&&t===Enums.Key.Enter&&""!==this.toAddr()&&this.sendCommand()}},this))},i.prototype.getMessageOnRoute=function(){var e=C.parseCompose(this.routeParams());""!==this.routeType()&&e.MessageFolderName&&e.MessageUid&&w.getMessage(e.MessageFolderName,e.MessageUid,this.onMessageResponse,this)},i.prototype.onShow=function(){var e=this.focusedField();n(this.splitterDom()).trigger("resize"),n(this.bottomPanel()).trigger("resize"),this.oHtmlEditor.init(this.textBody(),this.plainText(),"7"),this.oHtmlEditor.commit(),this.initUploader(),this.backToListOnSendOrSave(!1),this.focusedField(e),B.addClass("screen-compose"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0),this.visibleSaveTemplateControl(w.getCurrentTemplateFolders().length>0)},i.prototype.reset=function(){this.plainText(!1),this.bUploadStatus=!1,window.clearTimeout(this.iUploadAttachmentsTimer),this.messageUploadAttachmentsStarted(!1),this.templateUid(""),this.templateFolderName(w.getTemplateFolder()),this.draftUid(""),this.draftInfo.removeAll(),this.setDataFromMessage(new U),this.isDraftsCleared(!1),this.ignoreHasUnsavedChanges(!1)},i.prototype.onRoute=function(e){var t=C.parseCompose(e);switch(T.changeCurrentAccountByHash(t.AccountHash),this.reset(),this.routeType(t.RouteType),this.routeType()){case Enums.ReplyType.ForwardAsAttach:this.routeParams(e),this.fillDefault(t);case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:case Enums.ReplyType.Resend:case Enums.ReplyType.Forward:case"drafts":this.routeParams(e),0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;case"data":var s=t.Object;if(s){s.to&&this.setRecipient(this.toAddr,s.to),s.subject&&this.subject(s.subject),s.isHtml||this.plainText(!0);var i="<div></div>";s.body&&(console.log("oData.body: ",s.body),i=s.isHtml?"<div>"+s.body+"</div>":s.body,this.textBody(i)),this.triggerToolbarControllersAfterPopulatingMessage(!0,!s.isHtml,i)}break;default:this.routeParams(e),this.fillDefault(t)}},i.prototype.fillDefault=function(e){var t=S.getSignatureText(this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),s=x?x.getComposedMessage(window.name):null,i=e.ToAddr;s?(this.setMessageDataInNewTab(s),this.changedInPreviousWindow()&&o.defer(o.bind(this.executeSave,this,!0))):""!==t&&this.textBody("<br /><br />"+t+"<br />"),i&&(this.setRecipient(this.toAddr,i.to),i.hasMailto&&(this.subject(i.subject),this.setRecipient(this.ccAddr,i.cc),this.setRecipient(this.bccAddr,i.bcc),""!==i.body&&this.textBody("<div>"+i.body+"</div>"))),this.routeType()===Enums.ReplyType.ForwardAsAttach&&e.Object&&this.addMessageAsAttachment(e.Object),"attachments"===this.routeType()&&e.Object&&this.addAttachments(e.Object),o.defer(o.bind(function(){this.focusAfterFilling()},this)),this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0)},i.prototype.focusToAddr=function(){n(this.toAddrDom()).inputosaurus("focus")},i.prototype.focusCcAddr=function(){n(this.ccAddrDom()).inputosaurus("focus")},i.prototype.focusBccAddr=function(){n(this.bccAddrDom()).inputosaurus("focus")},i.prototype.focusAfterFilling=function(){switch(this.focusedField()){case"to":this.focusToAddr();break;case"cc":this.visibleCc(!0),this.focusCcAddr();break;case"bcc":this.visibleBcc(!0),this.focusBccAddr();break;case"subject":this.subjectFocused(!0);break;case"text":this.oHtmlEditor.setFocus();break;default:0===this.toAddr().length?this.focusToAddr():0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()}},i.prototype.onHide=function(){!o.isFunction(this.closePopup)&&this.hasUnsavedChanges()&&this.executeSave(!0),this.headersCompressed(!1),this.routeParams([]),this.subjectFocused(!1),this.focusedField(""),this.messageUploadAttachmentsStarted(!1),B.removeClass("screen-compose").removeClass("screen-compose-cc").removeClass("screen-compose-bcc").removeClass("screen-compose-attachments"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},i.prototype.setRecipient=function(e,t){e()===t?e.valueHasMutated():e(t)},i.prototype.onMessageResponse=function(e){var t=null;if(null===e)this.setDataFromMessage(new U);else{switch(this.routeType()){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:R.setFetcherOrIdentityByReplyMessage(e),t=S.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.setRecipient(this.bccAddr,t.Bcc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.ForwardAsAttach:t=S.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Forward:R.setFetcherOrIdentityByReplyMessage(e),t=S.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Resend:this.setDataFromMessage(e);break;case"drafts":-1!==n.inArray(e.folder(),w.getCurrentTemplateFolders())?(this.templateUid(e.uid()),this.templateFolderName(e.folder())):this.draftUid(e.uid()),this.setDataFromMessage(e)}this.routeType()!==Enums.ReplyType.ForwardAsAttach&&this.attachments().length>0&&this.requestAttachmentsTempName(),this.routeType("")}this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0),o.defer(o.bind(function(){this.focusAfterFilling()},this))},i.prototype.setDataFromMessage=function(e){var t="",s=S.getFirstFetcherOrIdentityByRecipientsOrDefault(e.oFrom.aCollection,e.accountId());R.changeSenderAccountId(e.accountId(),s),t=e.isPlain()?e.textRaw():e.getConvertedHtml(),this.draftInfo(e.draftInfo()),this.inReplyTo(e.inReplyTo()),this.references(e.references()),this.setRecipient(this.toAddr,e.oTo.getFull()),this.setRecipient(this.ccAddr,e.oCc.getFull()),this.setRecipient(this.bccAddr,e.oBcc.getFull()),this.subject(e.subject()),this.attachments(e.attachments()),this.plainText(e.isPlain()),this.textBody(t),this.selectedImportance(e.importance()),this.sendReadingConfirmation(""!==e.readingConfirmationAddressee());var i=!!e.folderObject()&&e.folderObject().type()===Enums.FolderTypes.Drafts;this.triggerToolbarControllersAfterPopulatingMessage(i,e.isPlain(),e.textRaw(),e.sensitivity())},i.prototype.triggerToolbarControllersAfterPopulatingMessage=function(e,t,s,i){o.each(this.toolbarControllers(),function(n){o.isFunction(n.doAfterPopulatingMessage)&&n.doAfterPopulatingMessage({bDraft:e,bPlain:t,sRawText:s,iSensitivity:i})})},i.prototype.onDataAsAttachmentUpload=function(e,t){var s=t.Parameters,i=e.Result,n=s.Hash,r=o.find(this.attachments(),function(e){return e.hash()===n});this.messageUploadAttachmentsStarted(!1),r&&(i&&i.Attachment?r.parseFromUpload(i.Attachment):r.errorFromUpload())},i.prototype.addAttachments=function(e){o.each(e,o.bind(function(e){var t=new P;t.parseFromUpload(e),this.attachments.push(t)},this))},i.prototype.addFilesAsAttachment=function(e){var t=null,s=[];o.each(e,function(e){(t=new P).fileName(e.fileName()),t.hash(e.hash()),t.thumbUrlInQueue(e.thumbUrlInQueue()),t.uploadStarted(!0),this.attachments.push(t),s.push(e.hash())},this),s.length>0&&(this.messageUploadAttachmentsStarted(!0),M.send("Files","GetFilesForUpload",{Hashes:s},this.onFilesUpload,this))},i.prototype.onFilesUpload=function(e,t){var s=t.Parameters,i=e.Result,n=s.Hashes;this.messageUploadAttachmentsStarted(!1),o.isArray(i)?o.each(i,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e.Hash});t&&(t.parseFromUpload(e),t.hash(e.NewHash))},this):o.each(n,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e});t&&t.errorFromUpload()},this)},i.prototype.addMessageAsAttachment=function(e){var t=new P,s=null;e&&(t.fileName(e.subject()+".eml"),t.uploadStarted(!0),this.attachments.push(t),s={MessageFolder:e.folder(),MessageUid:e.uid(),FileName:t.fileName()},this.messageUploadAttachmentsStarted(!0),L.send("SaveMessageAsTempFile",s,this.onSaveMessageAsTempFile,this))},i.prototype.onSaveMessageAsTempFile=function(e,t){var s=e.Result,i=t.Parameters.FileName,n=null;this.messageUploadAttachmentsStarted(!1),s?(n=o.find(this.attachments(),function(e){return e.fileName()===i&&e.uploadStarted()}))&&n.parseFromUpload(s,t.Parameters.MessageFolder,t.Parameters.MessageUid):(n=o.find(this.attachments(),function(e){return e.fileName()===i&&e.uploadStarted()}))&&n.errorFromUpload()},i.prototype.onContactVCardUpload=function(e,t){var s=t.Parameters,i=e.Result,n=null;this.messageUploadAttachmentsStarted(!1),i?(n=o.find(this.attachments(),function(e){return e.fileName()===i.Name&&e.uploadStarted()}))&&n.parseFromUpload(i):(n=o.find(this.attachments(),function(e){return e.fileName()===s.Name&&e.uploadStarted()}))&&n.errorFromUpload()},i.prototype.requestAttachmentsTempName=function(){var e=o.map(this.attachments(),function(e){return e.uploadUid(e.hash()),e.uploadStarted(!0),e.hash()});e.length>0&&(this.messageUploadAttachmentsStarted(!0),L.send("SaveAttachmentsAsTempFiles",{Attachments:e},this.onMessageUploadAttachmentsResponse,this))},i.prototype.onMessageUploadAttachmentsResponse=function(e,t){var s=t.Parameters.Attachments;this.messageUploadAttachmentsStarted(!1),e.Result?o.each(e.Result,o.bind(this.setAttachTepmNameByHash,this)):(o.each(s,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e});t&&t.errorFromUpload()},this),b.showError(h.i18n("MAILWEBCLIENT/ERROR_UPLOAD_FORWARD_ATTACHMENTS")))},i.prototype.setAttachTepmNameByHash=function(e,t){o.each(this.attachments(),function(s){s.hash()===e&&(s.tempName(t),s.uploadStarted(!1))})},i.prototype.setMessageDataInNewTab=function(e){this.templateUid(e.templateUid),this.templateFolderName(e.templateFolderName),this.draftInfo(e.draftInfo),this.draftUid(e.draftUid),this.inReplyTo(e.inReplyTo),this.references(e.references),this.setRecipient(this.toAddr,e.toAddr),this.setRecipient(this.ccAddr,e.ccAddr),this.setRecipient(this.bccAddr,e.bccAddr),this.subject(e.subject),this.attachments(o.map(e.attachments,function(e){var t=new P;return t.parse(e),t},this)),this.plainText(e.plainText),this.textBody(e.textBody),this.selectedImportance(e.selectedImportance),this.sendReadingConfirmation(e.sendReadingConfirmation),this.changedInPreviousWindow(e.changedInPreviousWindow),o.each(this.toolbarControllers(),function(t){o.isFunction(t.doAfterApplyingMainTabParameters)&&t.doAfterApplyingMainTabParameters(e)}),R.changeSenderAccountId(e.senderAccountId,e.selectedFetcherOrIdentity),this.focusedField(e.focusedField)},i.prototype.commit=function(e){this.toAddr.commit(),this.ccAddr.commit(),this.bccAddr.commit(),this.subject.commit(),this.selectedImportance.commit(),this.sendReadingConfirmation.commit(),o.each(this.toolbarControllers(),function(e){o.isFunction(e.commit)&&e.commit()}),this.oHtmlEditor.commit(),this.attachmentsChanged(!1),e||this.changedInPreviousWindow(!1)},i.prototype.isChanged=function(){var e=this.toAddr.changed(),t=this.ccAddr.changed(),s=this.bccAddr.changed(),i=this.subject.changed(),n=this.selectedImportance.changed(),r=this.sendReadingConfirmation.changed(),a=!1,l=this.oHtmlEditor.textChanged(),h=this.attachmentsChanged(),d=this.changedInPreviousWindow();return o.each(this.toolbarControllers(),function(e){o.isFunction(e.isChanged)&&(a=a||e.isChanged())}),e||t||s||i||n||r||a||l||h||d},i.prototype.executeBackToList=function(){c.isNewTab()?window.close():this.shown&&this.shown()&&g.setPreviousHash(),this.backToListOnSendOrSave(!1)},i.prototype.onFileUploadSelect=function(e,t){var s;return!l.showErrorIfAttachmentSizeLimit(t.FileName,d.pInt(t.Size))&&((s=new P).onUploadSelect(e,t),this.attachments.push(s),!0)},i.prototype.getAttachmentByUid=function(e){return o.find(this.attachments(),function(t){return t.uploadUid()===e})},i.prototype.onFileUploadStart=function(e){var t=this.getAttachmentByUid(e);t&&t.onUploadStart()},i.prototype.onFileUploadProgress=function(e,t,s){var i=this.getAttachmentByUid(e);i&&i.onUploadProgress(t,s)},i.prototype.onFileUploadComplete=function(e,t,s){var i=this.getAttachmentByUid(e);i&&i.onUploadComplete(e,t,s)},i.prototype.onFileRemove=function(e){var t=this.getAttachmentByUid(e);this.oJua&&this.oJua.cancel(e),this.attachments.remove(t)},i.prototype.initUploader=function(){this.composeShown()&&this.composeUploaderButton()&&(this.oJua=new m({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),hiddenElementsPosition:y.IsRTL?"right":"left",dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:o.extendOwn({Module:N.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:w.currentAccountId()})}},c.getCommonRequestParameters())}),this.oJua.on("onDragEnter",o.bind(this.composeUploaderDragOver,this,!0)).on("onDragLeave",o.bind(this.composeUploaderDragOver,this,!1)).on("onBodyDragEnter",o.bind(this.composeUploaderBodyDragOver,this,!0)).on("onBodyDragLeave",o.bind(this.composeUploaderBodyDragOver,this,!1)).on("onProgress",o.bind(this.onFileUploadProgress,this)).on("onSelect",o.bind(this.onFileUploadSelect,this)).on("onStart",o.bind(this.onFileUploadStart,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))},i.prototype.getSendSaveParameters=function(e,t){var s=S.convertAttachmentsForSending(this.attachments()),i=null;return o.each(this.oHtmlEditor.getUploadedImagesData(),function(e){s[e.TempName]=[e.Name,e.CID,"1","1"]}),i={AccountID:this.senderAccountId(),FetcherID:this.selectedFetcherOrIdentity()&&this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",IdentityID:this.selectedFetcherOrIdentity()&&!this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(e),IsHtml:!this.plainText(),Importance:this.selectedImportance(),SendReadingConfirmation:this.sendReadingConfirmation(),Attachments:s,InReplyTo:this.inReplyTo(),References:this.references()},o.each(this.toolbarControllers(),function(e){o.isFunction(e.doAfterPreparingSendMessageParameters)&&e.doAfterPreparingSendMessageParameters(i)}),""!==this.templateFolderName()&&t&&(i.DraftFolder=this.templateFolderName(),i.DraftUid=this.templateUid()),i},i.prototype.onSendOrSaveMessageResponse=function(e,t){var s=S.onSendOrSaveMessageResponse(e,t,this.requiresPostponedSending()),n=t.Parameters;switch(this.commit(),s.Method){case"SaveMessage":s.Result&&n.DraftUid===this.templateUid()&&n.DraftFolder===this.templateFolderName()?(this.templateUid(d.pString(s.NewUid)),this.composeShown()&&this instanceof i&&g.replaceHashDirectly(C.getComposeFromMessage("drafts",n.DraftFolder,this.templateUid()))):s.Result&&n.DraftUid===this.draftUid()&&(this.draftUid(d.pString(s.NewUid)),this.composeShown()&&this instanceof i&&g.replaceHashDirectly(C.getComposeFromMessage("drafts",n.DraftFolder,this.draftUid()))),this.saving(!1);break;case"SendMessage":s.Result&&this.backToListOnSendOrSave()&&(o.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()),this.sending(!1)}},i.prototype.verifyDataForSending=function(){var e=a.getIncorrectEmailsFromAddressString(this.toAddr()),t=a.getIncorrectEmailsFromAddressString(this.ccAddr()),s=a.getIncorrectEmailsFromAddressString(this.bccAddr()),i=o.union(e,t,s),n=o.map(i,function(e){return h.encodeHtml(e)}),r=h.i18n("MAILWEBCLIENT/ERROR_INPUT_CORRECT_EMAILS")+n.join(", ");return!(i.length>0)||(A.showPopup(I,[r]),!1)},i.prototype.executeSend=function(e){var t=!1,s=o.bind(function(){this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),S.send("SendMessage",this.getSendSaveParameters(!0),!0,this.onSendOrSaveMessageResponse,this,this.requiresPostponedSending()),this.backToListOnSendOrSave(!0)},this);this.isEnableSending()&&this.verifyDataForSending()&&(o.each(this.toolbarControllers(),function(e){o.isFunction(e.doBeforeSend)&&(t=t||e.doBeforeSend(s))}),t||s())},i.prototype.executeSaveCommand=function(){this.draftFolderIsAvailable()&&this.executeSave(!1)},i.prototype.executeTemplateSaveCommand=function(){this.executeSave(!1,!0,!0)},i.prototype.executeSave=function(e,t,s){e=!!e,s=!!s;var i=(t=void 0===t||t)?this.onSendOrSaveMessageResponse:S.onSendOrSaveMessageResponse,n=t?this:S,r=o.bind(function(o){o&&(this.saving(t),S.send("SaveMessage",this.getSendSaveParameters(!1,s),!e,i,n))},this),a=!1;this.isEnableSaving()&&(e&&!this.isChanged()||(e||o.each(this.toolbarControllers(),function(e){o.isFunction(e.doBeforeSave)&&(a=a||e.doBeforeSave(r))},this),a||r(!0)),this.backToListOnSendOrSave(!0))},i.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc()),this.visibleBcc()?this.focusBccAddr():this.focusToAddr()},i.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc()),this.visibleCc()?this.focusCcAddr():this.focusToAddr()},i.prototype.getMessageDataForNewTab=function(){var e=o.map(this.attachments(),function(e){return{"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Attachment",FileName:e.fileName(),TempName:e.tempName(),MimeType:e.mimeType(),MimePartIndex:e.mimePartIndex(),EstimatedSize:e.size(),CID:e.cid(),ContentLocation:e.contentLocation(),IsInline:e.inline(),IsLinked:e.linked(),Hash:e.hash()}}),t=null;return t={accountId:this.senderAccountId(),templateUid:this.templateUid(),templateFolderName:this.templateFolderName(),draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),senderAccountId:this.senderAccountId(),selectedFetcherOrIdentity:this.selectedFetcherOrIdentity(),toAddr:this.toAddr(),ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:e,plainText:this.plainText(),textBody:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),sendReadingConfirmation:this.sendReadingConfirmation(),changedInPreviousWindow:this.isChanged(),focusedField:this.focusedField()},o.each(this.toolbarControllers(),function(e){o.isFunction(e.doAfterPreparingMainTabParameters)&&e.doAfterPreparingMainTabParameters(t)}),t},i.prototype.openInNewWindow=function(){var e="id"+Math.random().toString(),t={},s=g.buildHashFromArray(C.getCompose());this.ignoreHasUnsavedChanges(!0),t=this.getMessageDataForNewTab(),this.draftUid().length>0&&!this.isChanged()?(s=g.buildHashFromArray(C.getComposeFromMessage("drafts",w.folderList().draftsFolderFullName(),this.draftUid(),!0)),v.openTab("?message-newtab"+s)):this.templateUid().length>0&&!this.isChanged()?(s=g.buildHashFromArray(C.getComposeFromMessage("drafts",this.templateFolderName(),this.templateUid(),!0)),v.openTab("?message-newtab"+s)):this.isChanged()?(D.passComposedMessage(e,t),v.openTab("?message-newtab"+s,e)):(this.routeParams().length>0&&(s=g.buildHashFromArray(o.union([N.HashModuleName+"-compose"],this.routeParams()))),v.openTab("?message-newtab"+s)),this.commit(),o.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()},i.prototype.onShowFilesPopupClick=function(){this.bAllowFiles&&A.showPopup(E,[o.bind(this.addFilesAsAttachment,this)])},i.prototype.registerOwnToolbarControllers=function(){this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_BackButtonView",sId:"back",bOnlyMobile:!0,backToListCommand:this.backToListCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SendButtonView",sId:"send",bAllowMobile:!0,sendCommand:this.sendCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SaveButtonView",sId:"save",bAllowMobile:!0,visible:this.draftFolderIsAvailable,saveCommand:this.saveCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SaveTemplateButtonView",sId:"save-template",bAllowMobile:!1,visible:this.visibleSaveTemplateControl,saveTemplateCommand:this.saveTemplateCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ImportanceDropdownView",sId:"importance",selectedImportance:this.selectedImportance}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ConfirmationCheckboxView",sId:"confirmation",sendReadingConfirmation:this.sendReadingConfirmation})},i.prototype.registerToolbarController=function(e){var t=c.isMobile()?e.bAllowMobile:!e.bOnlyMobile,s=N.ComposeToolbarOrder.length;t&&(this.toolbarControllers.push(e),this.toolbarControllers(o.sortBy(this.toolbarControllers(),function(e){var t=o.indexOf(N.ComposeToolbarOrder,e.sId);return-1!==t?t:s})),o.isFunction(e.assignComposeExtInterface)&&e.assignComposeExtInterface(this.getExtInterface()))},i.prototype.getExtInterface=function(){return{isHtml:o.bind(function(){return!this.plainText()},this),hasAttachments:o.bind(function(){return this.notInlineAttachments().length>0},this),getPlainText:o.bind(this.oHtmlEditor.getPlainText,this.oHtmlEditor),getFromEmail:o.bind(function(){return T.getEmail(this.senderAccountId())},this),getRecipientEmails:o.bind(function(){return this.recipientEmails()},this),saveSilently:o.bind(this.executeSave,this,!0),setPlainTextMode:o.bind(this.plainText,this,!0),setPlainText:o.bind(function(e){this.textBody(e)},this),setHtmlTextMode:o.bind(this.plainText,this,!1),setHtmlText:o.bind(function(e){this.textBody(e)},this),undoHtml:o.bind(this.oHtmlEditor.undoAndClearRedo,this.oHtmlEditor)}},e.exports=i},Nfk5:function(e,t,s){"use strict";function i(){this.accountId=r.observable(g.currentId()),this.folder=r.observable(""),this.uid=r.observable(""),this.sUniq="",this.subject=r.observable(""),this.emptySubject=r.computed(function(){return""===n.trim(this.subject())},this),this.subjectForDisplay=r.computed(function(){return this.emptySubject()?l.i18n("MAILWEBCLIENT/LABEL_NO_SUBJECT"):this.subject()},this),this.messageId=r.observable(""),this.size=r.observable(0),this.friendlySize=r.computed(function(){return l.getFriendlySize(this.size())},this),this.textSize=r.observable(0),this.oDateModel=new m,this.fullDate=r.observable(""),this.oFrom=new p,this.fullFrom=r.observable(""),this.oTo=new p,this.to=r.observable(""),this.fromOrToText=r.observable(""),this.oCc=new p,this.cc=r.observable(""),this.oBcc=new p,this.bcc=r.observable(""),this.oReplyTo=new p,this.seen=r.observable(!1),this.flagged=r.observable(!1),this.partialFlagged=r.observable(!1),this.answered=r.observable(!1),this.forwarded=r.observable(!1),this.hasAttachments=r.observable(!1),this.hasIcalAttachment=r.observable(!1),this.hasVcardAttachment=r.observable(!1),this.folderObject=r.computed(function(){return this.requireMailCache(),b.getFolderByFullName(this.accountId(),this.folder())},this),this.threadsAllowed=r.computed(function(){var e=g.getAccount(this.accountId()),t=this.folderObject(),s=t&&(t.type()===Enums.FolderTypes.Drafts||t.type()===Enums.FolderTypes.Spam||t.type()===Enums.FolderTypes.Trash);return e&&e.threadingIsAvailable()&&!s},this),this.otherSendersAllowed=r.computed(function(){var e=this.folderObject();return e&&e.type()!==Enums.FolderTypes.Drafts&&e.type()!==Enums.FolderTypes.Sent},this),this.threadPart=r.observable(!1),this.threadPart.subscribe(function(){this.threadPart()&&this.partialFlagged(!1)},this),this.threadParentUid=r.observable(""),this.threadUids=r.observableArray([]),this.threadCount=r.computed(function(){return this.threadUids().length},this),this.threadUnreadCount=r.observable(0),this.threadOpened=r.observable(!1),this.threadLoading=r.observable(!1),this.threadLoadingVisible=r.computed(function(){return this.threadsAllowed()&&this.threadOpened()&&this.threadLoading()},this),this.threadCountVisible=r.computed(function(){return this.threadsAllowed()&&this.threadCount()>0&&!this.threadLoading()},this),this.threadCountHint=r.computed(function(){return this.threadCount()>0?this.threadOpened()?l.i18n("MAILWEBCLIENT/ACTION_FOLD_THREAD"):this.threadUnreadCount()>0?l.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD_WITH_UNREAD",{},null,this.threadUnreadCount()):l.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD"):""},this),this.threadCountForLoad=r.observable(5),this.threadNextLoadingVisible=r.observable(!1),this.threadNextLoadingLinkVisible=r.observable(!1),this.threadFunctionLoadNext=null,this.threadShowAnimation=r.observable(!1),this.threadHideAnimation=r.observable(!1),this.importance=r.observable(Enums.Importance.Normal),this.draftInfo=r.observableArray([]),this.hash=r.observable(""),this.sDownloadAsEmlUrl="",this.completelyFilled=r.observable(!1),this.iLastAccessTime=0,this.updateLastAccessTime(),this.checked=r.observable(!1),this.checked.subscribe(function(e){if(this.requireMailCache(),!this.threadOpened()&&b.useThreadingInCurrentList()){var t=b.folderList().getFolderByFullName(this.folder());o.each(this.threadUids(),function(s){var i=y.get([t.iAccountId,t.fullName(),s]);i&&i.checked(e)})}},this),this.selected=r.observable(!1),this.deleted=r.observable(!1),this.truncated=r.observable(!1),this.inReplyTo=r.observable(""),this.references=r.observable(""),this.readingConfirmationAddressee=r.observable(""),this.sensitivity=r.observable(Enums.Sensitivity.Nothing),this.isPlain=r.observable(!1),this.text=r.observable(""),this.textBodyForNewWindow=r.observable(""),this.$text=null,this.rtl=r.observable(!1),this.hasExternals=r.observable(!1),this.isExternalsShown=r.observable(!1),this.isExternalsAlwaysShown=r.observable(!1),this.foundCids=r.observableArray([]),this.attachments=r.observableArray([]),this.safety=r.observable(!1),this.sourceHeaders=r.observable(""),this.date=r.observable(""),this.textRaw=r.observable(""),this.domMessageForPrint=r.observable(null),this.Custom={}}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("wd/R"),l=s("RN+F"),h=s("AFLV"),d=s("ZP6a"),u=s("IAk5"),c=s("SQrT"),p=s("KARm"),m=s("5hOJ"),f=s("zu1m"),g=s("jonm"),b=null,y=s("xzvH"),v=s("XTZw");i.prototype.requireMailCache=function(){null===b&&(b=s("4+IO"))},i.prototype.updateLastAccessTime=function(){this.iLastAccessTime=a().unix(),o.each(this.threadUids(),function(e){var t=y.get([this.accountId(),this.folder(),e]);t&&t.updateLastAccessTime()},this)},i.prototype.viewMessage=function(e){var t=this.getDomText(d.getAppPath()),s="";this.textBodyForNewWindow(t.html()),s=n(this.domMessageForPrint()).html(),e&&(n(e.document.body).html(s),e.focus(),o.each(this.attachments(),function(t){var s=n(e.document.body).find("[data-hash='download-"+t.hash()+"']");t.hasAction("download")?s.on("click",o.bind(t.executeAction,t,"download")):s.hide(),s=n(e.document.body).find("[data-hash='view-"+t.hash()+"']"),t.hasAction("view")?s.on("click",o.bind(t.executeAction,t,"view")):s.hide()},this))},i.prototype.fillFromOrToText=function(){this.requireMailCache();var e=b.getFolderByFullName(this.accountId(),this.folder()),t=g.getAccount(this.accountId());e.type()===Enums.FolderTypes.Drafts||e.type()===Enums.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay(l.i18n("MAILWEBCLIENT/LABEL_ME_RECIPIENT"),t.email())):this.fromOrToText(this.oFrom.getDisplay(l.i18n("MAILWEBCLIENT/LABEL_ME_SENDER"),t.email()))},i.prototype.changeThreadUids=function(e,t){this.threadUids(e),this.threadLoading(t<Math.min(this.threadUids().length,this.threadCountForLoad()))},i.prototype.showNextLoadingLink=function(e){this.threadNextLoadingLinkVisible()&&(this.threadNextLoadingVisible(!0),this.threadFunctionLoadNext=e)},i.prototype.increaseThreadCountForLoad=function(){this.threadCountForLoad(this.threadCountForLoad()+5),this.requireMailCache(),b.showOpenedThreads(this.folder())},i.prototype.loadNextMessages=function(){this.threadFunctionLoadNext&&(this.threadFunctionLoadNext(),this.threadNextLoadingLinkVisible(!1),this.threadFunctionLoadNext=null)},i.prototype.markAsThreadPart=function(e,t){var s=this;this.threadPart(!0),this.threadParentUid(t),this.threadUids([]),this.threadNextLoadingVisible(!1),this.threadNextLoadingLinkVisible(!0),this.threadFunctionLoadNext=null,this.threadHideAnimation(!1),setTimeout(function(){s.threadShowAnimation(!0)},e)},i.prototype.parse=function(e,t,s,i){var n="",r="";i&&this.threadPart(s),this.threadPart()||this.threadParentUid(""),"Object/MessageListItem"===e["@Object"]&&(this.seen(!!e.IsSeen),this.flagged(!!e.IsFlagged),this.answered(!!e.IsAnswered),this.forwarded(!!e.IsForwarded),e.Custom&&(this.Custom=e.Custom)),"Object/Message"!==e["@Object"]&&"Object/MessageListItem"!==e["@Object"]||(this.Custom.Sensitivity=e.Sensitivity,this.accountId(t),this.folder(e.Folder),this.uid(h.pString(e.Uid)),this.sUniq=this.accountId()+this.folder()+this.uid(),this.subject(h.pString(e.Subject)),this.messageId(h.pString(e.MessageId)),this.size(e.Size),this.textSize(e.TextSize),this.oDateModel.parse(e.TimeStampInUTC),this.oFrom.parse(e.From),this.oTo.parse(e.To),this.fillFromOrToText(),this.oCc.parse(e.Cc),this.oBcc.parse(e.Bcc),this.oReplyTo.parse(e.ReplyTo),this.fullDate(this.oDateModel.getFullDate()),this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!e.HasAttachments),this.hasIcalAttachment(!!e.HasIcalAttachment),this.hasVcardAttachment(!!e.HasVcardAttachment),"Object/MessageListItem"===e["@Object"]&&i&&this.threadUids(o.map(e.Threads,function(e){return e.toString()},this)),this.importance(h.pInt(e.Importance)),Enums.has("Importance",this.importance())||this.importance(Enums.Importance.Normal),this.sensitivity(h.pInt(e.Sensitivity)),Enums.has("Sensitivity",this.sensitivity())||this.sensitivity(Enums.Sensitivity.Nothing),o.isArray(e.DraftInfo)&&this.draftInfo(e.DraftInfo),this.hash(h.pString(e.Hash)),this.sDownloadAsEmlUrl=h.pString(e.DownloadAsEmlUrl),"Object/Message"===e["@Object"]&&(this.truncated(e.Truncated),this.inReplyTo(e.InReplyTo),this.references(e.References),this.readingConfirmationAddressee(h.pString(e.ReadingConfirmationAddressee)),n=h.pString(e.Html),r=h.pString(e.Plain),""!==n?(this.textRaw(e.HtmlRaw),this.text(n),this.isPlain(!1)):(this.textRaw(e.PlainRaw),this.text(""!==r?"<div>"+r+"</div>":""),this.isPlain(!0)),this.$text=null,this.isExternalsShown(!1),this.rtl(e.Rtl),this.hasExternals(!!e.HasExternals),this.foundCids(e.FoundedCIDs),this.parseAttachments(e.Attachments,t),this.safety(e.Safety),this.sourceHeaders(e.Headers),this.aExtend=e.Extend,this.completelyFilled(!0),u.broadcastEvent("MailWebclient::ParseMessage::after",{msg:this})),this.updateMomentDate())},i.prototype.updateMomentDate=function(){this.date(this.oDateModel.getShortDate(a().clone().subtract(1,"days").format("L")===a.unix(this.oDateModel.getTimeStampInUTC()).format("L")))},i.prototype.getDomText=function(e,t){var s=this.$text;return e=e||"",null!==this.$text&&""===e||(this.completelyFilled()?(this.$text=n(this.text()),this.showInlinePictures(e),!0===this.safety()&&this.alwaysShowExternalPicturesForSender(),t&&this.isExternalsShown()&&this.showExternalPictures(),s=this.$text):s=n("")),s.clone()},i.prototype.getConvertedHtml=function(e,t){var s=this.getDomText(e,t);return s.length>0?s.wrap("<p>").parent().html():""},i.prototype.parseAttachments=function(e,t){var s=e?e["@Collection"]:[];this.attachments([]),h.isNonEmptyArray(s)&&this.attachments(o.map(s,function(e){var t=new v;return t.setMessageData(this.folder(),this.uid()),t.parse(e,this.folder(),this.uid()),t},this))},i.prototype.parseAddressArray=function(e){var t=[];return o.isArray(e)&&(t=o.map(e,function(e){var t=new CAddressModel;return t.parse(e),t})),t},i.prototype.showInlinePictures=function(e){var t=o.map(this.attachments(),function(e){return{CID:e.cid(),ContentLocation:e.contentLocation(),ViewLink:e.getActionUrl("view")}});f.showInlinePictures(this.$text,t,this.foundCids(),e)},i.prototype.showExternalPictures=function(){f.showExternalPictures(this.$text),this.isExternalsShown(!0)},i.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())},i.prototype.openThread=function(){if(this.threadCountVisible()){var e=this.folder();this.threadOpened(!this.threadOpened()),this.requireMailCache(),this.threadOpened()?b.showOpenedThreads(e):(b.hideThreads(this),setTimeout(function(){b.showOpenedThreads(e)},500))}},i.prototype.getAttachmentsHashes=function(){var e=o.filter(this.attachments(),function(e){return!e.linked()});return o.map(e,function(e){return e.hash()})},i.prototype.onSaveAttachmentsToFilesResponse=function(e,t){var s=t.Parameters,i=0,n=s.Attachments.length;e.Result&&o.each(s.Attachments,function(t){void 0!==e.Result[t]&&i++}),0===i?c.showError(l.i18n("MAILWEBCLIENT/ERROR_CANT_SAVE_ATTACHMENTS_TO_FILES")):i<n?c.showError(l.i18n("MAILWEBCLIENT/ERROR_SOME_ATTACHMENTS_WERE_NOT_SAVED",{SAVED_COUNT:i,TOTAL_COUNT:n})):c.showReport(l.i18n("MAILWEBCLIENT/REPORT_ATTACHMENTS_SAVED_TO_FILES"))},i.prototype.downloadAllAttachmentsSeparately=function(){o.each(this.attachments(),function(e){e.linked()||e.executeAction("download")})},i.prototype.toJSON=function(){return{uid:this.uid(),accountId:this.accountId(),to:this.to(),subject:this.subject(),threadPart:this.threadPart(),threadUids:this.threadUids(),threadOpened:this.threadOpened()}},e.exports=i},Olic:function(e,t,s){"use strict";var i=s("QaF5"),o=s("4M/5"),n={};n.composeMessage=function(){i.setHash(o.getCompose())},n.composeMessageFromDrafts=function(e,t){var s=o.getComposeFromMessage("drafts",e,t);i.setHash(s)},n.composeMessageAsReplyOrForward=function(e,t,s){var n=o.getComposeFromMessage(e,t,s);i.setHash(n)},n.composeMessageToAddresses=function(e){var t=o.getComposeWithToField(e);i.setHash(t)},n.composeMessageWithData=function(e){var t=o.getComposeWithData(e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)},n.composeMessageWithEml=function(e){var t=o.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)},n.composeMessageWithAttachments=function(e){var t=o.getComposeWithObject("attachments",e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)},e.exports=n},QFUI:function(e,t,s){"use strict";var i=s("RN+F"),o=s("76Kh"),n=s("1grR"),r=s("hPb3"),a={};a.getDownloadLink=function(e,t,s){return t.length>0?"?/Download/"+e+"/DownloadFile/"+t+"/"+(s?"0/"+s:""):""},a.getIframeWrappwer=function(e,t){return"?/Raw/Iframe/"+e+"/"+window.encodeURIComponent(t)+"/"},a.thumbQueue=function(){var e={},t={};return function(s,i,o){i&&o?!(s in t)||t[s]>0?(s in t||(t[s]=2,e[s]=[]),t[s]--,o(i)):e[s].push({imageSrc:i,imageSrcObserver:o,messageUid:s}):e[s]&&e[s].length&&(e[s][0].imageSrcObserver(e[s][0].imageSrc),e[s].shift())}}(),a.showErrorIfAttachmentSizeLimit=function(e,t){var s=i.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE_DETAILED",{FILENAME:e,MAXSIZE:i.getFriendlySize(r.AttachmentSizeLimit)});return r.AttachmentSizeLimit>0&&t>r.AttachmentSizeLimit&&(o.showPopup(n,[s]),!0)},e.exports=a},RGpW:function(e,t,s){"use strict";var i=s("F/us"),o=s("AFLV");e.exports={ModuleName:"ImportExportMailPlugin",UploadSizeLimitMb:0,init:function(e){var t=e[this.ModuleName]||{};i.isEmpty(t)||(this.UploadSizeLimitMb=o.pInt(t.UploadSizeLimitMb,this.UploadSizeLimitMb))}}},SbmC:function(e,t,s){"use strict";function i(){this.iAccountId=0,this.collection=n.observableArray([])}var o=s("F/us"),n=s("0h2I"),r=s("Aqrs");i.prototype.parse=function(e,t){var s=0,i=t.length,n=null;if(this.iAccountId=e,o.isArray(t))for(i=t.length;s<i;s++)(n=new r(e)).parse(t[s]),this.collection.push(n)},e.exports=i},TCxV:function(e,t,s){"use strict";function i(){return s("MHRZ")}var o=s("76Kh"),n=s("4M/5"),r={};r.composeMessage=function(){o.showPopup(i())},r.composeMessageFromDrafts=function(e,t){var s=n.getComposeFromMessage("drafts",e,t);s.shift(),o.showPopup(i(),[s])},r.composeMessageAsReplyOrForward=function(e,t,s){var r=n.getComposeFromMessage(e,t,s);r.shift(),o.showPopup(i(),[r])},r.composeMessageToAddresses=function(e){var t=n.getComposeWithToField(e);t.shift(),o.showPopup(i(),[t])},r.composeMessageWithData=function(e){var t=n.getComposeWithData(e);t.shift(),o.showPopup(i(),[t])},r.composeMessageWithEml=function(e){var t=n.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),o.showPopup(i(),[t])},r.composeMessageWithAttachments=function(e){var t=n.getComposeWithObject("attachments",e);t.shift(),o.showPopup(i(),[t])},r.closeComposePopup=function(){o.showPopup(i(),[["close"]])},e.exports=r},TKFr:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("wd/R"),a=[],l=[],h=n.observable(r().date());window.setInterval(function(){i.each(a,function(e){e()}),h(r().date())},6e4),h.subscribe(function(){i.each(l,function(e){e()})},this),e.exports={registerEveryMinuteFunction:function(e){o.isFunction(e)&&a.push(e)},registerDayOfMonthFunction:function(e){o.isFunction(e)&&l.push(e)}}},UN2P:function(e,t,s){"use strict";var i=s("F/us"),o=s("AFLV"),n=s("o0Bx"),r=s("p2hp");n.registerAbortRequestHandler(r.ServerModuleName,function(e,t){var s=e.Parameters,i=t.Parameters;switch(e.Method){case"MoveMessages":case"DeleteMessages":return"GetMessage"===t.Method||"GetMessages"===t.Method&&i.Folder===s.Folder;case"GetMessages":case"SetMessagesSeen":case"SetMessageFlagged":return"GetMessages"===t.Method&&i.Folder===s.Folder;case"SetAllMessagesSeen":return("GetMessages"===t.Method||"GetMessages"===t.Method)&&i.Folder===s.Folder;case"ClearFolder":return"GetRelevantFoldersInformation"===t.Method||"GetMessages"===t.Method&&i.Folder===s.Folder;case"GetRelevantFoldersInformation":return"GetRelevantFoldersInformation"===t.Method&&s.AccountID===i.AccountID;case"GetMessagesFlags":return"GetMessagesFlags"===t.Method}return!1}),e.exports={getOpenedRequest:function(e){n.getOpenedRequest("Mail",e)},hasOpenedRequests:function(e){n.hasOpenedRequests("Mail",e)},registerOnAllRequestsClosedHandler:n.registerOnAllRequestsClosedHandler,send:function(e,t,a,l){var h=s("4+IO"),d="GetMessagesBodies"===e?1e5:void 0;t&&!t.AccountID&&(t.AccountID=h.currentAccountId()),n.send(r.ServerModuleName,e,t,function(e,t){if(!e.Result&&4002===e.ErrorCode){var n=s("jonm"),r=o.pInt(t.Parameters.AccountID);n.getAccount(r).passwordMightBeIncorrect(!0)}i.isFunction(a)&&a.apply(l,[e,t])},null,d)}}},UvKh:function(e,t,s){"use strict";function i(){this.senderList=n.observableArray([]),this.senderAccountId=n.observable(l.currentId()),this.selectedFetcherOrIdentity=n.observable(null),this.lockSelectedSender=n.observable(!1),this.selectedSender=n.observable(""),this.selectedSender.subscribe(function(){if(!this.lockSelectedSender()){var e=l.getAccount(this.senderAccountId()),t=this.selectedSender(),s=null;r.isNonEmptyString(t)&&(0===t.indexOf("fetcher")?(t=t.replace("fetcher",""),s=o.find(e.fetchers(),function(e){return e.id()===r.pInt(t)})):s=o.find(e.identities(),function(e){return e.id()===r.pInt(t)})),s&&this.selectedFetcherOrIdentity(s)}},this)}var o=s("F/us"),n=s("0h2I"),r=s("AFLV"),a=s("Cq+9"),l=s("jonm");i.prototype.changeSelectedSender=function(e){if(e){var t=r.pString(e.id());e.FETCHER&&(t="fetcher"+t),o.find(this.senderList(),function(e){return e.id===t})&&(this.lockSelectedSender(!0),this.selectedSender(t),this.selectedFetcherOrIdentity(e),this.lockSelectedSender(!1))}},i.prototype.changeSenderAccountId=function(e,t){var s=!1;this.senderAccountId()!==e&&(l.hasAccountWithId(e)?(this.senderAccountId(e),s=!0):l.hasAccountWithId(this.senderAccountId())||(this.senderAccountId(l.currentId()),s=!0)),(s||0===this.senderList().length)&&(this.fillSenderList(t),s=!0),!s&&t&&this.changeSelectedSender(t)},i.prototype.fillSenderList=function(e){var t=[],s=l.getAccount(this.senderAccountId());s&&(o.isArray(s.identities())&&o.each(s.identities(),function(e){t.push({fullEmail:e.fullEmail(),id:r.pString(e.id())})},this),s.identitiesSubscribtion&&s.identitiesSubscribtion.dispose(),s.identitiesSubscribtion=s.identities.subscribe(function(){this.fillSenderList(e),this.changeSelectedSender(s.getDefaultIdentity())},this),o.each(s.fetchers(),function(e){var s=e.fullEmail();e.isEnabled()&&e.isOutgoingEnabled()&&s.length>0&&t.push({fullEmail:s,id:"fetcher"+e.id()})},this),s.fetchersSubscribtion&&s.fetchersSubscribtion.dispose(),s.fetchersSubscribtion=s.fetchers.subscribe(function(){this.fillSenderList(e)},this)),this.senderList(t),this.changeSelectedSender(e)},i.prototype.setFetcherOrIdentityByReplyMessage=function(e){var t=e.oTo.aCollection.concat(e.oCc.aCollection),s=a.getFirstFetcherOrIdentityByRecipientsOrDefault(t,e.accountId());s&&this.changeSelectedSender(s)},e.exports=new i},XTZw:function(e,t,s){"use strict";function i(){this.folderName=r.observable(""),this.messageUid=r.observable(""),this.cid=r.observable(""),this.contentLocation=r.observable(""),this.inline=r.observable(!1),this.linked=r.observable(!1),this.mimePartIndex=r.observable(""),this.messagePart=r.observable(null),u.call(this),this.content=r.observable(""),this.isMessageType=r.computed(function(){return this.mimeType(),this.mimePartIndex(),"message/rfc822"===this.mimeType()},this)}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("RN+F"),l=s("AFLV"),h=s("IAk5"),d=s("ZCBP"),u=s("cGGv"),c=s("UN2P");o.extendOwn(i.prototype,u.prototype),i.prototype.getNewInstance=function(){return new i},i.prototype.getCopy=function(){var e=new i;return e.copyProperties(this),e},i.prototype.copyProperties=function(e){this.fileName(e.fileName()),this.tempName(e.tempName()),this.size(e.size()),this.hash(e.hash()),this.mimeType(e.mimeType()),this.cid(e.cid()),this.contentLocation(e.contentLocation()),this.inline(e.inline()),this.linked(e.linked()),this.thumbnailSrc(e.thumbnailSrc()),this.thumbnailLoaded(e.thumbnailLoaded()),this.statusText(e.statusText()),this.uploaded(e.uploaded()),this.oActionsData=e.oActionsData,this.actions(e.actions()),this.thumbUrlInQueue(e.thumbUrlInQueue())},i.prototype.additionalParse=function(e){this.content(l.pString(e.Content)),this.mimePartIndex(l.pString(e.MimePartIndex)),this.isMessageType()&&""===this.mimePartIndex()&&this.actions(o.without(this.actions(),"view")),this.cid(l.pString(e.CID)),this.contentLocation(l.pString(e.ContentLocation)),this.inline(!!e.IsInline),this.linked(!!e.IsLinked),h.broadcastEvent("MailWebclient::ParseFile::after",this)},i.prototype.setMessageData=function(e,t){this.folderName(e),this.messageUid(t)},i.prototype.onGetMessageResponse=function(e,t){var i=t.Parameters,o=(e=e.Result,new(s("Nfk5")));e&&this.oNewWindow&&(o.parse(e,i.AccountID,!1,!0),this.messagePart(o),this.messagePart().viewMessage(this.oNewWindow),this.oNewWindow=void 0)},i.prototype.viewFile=function(){this.isMessageType()?this.viewMessageFile():this.viewCommonFile()},i.prototype.viewMessageFile=function(){var e=null,t='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+a.i18n("COREWEBCLIENT/INFO_LOADING")+"</div>";(e=d.open("",this.fileName()))&&(this.messagePart()?this.messagePart().viewMessage(e):(n(e.document.body).html(t),this.oNewWindow=e,c.send("GetMessage",{Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()},this.onGetMessageResponse,this)),e.focus())},i.prototype.fillDataAfterUploadComplete=function(e,t){this.cid(l.pString(t)),e&&e.Result&&e.Result.Attachment&&(this.tempName(l.pString(e.Result.Attachment.TempName)),this.mimeType(l.pString(e.Result.Attachment.MimeType)),this.size(l.pInt(e.Result.Attachment.Size)),this.hash(l.pString(e.Result.Attachment.Hash)),this.parseActions(e.Result.Attachment))},i.prototype.parseFromUpload=function(e,t,s){this.setMessageData(t,s),this.fileName(l.pString(e.Name)),this.tempName(e.TempName?l.pString(e.TempName):this.fileName()),this.mimeType(l.pString(e.MimeType)),this.size(l.pInt(e.Size)),this.hash(l.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),this.uploadStarted(!1)},i.prototype.parseActions=function(e){this.thumbUrlInQueue(""!==l.pString(e.ThumbnailUrl)?l.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(e),this.isMessageType()?""!==this.folderName()&&""!==this.messageUid()?(this.hasAction("view")||this.actions.unshift("view"),this.otherTemplates.push({name:"MailWebclient_PrintMessageView",data:this.messagePart})):this.actions(o.without(this.actions(),"view")):this.commonExcludeActions()},i.prototype.errorFromUpload=function(){this.uploaded(!0),this.uploadError(!0),this.uploadStarted(!1),this.statusText(a.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"))},e.exports=i},a28q:function(e,t,s){"use strict";function i(e,t){this.oParent=t,this.creaId="creaId"+Math.random().toString().replace(".",""),this.textFocused=r.observable(!1),this.workareaDom=r.observable(),this.uploaderAreaDom=r.observable(),this.editorUploaderBodyDragOver=r.observable(!1),this.htmlEditorDom=r.observable(),this.toolbarDom=r.observable(),this.colorPickerDropdownDom=r.observable(),this.insertLinkDropdownDom=r.observable(),this.insertImageDropdownDom=r.observable(),this.isFWBold=r.observable(!1),this.isFSItalic=r.observable(!1),this.isTDUnderline=r.observable(!1),this.isTDStrikeThrough=r.observable(!1),this.isEnumeration=r.observable(!1),this.isBullets=r.observable(!1),this.isEnable=r.observable(!0),this.isEnable.subscribe(function(){this.oCrea&&this.oCrea.setEditable(this.isEnable())},this),this.bInsertImageAsBase64=e,this.bAllowFileUpload=!(e&&void 0===window.File),this.bAllowInsertImage=v.AllowInsertImage,this.lockFontSubscribing=r.observable(!1),this.bAllowImageDragAndDrop=!u.ie10AndAbove,this.aFonts=["Arial","Arial Black","Courier New","Tahoma","Times New Roman","Verdana"],this.sDefaultFont=v.DefaultFontName,this.correctFontFromSettings(),this.selectedFont=r.observable(""),this.selectedFont.subscribe(function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontName(this.selectedFont())},this),this.iDefaultSize=v.DefaultFontSize,this.selectedSize=r.observable(0),this.selectedSize.subscribe(function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontSize(this.selectedSize())},this),this.visibleInsertLinkPopup=r.observable(!1),this.linkForInsert=r.observable(""),this.linkFocused=r.observable(!1),this.visibleLinkPopup=r.observable(!1),this.linkPopupDom=r.observable(null),this.linkHrefDom=r.observable(null),this.linkHref=r.observable(""),this.visibleLinkHref=r.observable(!1),this.visibleImagePopup=r.observable(!1),this.visibleImagePopup.subscribe(function(){this.onImageOut()},this),this.imagePopupTop=r.observable(0),this.imagePopupLeft=r.observable(0),this.imageSelected=r.observable(!1),this.tooltipText=r.observable(""),this.tooltipPopupTop=r.observable(0),this.tooltipPopupLeft=r.observable(0),this.visibleInsertImagePopup=r.observable(!1),this.imageUploaderButton=r.observable(null),this.aUploadedImagesData=[],this.imagePathFromWeb=r.observable(""),this.visibleFontColorPopup=r.observable(!1),this.oFontColorPickerView=new F(l.i18n("MAILWEBCLIENT/LABEL_TEXT_COLOR"),this.setTextColorFromPopup,this),this.oBackColorPickerView=new F(l.i18n("MAILWEBCLIENT/LABEL_BACKGROUND_COLOR"),this.setBackColorFromPopup,this),this.inactive=r.observable(!1),this.sPlaceholderText="",this.bAllowChangeInputDirection=p.IsRTL||v.AllowChangeInputDirection,this.disableEdit=r.observable(!1),this.textChanged=r.observable(!1),this.actualTextСhanged=r.observable(!1)}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("Ol7c"),l=s("RN+F"),h=s("AFLV"),d=s("IAk5"),u=s("HLSX"),c=s("mjrp"),p=s("hPb3"),m=s("76Kh"),f=s("1grR"),g=s("XTZw"),b=s("sWkr"),y=s("4+IO"),v=s("p2hp"),F=s("jDNX");i.prototype.ViewTemplate="MailWebclient_HtmlEditorView",i.prototype.setInactive=function(e){this.inactive(e),this.inactive()?this.setPlaceholder():this.removePlaceholder()},i.prototype.setPlaceholder=function(){var e=this.removeAllTags(this.getText());""!==e&&"&nbsp;"!==e||(this.setText("<span>"+this.sPlaceholderText+"</span>"),this.oCrea&&this.oCrea.setBlur())},i.prototype.removePlaceholder=function(){(this.oCrea?this.removeAllTags(this.oCrea.getText(!1)):"")===this.sPlaceholderText&&(this.setText(""),this.oCrea&&this.oCrea.setFocus(!0))},i.prototype.hasOpenedPopup=function(){return this.visibleInsertLinkPopup()||this.visibleLinkPopup()||this.visibleImagePopup()||this.visibleInsertImagePopup()||this.visibleFontColorPopup()},i.prototype.setDisableEdit=function(e){this.disableEdit(!!e)},i.prototype.correctFontFromSettings=function(){var e=this.sDefaultFont,t=!1;o.each(this.aFonts,function(s){s.toLowerCase()===e.toLowerCase()&&(e=s,t=!0)}),t?this.sDefaultFont=e:this.aFonts.push(e)},i.prototype.showLinkPopup=function(e){var t=n(this.workareaDom()),s=t.closest(".panel.compose"),i=t.position(),o=e.position(),r=e.height(),a=Math.round(o.left+i.left),l=Math.round(o.top+r+i.top);this.linkHref(e.attr("href")||e.text()),n(this.linkPopupDom()).css({left:a,top:l}),n(this.linkHrefDom()).css({left:a,top:l}),u.firefox||1!==s.length||n(this.linkPopupDom()).css({"max-width":s.width()-a-40+"px","white-space":"pre-line","word-wrap":"break-word"}),this.visibleLinkPopup(!0)},i.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)},i.prototype.showChangeLink=function(){this.visibleLinkHref(!0),this.hideLinkPopup()},i.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref()),this.hideChangeLink()},i.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)},i.prototype.showImagePopup=function(e,t){var s=n(this.workareaDom()),i=s.position(),o=s.offset();this.imagePopupLeft(Math.round(t.pageX+i.left-o.left)),this.imagePopupTop(Math.round(t.pageY+i.top-o.top)),this.visibleImagePopup(!0)},i.prototype.hideImagePopup=function(){this.visibleImagePopup(!1)},i.prototype.resizeImage=function(e){var t={width:"auto",height:"auto"};switch(e){case Enums.HtmlEditorImageSizes.Small:t.width="300px";break;case Enums.HtmlEditorImageSizes.Medium:t.width="600px";break;case Enums.HtmlEditorImageSizes.Large:t.width="1200px";break;case Enums.HtmlEditorImageSizes.Original:t.width="auto"}this.oCrea.changeCurrentImage(t),this.visibleImagePopup(!1)},i.prototype.onImageOver=function(e){if("IMG"===e.target.nodeName&&!this.visibleImagePopup()){this.imageSelected(!0),this.tooltipText(l.i18n("MAILWEBCLIENT/ACTION_CLICK_TO_EDIT_IMAGE"));var t=this,s=n(this.workareaDom());s.bind("mousemove.image",function(e){var i=s.position(),o=s.offset();t.tooltipPopupTop(Math.round(e.pageY+i.top-o.top)),t.tooltipPopupLeft(Math.round(e.pageX+i.left-o.left))})}return!0},i.prototype.onImageOut=function(e){if(this.imageSelected()){this.imageSelected(!1);n(this.workareaDom()).unbind("mousemove.image")}return!0},i.prototype.commit=function(){this.textChanged(!1)},i.prototype.init=function(e,t,s,i){this.sPlaceholderText=i||"",this.oCrea?(this.oCrea.$container=n("#"+this.oCrea.oOptions.creaId),0===this.oCrea.$container.children().length&&(this.oCrea.start(this.isEnable()),this.initEditorUploader())):(n(document.body).on("click",o.bind(function(e){0===n(e.target).parents("span.dropdown_helper").length&&this.closeAllPopups(!0)},this)),this.initEditorUploader(),this.oCrea=new b({creaId:this.creaId,fontNameArray:this.aFonts,defaultFontName:this.sDefaultFont,defaultFontSize:this.iDefaultSize,alwaysTryUseImageWhilePasting:v.AlwaysTryUseImageWhilePasting,isRtl:p.IsRTL,enableDrop:!1,onChange:o.bind(function(){this.textChanged(!0),this.actualTextСhanged.valueHasMutated()},this),onCursorMove:o.bind(this.setFontValuesFromText,this),onFocus:o.bind(this.onCreaFocus,this),onBlur:o.bind(this.onCreaBlur,this),onUrlIn:o.bind(this.showLinkPopup,this),onUrlOut:o.bind(this.hideLinkPopup,this),onImageSelect:o.bind(this.showImagePopup,this),onImageBlur:o.bind(this.hideImagePopup,this),onItemOver:u.mobileDevice||d.isMobile()?null:o.bind(this.onImageOver,this),onItemOut:u.mobileDevice||d.isMobile()?null:o.bind(this.onImageOut,this),openInsertLinkDialog:o.bind(this.insertLink,this),onUrlClicked:!0}),this.oCrea.start(this.isEnable())),this.oCrea.setTabIndex(s),this.clearUndoRedo(),this.setText(e,t),this.setFontValuesFromText(),this.aUploadedImagesData=[],this.selectedFont(this.sDefaultFont),this.selectedSize(this.iDefaultSize)},i.prototype.isInitialized=function(){return!!this.oCrea},i.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus(!1)},i.prototype.changeSignatureContent=function(e,t){this.oCrea&&this.oCrea.changeSignatureContent(e,t)},i.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0),this.isFWBold(this.oCrea.getIsBold()),this.isFSItalic(this.oCrea.getIsItalic()),this.isTDUnderline(this.oCrea.getIsUnderline()),this.isTDStrikeThrough(this.oCrea.getIsStrikeThrough()),this.isEnumeration(this.oCrea.getIsEnumeration()),this.isBullets(this.oCrea.getIsBullets()),this.selectedFont(this.oCrea.getFontName()),this.selectedSize(this.oCrea.getFontSizeInNumber().toString()),this.lockFontSubscribing(!1)},i.prototype.isUndoAvailable=function(){return!!this.oCrea&&this.oCrea.isUndoAvailable()},i.prototype.getPlainText=function(){return this.oCrea?this.oCrea.getPlainText():""},i.prototype.getText=function(e){var t=this.oCrea?this.oCrea.getText(e):"";return""!==this.sPlaceholderText&&this.removeAllTags(t)===this.sPlaceholderText?"":t},i.prototype.setText=function(e,t){this.oCrea&&(t?this.oCrea.setPlainText(e):this.oCrea.setText(e),this.inactive()&&""===e&&this.setPlaceholder())},i.prototype.undoAndClearRedo=function(){this.oCrea&&(this.oCrea.undo(),this.oCrea.clearRedo())},i.prototype.clearUndoRedo=function(){this.oCrea&&this.oCrea.clearUndoRedo()},i.prototype.isEditing=function(){return!!this.oCrea&&this.oCrea.bEditing},i.prototype.removeAllTags=function(e){return e.replace(/<style>.*<\/style>/g,"").replace(/<[^>]*>/g,"")},i.prototype.onCreaFocus=function(){this.oCrea&&(this.closeAllPopups(),this.textFocused(!0))},i.prototype.onCreaBlur=function(){this.oCrea&&this.textFocused(!1)},i.prototype.onEscHandler=function(){m.hasOpenedMaximizedPopups()||this.closeAllPopups()},i.prototype.closeAllPopups=function(e){(e=!!e)||this.visibleLinkPopup(!1),this.visibleInsertLinkPopup(!1),this.visibleImagePopup(!1),this.visibleInsertImagePopup(!1),this.visibleFontColorPopup(!1)},i.prototype.insertHtml=function(e){this.oCrea&&(this.oCrea.isFocused()||this.oCrea.setFocus(!0),this.oCrea.insertHtml(e,!1))},i.prototype.insertLink=function(e,t){this.inactive()||this.visibleInsertLinkPopup()||(t&&o.isFunction(t.stopPropagation)&&t.stopPropagation(),this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))},i.prototype.insertLinkFromPopup=function(e,t){return this.linkForInsert().length>0&&(a.isCorrectEmail(this.linkForInsert())?this.oCrea.insertEmailLink(this.linkForInsert()):this.oCrea.insertLink(this.linkForInsert())),this.closeInsertLinkPopup(e,t),!1},i.prototype.closeInsertLinkPopup=function(e,t){this.visibleInsertLinkPopup(!1),t&&t.stopPropagation()},i.prototype.textColor=function(e,t){this.inactive()||(this.closeAllPopups(),this.visibleFontColorPopup()||(t.stopPropagation(),this.visibleFontColorPopup(!0),this.oFontColorPickerView.onShow(),this.oBackColorPickerView.onShow()))},i.prototype.colorToHex=function(e){if("#"===e.substr(0,1))return e;for(var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),s=h.pInt(t[2]),i=h.pInt(t[3]),o=(h.pInt(t[4])|i<<8|s<<16).toString(16);o.length<6;)o="0"+o;return t[1]+"#"+o},i.prototype.setTextColorFromPopup=function(e){this.oCrea.textColor(this.colorToHex(e)),this.closeAllPopups()},i.prototype.setBackColorFromPopup=function(e){this.oCrea.backgroundColor(this.colorToHex(e)),this.closeAllPopups()},i.prototype.insertImage=function(e,t){return this.inactive()||!v.AllowInsertImage||this.visibleInsertImagePopup()||(t.stopPropagation(),this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader()),!0},i.prototype.insertWebImageFromPopup=function(e,t){v.AllowInsertImage&&this.imagePathFromWeb().length>0&&this.oCrea.insertImage(this.imagePathFromWeb()),this.closeInsertImagePopup(e,t)},i.prototype.insertComputerImageFromPopup=function(e,t){var s=new g,i="";s.parse(t),i=s.getActionUrl("view"),v.AllowInsertImage&&i.length>0&&this.oCrea.insertImage(i)&&(n(this.oCrea.$editableArea).find('img[src="'+i+'"]').attr("data-x-src-cid",e),t.CID=e,this.aUploadedImagesData.push(t)),this.closeInsertImagePopup()},i.prototype.getUploadedImagesData=function(){return this.aUploadedImagesData},i.prototype.closeInsertImagePopup=function(e,t){this.visibleInsertImagePopup(!1),t&&t.stopPropagation()},i.prototype.initUploader=function(){this.imageUploaderButton()&&(this.oJua=new c({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),hiddenElementsPosition:p.IsRTL?"right":"left",disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:o.extendOwn({Module:v.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:y.currentAccountId()})}},d.getCommonRequestParameters())}),this.bInsertImageAsBase64?this.oJua.on("onSelect",o.bind(this.onEditorDrop,this)):this.oJua.on("onSelect",o.bind(this.onFileUploadSelect,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)))},i.prototype.initEditorUploader=function(){if(v.AllowInsertImage&&this.uploaderAreaDom()){var e=null,t=null;this.oParent&&this.oParent.composeUploaderDragOver&&this.oParent.onFileUploadProgress&&this.oParent.onFileUploadStart&&this.oParent.onFileUploadComplete?(e=o.bind(function(){this.editorUploaderBodyDragOver(!0),this.oParent.composeUploaderDragOver(!0)},this),t=o.bind(function(){this.editorUploaderBodyDragOver(!1),this.oParent.composeUploaderDragOver(!1)},this),this.editorUploader=new c({action:"?/Api/",name:"jua-uploader",queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop,hidden:o.extendOwn({Module:v.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:y.currentAccountId()})}},d.getCommonRequestParameters())}),this.editorUploader.on("onDragEnter",o.bind(this.oParent.composeUploaderDragOver,this.oParent,!0)).on("onDragLeave",o.bind(this.oParent.composeUploaderDragOver,this.oParent,!1)).on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onProgress",o.bind(this.oParent.onFileUploadProgress,this.oParent)).on("onSelect",o.bind(this.onEditorDrop,this)).on("onStart",o.bind(this.oParent.onFileUploadStart,this.oParent)).on("onComplete",o.bind(this.oParent.onFileUploadComplete,this.oParent))):(e=o.bind(this.editorUploaderBodyDragOver,this,!0),t=o.bind(this.editorUploaderBodyDragOver,this,!1),this.editorUploader=new c({queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop}),this.editorUploader.on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onSelect",o.bind(this.onEditorDrop,this)))}},i.prototype.isDragAndDropSupported=function(){return!!this.editorUploader&&this.editorUploader.isDragAndDropSupported()},i.prototype.onEditorDrop=function(e,t){var s=null,i=null,o=this,n=!1,r=Math.random().toString(),a="";if(t&&t.File&&"string"==typeof t.File.type)if(v.AllowInsertImage&&0===t.File.type.indexOf("image/"))i=t.File,v.ImageUploadSizeLimit>0&&i.size>v.ImageUploadSizeLimit?m.showPopup(f,[l.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE")]):(s=new window.FileReader,(n=this.oCrea.isFocused())||this.oCrea.setFocus(!0),a=i.name+"_"+r,this.oCrea.insertHtml('<img id="'+a+'" src="./static/styles/images/wait.gif" />',!0),n||this.oCrea.fixFirefoxCursorBug(),s.onload=function(e){o.oCrea.changeImageSource(a,e.target.result)},s.readAsDataURL(i));else{if(this.oParent&&this.oParent.onFileUploadSelect)return this.oParent.onFileUploadSelect(e,t),!0;u.ie10AndAbove||m.showPopup(f,[l.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")])}return!1},i.prototype.isFileImage=function(e){if("string"==typeof e.Type)return-1!==e.Type.indexOf("image");var t=e.FileName.lastIndexOf("."),s=e.FileName.substr(t+1);return-1!==n.inArray(s,["jpg","jpeg","gif","tif","tiff","png"])},i.prototype.onFileUploadSelect=function(e,t){return this.isFileImage(t)?(this.closeInsertImagePopup(),!0):(m.showPopup(f,[l.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")]),!1)},i.prototype.onFileUploadComplete=function(e,t,s){var i="";s&&s.Result?s.Result.Error?(i="size"===s.Result.Error?l.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):l.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"),m.showPopup(f,[i])):(this.oCrea.setFocus(!0),this.insertComputerImageFromPopup(e,s.Result.Attachment)):m.showPopup(f,[l.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN")])},i.prototype.undo=function(){return this.inactive()||this.oCrea.undo(),!1},i.prototype.redo=function(){return this.inactive()||this.oCrea.redo(),!1},i.prototype.bold=function(){return this.inactive()||(this.oCrea.bold(),this.isFWBold(!this.isFWBold())),!1},i.prototype.italic=function(){return this.inactive()||(this.oCrea.italic(),this.isFSItalic(!this.isFSItalic())),!1},i.prototype.underline=function(){return this.inactive()||(this.oCrea.underline(),this.isTDUnderline(!this.isTDUnderline())),!1},i.prototype.strikeThrough=function(){return this.inactive()||(this.oCrea.strikeThrough(),this.isTDStrikeThrough(!this.isTDStrikeThrough())),!1},i.prototype.numbering=function(){return this.inactive()||(this.oCrea.numbering(),this.isBullets(!1),this.isEnumeration(!this.isEnumeration())),!1},i.prototype.bullets=function(){return this.inactive()||(this.oCrea.bullets(),this.isEnumeration(!1),this.isBullets(!this.isBullets())),!1},i.prototype.removeFormat=function(){return this.inactive()||this.oCrea.removeFormat(),!1},i.prototype.setRtlDirection=function(){return this.inactive()||this.oCrea.setRtlDirection(),!1},i.prototype.setLtrDirection=function(){return this.inactive()||this.oCrea.setLtrDirection(),!1},e.exports=i},bBfe:function(e,t,s){"use strict";function i(){this.FETCHER=!0,this.id=o.observable(0),this.accountId=o.observable(0),this.hash=o.computed(function(){return a.getHash(this.accountId()+"fetcher"+this.id())},this),this.isEnabled=o.observable(!1),this.isLocked=o.observable(!1).extend({autoResetToFalse:1e3}),this.email=o.observable(""),this.userName=o.observable(""),this.folder=o.observable(""),this.useSignature=o.observable(!1),this.signature=o.observable(""),this.incomingServer=o.observable(""),this.incomingPort=o.observable(0),this.incomingUseSsl=o.observable(!1),this.incomingLogin=o.observable(""),this.leaveMessagesOnServer=o.observable(""),this.isOutgoingEnabled=o.observable(!1),this.outgoingServer=o.observable(""),this.outgoingPort=o.observable(0),this.outgoingUseSsl=o.observable(!1),this.outgoingUseAuth=o.observable(!1),this.iCheckIntervalMinutes=0,this.fullEmail=o.computed(function(){return n.getFullEmail(this.userName(),this.email())},this)}var o=s("0h2I"),n=s("Ol7c"),r=s("AFLV"),a=s("Yjhd");i.prototype.parse=function(e){this.id(r.pInt(e.EntityId)),this.accountId(r.pInt(e.IdAccount)),this.isEnabled(!!e.IsEnabled),this.isLocked(!!e.IsLocked),this.email(r.pString(e.Email)),this.userName(r.pString(e.Name)),this.folder(r.pString(e.Folder)),this.useSignature(!!e.UseSignature),this.signature(r.pString(e.Signature)),this.incomingServer(r.pString(e.IncomingServer)),this.incomingPort(r.pInt(e.IncomingPort)),this.incomingUseSsl(!!e.IncomingUseSsl),this.incomingLogin(r.pString(e.IncomingLogin)),this.leaveMessagesOnServer(!!e.LeaveMessagesOnServer),this.isOutgoingEnabled(!!e.IsOutgoingEnabled),this.outgoingServer(r.pString(e.OutgoingServer)),this.outgoingPort(r.pInt(e.OutgoingPort)),this.outgoingUseSsl(!!e.OutgoingUseSsl),this.outgoingUseAuth(!!e.OutgoingUseAuth),this.iCheckIntervalMinutes=r.pInt(e.CheckInterval,0)},e.exports=i},cGGv:function(e,t,s){"use strict";function i(){this.id=r.observable(""),this.index=r.observable(0),this.fileName=r.observable(""),this.tempName=r.observable(""),this.displayName=r.observable(""),this.extension=r.observable(""),this.fileName.subscribe(function(e){this.id(e),this.displayName(e),this.extension(c.getFileExtension(e))},this),this.size=r.observable(0),this.friendlySize=r.computed(function(){return this.size()>0?h.getFriendlySize(this.size()):""},this),this.hash=r.observable(""),this.thumbUrlInQueue=r.observable(""),this.thumbUrlInQueueSubscribtion=this.thumbUrlInQueue.subscribe(function(){this.getInThumbQueue()},this),this.thumbnailSrc=r.observable(""),this.thumbnailLoaded=r.observable(!1),this.thumbnailSessionUid=r.observable(""),this.mimeType=r.observable(""),this.uploadUid=r.observable(""),this.uploaded=r.observable(!1),this.uploadError=r.observable(!1),this.downloading=r.observable(!1),this.isViewMimeType=r.computed(function(){return-1!==n.inArray(this.mimeType(),m)},this),this.bHasHtmlEmbed=!1,this.otherTemplates=r.observableArray([]),this.visibleCancelButton=r.observable(!0),this.statusText=r.observable(""),this.statusTooltip=r.computed(function(){return this.uploadError()?this.statusText():""},this),this.progressPercent=r.observable(0),this.visibleProgress=r.observable(!1),this.uploadStarted=r.observable(!1),this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this),this.downloading.subscribe(function(){this.downloading()?this.visibleProgress(!0):(this.visibleProgress(!1),this.progressPercent(0))},this),this.allowDrag=r.observable(!1),this.allowUpload=r.observable(!1),this.allowPublicLink=r.observable(!1),this.bIsSecure=r.observable(!1),this.isShared=r.observable(!1),this.sHeaderText="",this.oActionsData={view:{Text:h.i18n("COREWEBCLIENT/ACTION_VIEW_FILE"),Handler:o.bind(function(){this.viewFile()},this)},download:{Text:h.i18n("COREWEBCLIENT/ACTION_DOWNLOAD_FILE"),Handler:o.bind(function(){this.downloadFile()},this),Tooltip:r.computed(function(){var e=h.i18n("COREWEBCLIENT/INFO_CLICK_TO_DOWNLOAD_FILE",{FILENAME:this.fileName(),SIZE:this.friendlySize()});return""===this.friendlySize()&&(e=e.replace(" ()","")),e},this)}},this.allowActions=r.observable(!0),this.iconAction=r.observable("download"),this.cssClasses=r.computed(function(){return this.getCommonClasses().join(" ")},this),this.actions=r.observableArray([]),this.firstAction=r.computed(function(){return this.actions().length>1?this.actions()[0]:""},this),this.secondAction=r.computed(function(){return 1===this.actions().length?this.actions()[0]:this.actions().length>1?this.actions()[1]:""},this),this.subFiles=r.observableArray([]),this.subFilesExpanded=r.observable(!1)}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("IAk5"),l=s("QFUI"),h=s("RN+F"),d=s("AFLV"),u=s("ZP6a"),c=s("Yjhd"),p=s("ZCBP"),m=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"],f=[];n("html").hasClass("pdf")&&(m.push("application/pdf"),m.push("application/x-pdf")),i.prototype.addAction=function(e,t,s){t?this.actions.unshift(e):this.actions.push(e),this.actions(o.compact(this.actions())),s&&(this.oActionsData[e]=s)},i.prototype.removeAction=function(e){this.actions(o.without(this.actions(),e))},i.prototype.getMainAction=function(){return this.actions()[0]},i.prototype.hasAction=function(e){return-1!==o.indexOf(this.actions(),e)},i.prototype.getActionText=function(e){return this.hasAction(e)&&this.oActionsData[e]&&("string"==typeof this.oActionsData[e].Text||o.isFunction(this.oActionsData[e].Text))?o.isFunction(this.oActionsData[e].Text)?this.oActionsData[e].Text():this.oActionsData[e].Text:""},i.prototype.getActionUrl=function(e){return this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Url||"":""},i.prototype.executeAction=function(e){this.hasAction(e)&&this.oActionsData[e]&&o.isFunction(this.oActionsData[e].Handler)&&this.oActionsData[e].Handler()},i.prototype.getTooltip=function(e){var t=this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Tooltip:"";return"string"==typeof t?t:o.isFunction(t)?t():""},i.prototype.getCommonClasses=function(){var e=[];return(this.allowUpload()&&!this.uploaded()||this.downloading())&&e.push("incomplete"),this.uploadError()?e.push("fail"):e.push("success"),e},i.prototype.parse=function(e){this.fileName(d.pString(e.FileName)),this.tempName(d.pString(e.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.mimeType(d.pString(e.MimeType)),this.size(e.EstimatedSize?d.pInt(e.EstimatedSize):d.pInt(e.SizeInBytes)),this.hash(d.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),n.isFunction(this.additionalParse)&&this.additionalParse(e)},i.prototype.parseActions=function(e){this.thumbUrlInQueue(""!==d.pString(e.ThumbnailUrl)?d.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(e),this.commonExcludeActions()},i.prototype.commonExcludeActions=function(){this.isViewSupported()||this.actions(o.without(this.actions(),"view"))},i.prototype.commonParseActions=function(e){o.each(e.Actions,function(e,t){this.oActionsData[t]||(this.oActionsData[t]={}),this.oActionsData[t].Url=d.pString(e.url),this.actions.push(t)},this)},i.addViewExtensions=function(e){o.isArray(e)&&(f=o.union(f,e))},i.prototype.isViewSupported=function(){return-1!==n.inArray(this.mimeType(),m)||-1!==n.inArray(this.extension(),f)},i.prototype.getInThumbQueue=function(){""===this.thumbUrlInQueue()||this.linked&&(!this.linked||this.linked())||(this.thumbnailSessionUid(Date.now().toString()),l.thumbQueue(this.thumbnailSessionUid(),this.thumbUrlInQueue(),this.thumbnailSrc))},i.prototype.downloadFile=function(){var e=this.getActionUrl("download"),t={File:this,CancelDownload:!1};e.length>0&&"#"!==e&&(a.broadcastEvent("AbstractFileModel::FileDownload::before",t),t.CancelDownload||(o.isFunction(t.CustomDownloadHandler)?t.CustomDownloadHandler():u.downloadByUrl(e)))},i.prototype.viewFile=function(e,t){c.calmEvent(t),this.viewCommonFile()},i.prototype.viewCommonFile=function(e){var t=null,s=null;d.isNonEmptyString(e)||(e=u.getAppPath()+this.getActionUrl("view")),e.length>0&&"#"!==e&&(s={sUrl:e,index:this.index(),bBreakView:!1},a.broadcastEvent("AbstractFileModel::FileView::before",s),s.bBreakView||(t=p.open(e,e,!1))&&t.focus())},i.prototype.eventDragStart=function(e,t){var s=t.originalEvent||t;return e&&s&&s.dataTransfer&&s.dataTransfer.setData&&s.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},i.prototype.generateTransferDownloadUrl=function(){var e=this.getActionUrl("download");return"http"!==e.substr(0,4)&&(e=u.getAppPath()+e),this.mimeType()+":"+this.fileName()+":"+e},i.prototype.onUploadSelect=function(e,t,s){s||(this.fileName(d.pString(t.FileName)),this.mimeType(d.pString(t.Type)),this.size(d.pInt(t.Size))),this.uploadUid(e),this.uploaded(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},i.prototype.onUploadStart=function(){this.visibleProgress(!0)},i.prototype.onUploadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(!0))},i.prototype.onDownloadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(this.progressPercent()<100))},i.prototype.onUploadComplete=function(e,t,s){var i=!(t&&s&&!s.ErrorCode&&s.Result&&!s.Result.Error),o=s&&s.ErrorCode&&s.ErrorCode===Enums.Errors.CanNotUploadFileLimit?h.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):h.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN");this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(i),this.statusText(i?o:h.i18n("COREWEBCLIENT/REPORT_UPLOAD_COMPLETE")),i||(this.fillDataAfterUploadComplete(s,e),setTimeout(function(e){return function(){e.statusText("")}}(this),3e3))},i.prototype.fillDataAfterUploadComplete=function(e,t){},i.prototype.onImageLoad=function(e,t){""===this.thumbUrlInQueue()||this.thumbnailLoaded()||(this.thumbnailLoaded(!0),l.thumbQueue(this.thumbnailSessionUid()))},i.prototype.stopDownloading=function(){this.downloading(!1)},i.prototype.startDownloading=function(){this.downloading(!0)},e.exports=i},cPXi:function(e,t,s){"use strict";var i=s("F/us"),o=s("IAk5"),n=s("hPb3"),r=s("jonm"),a=s("UN2P"),l=s("p2hp"),h=s("4+IO"),d=(s("xzvH"),{}),u=!1;d.prefetchFetchersIdentities=function(){return!(o.isNewTab()||u||!l.AllowFetchers&&!l.AllowIdentities)&&(r.populateFetchersIdentities(),u=!0,!0)},d.prefetchAccountFilters=function(){var e=r.getCurrent(),t=!1;return e&&e.allowFilters()&&!e.filters()&&(e.requestFilters(),t=!0),t},d.prefetchMessageList=function(e,t,s,i){var o={page:t,search:s,filters:i},n=e.hasListBeenRequested(o),r=null;return r=h.requestMessageList(e.fullName(),o.page,o.search,o.filters,l.MessagesSortBy.DefaultSortBy,l.MessagesSortBy.DefaultSortOrder,!1,!1,n),!n&&!!r&&r.RequestStarted},d.prefetchStarredMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,s=!1;return t&&(s=this.prefetchMessageList(t,1,"",Enums.FolderFilter.Flagged)),s},d.prefetchUnseenMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,s=!1;return t&&(s=this.prefetchMessageList(t,1,"",Enums.FolderFilter.Unseen)),s},d.prefetchNextPage=function(e){var t=h.uidList(),s=i.indexOf(t.collection(),e),o=Math.ceil(s/l.MailsPerPage)+1;this.startPagePrefetch(o-1)},d.prefetchPrevPage=function(e){var t=h.uidList(),s=i.indexOf(t.collection(),e),o=Math.ceil((s+1)/l.MailsPerPage)+1;this.startPagePrefetch(o)},d.startPagePrefetch=function(e){var t=h.folderList().currentFolder(),s=h.uidList(),i=(e-1)*l.MailsPerPage,o=e>0&&i<s.resultCount(),n=!1;return t&&!t.hasChanges()&&o&&(n=this.prefetchMessageList(t,e,s.search(),"")),n},d.startOtherFoldersPrefetch=function(){var e=h.folderList(),t=e.currentFolderFullName(),s=h.getNamesOfFoldersToRefresh(),o=e?[e.inboxFolderFullName(),e.sentFolderFullName(),e.draftsFolderFullName(),e.spamFolderFullName()]:[],n=s.length<5?this.getOtherFolderNames(5-s.length):[],r=i.uniq(i.compact(i.union(o,s,n))),a=!1;return i.each(r,i.bind(function(s){a||t===s||(a=this.startFolderPrefetch(e.getFolderByFullName(s)))},this)),a},d.getOtherFolderNames=function(e){var t=h.folderList().inboxFolder(),s=t?t.subfolders():[],o=i.filter(h.folderList().collection(),function(e){return!e.isSystem()},this),n=i.first(i.union(s,o),e);return i.map(n,function(e){return e.fullName()})},d.startFolderPrefetch=function(e){var t=!1;return e&&(t=this.prefetchMessageList(e,1,"","")),t},d.startThreadListPrefetch=function(){var e=[],t=h.getCurrentFolder();return i.each(h.messages(),function(s){s.threadCount()>0&&i.each(s.threadUids(),function(s){t.hasThreadUidBeenRequested(s)||e.push(s)})},this),e.length>0&&(e=e.slice(0,l.MailsPerPage),t.addRequestedThreadUids(e),t.loadThreadMessages(e),!0)},d.startMessagesPrefetch=function(){var e=h.currentAccountId(),t=h.getCurrentFolder(),s=t?t.fullName():"",o=0,n=l.MaxMessagesBodiesSizeToPrefetch,r=[],d=null,u=function(e){var s=!e.deleted()&&!e.completelyFilled(),a=!i.find(r,function(t){return t===e.uid()},this),h=!t.hasUidBeenRequested(e.uid()),d=e.textSize()<l.MessageBodyTruncationThreshold?e.textSize():l.MessageBodyTruncationThreshold;o<n&&s&&a&&h&&(r.push(e.uid()),o+=d+2048)};return!!(t&&t.selected()&&(i.each(h.messages(),u),t.doForAllMessages(u),r.length>0))&&(t.addRequestedUids(r),d={AccountID:e,Folder:s,Uids:r,MessageBodyTruncationThreshold:l.MessageBodyTruncationThreshold},a.send("GetMessagesBodies",d,this.onGetMessagesBodiesResponse,this),!0)},d.onGetMessagesBodiesResponse=function(e,t){var s=t.Parameters,o=h.getFolderByFullName(s.AccountID,s.Folder);i.isArray(e.Result)&&i.each(e.Result,function(e){o.parseAndCacheMessage(e,!1,!1)})},d.prefetchAccountQuota=function(){var e=r.getCurrent(),t=e&&!e.quotaRecieved();return!(!n.ShowQuotaBar||!t)&&(e.updateQuotaParams(),!0)},e.exports={startMin:function(){var e=!1;return(e=d.prefetchFetchersIdentities())||(e=d.prefetchAccountFilters()),e||(e=d.prefetchStarredMessageList()),e||(e=d.prefetchAccountQuota()),e},startAll:function(){var e=!1;return(e=d.prefetchFetchersIdentities())||(e=d.prefetchAccountFilters()),e||(e=d.startMessagesPrefetch()),e||(e=d.startThreadListPrefetch()),e||(e=d.prefetchStarredMessageList()),e||(e=d.startPagePrefetch(h.page()+1)),e||(e=d.startPagePrefetch(h.page()-1)),e||(e=d.prefetchUnseenMessageList()),e||(e=d.prefetchAccountQuota()),e||(e=d.startOtherFoldersPrefetch()),e},prefetchStarredMessageList:function(){d.prefetchStarredMessageList()},startFolderPrefetch:function(e){d.startFolderPrefetch(e)},prefetchNextPage:function(e){d.prefetchNextPage(e)},prefetchPrevPage:function(e){d.prefetchPrevPage(e)}}},cyfa:function(e,t,s){"use strict";function i(){this.sName="",this.sEmail="",this.sDisplay="",this.sFull="",this.loaded=o.observable(!1),this.found=o.observable(!1)}var o=s("0h2I"),n=s("Ol7c"),r=s("AFLV");i.prototype.parse=function(e){null!==e&&(this.sName=r.pString(e.DisplayName),this.sEmail=r.pString(e.Email),this.sDisplay=this.sName.length>0?this.sName:this.sEmail,this.sFull=n.getFullEmail(this.sName,this.sEmail))},i.prototype.getEmail=function(){return this.sEmail},i.prototype.getName=function(){return this.sName},i.prototype.getDisplay=function(){return this.sDisplay},i.prototype.getFull=function(){return this.sFull},e.exports=i},dKfC:function(e,t,s){"use strict";var i=s("IAk5"),o=s("SQrT"),n=s("QaF5"),r=s("jxK9"),a=s("jonm"),l=s("4+IO"),h=[],d=[];if(i.isNewTab()){var u={getEditedDraftUid:function(){return l.editedDraftUid()}};window.SlaveTabMailMethods=u,e.exports={}}else{var c={showReport:function(e){o.showReport(e)},getAccountList:function(){return a},getFolderListItems:function(){return l.oFolderListItems},getUidList:function(){return l.uidList()},getComposedMessageAccountId:function(e){var t=h[e];return t?t.accountId:0},getComposedMessage:function(e){var t=h[e];return delete h[e],t},removeOneMessageFromCacheForFolder:function(e,t,s){l.removeOneMessageFromCacheForFolder(e,t,s)},replaceHashWithoutMessageUid:function(e){n.replaceHashWithoutMessageUid(e)},startMessagesLoadingWhenDraftSaving:function(e,t){l.startMessagesLoadingWhenDraftSaving(e,t)},removeMessagesFromCacheForFolder:function(e,t){l.removeMessagesFromCacheForFolder(e,t)},searchMessagesInCurrentFolder:function(e){l.searchMessagesInCurrentFolder(e)},getReplyData:function(e){var t=d[e];return delete d[e],t},deleteMessage:function(e,t){r.deleteMessages([e],t)}};window.MainTabMailMethods=c,e.exports={passReplyData:function(e,t){d[e]=t},passComposedMessage:function(e,t){h[e]=t}}}},gAbd:function(e,t,s){"use strict";var i=s("AFLV");e.exports=function(e){this.iId=e?i.pInt(e.EntityId)||i.pInt(e.ServerId):0,this.iTenantId=e?i.pInt(e.TenantId):0,this.sName=e?i.pString(e.Name):"",this.sIncomingServer=e?i.pString(e.IncomingServer):"",this.iIncomingPort=e?i.pInt(e.IncomingPort):143,this.bIncomingUseSsl=!!e&&!!e.IncomingUseSsl,this.sOutgoingServer=e?i.pString(e.OutgoingServer):"",this.iOutgoingPort=e?i.pInt(e.OutgoingPort):25,this.bOutgoingUseSsl=!!e&&!!e.OutgoingUseSsl,this.sDomains=e?i.pString(e.Domains):"",this.sSmtpAuthType=e?i.pString(e.SmtpAuthType):window.Enums.SmtpAuthType.UseUserCredentials,this.sSmtpLogin=e?i.pString(e.SmtpLogin):"",this.sSmtpPassword=e?i.pString(e.SmtpPassword):"",this.bEnableSieve=!!e&&!!e.EnableSieve,this.iSievePort=e&&e.SievePort?i.pInt(e.SievePort):4190,this.bEnableThreading=!!e&&!!e.EnableThreading,this.bUseFullEmailAddressAsLogin=!e||!!e.UseFullEmailAddressAsLogin,this.bSetExternalAccessServers=i.pBool(e&&e.SetExternalAccessServers,!1),this.sExternalAccessImapServer=i.pString(e&&e.ExternalAccessImapServer,""),this.iExternalAccessImapPort=i.pInt(e&&e.ExternalAccessImapPort,143),this.sExternalAccessSmtpServer=i.pString(e&&e.ExternalAccessSmtpServer,""),this.iExternalAccessSmtpPort=i.pInt(e&&e.ExternalAccessSmtpPort,25),this.bAllowToDelete=i.pBool(e&&e.AllowToDelete,!0),this.bAllowEditDomains=i.pBool(e&&e.AllowEditDomains,!0),this.sOwnerType=e?i.pString(e.OwnerType):""}},h1OO:function(e,t,s){"use strict";var i=s("IAk5"),o=s(i.isMobile()||i.isNewTab()?"Olic":"TCxV");e.exports=o},jDNX:function(e,t,s){"use strict";function i(e,t,s){this.aGreyColors=["rgb(0, 0, 0)","rgb(68, 68, 68)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(204, 204, 204)","rgb(238, 238, 238)","rgb(243, 243, 243)","rgb(255, 255, 255)"],this.aBrightColors=["rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],this.aColorLines=[["rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)"],["rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]],this.caption=e,this.pickHandler=t,this.pickContext=s,this.colorPickerDom=n.observable(null)}var o=s("F/us"),n=s("0h2I"),r=s("EVdn");i.prototype.ViewTemplate="MailWebclient_ColorPickerView",i.prototype.onShow=function(){r(this.colorPickerDom()).find("span.color-item").on("click",o.bind(function(e){e.stopPropagation(),this.setColorFromPopup(r(e.target).data("color"))},this))},i.prototype.setColorFromPopup=function(e){this.pickHandler.call(this.pickContext,e)},e.exports=i},jonm:function(e,t,s){"use strict";function i(){this.collection=n.observableArray([])}var o=s("F/us"),n=s("0h2I"),r=s("AFLV"),a=s("IAk5").isNewTab()&&window.opener?window.opener.MainTabMailMethods:null,l=s("QaF5"),h=s("o0Bx"),d=s("UN2P"),u=s("4M/5"),c=s("p2hp"),p=s("2ug6"),m=s("bBfe"),f=s("vsma");i.prototype.getAccountByHash=function(e){return o.find(this.collection(),function(t){return t.hash()===e},this)},i.prototype.changeCurrentAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.currentId()&&this.changeCurrentAccount(t.id(),!1)},i.prototype.changeCurrentAccount=function(e,t){var s=this.getCurrent(),i=this.getAccount(e);i&&this.currentId()!==e?(s&&s.isCurrent(!1),this.currentId(e),i.isCurrent(!0)):s||this.currentId(0),t&&l.setHash(u.getMailbox())},i.prototype.changeEditedAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.editedId()&&this.changeEditedAccount(t.id())},i.prototype.changeEditedAccount=function(e){var t=this.getEdited(),s=this.getAccount(e);s&&this.editedId()!==e?(t&&t.isEdited(!1),this.editedId(e),s.isEdited(!0)):t||this.editedId(0)},i.prototype.getDefaultFriendlyName=function(){var e=this.getCurrent(),t=o.find(e&&e.identities()||[],function(e){return e.isDefault()})||e;return t?t.friendlyName()||t.email():""},i.prototype.getIdentityByHash=function(e){var t=null;return o.each(this.collection(),function(s){t||(t=o.find(s.identities()||[],function(t){return t.hash()===e}))},this),t},i.prototype.getFetcherByHash=function(e){var t=null;return o.each(this.collection(),function(s){t||(t=o.find(s.fetchers(),function(t){return t.hash()===e}))},this),t},i.prototype.parse=function(e){o.isArray(e)&&(this.collection(o.map(e,function(e){return new p(e)})),this.initObservables(this.collection().length>0?this.collection()[0].id():0))},i.prototype.initObservables=function(e){var t=this.getAccount(e);t&&(t.isCurrent(!0),t.isEdited(!0)),this.currentId=n.observable(e),this.editedId=n.observable(e)},i.prototype.hasAccount=function(){return this.collection().length>0},i.prototype.getAccount=function(e){return o.find(this.collection(),function(t){return t.id()===e},this)},i.prototype.getDefault=function(){return o.find(this.collection(),function(e){return e.bDefault},this)},i.prototype.getCurrent=function(){return this.getAccount(this.currentId())},i.prototype.getEdited=function(){return this.getAccount(this.editedId())},i.prototype.getEmail=function(e){e=e||this.currentId();var t="",s=this.getAccount(e);return s&&(t=s.email()),t},i.prototype.addAccount=function(e){this.collection.push(e)},i.prototype.deleteAccount=function(e){this.collection.remove(function(t){return t.id()===e});var t=this.collection().length>0?this.collection()[0].id():0;this.changeCurrentAccount(t,!1),this.changeEditedAccount(t)},i.prototype.hasAccountWithId=function(e){return!!o.find(this.collection(),function(t){return t.id()===e},this)},i.prototype.populateFetchersIdentities=function(){this.populateFetchers(),this.populateIdentities()},i.prototype.populateFetchers=function(){c.AllowFetchers&&h.send(c.FetchersServerModuleName,"GetFetchers",{AccountID:this.editedId()},this.onGetFetchersResponse,this)},i.prototype.onGetFetchersResponse=function(e,t){var s={};r.isNonEmptyArray(e.Result)&&o.each(e.Result,function(e){var t=new m;t.parse(e),s[t.accountId()]||(s[t.accountId()]=[]),s[t.accountId()].push(t)}),o.each(this.collection(),function(e){var t=r.isNonEmptyArray(s[e.id()])?s[e.id()]:[];e.fetchers(t)},this)},i.prototype.populateIdentities=function(e){c.AllowIdentities&&this.collection().length>=1&&d.send("GetIdentities",null,function(t,s){this.onGetIdentitiesResponse(t,s),o.isFunction(e)&&e()},this)},i.prototype.onGetIdentitiesResponse=function(e,t){var s={};r.isNonEmptyArray(e.Result)&&o.each(e.Result,function(e){var t=new f,i=-1;t.parse(e),i=t.accountId(),s[i]||(s[i]=[]),s[i].push(t)}),o.each(this.collection(),function(e){var t=s[e.id()],i=new f;r.isNonEmptyArray(t)||(t=[]),i.parse({"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Identity",AccountPart:!0,Default:!o.find(t,function(e){return e.isDefault()}),Email:e.email(),FriendlyName:e.friendlyName(),IdAccount:e.id(),EntityId:1e5*e.id(),Signature:e.signature(),UseSignature:e.useSignature()}),t.unshift(i),e.identities(t)})},i.prototype.populateIdentitiesFromSourceAccount=function(e){e&&o.each(this.collection(),function(t){var s=e.getAccount(t.id());s&&(t.fetchers(s.fetchers()),t.identities(s.identities()),t.signature(s.signature()),t.useSignature(s.useSignature()))})},i.prototype.getAccountsEmails=function(){return o.uniq(o.map(this.collection(),function(e){return e.email()}))},i.prototype.getAllFullEmails=function(){var e=[];return o.each(this.collection(),function(t){t&&(r.isNonEmptyArray(t.identities())?o.each(t.identities(),function(t){e.push(t.fullEmail())}):e.push(t.fullEmail()),o.each(t.fetchers(),function(t){t.isEnabled()&&t.isOutgoingEnabled()&&""!==t.fullEmail()&&e.push(t.fullEmail())}))}),e},i.prototype.getCurrentFetchersAndFiltersFolderNames=function(){var e=this.getCurrent(),t=[];return e&&(e.filters()&&o.each(e.filters().collection(),function(e){t.push(e.folder())},this),o.each(e.fetchers(),function(e){t.push(e.folder())},this)),t},i.prototype.getAttendee=function(e){var t=[],s="";return o.each(this.collection(),function(e){t=e.isCurrent()?o.union([e.email()],e.getFetchersIdentitiesEmails(),t):o.union(t,[e.email()],e.getFetchersIdentitiesEmails())}),t=o.uniq(t),o.each(t,o.bind(function(t){if(""===s){o.find(e,function(e){return e===t})===t&&(s=t)}},this)),s};var g=new i;window.auroraAppData.Mail&&o.isArray(window.auroraAppData.Mail.Accounts)?g.parse(window.auroraAppData.Mail.Accounts):g.parse([]),a&&g.populateIdentitiesFromSourceAccount(a.getAccountList()),e.exports=g},jxK9:function(e,t,s){"use strict";var i=s("EVdn"),o=s("RN+F"),n=s("ZP6a"),r=s("gcBV"),a=s("hPb3"),l=s("76Kh"),h=s("20Ah"),d=s("4+IO"),u={};u.deleteMessages=function(e,t){i.isFunction(t)||(t=function(){});var s=d.folderList(),n=s.currentFolderFullName(),r=s.trashFolder(),a=r&&n===r.fullName(),u=s.spamFolder(),c=function(s){s&&(d.deleteMessages(e),t())};u&&n===u.fullName()?(d.deleteMessages(e),t()):a?l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_DELETE_MESSAGES_PLURAL",{},null,e.length),c,"",o.i18n("COREWEBCLIENT/ACTION_DELETE")]):r?(d.moveMessagesToFolder(r.fullName(),e),t()):r||l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),c])},u.registerMailto=function(e){!window.navigator||!i.isFunction(window.navigator.registerProtocolHandler)||e&&!0===r.getData("MailtoAsked")||(window.navigator.registerProtocolHandler("mailto",n.getAppPath()+"#mail/compose/to/%s",""!==a.SiteName?a.SiteName:"WebMail"),r.setData("MailtoAsked",!0))},e.exports=u},lPfU:function(e,t,s){"use strict";function i(){this.iAccountId=0,this.sFullName="",this.search=n.observable(""),this.filters=n.observable(""),this.sortBy=n.observable(a.MessagesSortBy.DefaultSortBy),this.sortOrder=n.observable(a.MessagesSortBy.DefaultSortOrder),this.resultCount=n.observable(-1),this.collection=n.observableArray([]),this.threadUids={}}var o=s("F/us"),n=s("0h2I"),r=s("xzvH"),a=s("p2hp");i.prototype.addThreadUids=function(e,t){-1!==o.indexOf(this.collection(),e)&&(this.threadUids[e]=t)},i.prototype.setUidsAndCount=function(e){"Collection/MessageCollection"===e["@Object"]&&(o.each(e.Uids,function(t,s){this.collection()[s+e.Offset]=t.toString()},this),this.resultCount(e.MessageResultCount))},i.prototype.getUidsForOffset=function(e){for(var t=0,s=this.collection().length,i="",o=0,n=[],l=null;t<s;t++)t>=e&&o<a.MailsPerPage&&(i=this.collection()[t],((l=r.get([this.iAccountId,this.sFullName,i]))&&!l.deleted()||void 0===i)&&(o++,void 0!==i&&n.push(i)));return n},i.prototype.deleteUids=function(e){for(var t=0,s=this.collection().length,i="",n=[],r=0;t<s;t++)i=this.collection()[t],-1===o.indexOf(e,i)?n.push(i):r++;this.collection(n),this.resultCount(this.resultCount()-r)},i.prototype.clearData=function(){this.resultCount(-1),this.collection([]),this.threadUids={}},e.exports=i},mjrp:function(e,t,s){"use strict";function i(e){return void 0===e}function o(e){0<e&&clearTimeout(e),e=0}function n(e){return(e=e&&(e.originalEvent?e.originalEvent:e)||window.event).dataTransfer?e:null}function r(e,t,s){return e&&t&&!i(e[t])?e[t]:s}function a(e,t,s){e[t]=s}function l(){return"jua-uid-"+function(e){var t="",s="0123456789abcdefghijklmnopqrstuvwxyz";for(e=i(e)?32:E.pInt(e);t.length<e;)t+=s.substr(Math.round(Math.random()*s.length),1);return t}(16)+"-"+(new Date).getTime().toString()}function h(e,t){return{FileName:i(e.fileName)?i(e.name)?null:e.name:e.fileName,Size:i(e.fileSize)?i(e.size)?null:e.size:e.fileSize,Type:i(e.type)?null:e.type,Folder:i(t)?"":t,File:e}}function d(e,t,s,o,n,r){var a=0,l=0,d=0,u=null,c=null,p=!1,m=!1,f=function(e,t,s,l){if(e&&!i(e.name))if(t=t||"",e.isFile)e.file(function(e){!p||0<=--n?s(h(e,t)):p&&!m&&0>n&&r&&(m=!0,r(a))});else if(o&&e.isDirectory&&e.createReader){var d=e.createReader(),u=0,c=0;d&&d.readEntries&&d.readEntries(function(i){if(i&&E.isNonEmptyArray(i))for(u=0,c=i.length;u<c;u++)f(i[u],t+e.name+"/",s,l)})}};if(o=!!i(o)||!!o,s=!i(s)&&!!s,n=i(n)?S:E.pInt(n),a=n,p=0<n,e=e&&0<e.length?e:null)for(d=0,l=e.length;d<l;d++)(u=e[d])&&(s?"file"===u.kind&&u.webkitGetAsEntry&&(c=u.webkitGetAsEntry())&&f(c,"",t,r):!p||0<=--n?t(h(u)):p&&!m&&0>n&&r&&(m=!0,r(a)))}function u(e,t,s,i){var o=e&&e.files&&0<e.files.length?e.files:null;o?d(o,t,!1,!1,s,i):t({FileName:e.value.split("\\").pop().split("/").pop(),Size:null,Type:null,Folder:"",File:null})}function c(e){var t=!1;if(e&&e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.length)for(var s=0,i=e.dataTransfer.types.length;s<i;s++)if("files"===e.dataTransfer.types[s].toLowerCase()){t=!0;break}return t}function p(){return v('<label style="position: absolute; background-color:#fff; right: 0px; top: 0px; left: 0px; bottom: 0px; margin: 0px; padding: 0px; cursor: pointer;"></label>').css({opacity:0})}function m(e,t,s,o){e=i(e)?"":e.toString();var n=function(e,t){return""!==t&&(t=' accept="'+t+'"'),v('<input type="file" tabindex="-1" hidefocus="hidefocus" style="position: absolute; '+e+': -9999px;"'+t+" />")}(s=i(s)?"left":s.toString(),o=i(o)?"":o.toString());return 0<e.length&&n.attr("name",e),(i(t)||t)&&n.prop("multiple",!0),n}function f(e,t){return E.pString(F.isFunction(e)?e.apply(null,F.isArray(t)?t:[]):e)}function g(e,t){this.oXhrs={},this.oUids={},this.oJua=e,this.oOptions=t}function b(e,t){this.oUids={},this.oForms={},this.oJua=e,this.oOptions=t}function y(e){e=i(e)?{}:e;var t=this;t.bEnableDnD=!0,t.bEnableButton=!0,t.oEvents={onDialog:null,onSelect:null,onStart:null,onComplete:null,onCompleteAll:null,onProgress:null,onDragEnter:null,onDragLeave:null,onDrop:null,onBodyDragEnter:null,onBodyDragLeave:null,onLimitReached:null},t.oOptions=F.extend({action:"",name:"",hidden:{},queueSize:10,clickElement:!1,dragAndDropElement:!1,dragAndDropBodyElement:!1,disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!1,disableMultiple:!1,disableDocumentDropPrevent:!1,disableAutoUploadOnDrop:!1,multipleSizeLimit:50,hiddenElementsPosition:"left"},e),t.oQueue=I(E.pInt(r(t.oOptions,"queueSize",10))),t.runEvent("onCompleteAll")&&t.oQueue.await(function(){t.runEvent("onCompleteAll")}),t.oDriver=t.isAjaxUploaderSupported()&&!r(t.oOptions,"disableAjaxUpload",!1)?new g(t,t.oOptions):new b(t,t.oOptions),t.oClickElement=r(t.oOptions,"clickElement",null),t.oClickElement&&(v(t.oClickElement).css({position:"relative",overflow:"hidden"}),"inline"===v(this.oClickElement).css("display")&&v(this.oClickElement).css("display","inline-block"),this.oDriver.generateNewInput(this.oClickElement)),this.oDriver.isDragAndDropSupported()&&r(this.oOptions,"dragAndDropElement",!1)&&!r(this.oOptions,"disableAjaxUpload",!1)?function(e){var t=v(document),s=v(r(e.oOptions,"dragAndDropBodyElement",!1)||t),i=r(e.oOptions,"dragAndDropElement",!1);i&&(r(e.oOptions,"disableDocumentDropPrevent",!1)||t.on("dragover",function(t){if(e.bEnableDnD&&t&&(t=n(t))&&t.dataTransfer&&c(t))try{t.dataTransfer.dropEffect="none",t.preventDefault()}catch(e){}}),s&&s[0]&&s.on("dragover",function(t){e.bEnableDnD&&t&&o(e.iDocTimer)}).on("dragenter",function(t){e.bEnableDnD&&t&&(t=n(t))&&c(t)&&(o(e.iDocTimer),t.preventDefault(),e.runEvent("onBodyDragEnter",[t]))}).on("dragleave",function(t){e.bEnableDnD&&t&&(t=n(t))&&(o(e.iDocTimer),e.iDocTimer=setTimeout(function(){e.runEvent("onBodyDragLeave",[t])},200))}).on("drop",function(t){if(e.bEnableDnD&&t&&(t=n(t))){var s=c(t);return s&&t.preventDefault(),e.runEvent("onBodyDragLeave",[t]),!s}return!1}),v(i).bind("dragenter",function(t){e.bEnableDnD&&t&&(t=n(t))&&c(t)&&(o(e.iDocTimer),t.preventDefault(),e.runEvent("onDragEnter",[i,t]))}).bind("dragover",function(t){if(e.bEnableDnD&&t&&(t=n(t))&&t.dataTransfer&&c(t))try{var i=t.dataTransfer.effectAllowed;o(e.iDocTimer),t.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",t.stopPropagation(),t.preventDefault(),s.trigger("dragover",t)}catch(e){}}).bind("dragleave",function(t){if(e.bEnableDnD&&t&&(t=n(t))){var s=document.elementFromPoint?document.elementFromPoint(t.clientX,t.clientY):null;if(s&&function(e,t){var s=!1;return e&&t&&(s=e===t||(e.contains?e.contains(t):!!t.compareDocumentPosition&&!!(8&t.compareDocumentPosition(e)))),s}(this,s))return;o(e.iDocTimer),e.runEvent("onDragLeave",[i,t])}}).bind("drop",function(t){e.bEnableDnD&&t&&(t=n(t))&&c(t)&&(t.preventDefault(),function(e,t,s,i,o){var a=null,l=null;(e=n(e))&&((a=(e.dataTransfer?r(e.dataTransfer,"items",null):null)||r(e,"items",null))&&0<a.length&&a[0]&&a[0].webkitGetAsEntry?d(a,t,!0,o,s,i):c(e)&&(l=r(e,"files",null)||(e.dataTransfer?r(e.dataTransfer,"files",null):null))&&0<l.length&&d(l,t,!1,!1,s,i))}(t,function(s){s&&(r(e.oOptions,"disableAutoUploadOnDrop",!1)?e.runEvent("onDrop",[s,t,function(){e.addNewFile(s),o(e.iDocTimer)}]):(e.runEvent("onDrop",[s,t]),e.addNewFile(s),o(e.iDocTimer)))},r(e.oOptions,"multipleSizeLimit",S),e.getEvent("onLimitReached"),!r(e.oOptions,"disableFolderDragAndDrop",!0))),e.runEvent("onDragLeave",[t])}))}(t):t.bEnableDnD=!1,a(t,"on",t.on),a(t,"cancel",t.cancel),a(t,"isDragAndDropSupported",t.isDragAndDropSupported),a(t,"isAjaxUploaderSupported",t.isAjaxUploaderSupported),a(t,"setDragAndDropEnabledStatus",t.setDragAndDropEnabledStatus)}var v=s("EVdn"),F=s("F/us"),A=s("0h2I"),I=s("w+bY"),E=s("AFLV"),C=s("IAk5"),S=20;g.prototype.oXhrs={},g.prototype.oUids={},g.prototype.oJua=null,g.prototype.oOptions={},g.prototype.isDragAndDropSupported=function(){return!0},g.prototype.regTaskUid=function(e){this.oUids[e]=!0},g.prototype.uploadTask=function(e,t,s,o,n,a,l){if(!1===this.oUids[e]||!t||!t.File)return o(null,e),!1;try{var h=this,d=new XMLHttpRequest,u=new FormData,c=r(this.oOptions,"action",""),p=F.clone(r(this.oOptions,"hidden",{})),m=this.oJua.getEvent("onStart"),g=this.oJua.getEvent("onComplete"),b=this.oJua.getEvent("onProgress");return d.open("POST",c,!0),d.setRequestHeader("Authorization","Bearer "+v.cookie("AuthToken")),d.setRequestHeader("X-Client","WebClient"),b&&d.upload&&(d.upload.onprogress=function(s){s&&s.lengthComputable&&!i(s.loaded)&&!i(s.total)&&(void 0===l?b(e,s.loaded,s.total):b(e,l+s.loaded>t.Size?t.Size:l+s.loaded,t.Size))}),d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){if(g&&!n){var t=!1,s=null;try{s=v.parseJSON(d.responseText),t=!0}catch(e){s=null}g(e,t,s)}i(h.oXhrs[e])||(h.oXhrs[e]=null),a?o(d.responseText,e):o(null,e)}else 4===d.readyState&&(g(e,!1,null),o(null,e))},m&&m(e),u.append("jua-post-type","ajax"),u.append(r(this.oOptions,"name","juaFile"),t.File,t.FileName),s=F.extend(s,t.Hidden||{}),p.Parameters=JSON.stringify(s),v.each(p,function(e,s){u.append(e,f(s,[t]))}),d.send(u),this.oXhrs[e]=d,!0}catch(e){window.console&&window.console.error(e)}return o(null,e),!1},g.prototype.generateNewInput=function(e){var t=this,s=null,i=null;e&&(i=m("",!r(this.oOptions,"disableMultiple",!1),r(this.oOptions,"hiddenElementsPosition","left"),r(this.oOptions,"accept","")),(s=p()).append(i),v(e).append(s),i.on("click",function(e){if(t.oJua.bEnableButton){var s=t.oJua.getEvent("onDialog");s&&s()}else e.preventDefault()}).on("change",function(){u(this,function(i){t.oJua.addNewFile(i),t.generateNewInput(e),setTimeout(function(){s.remove()},10)},r(t.oOptions,"multipleSizeLimit",S),t.oJua.getEvent("onLimitReached"))}))},g.prototype.cancel=function(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){}this.oXhrs[e]=null}},b.prototype.oUids={},b.prototype.oForms={},b.prototype.oJua=null,b.prototype.oOptions={},b.prototype.isDragAndDropSupported=function(){return!1},b.prototype.regTaskUid=function(e){this.oUids[e]=!0},b.prototype.uploadTask=function(e,t,s,i,o,n,a){if(!1===this.oUids[e])return i(null,e),!1;var l=this.oForms[e],h=F.clone(r(this.oOptions,"hidden",{})),d=this.oJua.getEvent("onStart"),u=this.oJua.getEvent("onComplete");return l?(l.append(v('<input type="hidden" />').attr("name","jua-post-type").val("iframe")),s=F.extend(s,t.Hidden||{}),h.Parameters=JSON.stringify(s),v.each(h,function(e,s){l.append(v('<input type="hidden" />').attr("name",e).val(f(s,[t])))}),l.trigger("submit"),d&&d(e),l.find("iframe").on("load",function(t){var s=!1,o=null,n={};if(u){try{o=this.contentDocument?this.contentDocument:this.contentWindow.document,n=v.parseJSON(o.body.innerHTML),s=!0}catch(e){n={}}u(e,s,n)}i(null,e),window.setTimeout(function(){l.remove()},100)})):i(null,e),!0},b.prototype.generateNewInput=function(e){var t=this,s="",i=null,o=null,n=r(this.oOptions,"action",""),a=null,h=r(this.oOptions,"hiddenElementsPosition","left");e&&(s=l(),i=m(r(this.oOptions,"name","juaFile"),!r(this.oOptions,"disableMultiple",!1),r(this.oOptions,"hiddenElementsPosition","left"),r(this.oOptions,"accept","")),a=v('<form action="'+n+'" target="iframe-'+s+'"  method="POST" enctype="multipart/form-data" style="display: block; cursor: pointer;"></form>'),o=v('<iframe name="iframe-'+s+'" tabindex="-1" src="javascript:void(0);"  style="position: absolute; top: -1000px; '+h+': -1000px; cursor: pointer;" />').css({opacity:0}),a.append(p().append(i)).append(o),v(e).append(a),this.oForms[s]=a,i.on("click",function(e){if(t.oJua.bEnableButton){var s=t.oJua.getEvent("onDialog");s&&s()}else e.preventDefault()}).on("change",function(){u(this,function(i){if(i){var o=r(t.oOptions,"hiddenElementsPosition","left");a.css({position:"absolute",top:-1e3}),a.css(o,-1e3),t.oJua.addFile(s,i),t.generateNewInput(e)}},r(t.oOptions,"multipleSizeLimit",S),t.oJua.getEvent("onLimitReached"))}))},b.prototype.cancel=function(e){this.oUids[e]=!1,this.oForms[e]&&(this.oForms[e].remove(),this.oForms[e]=!1)},y.prototype.bEnableDnD=!0,y.prototype.iDocTimer=0,y.prototype.oOptions={},y.prototype.oEvents={},y.prototype.oQueue=null,y.prototype.oDriver=null,y.prototype.on=function(e,t){return this.oEvents[e]=t,this},y.prototype.runEvent=function(e,t){this.oEvents[e]&&this.oEvents[e].apply(null,t||[])},y.prototype.getEvent=function(e){return this.oEvents[e]||null},y.prototype.cancel=function(e){this.oDriver.cancel(e)},y.prototype.isAjaxUploaderSupported=function(){return function(){var e=document.createElement("input");return e.type="file",!!("XMLHttpRequest"in window&&"multiple"in e&&"FormData"in window&&(new XMLHttpRequest).upload)}()},y.prototype.setDragAndDropEnabledStatus=function(e){this.bEnableDnD=!!e},y.prototype.isDragAndDropSupported=function(){return this.oDriver.isDragAndDropSupported()},y.prototype.addNewFile=function(e){this.addFile(l(),e)},y.prototype.addFile=function(e,t){var s=this.getEvent("onSelect"),o=null,n=r(this.oOptions,"hidden",{}),a=this.getEvent("onComplete"),l=F.bind(function(e,t){var s=r(this.oOptions,"hidden",{}),o=JSON.parse(f(s.Parameters,[t]));this.oDriver.regTaskUid(e),this.oQueue.defer(function(e,t){return function(){return e.apply(i(t)?null:t,Array.prototype.slice.call(arguments))}}(this.oDriver.uploadTask,this.oDriver),e,t,o)},this),h=this.getEvent("onCancel");if(!t||s&&!1===s(e,t))this.oDriver.cancel(e);else{o=F.bind(function(e,t,s,i,n,l){var h=null;h=function(t,i){var n=null;try{n=v.parseJSON(t)}catch(e){}n&&n.Result&&!n.Result.Error&&!n.ErrorCode?s(e,o):n&&n.Result&&n.Result.Error?(C.broadcastEvent("Jua::FileUploadingError"),a(i,!1,{ErrorCode:n.Result.Error})):n&&n.ErrorCode?(C.broadcastEvent("Jua::FileUploadingError"),a(i,!1,{ErrorCode:n.ErrorCode})):(C.broadcastEvent("Jua::FileUploadingError"),a(i,!1))};var d=r(this.oOptions,"hidden",{}),u=JSON.parse(f(d.Parameters,[t]));this.oDriver.regTaskUid(e),this.oDriver.uploadTask(e,t,u,h,i<n,!0,l)},this);var d=A.observable(!0),u=JSON.parse(f(n.Parameters,[t]));C.broadcastEvent("Jua::FileUpload::isUploadAvailable",{isUploadAvailable:d,sModuleName:n.Module,sUid:e,oFileInfo:t}),d()?!1===C.broadcastEvent("Jua::FileUpload::before",{sUid:e,oFileInfo:t,fOnChunkReadyCallback:o,sModuleName:n.Module,fRegularUploadFileCallback:l,fCancelFunction:h,sStorageType:u.Type})&&l(e,t):F.isFunction(h)&&h(e)}},y.prototype.setOption=function(e,t){this.oOptions[e]=t},e.exports=y},p2hp:function(e,t,s){"use strict";var i=s("0h2I"),o=s("F/us"),n=s("AFLV"),r=s("IAk5");e.exports={ServerModuleName:"Mail",HashModuleName:"mail",FetchersServerModuleName:"MtaConnector",EnableMultiTenant:!1,AllowAddAccounts:!1,AllowAutosaveInDrafts:!0,AllowChangeMailQuotaOnMailServer:!1,AllowDefaultAccountForUser:!0,AllowEditDomainsInServer:!0,AllowFetchers:!1,AllowIdentities:!1,OnlyUserEmailsInIdentities:!1,AllowInsertImage:!0,AllowMultiAccounts:!1,AutoSaveIntervalSeconds:60,AllowTemplateFolders:!1,AllowAlwaysRefreshFolders:!1,AutocreateMailAccountOnNewUserFirstLogin:!1,IgnoreImapSubscription:!1,ImageUploadSizeLimit:0,AllowAppRegisterMailto:!1,AllowChangeInputDirection:!0,FoldersExpandedByDefault:!1,AllowSpamFolder:!0,AllowAddNewFolderOnMainScreen:!1,ComposeToolbarOrder:["back","send","save","importance","MailSensitivity","confirmation","OpenPgp"],DefaultFontName:"Tahoma",DefaultFontSize:3,AlwaysTryUseImageWhilePasting:!0,JoinReplyPrefixes:!0,MailsPerPage:20,MaxMessagesBodiesSizeToPrefetch:5e4,MessageBodyTruncationThreshold:65e4,MessagesSortBy:{},ShowEmailAsTabName:!0,AllowShowMessagesCountInFolderList:!1,showMessagesCountInFolderList:i.observable(!1),AllowSearchMessagesBySubject:!1,PrefixesToRemoveBeforeSearchMessagesBySubject:[],AllowHorizontalLayout:!1,HorizontalLayout:!1,HorizontalLayoutByDefault:!1,userMailAccountsCount:i.observable(0),mailAccountsEmails:i.observableArray([]),init:function(e){var t=e.Core,s=e[this.ServerModuleName],i=e.MailWebclient,a=e[this.FetchersServerModuleName];if(o.isEmpty(t)||(this.EnableMultiTenant=n.pBool(t.EnableMultiTenant,this.EnableMultiTenant)),!o.isEmpty(s)){this.AllowAddAccounts=n.pBool(s.AllowAddAccounts,this.AllowAddAccounts),this.AllowAutosaveInDrafts=n.pBool(s.AllowAutosaveInDrafts,this.AllowAutosaveInDrafts),this.AllowChangeMailQuotaOnMailServer=n.pBool(s.AllowChangeMailQuotaOnMailServer,this.AllowChangeMailQuotaOnMailServer),this.AllowDefaultAccountForUser=n.pBool(s.AllowDefaultAccountForUser,this.AllowDefaultAccountForUser),this.AllowEditDomainsInServer=n.pBool(s.AllowEditDomainsInServer,this.AllowEditDomainsInServer),this.AllowIdentities=n.pBool(s.AllowIdentities,this.AllowIdentities),this.OnlyUserEmailsInIdentities=n.pBool(s.OnlyUserEmailsInIdentities,this.OnlyUserEmailsInIdentities),this.AllowInsertImage=n.pBool(s.AllowInsertImage,this.AllowInsertImage),this.AllowMultiAccounts=n.pBool(s.AllowMultiAccounts,this.AllowMultiAccounts),this.AutoSaveIntervalSeconds=n.pNonNegativeInt(s.AutoSaveIntervalSeconds,this.AutoSaveIntervalSeconds),this.AllowTemplateFolders=n.pBool(s.AllowTemplateFolders,this.AllowTemplateFolders),this.AllowAlwaysRefreshFolders=n.pBool(s.AllowAlwaysRefreshFolders,this.AllowAlwaysRefreshFolders),this.AutocreateMailAccountOnNewUserFirstLogin=n.pBool(s.AutocreateMailAccountOnNewUserFirstLogin,this.AutocreateMailAccountOnNewUserFirstLogin),this.IgnoreImapSubscription=n.pBool(s.IgnoreImapSubscription,this.IgnoreImapSubscription),this.ImageUploadSizeLimit=n.pNonNegativeInt(s.ImageUploadSizeLimit,this.ImageUploadSizeLimit),window.Enums.SmtpAuthType=n.pObject(s.SmtpAuthType),this.MessagesSortBy=o.clone(n.pObject(s.MessagesSortBy,this.MessagesSortBy)),this.MessagesSortBy.Allow=n.pBool(this.MessagesSortBy.Allow,!1),this.MessagesSortBy.List=n.pArray(this.MessagesSortBy.List,[]),this.MessagesSortBy.DefaultSortBy=n.pString(this.MessagesSortBy.DefaultSortBy,"arrival");var l=n.pString(this.MessagesSortBy.DefaultSortOrder,"desc");this.MessagesSortBy.DefaultSortOrder="desc"===l?Enums.SortOrder.Desc:Enums.SortOrder.Asc}o.isEmpty(i)||(this.AllowAppRegisterMailto=n.pBool(i.AllowAppRegisterMailto,this.AllowAppRegisterMailto),this.AllowChangeInputDirection=n.pBool(i.AllowChangeInputDirection,this.AllowChangeInputDirection),this.FoldersExpandedByDefault=n.pBool(i.FoldersExpandedByDefault,this.FoldersExpandedByDefault),this.AllowSpamFolder=n.pBool(i.AllowSpamFolder,this.AllowSpamFolder),this.AllowAddNewFolderOnMainScreen=n.pBool(i.AllowAddNewFolderOnMainScreen,this.AllowAddNewFolderOnMainScreen),this.ComposeToolbarOrder=n.pArray(i.ComposeToolbarOrder,this.ComposeToolbarOrder),this.DefaultFontName=n.pString(i.DefaultFontName,this.DefaultFontName),this.DefaultFontSize=n.pPositiveInt(i.DefaultFontSize,this.DefaultFontSize),this.AlwaysTryUseImageWhilePasting=n.pBool(i.AlwaysTryUseImageWhilePasting,this.AlwaysTryUseImageWhilePasting),this.JoinReplyPrefixes=n.pBool(i.JoinReplyPrefixes,this.JoinReplyPrefixes),this.MailsPerPage=n.pPositiveInt(i.MailsPerPage,this.MailsPerPage),this.MaxMessagesBodiesSizeToPrefetch=n.pNonNegativeInt(i.MaxMessagesBodiesSizeToPrefetch,this.MaxMessagesBodiesSizeToPrefetch),this.MessageBodyTruncationThreshold=n.pNonNegativeInt(i.MessageBodyTruncationThreshold,this.MessageBodyTruncationThreshold),this.ShowEmailAsTabName=n.pBool(i.ShowEmailAsTabName,this.ShowEmailAsTabName),this.AllowShowMessagesCountInFolderList=n.pBool(i.AllowShowMessagesCountInFolderList,this.AllowShowMessagesCountInFolderList),this.showMessagesCountInFolderList(n.pBool(i.ShowMessagesCountInFolderList,this.showMessagesCountInFolderList())),this.AllowSearchMessagesBySubject=n.pBool(i.AllowSearchMessagesBySubject,this.AllowSearchMessagesBySubject),this.PrefixesToRemoveBeforeSearchMessagesBySubject=n.pArray(i.PrefixesToRemoveBeforeSearchMessagesBySubject,this.PrefixesToRemoveBeforeSearchMessagesBySubject),this.AllowHorizontalLayout=n.pBool(i.AllowHorizontalLayout,this.AllowHorizontalLayout),this.HorizontalLayout=this.AllowHorizontalLayout&&n.pBool(i.HorizontalLayout,this.HorizontalLayout),this.HorizontalLayoutByDefault=this.AllowHorizontalLayout&&n.pBool(i.HorizontalLayoutByDefault,this.HorizontalLayoutByDefault)),o.isEmpty(a)||(this.AllowFetchers=n.pBool(a.AllowFetchers,this.AllowFetchers)),r.registerUserAccountsCount(this.userMailAccountsCount),r.registerAccountsWithPass(this.mailAccountsEmails)},update:function(e,t,s,i){this.AllowAutosaveInDrafts=n.pBool(t,this.AllowAutosaveInDrafts),this.AllowChangeInputDirection=n.pBool(s,this.AllowChangeInputDirection),this.MailsPerPage=n.pPositiveInt(e,this.MailsPerPage),this.showMessagesCountInFolderList(n.pBool(i,this.showMessagesCountInFolderList()))},updateAdmin:function(e,t,s){this.AutocreateMailAccountOnNewUserFirstLogin=n.pBool(e,this.AutocreateMailAccountOnNewUserFirstLogin),this.AllowAddAccounts=n.pBool(t,this.AllowAddAccounts),this.HorizontalLayoutByDefault=n.pBool(s,this.HorizontalLayoutByDefault)},disableEditDomainsInServer:function(){this.AllowEditDomainsInServer=!1}}},qGK3:function(e,t,s){"use strict";function i(e){this.iAccountId=e,this.bNamespace=!1,this.iDisplayedLevel=0,this.bIgnoreImapSubscription=I.IgnoreImapSubscription,this.bAllowTemplateFolders=I.AllowTemplateFolders,this.isTemplateStorage=r.observable(!1),this.bAllowAlwaysRefreshFolders=I.AllowAlwaysRefreshFolders,this.isAlwaysRefresh=r.observable(!1),this.sDelimiter="",this.bExists=!0,this.sUidNext="",this.sHash="",this.messageCount=r.observable(0),this.unseenMessageCount=r.observable(0),this.iRealUnseenMessageCount=0,this.hasExtendedInfo=r.observable(!1),this.fullName=r.observable(""),this.fullNameHash=r.observable(""),this.bSelectable=!0,this.subscribed=r.observable(!0),this.name=r.observable(""),this.nameForEdit=r.observable(""),this.subfolders=r.observableArray([]),this.subfoldersMessagesCount=r.observable(0),this.type=r.observable(Enums.FolderTypes.User),this.bVirtual=!1,this.selected=r.observable(!1),this.expanded=r.observable(!1),this.recivedAnim=r.observable(!1).extend({autoResetToFalse:500}),this.edited=r.observable(!1),this.aMessagesDictionaryUids=[],this.oUids={},this.aResponseHandlers=[],this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.hasChanges=r.observable(!1),this.oRelevantInformationLastMoment=null,this.bSubscribtionsInitialized=!1}var o=s("F/us"),n=s("EVdn"),r=s("0h2I"),a=s("wd/R"),l=s("Yjhd"),h=s("RN+F"),d=s("AFLV"),u=s("UN2P"),c=s("JFZZ"),p=s("IAk5"),m=s("QaF5"),f=s("gcBV"),g=s("76Kh"),b=s("20Ah"),y=s("4M/5"),v=s("jonm"),F=null,A=s("xzvH"),I=s("p2hp"),E=s("Nfk5"),C=s("lPfU");i.prototype.requireMailCache=function(){null===F&&(F=s("4+IO"))},i.prototype.setDisplayedLevel=function(e){this.iDisplayedLevel=e},i.prototype.getDisplayedLevel=function(){return this.iDisplayedLevel},i.prototype.getMessageByUid=function(e){return A.get([this.iAccountId,this.fullName(),e])},i.prototype.removeMessageFromDict=function(e){A.remove([this.iAccountId,this.fullName(),e]),this.aMessagesDictionaryUids=o.without(this.aMessagesDictionaryUids,e),this.aRequestedUids=o.without(this.aRequestedUids,e),this.aRequestedThreadUids=o.without(this.aRequestedThreadUids,e)},i.prototype.updateLastAccessTime=function(e){o.each(e,function(e){var t=this.getMessageByUid(e);t&&t.updateLastAccessTime()},this)},i.prototype.doForAllMessages=function(e){var t=[];o.each(this.aMessagesDictionaryUids,function(s){var i=this.getMessageByUid(s);i?e(i):t.push(s)},this),t.length>0&&(this.aMessagesDictionaryUids=o.difference(this.aMessagesDictionaryUids,t),this.aRequestedUids=o.difference(this.aRequestedUids,t),this.aRequestedThreadUids=o.difference(this.aRequestedThreadUids,t))},i.prototype.getFlaggedMessageUids=function(){var e=[];return this.doForAllMessages(function(t){t.flagged()&&e.push(t.uid())}),e},i.prototype.setMessageUnflaggedByUid=function(e){var t=this.getMessageByUid(e);t&&t.flagged(!1)},i.prototype.hideThreadMessages=function(e){o.each(e.threadUids(),function(e){var t=this.getMessageByUid(e);t&&(t.deleted()||(t.threadShowAnimation(!1),t.threadHideAnimation(!0),setTimeout(function(){t.threadHideAnimation(!1)},1e3)))},this)},i.prototype.getThreadMessages=function(e){var t=[],s=[],i=[],n=0,r=null;return o.each(e.threadUids(),function(o){if(n<e.threadCountForLoad()){var a=this.getMessageByUid(o);a?a.deleted()||(a.markAsThreadPart(50,e.uid()),t.push(a),i.push(a.uid()),n++,r=a):(s.push(o),i.push(o),n++)}else i.push(o)},this),e.threadLoading()||this.loadThreadMessages(s),e.changeThreadUids(i,t.length),r&&t.length<e.threadUids().length&&r.showNextLoadingLink(o.bind(e.increaseThreadCountForLoad,e)),this.addThreadUidsToUidLists(e.uid(),e.threadUids()),t},i.prototype.computeThreadData=function(e){var t=0,s=!1,i=[],r=[],a=e.oFrom.getFirstEmail();o.each(e.threadUids(),function(e){var o=this.getMessageByUid(e),l="";o&&!o.deleted()&&(o.seen()||t++,o.flagged()&&(s=!0),(l=o.oFrom.getFirstEmail())!==a&&-1===n.inArray(l,r)&&(r.push(l),l===v.getEmail()?i.push(h.i18n("MAILWEBCLIENT/LABEL_ME_SENDER")):i.push(o.oFrom.getFirstDisplay())))},this),e.threadUnreadCount(t),e.partialFlagged(s)},i.prototype.addThreadUidsToUidLists=function(e,t){o.each(this.oUids,function(s){s.addThreadUids(e,t)})},i.prototype.loadThreadMessages=function(e){if(e.length>0){var t={Folder:this.fullName(),Uids:e};u.send("GetMessagesByUids",t,this.onGetMessagesByUidsResponse,this)}},i.prototype.getThreadCheckedUidsFromList=function(e){var t=this,s=[];return o.each(e,function(e){e.threadCount()>0&&!e.threadOpened()&&o.each(e.threadUids(),function(e){var i=t.getMessageByUid(e);i&&!i.deleted()&&i.checked()&&s.push(e)})}),s},i.prototype.parseAndCacheMessage=function(e,t,s){var i=e.Uid.toString(),n=!1,r=this.getMessageByUid(i);return r||(n=!0,r=new E),r.parse(e,this.iAccountId,t,s),this.type()===Enums.FolderTypes.Inbox&&n&&r.flagged()&&(this.requireMailCache(),F.increaseStarredCount()),A.set([this.iAccountId,this.fullName(),i],r),n&&(this.aRequestedUids=o.without(this.aRequestedUids,i),this.aRequestedThreadUids=o.without(this.aRequestedThreadUids,i),-1===o.indexOf(this.aMessagesDictionaryUids,i)&&this.aMessagesDictionaryUids.push(i)),r},i.prototype.onGetMessagesByUidsResponse=function(e,t){var s=e.Result;s&&"Collection/MessageCollection"===s["@Object"]&&(o.each(s["@Collection"],function(e){this.parseAndCacheMessage(e,!0,!0)},this),this.requireMailCache(),F.showOpenedThreads(this.fullName()))},i.prototype.addRequestedUids=function(e){this.aRequestedUids=o.union(this.aRequestedUids,e)},i.prototype.hasUidBeenRequested=function(e){return-1!==o.indexOf(this.aRequestedUids,e)},i.prototype.addRequestedThreadUids=function(e){this.aRequestedThreadUids=o.union(this.aRequestedThreadUids,e)},i.prototype.hasThreadUidBeenRequested=function(e){return-1!==o.indexOf(this.aRequestedThreadUids,e)},i.prototype.hasListBeenRequested=function(e){var t=o.where(this.requestedLists,e).length>0;return t||this.requestedLists.push(e),t},i.prototype.markMessageReplied=function(e,t){var s=this.getMessageByUid(e);if(s)switch(t){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:s.answered(!0);break;case Enums.ReplyType.Forward:case Enums.ReplyType.ForwardAsAttach:s.forwarded(!0)}},i.prototype.removeAllMessages=function(){var e=this.oUids,t=this.aMessagesDictionaryUids;this.aMessagesDictionaryUids=[],this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.oUids={},this.messageCount(0),this.unseenMessageCount(0),this.iRealUnseenMessageCount=0,this.getUidList("","",I.MessagesSortBy.DefaultSortBy,I.MessagesSortBy.DefaultSortOrder).resultCount(0),F.currentMessage()&&F.currentMessage().accountId()===this.iAccountId&&F.currentMessage().folder()===this.fullName()&&(l.log("removeAllMessages, the current message is in the list to remove",F.currentMessage()?{accountId:F.currentMessage().accountId(),folder:F.currentMessage().folder(),uid:F.currentMessage().uid()}:null),t=o.without(t,F.currentMessage().uid())),o.each(t,function(e){this.removeMessageFromDict(e)},this),t=null,o.each(e,function(e){e.clearData()}),e=null},i.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.aRequestedThreadUids=[],this.hasChanges(!1))},i.prototype.removeFlaggedMessageListsFromCache=function(){o.each(this.oUids,function(e){e.filters()===Enums.FolderFilter.Flagged&&e.clearData()},this)},i.prototype.removeUnseenMessageListsFromCache=function(){o.each(this.oUids,function(e){e.filters()===Enums.FolderFilter.Unseen&&e.clearData()},this)},i.prototype.setRelevantInformation=function(e,t,s,i,o){var n=this.hasExtendedInfo()&&(this.sHash!==t||this.iRealUnseenMessageCount!==i||this.unseenMessageCount()!==i);return this.sHash=t,this.iRealUnseenMessageCount=i,this.hasExtendedInfo()&&o||(this.sUidNext=e,this.messageCount(s),this.unseenMessageCount(i),0===i&&this.unseenMessageCount.valueHasMutated()),this.hasExtendedInfo(!0),n&&this.markHasChanges(),this.oRelevantInformationLastMoment=a(),n},i.prototype.increaseCountIfHasNotInfo=function(){this.hasExtendedInfo()||this.messageCount(this.messageCount()+1)},i.prototype.markHasChanges=function(){this.hasChanges(!0)},i.prototype.addMessagesCountsDiff=function(e,t){var s=this.messageCount()+e,i=this.unseenMessageCount()+t;s<0&&(s=0),this.messageCount(s),i<0&&(i=0),i>s&&(i=s),this.unseenMessageCount(i)},i.prototype.markDeletedByUids=function(e){var t=0,s=0;return o.each(e,function(e){var i=this.getMessageByUid(e);i&&(t++,i.seen()||s++,i.deleted(!0))},this),this.addMessagesCountsDiff(-t,-s),{MinusDiff:t,UnseenMinusDiff:s}},i.prototype.revertDeleted=function(e){var t=0,s=0;return o.each(e,function(e){var i=this.getMessageByUid(e);i&&i.deleted()&&(t++,i.seen()||s++,i.deleted(!1))},this),this.addMessagesCountsDiff(t,s),{PlusDiff:t,UnseenPlusDiff:s}},i.prototype.commitDeleted=function(e){o.each(e,o.bind(function(e){F.currentMessage()&&F.currentMessage().accountId()===this.iAccountId&&F.currentMessage().folder()===this.fullName()&&F.currentMessage().uid()===e?l.log("commitDeleted, the current message is to remove",F.currentMessage()?{accountId:F.currentMessage().accountId(),folder:F.currentMessage().folder(),uid:F.currentMessage().uid()}:null):this.removeMessageFromDict(e),this.aMessagesDictionaryUids=o.without(this.aMessagesDictionaryUids,e),this.aRequestedUids=o.without(this.aRequestedUids,e),this.aRequestedThreadUids=o.without(this.aRequestedThreadUids,e)},this)),o.each(this.oUids,function(t){t.deleteUids(e)})},i.prototype.getUidList=function(e,t,s,i){var o=JSON.stringify([e,t,s,i]),n=null;return void 0===this.oUids[o]&&((n=new C).iAccountId=this.iAccountId,n.sFullName=this.fullName(),n.search(e),n.filters(t),n.sortBy(s),n.sortOrder(i),this.oUids[o]=n),this.oUids[o]},i.prototype.initStarredFolder=function(e,t){this.bVirtual=!0,this.setDisplayedLevel(e),this.fullName(t),this.name(h.i18n("MAILWEBCLIENT/LABEL_FOLDER_STARRED")),this.type(Enums.FolderTypes.Starred),this.initSubscriptions(""),this.initComputedFields(!0)},i.prototype.parse=function(e,t,s){var i="",n=Enums.FolderTypes.User,r=f.getData("folderAccordion")||[];return"Object/Folder"===e["@Object"]?(i=d.pString(e.Name),this.name(i),this.nameForEdit(i),this.fullName(d.pString(e.FullNameRaw)),this.fullNameHash(d.pString(e.FullNameHash)),this.sDelimiter=e.Delimiter,n=d.pInt(e.Type),I.AllowTemplateFolders||n!==Enums.FolderTypes.Template||(n=Enums.FolderTypes.User),(I.AllowSpamFolder||n!==Enums.FolderTypes.Spam)&&this.type(n),this.isTemplateStorage(this.type()===Enums.FolderTypes.Template),this.bNamespace=s===this.fullName(),this.isAlwaysRefresh(I.AllowAlwaysRefreshFolders&&!!e.AlwaysRefresh),this.subscribed(!!I.IgnoreImapSubscription||e.IsSubscribed),this.bSelectable=e.IsSelectable,this.bExists=e.Exists,e.Extended&&this.setRelevantInformation(e.Extended.UidNext.toString(),e.Extended.Hash,e.Extended.MessageCount,e.Extended.MessageUnseenCount,!1),o.find(r,function(e){return e===this.name()},this)&&this.expanded(!0),this.initSubscriptions(t),this.initComputedFields(),p.broadcastEvent("MailWebclient::ParseFolder::after",this),e.SubFolders):null},i.prototype.initSubscriptions=function(e){this.bSubscribtionsInitialized||(this.requireMailCache(),this.unseenMessageCount.subscribe(function(){o.delay(o.bind(function(){F.countMessages(this)},this),1e3)},this),this.subscribed.subscribe(function(){if(e){var t=F.folderList().getFolderByFullName(e);t&&F.countMessages(t)}},this),this.edited.subscribe(function(e){!1===e&&this.nameForEdit(this.name())},this),this.hasChanges.subscribe(function(){this.requestedLists=[]},this),this.bSubscribtionsInitialized=!0)},i.prototype.initComputedFields=function(){this.routingHash=r.computed(function(){return this.bVirtual?m.buildHashFromArray(y.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Flagged)):m.buildHashFromArray(y.getMailbox(this.fullName()))},this),this.isSystem=r.computed(function(){return this.type()!==Enums.FolderTypes.User},this),this.withoutThreads=r.computed(function(){return this.type()===Enums.FolderTypes.Drafts||this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash},this),this.enableEmptyFolder=r.computed(function(){return(this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash)&&this.messageCount()>0},this),this.virtualEmpty=r.computed(function(){return this.bVirtual&&0===this.messageCount()},this),this.hasSubscribedSubfolders=r.computed(function(){return o.any(this.subfolders(),function(e){return e.subscribed()})},this),this.canExpand=r.computed(function(){return!this.bNamespace&&this.hasSubscribedSubfolders()},this),this.unseenMessagesCountToShow=r.computed(function(){return!p.isMobile()&&this.canExpand()?this.unseenMessageCount()+this.subfoldersMessagesCount():this.unseenMessageCount()},this),this.showUnseenMessagesCount=r.computed(function(){return this.unseenMessagesCountToShow()>0&&this.type()!==Enums.FolderTypes.Drafts},this),this.showMessagesCount=r.computed(function(){return this.messageCount()>0&&(this.type()===Enums.FolderTypes.Drafts||I.AllowShowMessagesCountInFolderList&&I.showMessagesCountInFolderList())},this),this.visible=r.computed(function(){return this.subscribed()||this.isSystem()||this.hasSubscribedSubfolders()},this),this.canBeSelected=r.computed(function(){return this.bExists&&this.bSelectable&&this.subscribed()},this),this.canSubscribe=r.computed(function(){return!I.IgnoreImapSubscription&&!this.isSystem()&&this.bExists&&this.bSelectable},this),this.canDelete=r.computed(function(){return!this.isSystem()&&this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length},this),this.canRename=this.canSubscribe,this.visibleTemplateTrigger=r.computed(function(){return I.AllowTemplateFolders&&(this.bSelectable&&!this.isSystem()||this.isTemplateStorage())},this),this.templateButtonHint=r.computed(function(){return this.visibleTemplateTrigger()?this.isTemplateStorage()?h.i18n("MAILWEBCLIENT/ACTION_TURN_TEMPLATE_FOLDER_OFF"):h.i18n("MAILWEBCLIENT/ACTION_TURN_TEMPLATE_FOLDER_ON"):""},this),this.alwaysRefreshButtonHint=r.computed(function(){return I.AllowAlwaysRefreshFolders?this.isAlwaysRefresh()?h.i18n("MAILWEBCLIENT/ACTION_TURN_ALWAYS_REFRESH_OFF"):h.i18n("MAILWEBCLIENT/ACTION_TURN_ALWAYS_REFRESH_ON"):""},this),this.subscribeButtonHint=r.computed(function(){return this.canSubscribe()?this.subscribed()?h.i18n("MAILWEBCLIENT/ACTION_HIDE_FOLDER"):h.i18n("MAILWEBCLIENT/ACTION_SHOW_FOLDER"):""},this),this.deleteButtonHint=r.computed(function(){return this.canDelete()?h.i18n("MAILWEBCLIENT/ACTION_DELETE_FOLDER"):""},this),this.usedAs=r.computed(function(){switch(this.type()){case Enums.FolderTypes.Inbox:return h.i18n("MAILWEBCLIENT/LABEL_USED_AS_INBOX");case Enums.FolderTypes.Sent:return h.i18n("MAILWEBCLIENT/LABEL_USED_AS_SENT");case Enums.FolderTypes.Drafts:return h.i18n("MAILWEBCLIENT/LABEL_USED_AS_DRAFTS");case Enums.FolderTypes.Trash:return h.i18n("MAILWEBCLIENT/LABEL_USED_AS_TRASH");case Enums.FolderTypes.Spam:return h.i18n("MAILWEBCLIENT/LABEL_USED_AS_SPAM")}return""},this),this.displayName=r.computed(function(){switch(this.type()){case Enums.FolderTypes.Inbox:return h.i18n("MAILWEBCLIENT/LABEL_FOLDER_INBOX");case Enums.FolderTypes.Sent:return h.i18n("MAILWEBCLIENT/LABEL_FOLDER_SENT");case Enums.FolderTypes.Drafts:return h.i18n("MAILWEBCLIENT/LABEL_FOLDER_DRAFTS");case Enums.FolderTypes.Trash:return h.i18n("MAILWEBCLIENT/LABEL_FOLDER_TRASH");case Enums.FolderTypes.Spam:return h.i18n("MAILWEBCLIENT/LABEL_FOLDER_SPAM")}return this.name()},this)},i.prototype.onGetMessageResponse=function(e,t){var s=e.Result,i=t.Parameters,o=null,n=s?s.Uid.toString():i.Uid.toString(),r=this.getMessageByUid(n),a=!!r&&r.selected(),l=!1;s?r=this.parseAndCacheMessage(s,!1,!1):(a&&(c.showErrorByCode(e,h.i18n("COREWEBCLIENT/ERROR_UNKNOWN")),m.replaceHashWithoutMessageUid(n)),r=null,l=!0),(o=this.aResponseHandlers[n])&&(o.handler.call(o.context,r,n,l?e:null),delete this.aResponseHandlers[n])},i.prototype.getCompletelyFilledMessage=function(e,t,s){var i=this.getMessageByUid(e),o={AccountID:i?i.accountId():0,Folder:this.fullName(),Uid:e,MessageBodyTruncationThreshold:I.MessageBodyTruncationThreshold};e.length>0&&(i&&i.completelyFilled()&&!i.truncated()?t&&s&&t.call(s,i,e):(t&&s&&(this.aResponseHandlers[e]={handler:t,context:s}),u.send("GetMessage",o,this.onGetMessageResponse,this)))},i.prototype.showExternalPictures=function(e){var t=this.getMessageByUid(e);void 0!==t&&t.showExternalPictures()},i.prototype.alwaysShowExternalPicturesForSender=function(e){this.doForAllMessages(function(t){var s=t.oFrom.aCollection;s.length>0&&s[0].sEmail===e&&t.alwaysShowExternalPicturesForSender()})},i.prototype.executeGroupOperation=function(e,t,s){var i=0;this.doForAllMessages(function(n){t.length>0?o.each(t,function(t){n.uid()===t&&n[e]()!==s&&(n[e](s),i++)}):n[e](s)}),0===t.length&&(i=s?this.unseenMessageCount():this.messageCount()-this.unseenMessageCount()),"seen"===e&&i>0&&(s?this.addMessagesCountsDiff(0,-i):this.addMessagesCountsDiff(0,i),this.markHasChanges())},i.prototype.emptyFolder=function(){var e=h.i18n("MAILWEBCLIENT/CONFIRM_EMPTY_FOLDER"),t=o.bind(this.clearFolder,this);this.enableEmptyFolder()&&g.showPopup(b,[e,t])},i.prototype.clearFolder=function(e){this.enableEmptyFolder()&&e&&(u.send("ClearFolder",{Folder:this.fullName()}),this.requireMailCache(),F.onClearFolder(this),this.removeAllMessages())},i.prototype.onAccordion=function(e,t){var s=!this.expanded(),i=f.getData("folderAccordion")||[];s?i.push(this.name()):i=o.reject(i,function(e){return e===this.name()},this),f.setData("folderAccordion",i),this.expanded(s),this.requireMailCache(),F.countMessages(this),t&&t.stopPropagation()},i.prototype.executeUnseenFilter=function(){return this.unseenMessagesCountToShow()>this.unseenMessageCount()&&this.onAccordion(),!(this.unseenMessageCount()>0)||(this.requireMailCache(),F.waitForUnseenMessages(!0),m.setHash(y.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Unseen))&&F.changeCurrentMessageList(this.fullName(),1,"",Enums.FolderFilter.Unseen,I.MessagesSortBy.DefaultSortBy,I.MessagesSortBy.DefaultSortOrder),!1)},i.prototype.onDeleteClick=function(){var e=h.i18n("MAILWEBCLIENT/CONFIRM_DELETE_FOLDER"),t=o.bind(this.deleteAfterConfirm,this);this.canDelete()?g.showPopup(b,[e,t]):p.broadcastEvent("MailWebclient::AttemptDeleteNonemptyFolder")},i.prototype.deleteAfterConfirm=function(e){if(e){var t=F.editedFolderList(),s=this.fullName(),i=function(e){return s===e.fullName()||(e.subfolders.remove(i),!1)};t.collection.remove(i),u.send("DeleteFolder",{AccountID:v.editedId(),Folder:this.fullName()},function(e){e.Result||(c.showErrorByCode(e,h.i18n("MAILWEBCLIENT/ERROR_DELETE_FOLDER")),F.getFolderList(v.editedId()))},this)}},i.prototype.onSubscribeClick=function(){if(this.canSubscribe()){var e={AccountID:v.editedId(),Folder:this.fullName(),SetAction:!this.subscribed()};this.subscribed(!this.subscribed()),u.send("SubscribeFolder",e,function(e){e.Result||(this.subscribed()?c.showErrorByCode(e,h.i18n("MAILWEBCLIENT/ERROR_SUBSCRIBE_FOLDER")):c.showErrorByCode(e,h.i18n("MAILWEBCLIENT/ERROR_UNSUBSCRIBE_FOLDER")),F.getFolderList(v.editedId()))},this)}},i.prototype.afterMove=function(e){o.each(e,function(e){o.isFunction(e.afterMove)&&e.afterMove()})},i.prototype.cancelNameEdit=function(){this.edited(!1)},i.prototype.applyNameEdit=function(){if(this.name()!==this.nameForEdit()){var e={AccountID:v.editedId(),PrevFolderFullNameRaw:this.fullName(),NewFolderNameInUtf8:this.nameForEdit()};u.send("RenameFolder",e,o.bind(this.onResponseFolderRename,this),this),this.name(this.nameForEdit())}this.edited(!1)},i.prototype.onResponseFolderRename=function(e,t){if(e&&e.Result){if(e&&e.Result&&e.Result.FullName){F.editedFolderList().renameFolder(this.fullName(),e.Result.FullName,e.Result.FullNameHash)}}else c.showErrorByCode(e,h.i18n("MAILWEBCLIENT/ERROR_RENAME_FOLDER")),F.getFolderList(v.editedId())},i.prototype.triggerTemplateState=function(){if(this.visibleTemplateTrigger()){this.isTemplateStorage()?(this.type(Enums.FolderTypes.User),this.isTemplateStorage(!1)):(this.type(Enums.FolderTypes.Template),this.isTemplateStorage(!0)),F.changeTemplateFolder(this.fullName(),this.isTemplateStorage());var e={FolderFullName:this.fullName(),SetTemplate:this.isTemplateStorage()};u.send("SetTemplateFolderType",e,this.onSetTemplateFolderType,this)}},i.prototype.onSetTemplateFolderType=function(e){e.Result||(c.showErrorByCode(e,h.i18n("MAILWEBCLIENT/ERROR_SETUP_SPECIAL_FOLDERS")),F.getFolderList(v.editedId()))},i.prototype.triggerAlwaysRefreshState=function(){if(I.AllowAlwaysRefreshFolders){this.isAlwaysRefresh(!this.isAlwaysRefresh());var e={AccountID:this.iAccountId,FolderFullName:this.fullName(),AlwaysRefresh:this.isAlwaysRefresh()};u.send("SetAlwaysRefreshFolder",e,this.onSetAlwaysRefreshFolder,this)}},i.prototype.onSetAlwaysRefreshFolder=function(e){e.Result||(c.showErrorByCode(e),F.getFolderList(v.editedId()))},e.exports=i},sWkr:function(e,t,s){"use strict";function i(e){this.oOptions=o.extend({creaId:"creaId",fontNameArray:["Tahoma"],defaultFontName:"Tahoma",defaultFontSize:3,alwaysTryUseImageWhilePasting:!0,dropableArea:null,isRtl:!1,onChange:function(){},onCursorMove:function(){},onFocus:function(){},onBlur:function(){},onUrlIn:function(){},onUrlOut:function(){},onImageSelect:function(){},onImageBlur:function(){},onItemOver:null,onItemOut:null,openInsertLinkDialog:function(){},onUrlClicked:!1},void 0===e?{}:e)}var o=s("F/us"),n=s("EVdn"),r=s("AFLV"),a=s("HLSX");i.prototype.oOptions={},i.prototype.$container=null,i.prototype.$editableArea=null,i.prototype.aEditableAreaHtml=[],i.prototype.iUndoRedoPosition=0,i.prototype.bEditable=!1,i.prototype.bFocused=!1,i.prototype.bEditing=!1,i.prototype.aSizes=[{inNumber:1,inPixels:10},{inNumber:2,inPixels:13},{inNumber:3,inPixels:16},{inNumber:4,inPixels:18},{inNumber:5,inPixels:24},{inNumber:6,inPixels:32},{inNumber:7,inPixels:48}],i.prototype.bInUrl=!1,i.prototype.oCurrLink=null,i.prototype.oCurrImage=null,i.prototype.bInImage=!1,i.prototype.sBasicFontName="",i.prototype.sBasicFontSize="",i.prototype.sBasicDirection="",i.prototype.start=function(e){function t(e){return/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e)}function s(e){return!!e.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)}this.aRanges=null,this.$container=n("#"+this.oOptions.creaId),this.$editableArea=n("<div></div>").addClass("crea-content-editable").prop("contentEditable","true").appendTo(this.$container);var i=this;this.$editableArea.on("focus",function(){i.bFocused=!0}),this.$editableArea.on("blur",function(){i.bFocused=!1}),this.$editableArea.on("click","img",function(e){var t=n(this);i.bInImage=!0,i.oCurrImage=t,i.oOptions.onImageSelect(t,e),e.stopPropagation()}),this.$editableArea.on("click",function(e){i.bInImage=!1,i.oCurrImage=null,i.oOptions.onImageBlur()}),null!==i.oOptions.onItemOver&&this.$editableArea.on("mouseover",function(e){i.oOptions.onItemOver(e)}),null!==i.oOptions.onItemOver&&this.$editableArea.on("mouseout",function(e){i.oOptions.onItemOut(e)}),this.$editableArea.on("cut paste",function(){i.bEditing=!0,i.editableSave(),o.defer(function(){i.editableSave()})}),this.$editableArea.on("paste",function(e){if((e=e.originalEvent||e).clipboardData){var o,n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("text/html");i.oOptions.alwaysTryUseImageWhilePasting&&i.pasteImage(e)?e.preventDefault():t(n)?(e.preventDefault(),i.execCom("insertHTML",'<a href="'+n+'">'+n+"</a>")):s(n)?(e.preventDefault(),i.execCom("insertHTML",'<a href="mailto:'+n+'">'+n+"</a>")):""!==r&&(e.preventDefault(),3===(o=r.split(/<!--StartFragment-->|<!--EndFragment-->/gi)).length&&(r=o[1]),r=i.replacePToBr(r),i.execCom("insertHTML",r))}}),this.$editableArea.on("keydown",function(e){var o=e.keyCode||e.which||e.charCode||0,n=e.ctrlKey||e.metaKey,r=e.altKey,a=e.shiftKey,l="";if(i.bEditing=!0,a&&n&&o===Enums.Key.z||n&&o===Enums.Key.y)e.preventDefault(),i.editableRedo();else if(n&&!r&&o===Enums.Key.z)e.preventDefault(),i.editableUndo();else if(!n||o!==Enums.Key.k&&o!==Enums.Key.b&&o!==Enums.Key.i&&o!==Enums.Key.u)r||a||n||o!==Enums.Key.Del&&o!==Enums.Key.Backspace||i.editableSave();else switch(e.preventDefault(),o){case Enums.Key.k:t(l=i.getSelectedText())?i.insertLink(l):s(l)?i.insertLink("mailto:"+l):i.oOptions.openInsertLinkDialog();break;case Enums.Key.b:i.bold();break;case Enums.Key.i:i.italic();break;case Enums.Key.u:i.underline()}}),this.$editableArea.on("keyup",function(e){var t=e.keyCode||e.which||e.charCode||0,s=e.ctrlKey||e.metaKey,o=e.altKey,n=e.shiftKey;o||n||s||(t===Enums.Key.Space||t===Enums.Key.Enter||t===Enums.Key.Del||t===Enums.Key.Backspace?i.editableSave():i.oOptions.onChange())}),this.initContentEditable(),this.setEditable(e)},i.prototype.clearUndoRedo=function(){this.aEditableAreaHtml=[],this.iUndoRedoPosition=0,this.bEditing=!1},i.prototype.isUndoAvailable=function(){return this.iUndoRedoPosition>0},i.prototype.clearRedo=function(){this.aEditableAreaHtml=this.aEditableAreaHtml.slice(0,this.iUndoRedoPosition+1)},i.prototype.editableSave=function(){var e=this.$editableArea.html(),t=o.last(this.aEditableAreaHtml);e!==(t?t[0]:"")&&(this.clearRedo(),this.aEditableAreaHtml.push([e,this.getCaretPos(this.$editableArea[0])]),this.iUndoRedoPosition=this.aEditableAreaHtml.length-1,this.oOptions.onChange())},i.prototype.editableUndo=function(){var e=this.$editableArea.html(),t=this.aEditableAreaHtml[this.iUndoRedoPosition];e!==(t?t[0]:"")&&this.editableSave(),this.iUndoRedoPosition>0&&(this.iUndoRedoPosition--,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition][1]))},i.prototype.editableRedo=function(){this.iUndoRedoPosition<this.aEditableAreaHtml.length-1&&(this.iUndoRedoPosition++,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition]?this.aEditableAreaHtml[this.iUndoRedoPosition][1]:{}))},i.prototype.getCaretPos=function(e){var t=null,s={},i={},o=0,n={};return window.getSelection&&document.createRange?(t=window.getSelection()).rangeCount>0&&((i=(s=t.getRangeAt(0)).cloneRange()).selectNodeContents(e),i.setEnd(s.startContainer,s.startOffset),n={start:o=i.toString().length,end:o+s.toString().length}):document.selection&&document.body.createTextRange&&(s=document.selection.createRange(),(i=document.body.createTextRange()).moveToElementText(e),"function"==typeof i.setEndPoint&&i.setEndPoint("EndToStart",s),n={start:o=i.text.length,end:o+s.text.length}),n},i.prototype.setCaretPos=function(e,t){if(window.getSelection&&document.createRange){var s=[e],i={},o={},n=!1,r=!1,a=0,l=0,h=0,d=document.createRange();for(d.setStart(e,0),d.collapse(!0),i=s.pop();!r&&i;){if(3===i.nodeType)l=a+i.length,!n&&t.start>=a&&t.start<=l&&(d.setStart(i,t.start-a),n=!0),n&&t.end>=a&&t.end<=l&&(d.setEnd(i,t.end-a),r=!0),a=l;else for(h=i.childNodes.length;h--;)s.push(i.childNodes[h]);i=s.pop()}(o=window.getSelection()).removeAllRanges(),o.addRange(d)}else if(document.selection&&document.body.createTextRange){var u=document.body.createTextRange();u.moveToElementText(e),u.collapse(!0),u.moveEnd("character",t.end),u.moveStart("character",t.start),u.select()}},i.prototype.setTabIndex=function(e){e&&this.$editableArea.attr("tabindex",e)},i.prototype.initContentEditable=function(){this.$editableArea.bind({mousemove:o.bind(this.storeSelectionPosition,this),mouseup:o.bind(this.onCursorMove,this),keydown:o.bind(this.onButtonPressed,this),keyup:o.bind(this.onCursorMove,this),click:o.bind(this.onClickWith,this),focus:this.oOptions.onFocus,blur:this.oOptions.onBlur}),window.File&&window.FileReader&&window.FileList&&this.oOptions.enableDrop&&this.$editableArea.bind({dragover:o.bind(this.onDragOver,this),dragleave:o.bind(this.onDragLeave,this),drop:o.bind(this.onFileSelect,this)});var e=this,t=o.debounce(function(){e.oCurrLink=null,e.bInUrl=!1,e.oOptions.onUrlOut()},300);n("html, body").on("scroll",t)},i.prototype.onCursorMove=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),13===t&&this.breakQuotes(e),17===t&&this.$editableArea.find("a").css("cursor","inherit"),8===t&&this.uniteWithNextQuote(e),46===t&&a.chrome&&this.uniteWithPrevQuote(e),this.storeSelectionPosition(),this.oOptions.onCursorMove()},i.prototype.onClickWith=function(e){e.ctrlKey&&"A"===e.target.nodeName&&window.open(e.target.href,"_blank"),this.checkAnchorNode()},i.prototype.onButtonPressed=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),17===t&&this.$editableArea.find("a").css("cursor","pointer")},i.prototype.onFileSelect=function(e){if(e=(e&&e.originalEvent?e.originalEvent:e)||window.event){e.stopPropagation(),e.preventDefault();var t=null,s=null,i=e.files||(e.dataTransfer?e.dataTransfer.files:null),o=this;i&&1===i.length&&this.checkIsImage(i[0])&&(s=i[0],(t=new window.FileReader).onload=function(e){o.insertImage(e.target.result)},t.readAsDataURL(s))}},i.prototype.onDragLeave=function(){this.$editableArea.removeClass("editorDragOver")},i.prototype.onDragOver=function(e){e.stopPropagation(),e.preventDefault(),this.$editableArea.addClass("editorDragOver")},i.prototype.pasteImage=function(e){var t=e.clipboardData&&e.clipboardData.items,s=this,i=!1;return window.File&&window.FileReader&&window.FileList&&t&&o.each(t,function(e){if(s.checkIsImage(e)&&e.getAsFile){var t=null,o=e.getAsFile();o&&((t=new window.FileReader).onload=function(e){s.insertImage(e.target.result)},t.readAsDataURL(o),i=!0)}}),i},i.prototype.checkIsImage=function(e){return e&&e.type&&0===e.type.indexOf("image/")},i.prototype.setPlainText=function(e){"string"!=typeof e&&(e=""),this.$editableArea&&(this.editableSave(),this.$editableArea.empty().text(e).css("white-space","pre"),this.editableSave())},i.prototype.setText=function(e){if("string"!=typeof e&&(e=""),this.$editableArea){0===e.length&&(e="<br />");var t=n(e),s=n(e),i=s.children(),o=i.first(),r=1===s.length&&"font-wrapper"===s.data("crea"),a=1===s.length&&1===i.length&&"body"===s.data("xDivType")&&"font-wrapper"===o.data("crea");r?(this.setBasicStyles(s.css("font-family"),s.css("font-size"),s.css("direction")),t=s.contents()):a?(this.setBasicStyles(o.css("font-family"),o.css("font-size"),o.css("direction")),t=o.contents()):this.setBasicStyles(this.oOptions.defaultFontName,this.convertFontSizeToPixels(this.oOptions.defaultFontSize),this.oOptions.isRtl?"rtl":"ltr"),this.$editableArea.empty().append(t).css("white-space","normal"),this.clearUndoRedo(),this.editableSave()}},i.prototype.setBasicStyles=function(e,t,s){this.sBasicFontName=e,this.sBasicFontSize=t,this.sBasicDirection=s,this.$editableArea.css({"font-family":this.getFontNameWithFamily(this.sBasicFontName),"font-size":this.sBasicFontSize,direction:this.sBasicDirection})},i.prototype.replacePToBr=function(e){return e.replace(/<\/p>/gi,"<br />").replace(/<p [^>]*>/gi,"").replace(/<p>/gi,"")},i.prototype.getPlainText=function(){var e="";return this.$editableArea&&(e=this.$editableArea.html().replace(/([^>]{1})<div>/gi,"$1\n").replace(/<style[^>]*>[^<]*<\/style>/gi,"\n").replace(/<br *\/{0,1}>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<\/div>/gi,"\n").replace(/<a [^>]*href="([^"]*?)"[^>]*>(.*?)<\/a>/gi,"$2 ($1)").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"')),e},i.prototype.getText=function(e){var t="";return this.$editableArea&&this.$editableArea.length>0&&(e&&this.$editableArea.find('div[data-anchor="signature"]').removeAttr("data-anchor"),t=this.$editableArea.html(),t=this.replacePToBr(t),t='<div data-crea="font-wrapper" style="font-family: '+this.getFontNameWithFamily(this.sBasicFontName)+"; font-size: "+this.sBasicFontSize+"; direction: "+this.sBasicDirection+'">'+t+"</div>"),t},i.prototype.changeSignatureContent=function(e,t){var s,i,o,r,a,l,h,d=this.$editableArea.find('div[data-anchor="signature"]'),u=n(e).closest('div[data-crea="font-wrapper"]'),c=n(t).closest('div[data-crea="font-wrapper"]');if(d.length>0)o=d.html(),""===t?d.html(o+e):-1!==o.indexOf(t)?d.html(o.replace(t,e)):-1!==o.indexOf(e)||(s=0===u.length||0===c.length?t:c.html(),i=0===u.length||0===c.length?e:u.html(),-1!==o.indexOf(s)?d.html(o.replace(s,e)):-1!==o.indexOf(i)||d.html(o+e));else{l=t;try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=n("")}if(0===r.length&&c.length>0){l=c.html();try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=n("")}}r.length>0&&(a=(r=n(r[0])).closest("blockquote")),a&&0===a.length?r.html(r.html().replace(l,e)):(h=(d=this.$editableArea.find('div[data-anchor="reply-title"]')).length>0?n(d[0]).closest("blockquote"):d,(0===d.length||h.length>0)&&(d=this.$editableArea.find("blockquote")),d.length>0?n(d[0]).before(n('<br /><div data-anchor="signature">'+e+"</div><br />")):this.$editableArea.append(n('<br /><div data-anchor="signature">'+e+"</div><br />")))}this.editableSave()},i.prototype.isFocused=function(){return this.bFocused},i.prototype.setFocus=function(e){var t=this.$editableArea.contents(),s=null,i="";this.$editableArea.focus(),e&&o.isArray(this.aRanges)&&this.aRanges.length>0?this.restoreSelectionPosition():t.length>0&&(3===t[0].nodeType?s=n(t[0]):(s=n(document.createTextNode("")),n(t[0]).before(s)),i=s.text(),this.setCursorPosition(s[0],i.length))},i.prototype.setBlur=function(){this.$editableArea.blur()},i.prototype.setEditable=function(e){e?this.enableContentEditable():this.disableContentEditable()},i.prototype.disableContentEditable=function(){this.bEditable=!1,this.$editableArea.prop("contentEditable","false")},i.prototype.enableContentEditable=function(){this.$editableArea.prop("contentEditable","true"),setTimeout(o.bind(function(){this.bEditable=!0},this),0)},i.prototype.fixFirefoxCursorBug=function(){a.firefox&&(this.disableContentEditable(),setTimeout(o.bind(function(){this.enableContentEditable()},this),0))},i.prototype.setRtlDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"rtl")},i.prototype.setLtrDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"ltr")},i.prototype.pasteHtmlAtCaret=function(e){var t,s;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(s=t.getRangeAt(0)).deleteContents();var i=document.createElement("div");i.innerHTML=e;for(var o,n,r=document.createDocumentFragment();o=i.firstChild;)n=r.appendChild(o);s.insertNode(r),n&&((s=s.cloneRange()).setStartAfter(n),s.collapse(!0),t.removeAllRanges(),t.addRange(s))}}else document.selection&&"Control"!==document.selection.type&&(s=document.selection.createRange())&&s.pasteHTML&&s.pasteHTML(e)},i.prototype.execCom=function(e,t,s){var i,o=!1;return this.bEditable&&(this.editableSave(),a.opera&&this.restoreSelectionPosition(),"insertHTML"===e&&a.ie?this.pasteHtmlAtCaret(t):o=void 0===t?window.document.execCommand(e):window.document.execCommand(e,!1,t),a.chrome&&(this.storeSelectionPosition(),"insertHTML"===e&&this.aRanges.length>0&&((i=this.aRanges[0]).setEnd(i.startContainer,i.startOffset),this.restoreSelectionPosition())),s||this.editableSave()),o},i.prototype.insertHtml=function(e,t){this.execCom("insertHTML",e,t)},i.prototype.changeImageSource=function(e,t){this.$editableArea.find('img[id="'+e+'"]').attr("src",t),this.editableSave()},i.prototype.insertEmailLink=function(e){this.restoreSelectionPosition(),""===this.getSelectedText()?this.execCom("insertHTML",'<a href="mailto:'+e+'">'+e+"</a>"):this.insertLink("mailto:"+e)},i.prototype.insertLink=function(e){if(e=this.normaliseURL(e),this.restoreSelectionPosition(e),""===this.getSelectedText()&&a.ie)this.execCom("insertHTML",'<a href="'+e+'">'+e+"</a>");else{var t=a.ie8AndBelow?"CreateLink":"createlink";this.execCom(t,e)}this.changeFocusLink(e)},i.prototype.removeLink=function(){var e=a.ie8AndBelow?"Unlink":"unlink";this.execCom(e)},i.prototype.insertImage=function(e){var t=a.ie8AndBelow?"InsertImage":"insertimage";return this.isFocused()?this.restoreSelectionPosition():this.setFocus(!0),this.execCom(t,e)},i.prototype.numbering=function(){this.execCom("InsertOrderedList")},i.prototype.bullets=function(){this.execCom("InsertUnorderedList")},i.prototype.horizontalLine=function(){this.execCom("InsertHorizontalRule")},i.prototype.getFontNameWithFamily=function(e){var t="";switch(e){case"Arial":case"Arial Black":case"Tahoma":case"Verdana":t=", sans-serif";break;case"Courier New":t=", monospace";break;case"Times New Roman":t=", serif"}return e+t},i.prototype.fontName=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontName",this.getFontNameWithFamily(e)),t&&this.setBasicStyles(e,this.sBasicFontSize,this.sBasicDirection)},i.prototype.fontSize=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontSize",e),t&&this.setBasicStyles(this.sBasicFontName,this.convertFontSizeToPixels(e),this.sBasicDirection)},i.prototype.bold=function(){this.execCom("Bold"),this.$editableArea.focus()},i.prototype.italic=function(){this.execCom("Italic"),this.$editableArea.focus()},i.prototype.underline=function(){this.execCom("Underline"),this.$editableArea.focus()},i.prototype.strikeThrough=function(){this.execCom("StrikeThrough"),this.$editableArea.focus()},i.prototype.undo=function(){this.editableUndo()},i.prototype.redo=function(){this.editableRedo()},i.prototype.alignLeft=function(){this.execCom("JustifyLeft")},i.prototype.center=function(){this.execCom("JustifyCenter")},i.prototype.alignRight=function(){this.execCom("JustifyRight")},i.prototype.justify=function(){this.execCom("JustifyFull")},i.prototype.textColor=function(e){this.execCom("ForeColor",e),this.$editableArea.focus()},i.prototype.backgroundColor=function(e){var t=a.ie?"BackColor":"hilitecolor";this.execCom(t,e),this.$editableArea.focus()},i.prototype.removeFormat=function(){this.execCom("removeformat"),this.$editableArea.focus()},i.prototype.getFontName=function(){if(this.bEditable){var e=window.document.queryCommandValue("FontName"),t=this.sBasicFontName,s="";"string"==typeof e&&(e=e.replace(/'/g,""),n.each(this.oOptions.fontNameArray,function(t,i){(e.indexOf(i)>-1||e.indexOf(i.toLowerCase())>-1)&&(s=i)}),""!==s&&(t=s))}return t},i.prototype.getIsBold=function(){if(this.bEditable)var e=window.document.queryCommandState("bold");return e},i.prototype.getIsItalic=function(){if(this.bEditable)var e=window.document.queryCommandState("italic");return e},i.prototype.getIsUnderline=function(){if(this.bEditable)var e=window.document.queryCommandState("underline");return e},i.prototype.getIsEnumeration=function(){if(this.bEditable)var e=window.document.queryCommandState("insertOrderedList");return e},i.prototype.getIsBullets=function(){if(this.bEditable)var e=window.document.queryCommandState("insertUnorderedList");return e},i.prototype.getIsStrikeThrough=function(){if(this.bEditable)var e=window.document.queryCommandState("StrikeThrough");return e},i.prototype.convertFontSizeToPixels=function(e){var t=0;return n.each(this.aSizes,function(s,i){0===t&&e<=i.inNumber&&(t=i.inPixels)}),t+"px"},i.prototype.convertFontSizeToNumber=function(e){var t=r.pInt(e),s=0;return t>0&&n.each(this.aSizes,function(e,i){0===s&&t<=i.inPixels&&(s=i.inNumber)}),s},i.prototype.getFontSizeInNumber=function(){var e="",t=0;return this.bEditable&&(e=window.document.queryCommandValue("FontSize"),t=r.pInt(e)),(isNaN(t)||t<=0)&&(t=this.convertFontSizeToNumber(this.sBasicFontSize)),t},i.prototype.changeLink=function(e){var t=this.normaliseURL(e),s=n(this.oCurrLink);this.oCurrLink&&(s.attr("href")===s.text()&&s.text(t),"A"===this.oCurrLink.tagName?s.attr("href",t):s.parent().attr("href",t),this.oCurrLink=null,this.bInUrl=!1)},i.prototype.removeCurrentLink=function(){if(this.oCurrLink&&document.createRange&&window.getSelection){var e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.oCurrLink),t.removeAllRanges(),t.addRange(e),this.removeLink(),this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()}},i.prototype.changeFocusLink=function(e){var t=null,s=null;a.firefox&&window.getSelection&&(s=(t=window.getSelection()).focusNode?t.focusNode.parentElement:null)&&"A"===s.tagName&&n(s).attr("href",e)},i.prototype.removeCurrentImage=function(){this.oCurrImage&&(this.oCurrImage.remove(),this.oCurrImage=null,this.bInImage=!1,this.oOptions.onImageBlur()),this.setFocus(!0)},i.prototype.changeCurrentImage=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;n.each(e,function(e,s){t.css(e,s)})}this.setFocus(!0)},i.prototype.showImageTooltip=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;n.each(e,function(e,s){t.css(e,s)})}},i.prototype.normaliseURL=function(e){return-1!==e.search(/^https?:\/\/|^mailto:|^tel:/g)?e:"http://"+e},i.prototype.getSelectedText=function(){var e="",t=null;return window.getSelection&&(t=window.getSelection()).rangeCount>0&&(e=t.getRangeAt(0).toString()),e},i.prototype.storeSelectionPosition=function(){var e=this.getSelectionRanges();o.isArray(e)&&e.length>0&&(this.aRanges=e)},i.prototype.editableIsActive=function(){return!(!n(document.activeElement).hasClass("crea-content-editable")&&!n(document.activeElement).children().first().hasClass("crea-content-editable"))},i.prototype.getSelectionRanges=function(){var e=[];if(window.getSelection&&this.editableIsActive())for(var t=window.getSelection(),s=null,i=0,o=t.rangeCount;i<o;i++)s=t.getRangeAt(i),e.push(s);return e},i.prototype.checkAnchorNode=function(){if(window.getSelection&&this.editableIsActive()){var e=window.getSelection(),t=null;e.anchorNode&&(e.anchorNode.parentElement||e.anchorNode.parentNode)&&("A"===(t=e.anchorNode.parentElement||e.anchorNode.parentNode).tagName||"A"===t.parentNode.tagName||"A"===t.parentElement.tagName?this.bInUrl&&t===this.oCurrLink?this.bInUrl&&t===this.oCurrLink&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()):(this.oCurrLink=t,this.bInUrl=!0,this.oOptions.onUrlIn(n(t))):this.bInUrl&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()))}},i.prototype.restoreSelectionPosition=function(e){var t="",s=null,i=null,n=null;t=this.setSelectionRanges(this.aRanges),window.getSelection&&o.isArray(this.aRanges)&&(e=void 0!==e?e:"",a.firefox&&""===t&&""!==e&&(window.getSelection&&window.getSelection().getRangeAt?(s=window.getSelection()).getRangeAt&&s.rangeCount>0&&(n=(i=s.getRangeAt(0)).createContextualFragment(e),i.insertNode(n)):document.selection&&document.selection.createRange&&document.selection.createRange().pasteHTML(e)))},i.prototype.setSelectionRanges=function(e){var t=null,s=null,i=0,n=0,r="";if(window.getSelection&&o.isArray(e))for(n=e.length,t=window.getSelection(),a.ie10AndAbove||t.removeAllRanges();i<n;i++)(s=e[i])&&(t.addRange(s),r+=""+s);return r},i.prototype.uniteWithNextQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,s=t?this.getLastBlockQuote(t):null,i=s?n(s).next():null,o=i&&i.length>0&&"BLOCKQUOTE"===i[0].tagName?i[0]:null,r=[],a=0,l=0,h=null;if(s&&o){for(n("<br />").appendTo(s),l=(r=n(o).contents()).length,a=0;a<l;a++)h=r[a],n(h).appendTo(s);n(o).remove()}},i.prototype.uniteWithPrevQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,s=t?this.getLastBlockQuote(t):null;this.getPrevAndUnite(s),this.getPrevAndUnite(s)},i.prototype.getPrevAndUnite=function(e){var t=e?n(e).prev():null,s=t&&t.length>0&&"BLOCKQUOTE"===t[0].tagName?t[0]:null,i=[],o=0,r=null;if(e&&s){for(n("<br />").prependTo(e),o=(i=n(s).contents()).length-1;o>0;o--)r=i[o],n(r).prependTo(e);n(s).remove()}},i.prototype.getLastBlockQuote=function(e){for(var t=e,s=null;t&&t.parentNode;)"BLOCKQUOTE"===t.tagName&&(s=t),t=t.parentNode;return s},i.prototype.breakQuotes=function(e){var t=window.getSelection?window.getSelection():null,s=t?t.focusNode:null,i=s?this.getLastBlockQuote(s):null;s&&i&&this.breakBlocks(s,i,t.focusOffset)},i.prototype.setCursorPosition=function(e,t){if(document.createRange&&window.getSelection){var s=document.createRange(),i=window.getSelection();i.removeAllRanges(),s.setStart(e,t),s.setEnd(e,t),s.collapse(!0),i.addRange(s),this.aRanges=[s]}},i.prototype.cloneNode=function(e){var t=null,s="";try{t=n(e).clone()}catch(i){s=e.tagName,t=n("<"+s+"></"+s+">")}return t},i.prototype.breakBlocks=function(e,t,s){for(var i=e,o=null,r=[],a=0,l=0,h=null,d=!0,u=null,c=null,p=null,m=null,f=!0,g=null;f&&i.parentNode;){for(p=u,m=c,u=this.cloneNode(i).empty(),c=this.cloneNode(i).empty(),l=(r=n(i).contents()).length,d=!0,null===o&&(o=r[s]),0===l&&(u=null),a=0;a<l;a++)(h=r[a])===o?(null===p?a===s&&"BR"===h.tagName||n(h).appendTo(c):(p.html().length>0&&p.appendTo(u),m.appendTo(c)),d=!1):d?n(h).appendTo(u):n(h).appendTo(c);t===i&&(f=!1),o=i,i=i.parentNode}null!==u&&null!==c&&(u.insertBefore(n(t)),g=n("<span>&nbsp;</span>").insertBefore(n(t)),n("<br>").insertBefore(n(t)),c.insertBefore(n(t)),n(t).remove(),this.setCursorPosition(g[0],0))},e.exports=i},vsma:function(e,t,s){"use strict";function i(){this.bAccountPart=!1,this.isDefault=o.observable(!1),this.email=o.observable(""),this.friendlyName=o.observable(""),this.fullEmail=o.computed(function(){return n.getFullEmail(this.friendlyName(),this.email())},this),this.accountId=o.observable(-1),this.id=o.observable(-1),this.signature=o.observable(""),this.useSignature=o.observable(!1),this.hash=o.computed(function(){return a.getHash(this.accountId()+"identity"+this.id())},this)}var o=s("0h2I"),n=s("Ol7c"),r=s("AFLV"),a=s("Yjhd");i.prototype.parse=function(e){"Object/Aurora\\Modules\\Mail\\Classes\\Identity"===e["@Object"]&&(this.bAccountPart=!!e.AccountPart,this.isDefault(!!e.Default),this.email(r.pString(e.Email)),this.friendlyName(r.pString(e.FriendlyName)),this.accountId(r.pInt(e.IdAccount)),this.id(r.pInt(e.EntityId)),this.signature(r.pString(e.Signature)),this.useSignature(!!e.UseSignature))},e.exports=i},"w+bY":function(e,t,s){var i;!function(){function o(e){function t(){for(;o=h<l.length&&e>d;){var i=h++,n=l[i],a=r.call(n,1);a.push(function(e){return function(i,n){--d,null==c&&(null!=i?(c=i,h=u=NaN,s()):(l[e]=n,--u?o||t():s()))}}(i)),++d,n[0].apply(null,a)}}function s(){null!=c?p(c):a?p(c,l):p.apply(null,[c].concat(l))}var i,o,a,l=[],h=0,d=0,u=0,c=null,p=n;return e||(e=1/0),i={defer:function(){return c||(l.push(arguments),++u,t()),i},await:function(e){return p=e,a=!1,u||s(),i},awaitAll:function(e){return p=e,a=!0,u||s(),i}}}function n(){}var r=[].slice;o.version="1.0.7",void 0===(i=function(){return o}.call(t,s,t,e))||(e.exports=i)}()},xzvH:function(e,t,s){"use strict";function i(){this.oMessages={},setInterval(this.checkAndClear.bind(this),6e4*o)}var o=30,n=s("F/us"),r=s("wd/R"),a=s("Yjhd"),l=s("p2hp"),h=null;i.prototype.get=function(e){var t=JSON.stringify(e);return this.oMessages[t]},i.prototype.set=function(e,t){var s=JSON.stringify(e);this.oMessages[s]=t},i.prototype.requireMailCache=function(){null===h&&(h=s("4+IO"))},i.prototype.checkAndClear=function(){this.requireMailCache();var e=h.getCurrentFolder();if(!e&&h.folderList()&&(e=h.folderList().inboxFolder()),e&&!(r().diff(e.oRelevantInformationLastMoment)>6e4*o)){var t=n.size(this.oMessages),s=r().add(-4,"hours").unix(),i=8*l.MailsPerPage+700;t>i&&(a.log("checkAndClear",t,l.MailsPerPage,i),n.each(h.messages(),function(e){e.updateLastAccessTime()}),h.currentMessage()&&h.currentMessage().updateLastAccessTime(),n.each(this.oMessages,function(e,t){0!==e.iLastAccessTime&&e.iLastAccessTime<s&&a.destroyObjectWithObservables(this.oMessages,t)}.bind(this)),a.log("checkAndClear",n.size(this.oMessages)))}},i.prototype.remove=function(e){var t=JSON.stringify(e);a.destroyObjectWithObservables(this.oMessages,t)},i.prototype.updateMomentDates=function(){n.each(this.oMessages,function(e){e.updateMomentDate()},this)},e.exports=new i},zu1m:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("AFLV"),r={};r.showInlinePictures=function(e,t,s,n){var r=function(e){return i.find(t,function(t){return t.CID===e})};"string"!=typeof n&&(n=""),s.length>0&&(o("[data-x-src-cid]",e).each(function(){var e=o(this).attr("data-x-src-cid"),t=r(e);t&&t.ViewLink.length>0&&o(this).attr("src",n+t.ViewLink)}),o("[data-x-style-cid]",e).each(function(){var e="",t=o(this).attr("data-x-style-cid-name"),s=o(this).attr("data-x-style-cid"),i=r(s);i&&i.ViewLink.length>0&&""!==t&&(e=""===(e=o.trim(o(this).attr("style")))?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+t+": url('"+i.ViewLink+"')"))})),o("[data-x-src-location]",e).each(function(){var e=o(this).attr("data-x-src-location"),s=function(e){return i.find(t,function(t){return t.ContentLocation===e})}(e);s||(s=r(e)),s&&s.ViewLink.length>0&&o(this).attr("src",n+s.ViewLink)})},r.showExternalPictures=function(e){o("[data-x-src]",e).each(function(){o(this).attr("src",o(this).attr("data-x-src")).removeAttr("data-x-src")}),o("[data-x-style-url]",e).each(function(){var e=o.trim(o(this).attr("style"));e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+o(this).attr("data-x-style-url")).removeAttr("data-x-style-url")})},r.joinReplyPrefixesInSubject=function(e,t,s){var r=[t.toUpperCase()],a=[s.toUpperCase()],l=i.union(r,a).join("|"),h="",d=e.split(":"),u=[],c="";return i.each(d,function(e){if(0===c.length){var h=o.trim(e.toUpperCase()),d=-1!==i.indexOf(r,h),p=-1!==i.indexOf(a,h),m=1,f=u.length>0?u[u.length-1]:null;if(!d&&!p){var g=new window.RegExp("^\\s?("+l+")\\s?[\\[\\(]([\\d]+)[\\]\\)]$","gi").exec(h);g&&3===g.length&&(d=-1!==i.indexOf(r,g[1].toUpperCase()),p=-1!==i.indexOf(a,g[1].toUpperCase()),m=n.pInt(g[2]))}d?f&&f.prefix===t?f.count+=m:u.push({prefix:t,count:m}):p?f&&f.prefix===s?f.count+=m:u.push({prefix:s,count:m}):c=e}else c+=":"+e}),i.each(u,function(e){1===e.count?h+=e.prefix+": ":h+=e.prefix+"["+e.count+"]: "}),h+=o.trim(c)},e.exports=r}}]);