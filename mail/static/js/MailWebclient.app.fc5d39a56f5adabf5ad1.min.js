(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"/Lxk":function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("AFLV"),a=s("JFZZ"),l=s("HLSX"),h=s("OgeD"),c=s("SQrT"),u=s("o0Bx"),d=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),p=s("jonm"),m=s("UN2P"),g=s("p2hp"),f=s("a28q");function b(){d.call(this,g.ServerModuleName),this.fetcherOrIdentity=o.observable(null),this.useSignatureRadio=o.observable(Enums.UseSignature.Off),this.signature=o.observable(""),this.oHtmlEditor=new f(!0),this.oHtmlEditor.textFocused.subscribe((function(){this.oHtmlEditor.textFocused()&&this.useSignatureRadio(Enums.UseSignature.On)}),this),this.useSignatureRadio.subscribe((function(){this.oHtmlEditor.setInactive(this.useSignatureRadio()===Enums.UseSignature.Off)}),this),this.enableImageDragNDrop=o.observable(!1),this.enabled=o.observable(!0)}i.extendOwn(b.prototype,d.prototype),b.prototype.ViewTemplate="MailWebclient_Settings_SignatureSettingsFormView",b.prototype.ViewConstructorName="CSignatureSettingsFormView",b.prototype.onShow=function(e){this.fetcherOrIdentity(e||null),this.populate(),i.defer(i.bind(this.init,this))},b.prototype.init=function(){this.oHtmlEditor.setInactive(this.useSignatureRadio()===Enums.UseSignature.Off),this.oHtmlEditor.init(this.signature(),!1,"",n.i18n("MAILWEBCLIENT/LABEL_ENTER_SIGNATURE_HERE")),this.enableImageDragNDrop(this.oHtmlEditor.isDragAndDropSupported()&&!l.ie10AndAbove)},b.prototype.getCurrentValues=function(){return this.oHtmlEditor.isInitialized()&&this.signature(this.oHtmlEditor.getText()),[this.useSignatureRadio(),this.signature()]},b.prototype.revert=function(){this.populate()},b.prototype.getParametersForSave=function(){this.signature(this.oHtmlEditor.getText());var e=p.getEdited(),t={AccountID:this.fetcherOrIdentity()?this.fetcherOrIdentity().accountId():e?e.id():0,UseSignature:this.useSignatureRadio()===Enums.UseSignature.On,Signature:this.signature()};return this.fetcherOrIdentity()&&(this.fetcherOrIdentity().FETCHER?i.extendOwn(t,{FetcherId:this.fetcherOrIdentity().id()}):this.fetcherOrIdentity().bAccountPart||i.extendOwn(t,{IdentityId:this.fetcherOrIdentity().id()})),t},b.prototype.applySavedValues=function(e){if(e.FetcherId)p.populateFetchers();else if(!e.IdentityId){var t=p.getAccount(e.AccountID);t&&(t.useSignature(!!e.UseSignature),t.signature(e.Signature))}p.populateIdentities()},b.prototype.populate=function(){var e=p.getEdited(),t=this.fetcherOrIdentity()||e;t?(this.useSignatureRadio(t.useSignature()?Enums.UseSignature.On:Enums.UseSignature.Off),this.signature(t.signature()),this.oHtmlEditor.setText(this.signature())):e&&m.send("GetSignature",{AccountID:e.id()},this.onGetSignatureResponse,this),this.updateSavedState()},b.prototype.onGetSignatureResponse=function(e,t){if(e&&e.Result){var s=t.Parameters,i=r.pInt(s.AccountID);p.getAccount(i)&&(this.parseSignature(e.Result),i===p.editedId()&&this.populate())}},b.prototype.save=function(){this.isSaving(!0),this.updateSavedState(),this.fetcherOrIdentity()&&this.fetcherOrIdentity().FETCHER?u.send(g.FetchersServerModuleName,"UpdateSignature",this.getParametersForSave(),this.onResponse,this):m.send("UpdateSignature",this.getParametersForSave(),this.onResponse,this)},b.prototype.onResponse=function(e,t){this.isSaving(!1),e.Result?(this.applySavedValues(t.Parameters),c.showReport(n.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))):a.showErrorByCode(e,n.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},e.exports=new b},"2tUx":function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("p2hp"),a=s("Ig+v"),l=s("jonm"),h=s("4+IO");function c(){a.call(this,n.i18n("MAILWEBCLIENT/ACTION_SHOW_MAIL")),this.unseenCount=h.newMessagesCount,this.inactiveTitle=o.computed((function(){return n.i18n("MAILWEBCLIENT/HEADING_UNREAD_MESSAGES_BROWSER_TAB_PLURAL",{COUNT:this.unseenCount()},null,this.unseenCount())+" - "+l.getEmail()}),this),this.accounts=r.ShowEmailAsTabName?l.collection:o.observableArray([]),r.ShowEmailAsTabName&&(this.linkText=o.computed((function(){var e=l.getEmail();return e.length>0?e:n.i18n("MAILWEBCLIENT/HEADING_BROWSER_TAB")}))),this.mainHref=o.computed((function(){return this.isCurrent()?"javascript: void(0);":this.hash()}),this)}i.extendOwn(c.prototype,a.prototype),c.prototype.ViewTemplate="MailWebclient_HeaderItemView";var u=new c;u.allowChangeTitle(!0),e.exports=u},"2ug6":function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("Ol7c"),r=s("RN+F"),a=s("AFLV"),l=s("Yjhd"),h=null,c=s("JFZZ"),u=null,d=s("hPb3"),p=s("76Kh"),m=s("20Ah"),g=s("SbmC"),f=s("gAbd"),b=null,y=null,v=s("p2hp");function A(e){u=s("IAk5"),h=s("UN2P"),this.id=o.observable(a.pInt(e.AccountID)),this.email=o.observable(a.pString(e.Email)),this.friendlyName=o.observable(a.pString(e.FriendlyName)),this.incomingLogin=o.observable(a.pString(e.IncomingLogin)),this.passwordMightBeIncorrect=o.observable(!1),this.passwordMightBeIncorrect.subscribe((function(){this.passwordMightBeIncorrect()||(this.requireCache(),y.getFolderList(this.id()))}),this),this.signature=o.observable(a.pString(e.Signature)),this.useSignature=o.observable(!!e.UseSignature),this.serverId=o.observable(a.pInt(e.ServerId)),this.oServer=new f(e.Server),this.useToAuthorize=o.observable(!!e.UseToAuthorize),this.canBeUsedToAuthorize=o.observable(!!e.CanBeUsedToAuthorize),this.useThreading=o.observable(!!e.UseThreading),this.useThreading.subscribe((function(){this.requireCache(),y.clearMessagesCache(this.id())}),this),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder,this.isCurrent=o.observable(!1),this.isEdited=o.observable(!1),this.hash=o.computed((function(){return l.getHash(this.id()+this.email())}),this),this.fetchers=o.observableArray([]),this.identities=o.observable(null),this.allowAutoresponder=o.observable(a.pBool(e.AllowAutoresponder,!1)),this.autoresponder=o.observable(null),this.allowForward=o.observable(a.pBool(e.AllowForward,!1)),this.forward=o.observable(null),this.allowFilters=o.observable(a.pBool(e.AllowFilters,!1)),this.filters=o.observable(null),this.quota=o.observable(0),this.usedSpace=o.observable(0),this.quotaRecieved=o.observable(!1),this.fullEmail=o.computed((function(){return n.getFullEmail(this.friendlyName(),this.email())}),this),this.bDefault=v.AllowDefaultAccountForUser&&this.email()===u.getUserPublicId(),this.aExtend=a.pObject(e.Extend)}A.prototype.threadingIsAvailable=function(){return this.oServer.bEnableThreading&&this.useThreading()},A.prototype.updateFromServer=function(e){this.email(a.pString(e.Email)),this.friendlyName(a.pString(e.FriendlyName)),this.incomingLogin(a.pString(e.IncomingLogin)),this.serverId(a.pInt(e.ServerId)),this.oServer=new f(e.Server),this.useToAuthorize(!!e.UseToAuthorize),this.useThreading(!!e.UseThreading),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder},A.prototype.requireAccounts=function(){null===b&&(b=s("jonm"))},A.prototype.requireCache=function(){null===y&&(y=s("4+IO"))},A.prototype.onGetQuotaResponse=function(e,t){i.isArray(e.Result)&&1<e.Result.length&&(this.quota(a.pInt(e.Result[1])),this.usedSpace(a.pInt(e.Result[0])),this.requireCache(),y.quotaChangeTrigger(!y.quotaChangeTrigger())),this.quotaRecieved(!0)},A.prototype.updateQuotaParams=function(){d.ShowQuotaBar&&h.send("GetQuota",{AccountID:this.id()},this.onGetQuotaResponse,this)},A.prototype.updateFriendlyName=function(e){this.friendlyName(e)},A.prototype.changeAccount=function(){this.requireAccounts(),b.changeCurrentAccount(this.id(),!0)},A.prototype.getDefaultIdentity=function(){return i.find(this.identities()||[],(function(e){return e.isDefault()}))},A.prototype.getFetchersIdentitiesEmails=function(){var e=this.identities()||[],t=[];return i.each(this.fetchers(),(function(e){t.push(e.email())})),i.each(e,(function(e){t.push(e.email())})),t},A.prototype.remove=function(){var e=i.bind(this.confirmedRemove,this);this.bDefault||p.showPopup(m,[r.i18n("MAILWEBCLIENT/CONFIRM_REMOVE_ACCOUNT"),e,this.email()])},A.prototype.confirmedRemove=function(e){e&&h.send("DeleteAccount",{AccountID:this.id()},this.onAccountDeleteResponse,this)},A.prototype.onAccountDeleteResponse=function(e,t){if(e.Result){var o=s("h1OO");i.isFunction(o.closeComposePopup)&&o.closeComposePopup(),this.requireAccounts(),b.deleteAccount(this.id())}else c.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_REMOVE_ACCOUNT"))},A.prototype.requestFilters=function(){h.send("GetFilters",{AccountID:this.id()},this.onGetFiltersResponse,this)},A.prototype.onGetFiltersResponse=function(e,t){var s=new g;e.Result&&s.parse(this.id(),e.Result),this.filters(s)},e.exports=A},"3AgX":function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("3Y+r"),h=s("JFZZ"),c=s("czxF"),u=s("jonm"),d=s("UN2P"),p=s("2ug6"),m=s("NV9q");function g(){c.call(this),this.loading=n.observable(!1),this.friendlyName=n.observable(""),this.email=n.observable(""),this.email.focused=n.observable(!1),this.incomingLogin=n.observable(""),this.incomingLogin.focused=n.observable(!1),this.incomingPassword=n.observable(""),this.incomingPassword.focused=n.observable(!1),this.oServerPairPropertiesView=new m("acc_create"),this.email.focused.subscribe((function(){this.email.focused()||""!==o.trim(this.incomingLogin())||this.incomingLogin(this.email())}),this),this.aRequiredFields=[this.email,this.incomingLogin,this.incomingPassword].concat(this.oServerPairPropertiesView.aRequiredFields)}i.extendOwn(g.prototype,c.prototype),g.prototype.PopupTemplate="MailWebclient_Settings_CreateAccountPopup",g.prototype.init=function(){this.friendlyName(""),this.email(""),this.incomingLogin(""),this.incomingLogin.focused(!1),this.incomingPassword(""),this.oServerPairPropertiesView.fullInit()},g.prototype.onOpen=function(e,t,s,i){this.fCallback=e,this.init(),this.friendlyName(t),this.email(s),this.incomingLogin(s),this.incomingPassword(i),this.focusFieldToEdit()},g.prototype.focusFieldToEdit=function(){var e=i.find(this.aRequiredFields,(function(e){return""===e()}));e?e.focused(!0):this.aRequiredFields.length>0&&this.aRequiredFields[0].focused(!0)},g.prototype.onClose=function(){this.init()},g.prototype.save=function(){if(l.checkIfFieldsEmpty(this.aRequiredFields,r.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"))){var e={FriendlyName:this.friendlyName(),Email:o.trim(this.email()),IncomingLogin:o.trim(this.incomingLogin()),IncomingPassword:o.trim(this.incomingPassword()),Server:this.oServerPairPropertiesView.getParametersForSave()};this.loading(!0),d.send("CreateAccount",e,this.onAccountCreateResponse,this)}else this.loading(!1)},g.prototype.onAccountCreateResponse=function(e,t){if(this.loading(!1),e.Result){var s=a.pInt(e.Result.AccountID),i=new p(e.Result);u.addAccount(i),u.populateIdentities(),u.changeEditedAccount(s),1===u.collection().length&&u.changeCurrentAccount(s),this.fCallback&&this.fCallback(s),this.closePopup()}else h.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_CREATE_ACCOUNT"))},e.exports=new g},"3Y+r":function(e,t,s){"use strict";var i=s("F/us"),o=s("SQrT"),n={checkIfFieldsEmpty:function(e,t){var s=i.find(e,(function(e){return""===e()}));return!s||(t&&o.showError(t),s.focused(!0),!1)},checkPassword:function(e,t){var i=s("RN+F"),n=s("hPb3"),r=!1;return t!==e?o.showError(i.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")):n.PasswordMinLength>0&&e.length<n.PasswordMinLength?o.showError(i.i18n("COREWEBCLIENT/ERROR_PASSWORD_TOO_SHORT").replace("%N%",n.PasswordMinLength)):!n.PasswordMustBeComplex||e.match(/([0-9])/)&&e.match(/([!,%,&,@,#,$,^,*,?,_,~])/)?r=!0:o.showError(i.i18n("COREWEBCLIENT/ERROR_PASSWORD_TOO_SIMPLE")),r}};e.exports=n},"4+IO":function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("wd/R"),a=s("RN+F"),l=s("AFLV"),h=s("Yjhd"),c=s("JFZZ"),u=s("IAk5"),d=s("TKFr"),p=s("QaF5"),m=s("hPb3"),g=s("ZCBP"),f=s("76Kh"),b=s("20Ah"),y=s("4M/5"),v=s("jonm"),A=s("UN2P"),F=s("xzvH"),S=null,E=s("p2hp"),I=s("5aTH"),C=s("lPfU"),M=u.isNewTab()&&window.opener&&window.opener.MainTabMailMethods;function T(){this.currentAccountId=v.currentId,this.currentAccountId.subscribe((function(e){var t=v.getAccount(e),s=this.oFolderListItems[e];t?(t.quotaRecieved(!1),this.messagesLoadingError(!1),s?this.folderList(s):(this.messagesLoading(!0),this.folderList(new I),this.messages([]),this.currentMessage(null),this.getFolderList(e))):this.folderList(new I)}),this),this.editedAccountId=v.editedId,this.editedAccountId.subscribe((function(e){var t=this.oFolderListItems[e];t?this.editedFolderList(t):(this.editedFolderList(new I),this.currentAccountId()!==e&&this.getFolderList(e))}),this),this.oFolderListItems={},this.quotaChangeTrigger=n.observable(!1),this.checkMailStarted=n.observable(!1),this.checkMailStartedAccountId=n.observable(0),this.folderList=n.observable(new I),this.folderListLoading=n.observableArray([]),this.editedFolderList=n.observable(new I),this.newMessagesCount=n.computed((function(){var e=this.folderList().inboxFolder();return e?e.unseenMessageCount():0}),this),this.messages=n.observableArray([]),this.messages.subscribe((function(){this.messages().length>0&&this.messagesLoadingError(!1)}),this),this.uidList=n.observable(new C),this.page=n.observable(1),this.messagesLoading=n.observable(!1),this.messagesLoadingError=n.observable(!1),this.currentMessage=n.observable(null),this.nextMessageUid=n.observable(""),this.prevMessageUid=n.observable(""),this.savingDraftUid=n.observable(""),this.editedDraftUid=n.observable(""),this.disableComposeAutosave=n.observable(!1),this.aResponseHandlers=[],this.iAutoCheckMailTimer=-1,this.waitForUnseenMessages=n.observable(!0),this.iSetMessagesSeenCount=0,u.subscribeEvent("ReceiveAjaxResponse::after",i.bind((function(e){!this.checkMailStarted()&&"Ping"===e.Response.Method&&"Core"===e.Response.Module&&e.Response.Result&&this.executeCheckMail()}),this))}T.prototype.requirePrefetcher=function(){S=s("cPXi")},T.prototype.init=function(){if(A.registerOnAllRequestsClosedHandler((function(){i.delay((function(){A.hasOpenedRequests()||(L.checkMailStarted(!1),L.folderListLoading.removeAll())}),10),A.hasOpenedRequests()||L.savingDraftUid("")})),M){if(this.oFolderListItems=M.getFolderListItems(),this.uidList(M.getUidList()),window.name){var e=l.pInt(window.name);0===e&&(e=M.getComposedMessageAccountId(window.name)),0!==e&&this.currentAccountId(e)}this.currentAccountId.valueHasMutated(),this.initPrevNextSubscribes()}else this.currentAccountId.valueHasMutated(),this.initPrevNextSubscribes()},T.prototype.initPrevNextSubscribes=function(){this.bInThreadLevel=!1,this.currentMessage.subscribe(this.calcNextMessageUid,this),this.uidList.subscribe(this.calcNextMessageUid,this),this.currentMessage.subscribe(this.calcPrevMessageUid,this),this.uidList.subscribe(this.calcPrevMessageUid,this)},T.prototype.calcNextMessageUid=function(){var e="",t="",s=null,o=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!!M,n&&(o=s.getMessageByUid(this.currentMessage().threadParentUid()))&&(i.each(o.threadUids(),(function(s,i,o){s===e&&i>0&&(t=o[i-1])})),l.isNonEmptyString(t)||(t=o.uid()))):(i.each(this.uidList().collection(),(function(s,i,o){s===e&&i>0&&(t=o[i-1]||"")})),""===t&&M&&(this.requirePrefetcher(),S.prefetchNextPage(e)))),this.nextMessageUid(t)},T.prototype.calcPrevMessageUid=function(){var e=this.currentMessage()?this.currentMessage().uid():"",t="",s=null,o=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!0,n?(o=s.getMessageByUid(this.currentMessage().threadParentUid()))&&i.each(o.threadUids(),(function(s,i,o){s===e&&i+1<o.length&&(t=o[i+1]||"")})):this.currentMessage().threadCount()>0&&(t=this.currentMessage().threadUids()[0])):(i.each(this.uidList().collection(),(function(s,i,o){s===e&&i+1<o.length&&(t=o[i+1]||"")})),""===t&&M&&(this.requirePrefetcher(),S.prefetchPrevPage(e)))),this.prevMessageUid(t)},T.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()},T.prototype.getFolderByFullName=function(e,t){var s=this.oFolderListItems[e];return s?s.getFolderByFullName(t):null},T.prototype.checkCurrentFolderList=function(){var e=v.getCurrent(),t=e?this.oFolderListItems[e.id()]:null;!e||t||this.messagesLoading()||(this.messagesLoading(!0),this.messagesLoadingError(!1),this.getFolderList(e.id()))},T.prototype.getFolderList=function(e){v.getAccount(e)?(this.folderListLoading.push(e),A.send("GetFolders",{AccountID:e},this.onGetFoldersResponse,this)):e===this.currentAccountId()&&this.messagesLoading(!1)},T.prototype.markMessageReplied=function(e,t,s,i){var o=this.oFolderListItems[e],n=null;o&&(n=o.getFolderByFullName(t))&&n.markMessageReplied(s,i)},T.prototype.hideThreads=function(e){var t=v.getCurrent();t&&t.threadingIsAvailable()&&e.folder()===this.folderList().currentFolderFullName()&&!e.threadOpened()&&this.folderList().currentFolder().hideThreadMessages(e)},T.prototype.showOpenedThreads=function(e){this.messages(this.getMessagesWithThreads(e,this.uidList(),this.messages()))},T.prototype.useThreadingInCurrentList=function(e){e=e||this.uidList();var t=v.getCurrent(),s=this.folderList().currentFolder(),i=s&&s.withoutThreads(),o=""===e.search()&&""===e.filters();return t&&t.threadingIsAvailable()&&!i&&o},T.prototype.getMessagesWithThreads=function(e,t,s){var o=[],n=[],r=this.folderList().currentFolder();return r&&e===r.fullName()&&this.useThreadingInCurrentList(t)?(n=i.filter(s,(function(e){return!e.threadPart()})),i.each(n,(function(e){var t=[];o.push(e),e.threadCount()>0&&(e.threadOpened()&&(t=this.folderList().currentFolder().getThreadMessages(e),o=i.union(o,t)),r.computeThreadData(e))}),this),o):s},T.prototype.setMessagesFromUidList=function(e,t,s){var o=e.getUidsForOffset(t),n=i.map(o,(function(t){return F.get([e.iAccountId,e.sFullName,t])}),this),r=n.length;return s&&(this.messages(this.getMessagesWithThreads(this.folderList().currentFolderFullName(),e,n)),t+r<e.resultCount()&&r<E.MailsPerPage&&(e.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&this.currentMessage(null)),o},T.prototype.getNamesOfFoldersToRefresh=function(){var e=this.oFolderListItems[this.currentAccountId()],t=e?e.getNamesOfFoldersToRefresh():[],s=v.getCurrentFetchersAndFiltersFolderNames();return t=i.uniq(i.compact(i.union(t,s)))},T.prototype.getUseListStatusIfPossibleValue=function(e){var t=this.oFolderListItems[this.currentAccountId()];return(t?t.getFoldersCount():0)<100||e>50},T.prototype.executeCheckMail=function(e){clearTimeout(this.iAutoCheckMailTimer);var t=this.currentAccountId(),s=this.getNamesOfFoldersToRefresh(),i=this.checkMailStarted()&&this.checkMailStartedAccountId()===t,o=null;u.getUserRole()!==Enums.UserRole.Anonymous&&(e||!A.hasOpenedRequests("GetRelevantFoldersInformation")||!i)&&s.length>0&&(o={AccountID:t,Folders:s,UseListStatusIfPossible:this.getUseListStatusIfPossibleValue(s.length)},this.checkMailStarted(!0),this.checkMailStartedAccountId(t),v.getAccount(t)&&A.send("GetRelevantFoldersInformation",o,this.onGetRelevantFoldersInformationResponse,this))},T.prototype.setAutocheckmailTimer=function(){clearTimeout(this.iAutoCheckMailTimer),!u.isNewTab()&&m.AutoRefreshIntervalMinutes>0&&(this.iAutoCheckMailTimer=setTimeout((function(){L.isSearchExecuting()||(L.checkMessageFlags(),L.executeCheckMail(!1))}),60*m.AutoRefreshIntervalMinutes*1e3))},T.prototype.isSearchExecuting=function(){var e=A.getOpenedRequest("GetMessages"),t=e&&e.Parameters;return t&&""!==t.Search},T.prototype.checkMessageFlags=function(){var e=this.folderList().inboxFolder(),t=e?e.getFlaggedMessageUids():[],s={Folder:this.folderList().inboxFolderFullName(),Uids:t};t.length>0&&A.send("GetMessagesFlags",s,this.onGetMessagesFlagsResponse,this)},T.prototype.onGetMessagesFlagsResponse=function(e,t){var s=t.Parameters,o=this.oFolderListItems[s.AccountID],n=o?o.inboxFolder():null;n&&(e.Result&&i.each(e.Result,(function(e,t){-1===i.indexOf(e,"\\flagged")&&n.setMessageUnflaggedByUid(t)})),n.removeFlaggedMessageListsFromCache(),this.requirePrefetcher(),S.prefetchStarredMessageList())},T.prototype.changeCurrentMessageList=function(e,t,s,i,o,n){this.requestCurrentMessageList(e,t,s,i,o,n,!0)},T.prototype.requestCurrentMessageList=function(e,t,s,i,o,n,a){var l=this.requestMessageList(e,t,s,i||"",o,n,!0,a||!1),h=60*m.AutoRefreshIntervalMinutes*1e3,c=l.Folder.oRelevantInformationLastMoment?r().diff(l.Folder.oRelevantInformationLastMoment):h+1;this.uidList(l.UidList),this.page(t),this.messagesLoading(l.RequestStarted),this.messagesLoadingError(!1),!l.RequestStarted&&h>0&&c>h&&this.executeCheckMail(!0)},T.prototype.requestMessageList=function(e,t,s,i,o,n,r,a,h){h=l.pBool(h,!1);var c=this.oFolderListItems[this.currentAccountId()],u=c?c.getFolderByFullName(e):null,d=u&&u.withoutThreads(),p=v.getCurrent(),m=p&&p.threadingIsAvailable()&&!d&&""===s&&""===i,g=u?u.getUidList(s,i,o,n):null,f=g&&-1===g.resultCount(),b=(t-1)*E.MailsPerPage,y={Folder:e,Offset:b,Limit:E.MailsPerPage,Search:s,Filters:i,SortBy:o,SortOrder:n,UseThreading:m},F=!1,S=!1,I=r?this.onCurrentGetMessagesResponse:this.onGetMessagesResponse,C=[];return u.type()===Enums.FolderTypes.Inbox&&""===i?y.InboxUidnext=u.sUidNext:y.InboxUidnext="",f&&g.iAccountId===this.uidList().iAccountId&&g.sFullName===this.uidList().sFullName&&g.search()===this.uidList().search()&&g.filters()===this.uidList().filters()&&g.sortBy()===this.uidList().sortBy()&&g.sortOrder()===this.uidList().sortOrder()&&(g=this.uidList()),g&&(C=this.setMessagesFromUidList(g,b,a),u.updateLastAccessTime(C)),g&&(S=f||b+C.length<g.resultCount()&&C.length<E.MailsPerPage,F=!h&&(u.hasChanges()||S)),F?A.send("GetMessages",y,I,this):this.waitForUnseenMessages(!1),{UidList:g,RequestStarted:F,DataExpected:S,Folder:u}},T.prototype.executeEmptyTrash=function(){var e=this.folderList().trashFolder();e&&e.emptyFolder()},T.prototype.executeEmptySpam=function(){var e=this.folderList().spamFolder();e&&e.emptyFolder()},T.prototype.onClearFolder=function(e){if(e&&e.selected()){this.messages.removeAll(),this.currentMessage(null);var t=e?e.getUidList(this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder()):null;t?this.uidList(t):this.uidList(new C),this.checkMailStarted(!1),this.setAutocheckmailTimer()}},T.prototype.getOpenedDraftUids=function(){var e=g.getOpenedWindows(),t=i.map(e,(function(e){return e.SlaveTabMailMethods?e.SlaveTabMailMethods.getEditedDraftUid():""}));return f.hasOpenedMinimizedPopups()&&t.push(this.editedDraftUid()),i.uniq(i.compact(t))},T.prototype.closeComposesWithDraftUids=function(e){var t=g.getOpenedWindows();if(i.each(t,(function(t){t.SlaveTabMailMethods&&-1!==o.inArray(t.SlaveTabMailMethods.getEditedDraftUid(),e)&&t.close()})),-1!==o.inArray(this.editedDraftUid(),e)){var n=s("h1OO");i.isFunction(n.closeComposePopup)&&n.closeComposePopup()}},T.prototype.moveMessagesToFolder=function(e,t){if(t.length>0){var s=this.folderList().currentFolder(),n=s&&s.type()===Enums.FolderTypes.Drafts,r=n&&this.getOpenedDraftUids(),l=n&&i.find(t,i.bind((function(e){return-1!==o.inArray(e,r)}),this)),h=this.folderList().getFolderByFullName(e),c={Folder:s?s.fullName():"",ToFolder:e,Uids:t.join(",")},u=null,d=i.bind((function(){this.uidList().filters()===Enums.FolderFilter.Unseen&&this.uidList().resultCount()>E.MailsPerPage&&this.waitForUnseenMessages(!0),u=s.markDeletedByUids(t),h.addMessagesCountsDiff(u.MinusDiff,u.UnseenMinusDiff),h.recivedAnim(!0),this.excludeDeletedMessages(),h.markHasChanges(),A.send("MoveMessages",c,this.onMoveMessagesResponse,this)}),this);s&&h&&(l?(this.disableComposeAutosave(!0),f.showPopup(b,[a.i18n("MAILWEBCLIENT/CONFIRM_MESSAGE_FOR_DELETE_IS_EDITED"),i.bind((function(e){e&&(this.closeComposesWithDraftUids(t),d()),this.disableComposeAutosave(!1)}),this),"",a.i18n("MAILWEBCLIENT/ACTION_CLOSE_DELETE_DRAFT")])):d())}},T.prototype.copyMessagesToFolder=function(e,t){if(t.length>0){var s=this.folderList().currentFolder(),i=this.folderList().getFolderByFullName(e),o={Folder:s?s.fullName():"",ToFolder:e,Uids:t.join(",")};s&&i&&(i.recivedAnim(!0),i.markHasChanges(),A.send("CopyMessages",o,this.onCopyMessagesResponse,this))}},T.prototype.excludeDeletedMessages=function(){i.delay(i.bind((function(){var e=(this.page()-1)*E.MailsPerPage;this.setMessagesFromUidList(this.uidList(),e,!0)}),this),500)},T.prototype.removeOneMessageFromCacheForFolder=function(e,t,s){var i=this.oFolderListItems[e],o=i?i.getFolderByFullName(t):null;o&&o.type()===Enums.FolderTypes.Drafts&&(this.currentMessage()&&this.currentMessage().folder()===t&&this.currentMessage().uid()===s&&this.currentMessage(null),o.markDeletedByUids([s]),o.commitDeleted([s]))},T.prototype.startMessagesLoadingWhenDraftSaving=function(e,t){var s=this.oFolderListItems[e],i=s?s.getFolderByFullName(t):null;i&&i.type()===Enums.FolderTypes.Drafts&&i.selected()&&this.messagesLoading(!0)},T.prototype.removeMessagesFromCacheForFolder=function(e,t){var s=this.oFolderListItems[e],i=s?s.getFolderByFullName(t):null,o=s?s.currentFolderFullName():null;i&&(i.markHasChanges(),this.currentAccountId()===e&&t===o&&this.requestCurrentMessageList(o,this.page(),this.uidList().search(),"",this.uidList().sortBy(),this.uidList().sortOrder(),!0))},T.prototype.deleteMessages=function(e){var t=this.folderList().currentFolder();t&&this.deleteMessagesFromFolder(t,e)},T.prototype.deleteMessagesFromFolder=function(e,t){var s={Folder:e.fullName(),Uids:t.join(",")};e.markDeletedByUids(t),this.excludeDeletedMessages(),A.send("DeleteMessages",s,this.onMoveMessagesResponse,this)},T.prototype.showExternalPictures=function(e){var t=[],s=null;this.currentMessage()&&(t=this.currentMessage().oFrom.aCollection,s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e&&t.length>0?s.alwaysShowExternalPicturesForSender(t[0].sEmail):s.showExternalPictures(this.currentMessage().uid()))},T.prototype.setCurrentMessage=function(e,t){var s=this.folderList().currentFolder(),i=null;!u.isNewTab()||s&&s.fullName()===t||(this.folderList().setCurrentFolder(t,""),s=this.folderList().currentFolder()),s&&e&&(i=F.get([s.iAccountId,s.fullName(),e])),i&&!i.deleted()?(this.currentMessage(i),this.currentMessage().seen()||this.executeGroupOperation("SetMessagesSeen",[this.currentMessage().uid()],"seen",!0),s.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this)):(this.currentMessage(null),u.isNewTab()&&s&&s.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this))},T.prototype.onCurrentMessageResponse=function(e,t,s){var i=this.currentMessage()?this.currentMessage().uid():"";null===e&&M&&s&&c.showErrorByCode(s,"",!0),null===e&&i===t?this.currentMessage(null):e&&i===t?this.currentMessage.valueHasMutated():u.isNewTab()&&e&&null===this.currentMessage()&&this.currentMessage(e)},T.prototype.getMessage=function(e,t,s,i){var o=this.folderList().getFolderByFullName(e);o&&o.getCompletelyFilledMessage(t,s,i)},T.prototype.executeGroupOperation=function(e,t,s,i){var o=this.folderList().currentFolder(),n={Folder:o?o.fullName():"",Uids:t.join(","),SetAction:i},r=(this.page()-1)*E.MailsPerPage,a=t.length,l=this.folderList().oStarredFolder?this.folderList().oStarredFolder.messageCount():0,h=o?o.getUidList("",Enums.FolderFilter.Flagged,E.MessagesSortBy.DefaultSortBy,E.MessagesSortBy.DefaultSortOrder):null,c="SetMessagesSeen"===e?this.onSetMessagesSeenResponse:function(){};o&&("SetMessagesSeen"===e&&this.iSetMessagesSeenCount++,A.send(e,n,c,this),o.executeGroupOperation(s,t,i),o.type()===Enums.FolderTypes.Inbox&&"flagged"===s&&(this.uidList().filters()===Enums.FolderFilter.Flagged?i||(this.uidList().deleteUids(t),this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(h.resultCount())):(o.removeFlaggedMessageListsFromCache(),""===this.uidList().search()&&this.folderList().oStarredFolder&&(i?this.folderList().oStarredFolder.messageCount(l+a):this.folderList().oStarredFolder.messageCount(l-a>0?l-a:0)))),"seen"===s&&o.removeUnseenMessageListsFromCache(),(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.setMessagesFromUidList(this.uidList(),r,!0))},T.prototype.onSetMessagesSeenResponse=function(e,t){this.iSetMessagesSeenCount--,this.iSetMessagesSeenCount<0&&(this.iSetMessagesSeenCount=0),this.folderList().currentFolder()&&0===this.iSetMessagesSeenCount&&(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.requestCurrentMessageList(this.folderList().currentFolder().fullName(),this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),!1)},T.prototype.onGetFoldersResponse=function(e,t){var s=t.Parameters,o=new I,n=s.AccountID,r=this.oFolderListItems[n],a=r?r.oNamedCollection:{};!1===e.Result?(c.showErrorByCode(e),s.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0))):(o.parse(n,e.Result,a),r&&o.oStarredFolder.messageCount(r.oStarredFolder.messageCount()),this.__oldFolderList=this.oFolderListItems[n],this.oFolderListItems[n]=o,this.__oldFolderList&&(this.__oldFolderList.destroyFolders(),h.destroyObjectWithObservables(this,"__oldFolderList")),setTimeout(i.bind(this.getAllFoldersRelevantInformation,this,n),2e3),this.currentAccountId()===n&&this.folderList(o),this.editedAccountId()===n&&this.editedFolderList(o)),this.folderListLoading.remove(n)},T.prototype.getAllFoldersRelevantInformation=function(e){var t=this.oFolderListItems[e],s=t?t.getFoldersWithoutCountInfo():[],i={AccountID:e,Folders:s,UseListStatusIfPossible:this.getUseListStatusIfPossibleValue(s.length)};s.length>0&&v.getAccount(e)&&A.send("GetRelevantFoldersInformation",i,this.onGetRelevantFoldersInformationResponse,this)},T.prototype.onGetRelevantFoldersInformationResponse=function(e,t){var s=!1,o=t.Parameters.AccountID,n=this.oFolderListItems[o],r=this.folderList().currentFolderFullName(),a=this.currentAccountId()===o;!1===e.Result?(c.showErrorByCode(e),A.hasOpenedRequests("GetRelevantFoldersInformation")&&(s=!0)):n&&(i.each(e.Result&&e.Result.Counts,(function(e,t){if(i.isArray(e)&&e.length>3){var o=e[0],l=e[1],h=e[2],c=e[3],u=!1,d=!1,p=null;(p=n.getFolderByFullName(t))&&(d=a&&p.fullName()===r,u=p.setRelevantInformation(h,c,o,l,d),d&&u&&this.uidList().filters()!==Enums.FolderFilter.Unseen&&(this.requestCurrentMessageList(p.fullName(),this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),!1),s=!0))}}),this),n.countsCompletelyFilled(!0)),this.checkMailStarted(s),this.checkMailStarted()||this.setAutocheckmailTimer()},T.prototype.showNotificationsForNewMessages=function(e){var t=this.folderList().currentFolderFullName(),s=0,o="",n={},r="",c=[];e.Result.New&&e.Result.New.length>0&&(s=e.Result.New.length,o=e.Result.New[0].Uid,n={action:"show",icon:"static/styles/images/logo_140x140.png",title:a.i18n("MAILWEBCLIENT/INFO_NEW_MESSAGES_PLURAL",{COUNT:s},null,s),timeout:5e3,callback:function(){window.focus(),p.setHash(y.getMailbox(t,1,o,"",""))}},1===s&&(l.isNonEmptyString(e.Result.New[0].Subject)&&c.push(a.i18n("MAILWEBCLIENT/LABEL_SUBJECT")+": "+e.Result.New[0].Subject),r=i.map(e.Result.New[0].From,(function(e){return""!==e.DisplayName?e.DisplayName:e.Email})).join(", "),l.isNonEmptyString(r)&&c.push(a.i18n("MAILWEBCLIENT/LABEL_FROM")+": "+r),n.body=c.join("\r\n")),h.desktopNotify(n))},T.prototype.onCurrentGetMessagesResponse=function(e,t){this.checkMailStarted(!1),e.Result?(this.messagesLoadingError(!1),this.parseMessageList(e,t)):(c.showErrorByCode(e),!0!==this.messagesLoading()||0!==this.messages().length&&e.ErrorCode===Enums.Errors.NotDisplayedError||this.messagesLoadingError(!0),this.messagesLoading(!1),this.setAutocheckmailTimer())},T.prototype.onGetMessagesResponse=function(e,t){e&&e.Result?this.parseMessageList(e,t):h.log("onGetMessagesResponse, there was an error while getting message list",e,t)},T.prototype.parseMessageList=function(e,t){var s=e.Result,o=t.Parameters,n=o.AccountID,r=this.oFolderListItems[n],a=null,l=null,h=o.UseThreading,c=!1,u=this.currentAccountId()===n&&this.folderList().currentFolderFullName()===s.FolderName,d=u&&this.uidList().search()===s.Search&&this.uidList().filters()===s.Filters,p=this.page()===s.Offset/E.MailsPerPage+1,m=[];this.showNotificationsForNewMessages(e),!1!==s&&"Collection/MessageCollection"===s["@Object"]&&((a=r.getFolderByFullName(s.FolderName)).setRelevantInformation(s.UidNext.toString(),s.FolderHash,s.MessageCount,s.MessageUnseenCount,u&&!d),c=a.hasChanges(),a.removeAllMessageListsFromCacheIfHasChanges(),(l=a.getUidList(s.Search,s.Filters,t.Parameters.SortBy,t.Parameters.SortOrder)).setUidsAndCount(s),i.each(s["@Collection"],(function(e){var t=a.parseAndCacheMessage(e,!1,h);m.push(t)}),this),d&&(this.uidList(l),p&&(l.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&(this.messagesLoading(!1),this.waitForUnseenMessages(!1),this.setMessagesFromUidList(l,s.Offset,!0),this.messagesLoading()||this.setAutocheckmailTimer())),!c||!u||d&&p||this.uidList().filters()===Enums.FolderFilter.Unseen||this.requestCurrentMessageList(this.folderList().currentFolderFullName(),this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),!1),a.type()===Enums.FolderTypes.Inbox&&l.filters()===Enums.FolderFilter.Flagged&&""===l.search()&&this.folderList().oStarredFolder&&(this.folderList().oStarredFolder.messageCount(l.resultCount()),this.folderList().oStarredFolder.hasExtendedInfo(!0)))},T.prototype.increaseStarredCount=function(){this.folderList().oStarredFolder&&this.folderList().oStarredFolder.increaseCountIfHasNotInfo()},T.prototype.onMoveMessagesResponse=function(e,t){var s=e.Result,o=t.Parameters,n=o.Uids.split(","),r=this.folderList().getFolderByFullName(o.Folder),h=this.folderList().getFolderByFullName(o.ToFolder),u=h&&h.type()===Enums.FolderTypes.Trash,d=h&&h.type()===Enums.FolderTypes.Spam,m=null,g=u?a.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):a.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),y=i.bind((function(e){e&&r&&this.deleteMessagesFromFolder(r,n)}),this),v=this.folderList().currentFolder(),A=v?v.fullName():"",F=!1;if(!1===s?(r&&(m=r.revertDeleted(n)),h?(m&&h.addMessagesCountsDiff(-m.PlusDiff,-m.UnseenPlusDiff),e.ErrorCode===Enums.MailErrors.CannotMoveMessageQuota&&(u||d)?(l.isNonEmptyString(e.ErrorMessage)&&(g+=" ("+e.ErrorMessage+")"),f.showPopup(b,[g,y])):c.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_MOVING_MESSAGES"))):c.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_DELETING_MESSAGES")),F=!0):r&&(r.commitDeleted(n),i.each(n,(function(e){p.replaceHashWithoutMessageUid(e)}))),r&&A===r.fullName()||h&&A===h.fullName())switch(v.markHasChanges(),this.uidList().filters()){case Enums.FolderFilter.Flagged:break;case Enums.FolderFilter.Unseen:this.waitForUnseenMessages()&&this.requestCurrentMessageList(A,this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),F);break;default:this.requestCurrentMessageList(A,this.page(),this.uidList().search(),this.uidList().filters(),this.uidList().sortBy(),this.uidList().sortOrder(),F)}else r&&A!==r.fullName()?(this.requirePrefetcher(),S.startFolderPrefetch(r)):h&&A!==h.fullName()&&(this.requirePrefetcher(),S.startFolderPrefetch(h))},T.prototype.onCopyMessagesResponse=function(e,t){var s=e.Result,i=t.Parameters,o=this.folderList().getFolderByFullName(i.Folder),n=this.folderList().getFolderByFullName(i.ToFolder),r=this.folderList().currentFolder(),l=r.fullName();!1===s&&c.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_COPYING_MESSAGES")),l===o.fullName()||n&&l===n.fullName()?(r.markHasChanges(),this.requestCurrentMessageList(l,this.page(),this.uidList().search(),"",this.uidList().sortBy(),this.uidList().sortOrder(),!1)):l!==o.fullName()?(this.requirePrefetcher(),S.startFolderPrefetch(o)):n&&l!==n.fullName()&&(this.requirePrefetcher(),S.startFolderPrefetch(n))},T.prototype.searchMessagesInCurrentFolder=function(e){var t=this.folderList().currentFolderFullName()||"INBOX",s=this.currentMessage()?this.currentMessage().uid():"",i=this.uidList().filters();p.setHash(y.getMailbox(t,1,s,e,i))},T.prototype.searchMessagesInInbox=function(e){p.setHash(y.getMailbox(this.folderList().inboxFolderFullName()||"INBOX",1,"",e,""))},T.prototype.getFolderHash=function(e){return p.buildHashFromArray(y.getMailbox(e,1,"","",""))},T.prototype.countMessages=function(e){var t=[],s=function(e){i.each(e.subfolders(),(function(e,i){e.subscribed()&&(t.push(e.unseenMessageCount()),e.subfolders().length&&e.subscribed()&&s(e))}),this)};e.expanded()||e.bNamespace?e.subfoldersMessagesCount(0):(s(e),e.subfoldersMessagesCount(i.reduce(t,(function(e,t){return e+t}),0)))},T.prototype.changeDatesInMessages=function(){F.updateMomentDates()},T.prototype.clearMessagesCache=function(e){var t=this.oFolderListItems[e];i.each(t.collection(),(function(e){e.markHasChanges(),e.removeAllMessageListsFromCacheIfHasChanges()}),this),e===this.currentAccountId()&&this.messages([])},T.prototype.getTemplateFolder=function(){var e=this.folderList(),t="",s=e.currentFolder()?e.currentFolder().fullName():"";return l.isNonEmptyArray(this.getCurrentTemplateFolders())&&(t=-1!==o.inArray(s,this.getCurrentTemplateFolders())?s:i.find(this.getCurrentTemplateFolders(),(function(t){return!!e.oNamedCollection[t]}))),"string"==typeof t?t:""},T.prototype.getCurrentTemplateFolders=function(){return E.AllowTemplateFolders?this.folderList().aTemplateFolders:[]},T.prototype.changeTemplateFolder=function(e,t){E.AllowTemplateFolders&&this.folderList().changeTemplateFolder(e,t)};var L=new T;d.registerDayOfMonthFunction(i.bind(L.changeDatesInMessages,L)),m.timeFormat.subscribe(L.changeDatesInMessages,L),m.dateFormat.subscribe(L.changeDatesInMessages,L),e.exports=L},"4M/5":function(e,t,s){"use strict";var i=s("F/us"),o=s("AFLV"),n=s("p2hp"),r={};r.getMailbox=function(e,t,i,r,a,l,h,c){var u=s("jonm").getCurrent(),d=[n.HashModuleName,u?u.hash():""];return t=o.pInt(t,1),i=o.pString(i),r=o.pString(r),a=o.pString(a),l=o.pString(l,n.MessagesSortBy.DefaultSortBy),h=o.pInt(h,n.MessagesSortBy.DefaultSortOrder),c=o.pString(c),o.isNonEmptyString(e)&&d.push(e),""!==a&&d.push("filter:"+a),""!==l&&n.MessagesSortBy.DefaultSortBy!==l&&d.push("sortby:"+l),n.MessagesSortBy.DefaultSortOrder!==h&&d.push("sortorder:"+h),1<t&&d.push("p"+t),""!==i&&d.push("msg"+i),""!==r&&d.push(r),""!==c&&d.push("custom:"+c),d},r.parseMailbox=function(e,t){var s=e.length>0&&"compose"===e[0]&&"to"===e[1],r=s?[]:e,a="",l="INBOX",h=1,c="",u="",d="",p=n.MessagesSortBy.DefaultSortBy,m=n.MessagesSortBy.DefaultSortOrder,g="",f="",b=0;return o.isNonEmptyArray(r)&&(a=o.pString(r[b]),b++),o.isNonEmptyArray(r)&&(l=o.pString(r[b]),b++,r.length>b&&((f=o.pString(r[b]))==="filter:"+Enums.FolderFilter.Flagged&&(d=Enums.FolderFilter.Flagged,b++),f==="filter:"+Enums.FolderFilter.Unseen&&(d=Enums.FolderFilter.Unseen,b++)),r.length>b&&"sortby:"===(f=o.pString(r[b])).substr(0,7)&&(n.MessagesSortBy.Allow&&(p=f.substr(7)),b++),r.length>b&&"sortorder:"===(f=o.pString(r[b])).substr(0,10)&&(n.MessagesSortBy.Allow&&(m=o.pEnum(o.pInt(f.substr(10)),Enums.SortOrder,n.MessagesSortBy.DefaultSortOrder)),b++),i.find(n.MessagesSortBy.List,(function(e){return e.SortBy===p}))||(p=n.MessagesSortBy.DefaultSortBy,m=n.MessagesSortBy.DefaultSortOrder),r.length>b&&function(e){return"p"===e.substr(0,1)&&/^[1-9][\d]*$/.test(e.substr(1))}(f=o.pString(r[b]))&&((h=o.pInt(f.substr(1)))<=0&&(h=1),b++),r.length>b&&function(e){return"msg"===e.substr(0,3)&&/^[1-9][\d]*$/.test(e.substr(3))}(f=o.pString(r[b]))&&(c=f.substr(3),b++),r.length>b&&"custom:"!==(f=o.pString(r[b])).substr(0,7)&&(u=f,b++),r.length>b&&"custom:"===(f=o.pString(r[b])).substr(0,7)&&(g=f.substr(7))),{MailtoCompose:s,AccountHash:a,Folder:""===l?t:l,Page:h,Uid:c,Search:u,Filters:d,SortBy:p,SortOrder:m,Custom:g}},r.getViewMessage=function(e,t){var i=s("jonm").getCurrent(),o=i?i.hash():"";return[n.HashModuleName+"-view",o,e,"msg"+t]},r.getCompose=function(){var e=s("jonm").getCurrent(),t=e?e.hash():"";return[n.HashModuleName+"-compose",t]},r.getComposeFromMessage=function(e,t,i){var o=s("jonm").getCurrent(),r=o?o.hash():"";return[n.HashModuleName+"-compose",r,e,t,i]},r.getComposeWithToField=function(e){var t=s("jonm").getCurrent(),i=t?t.hash():"";return[n.HashModuleName+"-compose",i,"to",e]},r.getComposeWithData=function(e){var t=s("jonm").getCurrent(),i=t?t.hash():"";return[n.HashModuleName+"-compose",i,"data",e]},r.getComposeWithObject=function(e,t){var i=s("jonm").getCurrent(),o=i?i.hash():"";return[n.HashModuleName+"-compose",o,e,t]},r.getComposeWithEmlObject=function(e,t,i){var o=s("jonm").getCurrent(),r=o?o.hash():"";return[n.HashModuleName+"-compose",r,Enums.ReplyType.ForwardAsAttach,e,t,i]},r.parseCompose=function(e){var t=e.length>0?e[0]:"",s=e.length>1?e[1]:"",i=(s===Enums.ReplyType.ForwardAsAttach||"attachments"===s||"data"===s)&&e.length>2?s===Enums.ReplyType.ForwardAsAttach?e[4]:e[2]:null,o="to"===s&&e.length>2?r.parseToAddr(e[2]):null,n=(s===Enums.ReplyType.Reply||s===Enums.ReplyType.ReplyAll||s===Enums.ReplyType.Resend||s===Enums.ReplyType.Forward||"drafts"===s||s===Enums.ReplyType.ForwardAsAttach)&&e.length>2;return{AccountHash:t,RouteType:s,ToAddr:o,Object:i,MessageFolderName:n?e[2]:"",MessageUid:n?e[3]:""}},r.parseToAddr=function(e){var t=o.pString(e),s=-1!==t.indexOf("mailto:"),n=[],r=[],a="",l="",h="",c="";return s&&(n=t.replace(/^mailto:/,"").split("?"),t=n[0],2===n.length&&(r=n[1].split("&"),i.each(r,(function(e){var t=e.split("=");if(2===t.length)switch(t[0].toLowerCase()){case"subject":a=decodeURIComponent(t[1]);break;case"cc":l=decodeURIComponent(t[1]);break;case"bcc":h=decodeURIComponent(t[1]);break;case"body":c=decodeURIComponent(t[1])}})))),{to:t,hasMailto:s,subject:a,cc:l,bcc:h,body:c}},e.exports=r},"5H03":function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("czxF");function r(){n.call(this),this.fConfirmCallback=null,this.shown=!1}i.extendOwn(r.prototype,n.prototype),r.prototype.PopupTemplate="MailWebclient_ConfirmAnotherMessageComposedPopup",r.prototype.onOpen=function(e){this.fConfirmCallback=o.isFunction(e)?e:null,this.shown=!0},r.prototype.onClose=function(){this.shown=!1},r.prototype.onDiscardClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Discard),this.closePopup()},r.prototype.onSaveAsDraftClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.SaveAsDraft),this.closePopup()},r.prototype.cancelPopup=function(){this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Cancel),this.closePopup()},r.prototype.onEnterHandler=function(){this.onSaveAsDraftClick()},e.exports=new r},"5aTH":function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("AFLV"),r=s("Yjhd"),a=s("gcBV"),l=s("p2hp"),h=s("qGK3");function c(){this.iAccountId=0,this.initialized=o.observable(!1),this.bExpandFolders=!1,this.expandNames=o.observableArray([]),this.collection=o.observableArray([]),this.options=o.observableArray([]),this.sNamespaceFolder="",this.oStarredFolder=null,this.oNamedCollection={},this.aLinedCollection=[];var e=this,t=function(e){return function(t){t&&t.type(e)}},s=function(t){return{read:function(){return this.collection(),t()?t().fullName():""},write:function(e){t(this.getFolderByFullName(e))},owner:e}};this.currentFolder=o.observable(null),this.inboxFolder=o.observable(null),this.sentFolder=o.observable(null),this.draftsFolder=o.observable(null),this.spamFolder=o.observable(null),this.trashFolder=o.observable(null),this.aTemplateFolders=[],this.countsCompletelyFilled=o.observable(!1),this.inboxFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.sentFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.draftsFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.spamFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.trashFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.inboxFolder.subscribe(t(Enums.FolderTypes.Inbox)),this.sentFolder.subscribe(t(Enums.FolderTypes.Sent)),this.draftsFolder.subscribe(t(Enums.FolderTypes.Drafts)),this.spamFolder.subscribe(t(Enums.FolderTypes.Spam)),this.trashFolder.subscribe(t(Enums.FolderTypes.Trash)),this.inboxFolderFullName=o.computed(s(this.inboxFolder)),this.sentFolderFullName=o.computed(s(this.sentFolder)),this.draftsFolderFullName=o.computed(s(this.draftsFolder)),this.spamFolderFullName=o.computed(s(this.spamFolder)),this.trashFolderFullName=o.computed(s(this.trashFolder)),this.currentFolderFullName=o.computed(s(this.currentFolder)),this.currentFolderType=o.computed((function(){return this.currentFolder()?this.currentFolder().type():Enums.FolderTypes.User}),this),this.sDelimiter=""}c.prototype.getFoldersCount=function(){return this.aLinedCollection.length},c.prototype.getTotalMessageCount=function(){var e=0;return i.each(this.oNamedCollection,(function(t){e+=t.messageCount()}),this),e},c.prototype.getFoldersWithoutCountInfo=function(){return i.compact(i.map(this.oNamedCollection,(function(e,t){return e.canBeSelected()&&!e.hasExtendedInfo()?t:null})))},c.prototype.getNamesOfFoldersToRefresh=function(){var e=[this.inboxFolderFullName(),this.spamFolderFullName(),this.currentFolderFullName()];return i.each(this.oNamedCollection,(function(t){t.isAlwaysRefresh()&&e.push(t.fullName())})),i.uniq(e)},c.prototype.setCurrentFolder=function(e,t){var s=this.getFolderByFullName(e);null!==s&&s.canBeSelected()||(s=this.inboxFolder()),null!==s&&(this.currentFolder()&&(this.currentFolder().selected(!1),this.oStarredFolder&&this.oStarredFolder.selected(!1)),this.currentFolder(s),t===Enums.FolderFilter.Flagged?this.oStarredFolder&&this.oStarredFolder.selected(!0):this.currentFolder().selected(!0))},c.prototype.getFolderByFullName=function(e){var t=this.oNamedCollection[e];return t||null},c.prototype.renameFolder=function(e,t,s){var i=this.oNamedCollection[e];i.fullName(t),i.fullNameHash(s),this.oNamedCollection[t]=i,delete this.oNamedCollection[e]},c.prototype.changeTemplateFolder=function(e,t){l.AllowTemplateFolders&&(t?this.aTemplateFolders.push(e):this.aTemplateFolders=i.without(this.aTemplateFolders,e))},c.prototype.parse=function(e,t,s){var i=n.pString(t.Namespace),o=t.Folders["@Collection"];i.length>0&&(this.sNamespaceFolder=i.substring(0,i.length-1)),this.iAccountId=e,this.initialized(!0),this.bExpandFolders=l.FoldersExpandedByDefault&&!a.hasData("folderAccordion"),a.hasData("folderAccordion")||a.setData("folderAccordion",[]),this.oNamedCollection={},this.aLinedCollection=[],this.collection(this.parseRecursively(o,s))},c.prototype.destroyFolders=function(){for(var e in r.destroyObjectWithObservables(this,"oStarredFolder"),this.collection.removeAll(),this.aLinedCollection=[],this.oNamedCollection)r.destroyObjectWithObservables(this.oNamedCollection,e)},c.prototype.parseRecursively=function(e,t,s,o){var r=[],l=0,c=0,u=null,d="",p=null,m=[];if(o=o||"",void 0===s&&(s=-1),s++,i.isArray(e)){for(c=e.length;l<c;l++){switch(p=(u=t[d=n.pString(e[l].FullNameRaw)]||new h(this.iAccountId)).parse(e[l],o,this.sNamespaceFolder),delete t[d],this.bExpandFolders&&null!==p&&(u.expanded(!0),this.expandNames().push(n.pString(e[l].Name))),u.setDisplayedLevel(s),u.type()){case Enums.FolderTypes.Inbox:this.inboxFolder(u),this.sDelimiter=u.sDelimiter;break;case Enums.FolderTypes.Sent:this.sentFolder(u);break;case Enums.FolderTypes.Drafts:this.draftsFolder(u);break;case Enums.FolderTypes.Trash:this.trashFolder(u);break;case Enums.FolderTypes.Spam:this.spamFolder(u);break;case Enums.FolderTypes.Template:this.aTemplateFolders.push(u.fullName())}this.oNamedCollection[u.fullName()]=u,this.aLinedCollection.push(u),r.push(u),null===p&&u.type()===Enums.FolderTypes.Inbox?(this.createStarredFolder(u.fullName(),s),this.oStarredFolder&&r.push(this.oStarredFolder)):null!==p&&(m=u.bNamespace&&u.type()===Enums.FolderTypes.Inbox?this.parseRecursively(p["@Collection"],t,s-1,u.fullName()):this.parseRecursively(p["@Collection"],t,s,u.fullName()),u.type()===Enums.FolderTypes.Inbox&&(this.createStarredFolder(u.fullName(),s),u.bNamespace?this.oStarredFolder&&m.unshift(this.oStarredFolder):this.oStarredFolder&&r.push(this.oStarredFolder)),u.subfolders(m))}this.bExpandFolders&&a.setData("folderAccordion",this.expandNames())}return r},c.prototype.createStarredFolder=function(e,t){this.oStarredFolder=new h(this.iAccountId),this.oStarredFolder.initStarredFolder(t,e)},c.prototype.repopulateLinedCollection=function(){var e=this;return this.aLinedCollection=[],function t(s){i.each(s,(function(s){e.aLinedCollection.push(s),s.subfolders().length>0&&t(s.subfolders())}))}(this.collection()),this.aLinedCollection},c.prototype.getOptions=function(e,t,s,o,n){t=!!t,s=!!s,o=!!o,n=!!n;var r=[];return i.each(this.aLinedCollection,(function(e){if(e&&!e.bVirtual&&(!s||Enums.FolderTypes.Inbox!==e.type())&&(!n||e.subscribed())){var i=new Array(e.getDisplayedLevel()+1).join("    ");r.push({name:e.name(),fullName:e.fullName(),displayName:i+e.name(),translatedDisplayName:i+e.displayName(),disable:!t&&e.isSystem()||!o&&!e.canBeSelected()})}})),""!==e&&r.unshift({name:e,fullName:"",displayName:e,translatedDisplayName:e,disable:!1}),r},e.exports=c},"5hOJ":function(e,t,s){"use strict";var i=s("wd/R"),o=s("RN+F"),n=s("Yjhd"),r=s("hPb3");function a(){this.iTimeStampInUTC=0,this.oMoment=null}a.prototype.parse=function(e){this.iTimeStampInUTC=e,this.oMoment=i.unix(this.iTimeStampInUTC)},a.prototype.setDate=function(e,t,s){this.oMoment=i([e,t,s])},a.prototype.getTimeFormat=function(){return r.timeFormat()===window.Enums.TimeFormat.F24?"HH:mm":"hh:mm A"},a.prototype.getFullDate=function(){return this.getDate()+" "+this.getTime()},a.prototype.getMidDate=function(){return this.getShortDate(!0)},a.prototype.getShortDate=function(e){var t="",s=null;return this.oMoment&&((s=i()).format("L")===this.oMoment.format("L")?t=this.oMoment.format(this.getTimeFormat()):(t=s.clone().subtract(1,"days").format("L")===this.oMoment.format("L")?o.i18n("COREWEBCLIENT/LABEL_YESTERDAY"):r.UserSelectsDateFormat?this.oMoment.format(n.getDateFormatForMoment(r.dateFormat())):s.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),e&&(t+=", "+this.oMoment.format(this.getTimeFormat())))),t},a.prototype.getDate=function(){var e="ddd, MMM D, YYYY";return r.UserSelectsDateFormat&&(e="ddd, "+n.getDateFormatForMoment(r.dateFormat())),this.oMoment?this.oMoment.format(e):""},a.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},a.prototype.getTimeStampInUTC=function(){return this.iTimeStampInUTC},e.exports=a},"6Fw4":function(e,t,s){"use strict";var i=s("AFLV");function o(){this.iAccountId=0,this.enable=!1,this.email=""}o.prototype.parse=function(e,t){this.iAccountId=e,this.enable=!!t.Enable,this.email=i.pString(t.Email)},e.exports=o},"9z2M":function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("OgeD"),a=s("QaF5"),l=s("SQrT"),h=s("76Kh"),c=s("YOyf"),u=s("MSV7"),d=s("Huhx"),p=s("jonm"),m=s("p2hp"),g=s("XJC/"),f=s("SQkM"),b=s("QYtA"),y=s("DGOq"),v=s("GhJf"),A=s("VgCI"),F=s("zDln"),S=s("oj+D"),E=s("/Lxk");function I(){this.bAllowAddAccounts=m.AllowAddAccounts,this.bAllowMultiAccounts=m.AllowMultiAccounts,this.bAllowIdentities=!!m.AllowIdentities,this.bAllowFetchers=!!m.AllowFetchers,this.accounts=p.collection,this.editedAccountId=p.editedId,this.editedFetcher=o.observable(null),this.editedFetcherId=o.computed((function(){return this.editedFetcher()?this.editedFetcher().id():null}),this),this.editedIdentity=o.observable(null),this.editedIdentityId=o.computed((function(){return this.editedIdentity()?this.editedIdentity().id():null}),this),this.allowFolders=o.observable(!1),this.allowForward=o.observable(!1),this.allowAutoresponder=o.observable(!1),this.allowFilters=o.observable(!1),this.allowSignature=o.observable(!1),this.aAccountTabs=[{name:"properties",title:n.i18n("MAILWEBCLIENT/LABEL_PROPERTIES_TAB"),view:v,visible:v.visibleTab},{name:"folders",title:n.i18n("MAILWEBCLIENT/LABEL_MANAGE_FOLDERS_TAB"),view:b,visible:this.allowFolders},{name:"forward",title:n.i18n("MAILWEBCLIENT/LABEL_FORWARD_TAB"),view:y,visible:this.allowForward},{name:"autoresponder",title:n.i18n("MAILWEBCLIENT/LABEL_AUTORESPONDER_TAB"),view:g,visible:this.allowAutoresponder},{name:"filters",title:n.i18n("MAILWEBCLIENT/LABEL_FILTERS_TAB"),view:f,visible:this.allowFilters},{name:"signature",title:n.i18n("MAILWEBCLIENT/LABEL_SIGNATURE_TAB"),view:E,visible:this.allowSignature}],this.aIdentityTabs=[{name:"properties",title:n.i18n("MAILWEBCLIENT/LABEL_PROPERTIES_TAB"),view:new A(this),visible:o.observable(!0)},{name:"signature",title:n.i18n("MAILWEBCLIENT/LABEL_SIGNATURE_TAB"),view:E,visible:o.observable(!0)}],this.aFetcherTabs=[{name:"incoming",title:n.i18n("MAILWEBCLIENT/LABEL_POP3_SETTINGS_TAB"),view:new F(this),visible:o.observable(!0)},{name:"outgoing",title:n.i18n("MAILWEBCLIENT/LABEL_SMTP_SETTINGS_TAB"),view:S,visible:o.observable(!0)},{name:"signature",title:n.i18n("MAILWEBCLIENT/LABEL_SIGNATURE_TAB"),view:E,visible:o.observable(!0)}],this.currentTab=o.observable(null),this.tabs=o.computed((function(){return this.editedIdentity()?this.aIdentityTabs:this.editedFetcher()?this.aFetcherTabs:this.aAccountTabs}),this),p.editedId.subscribe((function(){this.populate()}),this)}I.prototype.ViewTemplate="MailWebclient_Settings_AccountsSettingsPaneView",I.prototype.hasUnsavedChanges=function(){var e=this.currentTab();return e&&e.view&&i.isFunction(e.view.hasUnsavedChanges)&&e.view.hasUnsavedChanges()},I.prototype.revert=function(){var e=this.currentTab();e&&e.view&&i.isFunction(e.view.revert)&&e.view.revert()},I.prototype.hide=function(e,t){this.currentTab()&&i.isFunction(this.currentTab().view.hide)?this.currentTab().view.hide(e,t):e()},I.prototype.showTab=function(e){var t=e.length>0?e[0]:"account",s=p.getEdited(),o=e.length>1?e[1]:s?s.hash():"",r=e.length>2?e[2]:"";this.editedIdentity("identity"===t&&p.getIdentityByHash(o)||null),this.editedFetcher("fetcher"===t&&p.getFetcherByHash(o)||null),"account"===t&&("create"!==e[1]||p.hasAccount()?""!==o&&(s&&s.hash()===o?this.populate():i.find(p.collection(),(function(e){return e.hash()===o}))?p.changeEditedAccountByHash(o):a.replaceHash(["settings","mail-accounts"])):(this.addAccount(),l.showError(n.i18n("MAILWEBCLIENT/INFO_SPECIFY_CREDENTIALS")),a.replaceHashDirectly(["settings","mail-accounts"]))),this.changeTab(r||this.getAutoselectedTab().name)},I.prototype.getAutoselectedTab=function(){var e=i.find(this.tabs(),(function(e){return e.visible()}));return e||(e=this.tabs()[0]),e},I.prototype.addAccount=function(){h.showPopup(c,[i.bind((function(e){var t=p.getAccount(e);t&&this.editAccount(t.hash())}),this)])},I.prototype.editAccount=function(e){r.run("SettingsWebclient","setAddHash",[["account",e]])},I.prototype.addIdentity=function(e,t){t.stopPropagation(),h.showPopup(u,[e])},I.prototype.editIdentity=function(e){r.run("SettingsWebclient","setAddHash",[["identity",e]])},I.prototype.addFetcher=function(e,t){t.stopPropagation(),h.showPopup(d,[e])},I.prototype.editFetcher=function(e){r.run("SettingsWebclient","setAddHash",[["fetcher",e]])},I.prototype.changeRoute=function(e){var t=p.getEdited(),s=["account",t?t.hash():"",e];this.editedIdentity()?s=["identity",this.editedIdentity().hash(),e]:this.editedFetcher()&&(s=["fetcher",this.editedFetcher().hash(),e]),r.run("SettingsWebclient","setAddHash",[s])},I.prototype.changeTab=function(e){var t=this.currentTab(),s=i.find(this.tabs(),(function(t){return t.visible()&&t.name===e})),o=function(){s&&(i.isFunction(s.view.showTab)&&s.view.showTab(this.editedIdentity()||this.editedFetcher()),this.currentTab(s))}.bind(this),n=!0;s?t&&i.isFunction(t.view.hide)&&(t.view.hide(o,i.bind((function(){i.isFunction(a.stopListening)&&i.isFunction(a.startListening)&&a.stopListening(),this.changeRoute(t.name),i.isFunction(a.startListening)&&a.startListening()}),this)),n=!1):t||(s=this.getAutoselectedTab()),t||i.delay(i.bind((function(){this.changeRoute(s.name)}),this)),n&&o()},I.prototype.populate=function(){var e=p.getEdited();e&&(this.allowFolders(!0),this.allowForward(e.allowForward()),this.allowAutoresponder(e.allowAutoresponder()),this.allowFilters(e.allowFilters()),this.allowSignature(!m.AllowIdentities),this.currentTab()&&this.currentTab().visible()||this.currentTab(this.getAutoselectedTab()))},I.prototype.onRemoveIdentity=function(){this.editedIdentity(null),this.changeTab(this.currentTab()?this.currentTab().name:"")},I.prototype.onRemoveFetcher=function(){this.editedFetcher(null),this.changeRoute("")},e.exports=new I},Aqrs:function(e,t,s){"use strict";var i=s("0h2I"),o=s("AFLV");function n(e){this.iAccountId=e,this.enable=i.observable(!0).extend({reversible:!0}),this.field=i.observable("").extend({reversible:!0}),this.condition=i.observable("").extend({reversible:!0}),this.filter=i.observable("").extend({reversible:!0}),this.action=i.observable("").extend({reversible:!0}),this.folder=i.observable("").extend({reversible:!0})}n.prototype.parse=function(e){this.enable(!!e.Enable),this.field(o.pInt(e.Field)),this.condition(o.pInt(e.Condition)),this.filter(o.pString(e.Filter)),this.action(o.pInt(e.Action)),this.folder(o.pString(e.FolderFullName)),this.commit()},n.prototype.revert=function(){this.enable.revert(),this.field.revert(),this.condition.revert(),this.filter.revert(),this.action.revert(),this.folder.revert()},n.prototype.commit=function(){this.enable.commit(),this.field.commit(),this.condition.commit(),this.filter.commit(),this.action.commit(),this.folder.commit()},n.prototype.toString=function(){return[this.enable(),this.field(),this.condition(),this.filter(),this.action(),this.folder()].join(":")},e.exports=n},BOSG:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("ZP6a"),h=s("Yjhd"),c=s("IAk5"),u=s("dKfC"),d=s("OgeD"),p=s("TKFr"),m=s("QaF5"),g=s("gcBV"),f=s("hPb3"),b=s("ZCBP"),y=s("xcwT"),v=s("h1OO"),A=s("4M/5"),F=s("jxK9"),S=s("Cq+9"),E=s("jonm"),I=s("UN2P"),C=s("4+IO"),M=s("p2hp"),T=s("XTZw"),L=c.isNewTab()&&window.opener&&window.opener.MainTabMailMethods;function w(){y.call(this,"MailWebclient"),this.bNewTab=c.isNewTab(),this.isLoading=n.observable(!1),this.bAllowSearchMessagesBySubject=M.AllowSearchMessagesBySubject,C.folderList.subscribe(this.onFolderListSubscribe,this),this.messages=C.messages,this.messages.subscribe(this.onMessagesSubscribe,this),this.currentMessage=C.currentMessage,this.currentMessage.subscribe(this.onCurrentMessageSubscribe,this),f.timeFormat.subscribe(this.onCurrentMessageSubscribe,this),f.dateFormat.subscribe(this.onCurrentMessageSubscribe,this),this.displayedMessageUid=n.observable(""),this.browserTitle=n.computed((function(){var e=this.currentMessage(),t=e?e.subject():"";return(t?t+" - ":"")+E.getEmail()+" - "+r.i18n("MAILWEBCLIENT/HEADING_MESSAGE_BROWSER_TAB")}),this),this.isCurrentMessage=n.computed((function(){return!!this.currentMessage()}),this),this.isCurrentMessageLoaded=n.computed((function(){return this.isCurrentMessage()&&!this.isLoading()}),this),this.visibleNoMessageSelectedText=n.computed((function(){return this.messages().length>0&&!this.isCurrentMessage()}),this),this.prevMessageUid=C.prevMessageUid,this.nextMessageUid=C.nextMessageUid,this.isEnablePrevMessage=n.computed((function(){return c.isNewTab()&&a.isNonEmptyString(this.prevMessageUid())}),this),this.isEnableNextMessage=n.computed((function(){return c.isNewTab()&&a.isNonEmptyString(this.nextMessageUid())}),this),this.isEnableDelete=this.isCurrentMessage,this.isEnableReply=this.isCurrentMessageLoaded,this.isEnableReplyAll=this.isCurrentMessageLoaded,this.isEnableResend=this.isCurrentMessageLoaded,this.isEnableForward=this.isCurrentMessageLoaded,this.isEnablePrint=this.isCurrentMessageLoaded,this.isEnableSave=function(){return this.isCurrentMessage()&&""!==this.currentMessage().sDownloadAsEmlUrl},this.deleteCommand=h.createCommand(this,this.executeDeleteMessage,this.isEnableDelete),this.prevMessageCommand=h.createCommand(this,this.executePrevMessage,this.isEnablePrevMessage),this.nextMessageCommand=h.createCommand(this,this.executeNextMessage,this.isEnableNextMessage),this.replyCommand=h.createCommand(this,this.executeReply,this.isEnableReply),this.replyAllCommand=h.createCommand(this,this.executeReplyAll,this.isEnableReplyAll),this.resendCommand=h.createCommand(this,this.executeResend,this.isEnableResend),this.forwardCommand=h.createCommand(this,this.executeForward,this.isEnableForward),this.printCommand=h.createCommand(this,this.executePrint,this.isEnablePrint),this.saveCommand=h.createCommand(this,this.executeSave,this.isEnableSave),this.forwardAsAttachment=h.createCommand(this,this.executeForwardAsAttachment,this.isCurrentMessageLoaded),this.moreCommand=h.createCommand(this,null,this.isCurrentMessageLoaded),this.moreSectionCommands=n.observableArray([]),c.broadcastEvent("MailWebclient::AddMoreSectionCommand",i.bind((function(e){var t=i.extend({Text:"",CssClass:"",Handler:function(){}},e);t.Command=h.createCommand(this,t.Handler,this.isCurrentMessageLoaded),this.moreSectionCommands.push(t)}),this)),this.visiblePicturesControl=n.observable(!1),this.visibleShowPicturesLink=n.observable(!1),this.visibleConfirmationControl=n.computed((function(){return this.currentMessage()&&""!==this.currentMessage().readingConfirmationAddressee()&&this.currentMessage()&&this.currentMessage().readingConfirmationAddressee()!==E.getEmail()}),this),this.isCurrentNotDraftOrSent=n.computed((function(){var e=C.folderList().currentFolder();return e&&e.fullName().length>0&&e.type()!==Enums.FolderTypes.Drafts&&e.type()!==Enums.FolderTypes.Sent}),this),this.isCurrentSentFolder=n.computed((function(){var e=C.folderList().currentFolder();return!!e&&e.fullName().length>0&&e.type()===Enums.FolderTypes.Sent}),this),this.isCurrentNotDraftFolder=n.computed((function(){var e=C.folderList().currentFolder();return!!e&&e.fullName().length>0&&e.type()!==Enums.FolderTypes.Drafts}),this),this.isVisibleReplyTool=this.isCurrentNotDraftOrSent,this.isVisibleResendTool=this.isCurrentSentFolder,this.isVisibleForwardTool=this.isCurrentNotDraftFolder,this.uid=n.observable(""),this.folder=n.observable(""),this.folder.subscribe((function(){this.jqPanelHelper&&this.jqPanelHelper.trigger("resize",[null,"min",null,!0])}),this),this.subject=n.observable(""),this.emptySubject=n.computed((function(){return""===o.trim(this.subject())}),this),this.subjectForDisplay=n.computed((function(){return this.emptySubject()?r.i18n("MAILWEBCLIENT/LABEL_NO_SUBJECT"):this.subject()}),this),this.importance=n.observable(Enums.Importance.Normal),this.oFromAddr=n.observable(null),this.from=n.observable(""),this.fromEmail=n.observable(""),this.fullFrom=n.observable(""),this.to=n.observable(""),this.aToAddr=n.observableArray([]),this.cc=n.observable(""),this.aCcAddr=n.observableArray([]),this.bcc=n.observable(""),this.aBccAddr=n.observableArray([]),this.allRecipients=n.observableArray([]),this.currentAccountEmail=n.observable(),this.meSender=r.i18n("MAILWEBCLIENT/LABEL_ME_SENDER"),this.meRecipient=r.i18n("MAILWEBCLIENT/LABEL_ME_RECIPIENT"),this.fullDate=n.observable(""),this.midDate=n.observable(""),this.textBody=n.observable(""),this.textBodyForNewWindow=n.observable(""),this.domTextBody=n.observable(null),this.rtlMessage=n.observable(!1),this.contentHasFocus=n.observable(!1),this.topControllers=n.observableArray(),this.bodyControllers=n.observableArray(),this.controllers=n.computed((function(){return i.union(this.topControllers(),this.bodyControllers())}),this),c.broadcastEvent("MailWebclient::RegisterMessagePaneController",i.bind((function(e,t){this.registerController(e,t)}),this)),this.fakeHeader=n.computed((function(){var e=!!i.find(this.topControllers(),(function(e){return!!e.visible&&e.visible()}));return!(this.visiblePicturesControl()||this.visibleConfirmationControl()||e)}),this),this.sAttachmentsSwitcherViewTemplate=c.isMobile()?"MailWebclient_Message_AttachmentsSwitcherView":"",this.sQuickReplyViewTemplate=c.isMobile()?"":"MailWebclient_Message_QuickReplyView",this.attachments=n.observableArray([]),this.notInlineAttachments=n.computed((function(){return i.filter(this.attachments(),(function(e){return!e.linked()}))}),this),this.notInlineAttachmentsInString=n.computed((function(){return i.map(this.notInlineAttachments(),(function(e){return e.fileName()}),this).join(", ")}),this),this.allAttachmentsDownloadMethods=n.observableArray([]),this.visibleDownloadAllAttachmentsSeparately=n.computed((function(){return this.notInlineAttachments().length>1}),this),this.visibleExtendedDownload=n.computed((function(){return this.visibleDownloadAllAttachmentsSeparately()||this.allAttachmentsDownloadMethods().length>0}),this),c.broadcastEvent("MailWebclient::AddAllAttachmentsDownloadMethod",i.bind((function(e){this.allAttachmentsDownloadMethods.push(e)}),this)),this.detailsVisible=n.observable("1"===g.getData("MessageDetailsVisible")),this.detailsTooltip=n.computed((function(){return this.detailsVisible()?r.i18n("COREWEBCLIENT/ACTION_HIDE_DETAILS"):r.i18n("COREWEBCLIENT/ACTION_SHOW_DETAILS")}),this),this.hasNotInlineAttachments=n.computed((function(){return this.notInlineAttachments().length>0}),this),this.hasBodyText=n.computed((function(){return this.textBody().length>0}),this),this.visibleAddMenu=n.observable(!1),this.replyText=n.observable(""),this.replyTextFocus=n.observable(!1),this.replyPaneVisible=n.computed((function(){return this.currentMessage()&&this.currentMessage().completelyFilled()}),this),this.replySendingStarted=n.observable(!1),this.replySavingStarted=n.observable(!1),this.replyAutoSavingStarted=n.observable(!1),this.requiresPostponedSending=n.observable(!1),this.replyAutoSavingStarted.subscribe((function(){!this.replyAutoSavingStarted()&&this.requiresPostponedSending()&&(S.sendPostponedMail(this.replyDraftUid()),this.requiresPostponedSending(!1))}),this),this.hasReplyAllCcAddrs=n.observable(!1),this.placeholderText=n.computed((function(){return this.hasReplyAllCcAddrs()?r.i18n("MAILWEBCLIENT/LABEL_QUICK_REPLY_ALL"):r.i18n("MAILWEBCLIENT/LABEL_QUICK_REPLY")}),this),this.sendButtonText=n.computed((function(){return this.hasReplyAllCcAddrs()?r.i18n("MAILWEBCLIENT/ACTION_SEND_ALL"):r.i18n("MAILWEBCLIENT/ACTION_SEND")}),this),n.computed((function(){(!this.replyTextFocus()||this.replyAutoSavingStarted()||this.replySavingStarted()||this.replySendingStarted())&&this.stopAutosaveTimer(),!this.replyTextFocus()||this.replyAutoSavingStarted()||this.replySavingStarted()||this.replySendingStarted()||this.startAutosaveTimer()}),this),this.saveButtonText=n.computed((function(){return this.replyAutoSavingStarted()?r.i18n("MAILWEBCLIENT/ACTION_SAVE_IN_PROGRESS"):r.i18n("MAILWEBCLIENT/ACTION_SAVE")}),this),this.replyDraftUid=n.observable(""),this.replyLoadingText=n.computed((function(){return this.replySendingStarted()?r.i18n("COREWEBCLIENT/INFO_SENDING"):this.replySavingStarted()?r.i18n("MAILWEBCLIENT/INFO_SAVING"):""}),this),this.isEnableSendQuickReply=n.computed((function(){return this.isCurrentMessageLoaded()&&""!==this.replyText()&&!this.replySendingStarted()}),this),this.isEnableSaveQuickReply=n.computed((function(){return this.isEnableSendQuickReply()&&!this.replySavingStarted()&&!this.replyAutoSavingStarted()}),this),this.saveQuickReplyCommand=h.createCommand(this,this.executeSaveQuickReply,this.isEnableSaveQuickReply),this.sendQuickReplyCommand=h.createCommand(this,this.executeSendQuickReply,this.isEnableSendQuickReply),this.domMessageHeader=n.observable(null),this.domQuickReply=n.observable(null),this.domMessageForPrint=n.observable(null),this.replyTextFocusThrottled=n.observable(!1).extend({throttle:50}),this.replyTextFocus.subscribe((function(){this.replyTextFocusThrottled(this.replyTextFocus())}),this),this.isQuickReplyActive=n.computed((function(){return this.replyText().length>0||this.replyTextFocusThrottled()}),this),this.jqPanelHelper=null,this.visibleAttachments=n.observable(!1),this.showMessage=function(){this.visibleAttachments(!1)},this.showAttachments=function(){this.visibleAttachments(!0)},this.sDefaultFontName=M.DefaultFontName,p.registerDayOfMonthFunction(i.bind(this.updateMomentDate,this)),c.broadcastEvent("MailWebclient::ConstructView::after",{Name:"CMessagePaneView",View:this})}i.extendOwn(w.prototype,y.prototype),w.prototype.ViewTemplate=c.isNewTab()?"MailWebclient_MessagePaneScreenView":"MailWebclient_MessagePaneView",w.prototype.ViewConstructorName="CMessagePaneView",w.prototype.resizeDblClick=function(e,t){""!==t.target.className&&t.target.className.search(/add_contact|icon|link|title|subject|link|date|from/)&&(h.calmEvent(t),h.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=o(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[5,"min",!0]))},w.prototype.notifySender=function(){if(this.currentMessage()&&""!==this.currentMessage().readingConfirmationAddressee()){var e=r.i18n("MAILWEBCLIENT/LABEL_RETURN_RECEIPT_MAIL_TEXT",{EMAIL:E.getEmail(),SUBJECT:this.subject()}).replace(/\\r\\n/g,"\n");I.send("SendMessage",{To:this.currentMessage().readingConfirmationAddressee(),Subject:r.i18n("MAILWEBCLIENT/LABEL_RETURN_RECEIPT_MAIL_SUBJECT"),Text:e,ConfirmFolder:this.currentMessage().folder(),ConfirmUid:this.currentMessage().uid()}),this.currentMessage().readingConfirmationAddressee("")}},w.prototype.onFolderListSubscribe=function(){c.isNewTab()&&this.onMessagesSubscribe()},w.prototype.onMessagesSubscribe=function(){!this.currentMessage()&&this.uid().length>0&&C.setCurrentMessage(this.uid(),this.folder())},w.prototype.passReplyDataToNewTab=function(e){this.currentMessage()&&this.currentMessage().sUniq===e&&""!==this.replyText()&&(u.passReplyData(e,{ReplyText:this.replyText(),ReplyDraftUid:this.replyDraftUid()}),this.replyText(""),this.replyDraftUid(""))},w.prototype.onCurrentMessageSubscribe=function(){var e=this.currentMessage(),t=e?E.getAccount(e.accountId()):null,s=null;if(L&&e?(s=L.getReplyData(e.sUniq))&&(this.replyText(s.ReplyText),this.replyDraftUid(s.ReplyDraftUid)):e&&e.uid()===this.displayedMessageUid()||(this.replyText(""),this.replyDraftUid("")),e&&this.uid()===e.uid()){if(this.hasReplyAllCcAddrs(S.hasReplyAllCcAddrs(e)),this.subject(e.subject()),this.importance(e.importance()),this.from(e.oFrom.getDisplay()),this.fromEmail(e.oFrom.getFirstEmail()),this.fullFrom(e.oFrom.getFull()),e.oFrom.aCollection.length>0?this.oFromAddr(e.oFrom.aCollection[0]):this.oFromAddr(null),this.to(e.oTo.getFull()),this.aToAddr(e.oTo.aCollection),this.cc(e.oCc.getFull()),this.aCcAddr(e.oCc.aCollection),this.bcc(e.oBcc.getFull()),this.aBccAddr(e.oBcc.aCollection),this.currentAccountEmail(t.email()),this.allRecipients(i.uniq(i.union(this.aToAddr(),this.aCcAddr(),this.aBccAddr()))),this.midDate(e.oDateModel.getMidDate()),this.fullDate(e.oDateModel.getFullDate()),this.isLoading(""!==e.uid()&&!e.completelyFilled()),this.setMessageBody(),this.rtlMessage(e.rtl()),c.isNewTab()){var n=[];i.each(e.attachments(),i.bind((function(e){var t=new T;t.copyProperties(e),n.push(t)}),this)),this.attachments(n)}else this.attachments(e.attachments());if(!e.completelyFilled()||e.truncated()){var r=e.completelyFilled()?e.truncated:e.completelyFilled;c.isNewTab()?e.completelyFilledNewTabSubscription=r.subscribe(this.onCurrentMessageSubscribe,this):e.completelyFilledSubscription=r.subscribe(this.onCurrentMessageSubscribe,this)}else e.completelyFilledSubscription?(e.completelyFilledSubscription.dispose(),e.completelyFilledSubscription=void 0):e.completelyFilledNewTabSubscription&&(e.completelyFilledNewTabSubscription.dispose(),e.completelyFilledNewTabSubscription=void 0)}else this.hasReplyAllCcAddrs(!1),this.isLoading(!1),o(this.domTextBody()).empty().data("displayed-message-uid",""),this.displayedMessageUid(""),this.rtlMessage(!1),this.attachments([]),this.visiblePicturesControl(!1),this.visibleShowPicturesLink(!1);this.doAfterPopulatingMessage()},w.prototype.updateMomentDate=function(){var e=this.currentMessage();e&&e.oDateModel&&(this.midDate(e.oDateModel.getMidDate()),this.fullDate(e.oDateModel.getFullDate()))},w.prototype.setMessageBody=function(){if(this.currentMessage()){var e=this.currentMessage(),t=e.text(),s=o(this.domTextBody()),i=null,n="",a=t.length,l=[];this.textBody(t),s.data("displayed-message-uid")===e.uid()&&(l=this.getBlockquotesStatus()),s.empty(),e.isPlain()||a>5e6?(s.html(t),this.visiblePicturesControl(!1)):(n=(i=e.getDomText()).length>0?i.html():"",s.append(n),this.visiblePicturesControl(e.hasExternals()&&!e.isExternalsAlwaysShown()),this.visibleShowPicturesLink(!e.isExternalsShown()),r.htmlStartsWithBlockquote(n)||this.doHidingBlockquotes(l)),s.data("displayed-message-uid",e.uid()),this.displayedMessageUid(e.uid())}},w.prototype.getBlockquotesStatus=function(){var e=[];return o(o("blockquote",o(this.domTextBody())).get()).each((function(){var t=o(this);t.hasClass("blockquote_before_toggle")&&e.push(t.hasClass("collapsed"))})),e},w.prototype.doHidingBlockquotes=function(e){var t=0;o(o("blockquote",o(this.domTextBody())).get()).each((function(){var s=o(this),i=s.parents("blockquote"),n=o('<span class="blockquote_toggle"></span>').html(r.i18n("MAILWEBCLIENT/ACTION_SHOW_QUOTED_TEXT")),a=!0;0===i.length&&s.height()>120&&(s.addClass("blockquote_before_toggle").after(n).wrapInner('<div class="blockquote_content"></div>'),n.bind("click",(function(){a?(s.height("auto"),n.html(r.i18n("MAILWEBCLIENT/ACTION_HIDE_QUOTED_TEXT")),a=!1):(s.height(80),n.html(r.i18n("MAILWEBCLIENT/ACTION_SHOW_QUOTED_TEXT")),a=!0),s.toggleClass("collapsed",a)})),t<e.length&&(a=e[t],t++),s.height(a?80:"auto").toggleClass("collapsed",a))}))},w.prototype.onRoute=function(e){var t=A.parseMailbox(e);E.changeCurrentAccountByHash(t.AccountHash),""!==this.replyText()&&this.uid()!==t.Uid&&this.saveReplyMessage(!1),this.uid(t.Uid),this.folder(t.Folder),C.setCurrentMessage(this.uid(),this.folder()),this.contentHasFocus(!0)},w.prototype.showPictures=function(){C.showExternalPictures(!1),this.visibleShowPicturesLink(!1),this.setMessageBody()},w.prototype.alwaysShowPictures=function(){var e=this.currentMessage()?this.currentMessage().oFrom.getFirstEmail():"";e.length>0&&I.send("SetEmailSafety",{Email:e}),C.showExternalPictures(!0),this.visiblePicturesControl(!1),this.setMessageBody()},w.prototype.openInNewWindow=function(){this.openMessageInNewWindowBound(this.currentMessage())},w.prototype.getReplyHtmlText=function(){return'<div style="font-family: '+this.sDefaultFontName+'; font-size: 16px">'+S.getHtmlFromText(this.replyText())+"</div>"},w.prototype.executeReplyOrForward=function(e){this.currentMessage()&&(S.setReplyData(this.getReplyHtmlText(),this.replyDraftUid()),this.replyText(""),this.replyDraftUid(""),v.composeMessageAsReplyOrForward(e,this.currentMessage().folder(),this.currentMessage().uid()))},w.prototype.executeDeleteMessage=function(){this.currentMessage()&&(L?L.deleteMessage(this.currentMessage().uid(),(function(){window.close()})):c.isMobile()&&F.deleteMessages([this.currentMessage().uid()],c))},w.prototype.executePrevMessage=function(){this.isEnablePrevMessage()&&m.setHash(A.getViewMessage(C.folderList().currentFolderFullName(),this.prevMessageUid()))},w.prototype.executeNextMessage=function(){this.isEnableNextMessage()&&m.setHash(A.getViewMessage(C.folderList().currentFolderFullName(),this.nextMessageUid()))},w.prototype.executeReply=function(){this.executeReplyOrForward(Enums.ReplyType.Reply)},w.prototype.executeReplyAll=function(){this.executeReplyOrForward(Enums.ReplyType.ReplyAll)},w.prototype.executeResend=function(){this.executeReplyOrForward(Enums.ReplyType.Resend)},w.prototype.executeForward=function(){this.executeReplyOrForward(Enums.ReplyType.Forward)},w.prototype.executePrint=function(){var e=this.currentMessage(),t=e?b.open("",this.subject()+"-print"):null,s="";e&&t&&(this.textBodyForNewWindow(e.getConvertedHtml(l.getAppPath(),!0)),s=o(this.domMessageForPrint()).html(),o(t.document.body).html(s),t.print())},w.prototype.executeSave=function(){this.isEnableSave()&&this.currentMessage()&&l.downloadByUrl(this.currentMessage().sDownloadAsEmlUrl)},w.prototype.executeForwardAsAttachment=function(){this.currentMessage()&&v.composeMessageWithEml(this.currentMessage())},w.prototype.changeAddMenuVisibility=function(){var e=!this.visibleAddMenu();this.visibleAddMenu(e)},w.prototype.onSendOrSaveMessageResponse=function(e,t){var s=S.onSendOrSaveMessageResponse(e,t,this.requiresPostponedSending());switch(s.Method){case"SendMessage":this.replySendingStarted(!1),s.Result&&this.replyText("");break;case"SaveMessage":s.Result&&this.replyDraftUid(s.NewUid),this.replySavingStarted(!1),this.replyAutoSavingStarted(!1)}},w.prototype.executeSendQuickReply=function(){this.isEnableSendQuickReply()&&(this.replySendingStarted(!0),this.requiresPostponedSending(this.replyAutoSavingStarted()),S.sendReplyMessage("SendMessage",this.getReplyHtmlText(),this.replyDraftUid(),this.onSendOrSaveMessageResponse,this,this.requiresPostponedSending()),this.replyTextFocus(!1))},w.prototype.executeSaveQuickReply=function(){this.saveReplyMessage(!1)},w.prototype.saveReplyMessage=function(e){this.isEnableSaveQuickReply()&&(e?this.replyAutoSavingStarted(!0):this.replySavingStarted(!0),S.sendReplyMessage("SaveMessage",this.getReplyHtmlText(),this.replyDraftUid(),this.onSendOrSaveMessageResponse,this))},w.prototype.stopAutosaveTimer=function(){window.clearTimeout(this.autoSaveTimer)},w.prototype.startAutosaveTimer=function(){if(this.isEnableSaveQuickReply()){var e=i.bind(this.saveReplyMessage,this,!0);this.stopAutosaveTimer(),M.AllowAutosaveInDrafts&&(this.autoSaveTimer=window.setTimeout(e,1e3*M.AutoSaveIntervalSeconds))}},w.prototype.executeAllAttachmentsDownloadMethod=function(e){this.currentMessage()&&e(this.currentMessage().accountId(),this.currentMessage().getAttachmentsHashes())},w.prototype.downloadAllAttachmentsSeparately=function(){this.currentMessage()&&this.currentMessage().downloadAllAttachmentsSeparately()},w.prototype.onShow=function(){this.bShown=!0},w.prototype.onHide=function(){this.bShown=!1},w.prototype.onBind=function(e){d.run("SessionTimeoutWeblient","registerFunction",[i.bind((function(){""!==this.replyText()&&this.saveReplyMessage(!1)}),this)]),this.$MailViewDom=i.isUndefined(e)?this.$viewDom:e,this.$MailViewDom.on("mousedown","a",(function(e){if(e&&3!==e.which){var t=o(this).attr("href");if(t&&"mailto:"===t.toString().toLowerCase().substr(0,7))return v.composeMessageToAddresses(t.toString()),!1}return!0})),c.isMobile()||this.hotKeysBind()},w.prototype.hotKeysBind=function(){o(document).on("keydown",o.proxy((function(e){var t=this.bShown&&e&&!e.ctrlKey&&!e.shiftKey&&!h.isTextFieldFocused()&&this.isEnableReply();t&&e.keyCode===Enums.Key.q?(e.preventDefault(),this.replyTextFocus(!0)):t&&e.keyCode===Enums.Key.r&&this.executeReply()}),this))},w.prototype.showSourceHeaders=function(){var e=this.currentMessage(),t=e&&e.completelyFilled()?b.open("",this.subject()+"-headers"):null;t&&o(t.document.body).html("<pre>"+r.encodeHtml(e.sourceHeaders())+"</pre>")},w.prototype.switchDetailsVisibility=function(){this.detailsVisible(!this.detailsVisible()),g.setData("MessageDetailsVisible",this.detailsVisible()?"1":"0")},w.prototype.registerController=function(e,t){switch(t){case"BeforeMessageHeaders":this.topControllers.push(e);break;case"BeforeMessageBody":this.bodyControllers.push(e)}o.isFunction(e.assignMessagePaneExtInterface)&&e.assignMessagePaneExtInterface(this.getExtInterface())},w.prototype.getExtInterface=function(){return{changeText:i.bind((function(e){var t=this.currentMessage();t&&this.isCurrentMessageLoaded()&&(t.text(e),t.$text=null,this.setMessageBody())}),this)}},w.prototype.doAfterPopulatingMessage=function(){var e=this.currentMessage(),t=e&&this.isCurrentMessageLoaded()?{aToEmails:e.oTo.getEmails(),bPlain:e.isPlain(),sRawText:e.textRaw(),sText:e.text(),sAccountEmail:E.getEmail(e.accountId()),sFromEmail:e.oFrom.getFirstEmail(),iSensitivity:e.sensitivity(),aExtend:e.aExtend}:null;i.each(this.controllers(),i.bind((function(e){o.isFunction(e.doAfterPopulatingMessage)&&e.doAfterPopulatingMessage(t)}),this)),d.run("ContactsWebclient","applyContactsCards",[this.$MailViewDom.find("span.address")])},w.prototype.searchBySubject=function(){if(M.AllowSearchMessagesBySubject&&this.currentMessage()){var e=this.currentMessage().folder(),t=this.currentMessage().uid(),s="",n=this.currentMessage().subject().split(":"),r=M.PrefixesToRemoveBeforeSearchMessagesBySubject,a=[];0===r.length?s=n:(i.each(n,(function(e){if(a.length>0)a.push(e);else{var t=!1,s=o.trim(e);i.each(r,(function(e){var i=new RegExp("^"+e+"(\\[\\d*\\]){0,1}$","i");t=t||i.test(s)})),t||a.push(e)}})),s=o.trim(a.join(":"))),m.setHash(A.getMailbox(e,1,t,s,""))}},e.exports=new w},"Cq+9":function(e,t,s){"use strict";(function(t){var i=s("F/us"),o=s("RN+F"),n=s("AFLV"),r=s("JFZZ"),a=s("IAk5"),l=s("QaF5"),h=s("SQrT"),c=s("cyfa"),u=s("KARm"),d=s("zu1m"),p=s("jonm"),m=s("UN2P"),g=s("4+IO"),f=s("p2hp"),b=a.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,y={sReplyText:"",sReplyDraftUid:"",oPostponedMailData:null};function v(e,t,s,i){var n=o.i18n("MAILWEBCLIENT/TEXT_REPLY_MESSAGE",{DATE:e.oDateModel.getDate(),TIME:e.oDateModel.getTime(),SENDER:o.encodeHtml(e.oFrom.getFull())});return"<br /><br />"+this.getSignatureText(t,s,i)+'<br /><br /><div data-anchor="reply-title">'+n+"</div><blockquote>"+e.getConvertedHtml()+"</blockquote>"}function A(e,t,s){var o=new u,n=i.union(e.oTo.aCollection,e.oCc.aCollection,e.oBcc.aCollection),r=i.find(p.collection(),(function(e){return e.id()===t}),this),a=new c,l=new c;return a.sEmail=r.email(),l.sEmail=s?s.email():"",o.addCollection(n),o.excludeCollection(i.union(e.oFrom.aCollection,[a,l])),o.getFull()}y.setReplyData=function(e,t){this.sReplyText=e,this.sReplyDraftUid=t},y.send=function(e,t,s,i,r,a){var c=t.AccountID,u=p.getAccount(c),d=g.oFolderListItems[c],f="",y=d?d.sentFolderFullName():"",v=d?d.draftsFolderFullName():"",A=u?u.email():"",F=t.To.indexOf(A)>-1||t.Cc.indexOf(A)>-1||t.Bcc.indexOf(A)>-1;switch(u.bSaveRepliesToCurrFolder&&!F&&n.isNonEmptyArray(t.DraftInfo,3)&&(y=t.DraftInfo[2]),t.Method=e,t.ShowReport=s,e){case"SendMessage":f=o.i18n("COREWEBCLIENT/INFO_SENDING"),t.SentFolder=y,""!==t.DraftUid&&(t.DraftFolder=v,b?(b.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),b.replaceHashWithoutMessageUid(t.DraftUid)):(g.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),l.replaceHashWithoutMessageUid(t.DraftUid)));break;case"SaveMessage":f=o.i18n("MAILWEBCLIENT/INFO_SAVING"),void 0===t.DraftFolder&&(t.DraftFolder=v),g.savingDraftUid(t.DraftUid),b?(b.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),b.replaceHashWithoutMessageUid(t.DraftUid)):(g.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),l.replaceHashWithoutMessageUid(t.DraftUid))}s&&h.showLoading(f),a?this.postponedMailData={Parameters:t,SendMessageResponseHandler:i,SendMessageResponseContext:r}:m.send(e,t,i,r)},y.sendPostponedMail=function(e){var t=this.postponedMailData,s=t.Parameters,i=s.AccountID,o=g.oFolderListItems[i],n=o?o.draftsFolderFullName():"";""!==e&&(s.DraftUid=e,s.DraftFolder=n,b?(b.removeOneMessageFromCacheForFolder(s.AccountID,s.DraftFolder,s.DraftUid),b.replaceHashWithoutMessageUid(s.DraftUid)):(g.removeOneMessageFromCacheForFolder(s.AccountID,s.DraftFolder,s.DraftUid),l.replaceHashWithoutMessageUid(s.DraftUid))),this.postponedMailData&&(m.send(s.Method,s,t.SendMessageResponseHandler,t.SendMessageResponseContext),this.postponedMailData=null)},y.sendReplyMessage=function(e,t,s,i,o,n){var r=null,a=g.currentMessage(),l=[],h=null;a&&(l=a.oTo.aCollection.concat(a.oCc.aCollection),h=this.getFirstFetcherOrIdentityByRecipientsOrDefault(l,a.accountId()),(r=this.getReplyDataFromMessage(a,Enums.ReplyType.ReplyAll,a.accountId(),h,!1,t,s)).AccountID=a.accountId(),h&&(r.FetcherID=h&&h.FETCHER?h.id():"",r.IdentityID=h&&!h.FETCHER?h.id():""),r.Bcc="",r.Importance=Enums.Importance.Normal,r.SendReadingConfirmation=!1,r.IsQuickReply=!0,r.IsHtml=!0,r.Attachments=this.convertAttachmentsForSending(r.Attachments),this.send(e,r,!1,i,o,n))},y.convertAttachmentsForSending=function(e){var t={};return i.each(e,(function(e){t[e.tempName()]=[e.fileName(),e.linked()?e.cid():"",e.inline()?"1":"0",e.linked()?"1":"0",e.contentLocation()]})),t},y.onSendOrSaveMessageResponse=function(e,s,n){var a,l,c,u=s.Parameters,d=!!e.Result;switch(n||h.hideLoading(),s.Method){case"SaveMessage":g.savingDraftUid(""),d?(u.ShowReport&&!n&&(-1!==t.inArray(s.Parameters.DraftFolder,g.getCurrentTemplateFolders())?h.showReport(o.i18n("MAILWEBCLIENT/REPORT_TEMPLATE_SAVED")):h.showReport(o.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SAVED"))),e.Result.NewUid||(f.AllowAutosaveInDrafts=!1)):u.ShowReport&&(-1!==t.inArray(s.Parameters.DraftFolder,g.getCurrentTemplateFolders())?r.showErrorByCode(e,o.i18n("MAILWEBCLIENT/ERROR_TEMPLATE_SAVING")):r.showErrorByCode(e,o.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SAVING")));break;case"SendMessage":d?(u.IsQuickReply?h.showReport(o.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):b?b.showReport(o.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):h.showReport(o.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")),i.isArray(u.DraftInfo)&&3===u.DraftInfo.length&&(c=u.DraftInfo[0],l=u.DraftInfo[1],a=u.DraftInfo[2],g.markMessageReplied(u.AccountID,a,l,c))):r.showErrorByCode(e,o.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SENDING")),u.SentFolder&&(b?b.removeMessagesFromCacheForFolder(u.AccountID,u.SentFolder):g.removeMessagesFromCacheForFolder(u.AccountID,u.SentFolder))}return u.DraftFolder&&!n&&(b?b.removeMessagesFromCacheForFolder(u.AccountID,u.DraftFolder):g.removeMessagesFromCacheForFolder(u.AccountID,u.DraftFolder)),{Method:s.Method,Result:d,NewUid:e.Result?e.Result.NewUid:""}},y.getReplyDataFromMessage=function(e,t,s,o,n,r,a){var l={DraftInfo:[],DraftUid:"",To:"",Cc:"",Bcc:"",Subject:"",Attachments:[],InReplyTo:e.messageId(),References:this.getReplyReferences(e)},h=[],c=e.oReplyTo.getFull(),u=e.oTo.getFull();switch((""===c||e.oFrom.getFirstEmail()===e.oReplyTo.getFirstEmail()&&""===e.oReplyTo.getFirstName())&&(c=e.oFrom.getFull()),r&&""!==r||(r=this.sReplyText,this.sReplyText=""),"forward"===t?l.Text=r+this.getForwardMessageBody(e,s,o):"resend"===t?(l.Text=e.getConvertedHtml(),l.Cc=e.cc(),l.Bcc=e.bcc()):l.Text=r+v.call(this,e,s,o,n),a?l.DraftUid=a:(l.DraftUid=this.sReplyDraftUid,this.sReplyDraftUid=""),t){case Enums.ReplyType.Reply:l.DraftInfo=[Enums.ReplyType.Reply,e.uid(),e.folder()],l.To=c,l.Subject=this.getReplySubject(e.subject(),!0),h=i.filter(e.attachments(),(function(e){return e.linked()}));break;case Enums.ReplyType.ReplyAll:l.DraftInfo=[Enums.ReplyType.ReplyAll,e.uid(),e.folder()],l.To=c,l.Cc=A(e,s,o),l.Subject=this.getReplySubject(e.subject(),!0),h=i.filter(e.attachments(),(function(e){return e.linked()}));break;case Enums.ReplyType.Resend:l.DraftInfo=[Enums.ReplyType.Resend,e.uid(),e.folder(),e.cc(),e.bcc()],l.To=u,l.Subject=e.subject(),h=e.attachments();break;case Enums.ReplyType.ForwardAsAttach:case Enums.ReplyType.Forward:l.DraftInfo=[Enums.ReplyType.Forward,e.uid(),e.folder()],l.Subject=this.getReplySubject(e.subject(),!1),h=e.attachments()}return i.each(h,(function(e){if(e.getCopy){var t=e.getCopy();l.Attachments.push(t)}})),l},y.getReplyReferences=function(e){var t=e.references(),s=e.messageId();return-1===t.indexOf(s)&&(t+=" "+s),t},y.getClearSignature=function(e,t){var s=p.getAccount(e),i="";return t&&t.accountId()===e&&t.useSignature()?i=t.signature():s&&s.useSignature()&&(i=s.signature()),i},y.getSignatureText=function(e,t,s){var i=this.getClearSignature(e,t);return s?'<div data-anchor="signature">'+i+"</div>":"<div>"+i+"</div>"},y.getFirstFetcherOrIdentityByRecipientsOrDefault=function(e,t){var s=p.getAccount(t),o=this.getAccountFetchersIdentitiesList(s),n=[],r=null;return i.each(e,(function(e){if(!r)switch((n=i.filter(o,(function(t){return e.sEmail===t.email}))).length){case 0:break;case 1:r=n[0];break;default:(r=i.find(n,(function(t){return e.sEmail===t.email&&e.sName===t.name})))||(r=i.find(n,(function(e){return e.isDefault})))||(r=n[0])}})),r||(r=i.find(o,(function(e){return e.isDefault}))),r&&r.result},y.getAccountFetchersIdentitiesList=function(e){var t=[];return e&&(i.each(e.fetchers(),(function(e){t.push({email:e.email(),name:e.userName(),isDefault:!1,result:e})})),i.each(e.identities(),(function(e){t.push({email:e.email(),name:e.friendlyName(),isDefault:e.isDefault(),result:e})}))),t},y.getForwardMessageBody=function(e,t,s){var i=o.encodeHtml(e.oCc.getFull()),n=""!==i?o.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE_CCPART",{CCADDR:i}):"",r=o.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE",{FROMADDR:o.encodeHtml(e.oFrom.getFull()),TOADDR:o.encodeHtml(e.oTo.getFull()),CCPART:n,FULLDATE:e.oDateModel.getFullDate(),SUBJECT:o.encodeHtml(e.subject())});return"<br /><br />"+this.getSignatureText(t,s,!0)+'<br /><br /><div data-anchor="reply-title">'+r+"</div><br /><br />"+e.getConvertedHtml()},y.hasReplyAllCcAddrs=function(e){var t=e.accountId(),s=e.oTo.aCollection.concat(e.oCc.aCollection),i=this.getFirstFetcherOrIdentityByRecipientsOrDefault(s,e.accountId());return""!==A(e,t,i)},y.getReplySubject=function(e,t){var s=o.i18n("MAILWEBCLIENT/TEXT_REPLY_PREFIX"),i=o.i18n("MAILWEBCLIENT/TEXT_FORWARD_PREFIX"),n=(t?s:i)+": "+e;return f.JoinReplyPrefixes&&(n=d.joinReplyPrefixesInSubject(n,s,i)),n},y.getHtmlFromText=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},e.exports=y}).call(this,s("EVdn"))},DGOq:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("Ol7c"),a=s("RN+F"),l=s("AFLV"),h=s("JFZZ"),c=s("OgeD"),u=s("SQrT"),d=c.run("SettingsWebclient","getAbstractSettingsFormViewClass"),p=s("76Kh"),m=s("1grR"),g=s("jonm"),f=s("UN2P"),b=s("p2hp"),y=s("6Fw4");function v(){d.call(this,b.ServerModuleName),this.enable=n.observable(!1),this.email=n.observable(""),this.email.focused=n.observable(!1),g.editedId.subscribe((function(){this.bShown&&this.populate()}),this)}i.extendOwn(v.prototype,d.prototype),v.prototype.ViewTemplate="MailWebclient_Settings_AccountForwardSettingsFormView",v.prototype.getCurrentValues=function(){return[this.enable(),this.email()]},v.prototype.revert=function(){this.populate()},v.prototype.getParametersForSave=function(){return{AccountID:g.getEdited().id(),Enable:this.enable(),Email:o.trim(this.email())}},v.prototype.applySavedValues=function(e){var t=g.getEdited().forward();t&&(t.enable=e.Enable,t.email=e.Email)},v.prototype.save=function(){var e=function(){this.isSaving(!0),this.updateSavedState(),f.send("UpdateForward",this.getParametersForSave(),this.onResponse,this)}.bind(this),t=o.trim(this.email());this.enable()&&""===t?this.email.focused(!0):this.enable()&&""!==t?r.isCorrectEmail(t)?e():p.showPopup(m,[a.i18n("MAILWEBCLIENT/ERROR_INPUT_CORRECT_EMAILS")+" "+t]):e()},v.prototype.onResponse=function(e,t){if(this.isSaving(!1),!1===e.Result)h.showErrorByCode(e,a.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"));else{var s=t.Parameters;this.applySavedValues(s),u.showReport(a.i18n("MAILWEBCLIENT/REPORT_FORWARD_UPDATE_SUCCESS"))}},v.prototype.populate=function(){var e=g.getEdited(),t=e.forward()?e.forward():null;null!==t?(this.enable(t.enable),this.email(t.email)):f.send("GetForward",{AccountID:e.id()},this.onGetForwardResponse,this),this.updateSavedState()},v.prototype.onGetForwardResponse=function(e,t){if(e&&e.Result){var s=t.Parameters,i=l.pInt(s.AccountID),o=g.getAccount(i),n=new y;o&&(n.parse(i,e.Result),o.forward(n),i===g.editedId()&&this.populate())}},e.exports=new v},DM8i:function(e,t,s){"use strict";var i=s("EVdn"),o=s("0h2I"),n=s("F/us"),r=s("AFLV");function a(e,t,s,n,a){this.server=o.observable(""),this.server.focused=o.observable(!1),this.label=n,this.defaultPort=o.observable(e),this.defaultSslPort=o.observable(t),this.port=o.observable(e),this.port.focused=o.observable(!1),this.ssl=o.observable(!1),this.isEnabled=o.observable(!0),this.id=s,i.isFunction(a)&&a.focused.subscribe((function(){a.focused()||""!==this.server()||this.server(a())}),this),this.ssl.subscribe((function(){var e=r.pInt(this.port());this.ssl()?e===this.defaultPort()&&this.port(this.defaultSslPort()):e===this.defaultSslPort()&&this.port(this.defaultPort())}),this)}a.prototype.set=function(e,t,s){this.server(e),this.ssl(s),this.port(t)},a.prototype.clear=function(){this.server(""),this.ssl(!1),this.port(this.defaultPort())},a.prototype.getIntPort=function(){return r.pInt(this.port())},a.prototype.parentSave=function(e,t){e.focused&&e.focused(!1);var s=n.find(t,(function(e){return n.isFunction(e.save)}));s&&s.save()},e.exports=a},GhJf:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("JFZZ"),h=s("OgeD"),c=s("SQrT"),u=s("IAk5"),d=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),p=s("76Kh"),m=h.run("ChangePasswordWebclient","getChangePasswordPopup"),g=s("jonm"),f=s("UN2P"),b=s("p2hp"),y=s("NV9q");function v(){d.call(this,b.ServerModuleName),this.sFakePass="xxxxxxxx",this.bAllowIdentities=b.AllowIdentities,this.useToAuthorize=n.observable(!1),this.canBeUsedToAuthorize=n.observable(!1),this.isDefaultAccount=n.observable(!1),this.isServerOwner=n.observable(!1),this.friendlyName=n.observable(""),this.email=n.observable(""),this.incomingLogin=n.observable(""),this.incomingPassword=n.observable(""),this.allowSpecifyPassword=n.observable(!1),this.useThreading=n.observable(!1),this.saveRepliesToCurrFolder=n.observable(!1),this.oServerPairPropertiesView=new y("acc_edit"),this.enableThreading=this.oServerPairPropertiesView.enableThreading,this.enableThreading.subscribe((function(){this.enableThreading()||this.useThreading(!1)}),this),this.allowChangePassword=n.observable(!1),this.incLoginFocused=n.observable(!1),this.incLoginFocused.subscribe((function(){this.incLoginFocused()&&""===this.incomingLogin()&&this.incomingLogin(this.email())}),this),g.editedId.subscribe((function(){this.bShown&&this.populate()}),this),this.updateSavedState(),this.oServerPairPropertiesView.currentValues.subscribe((function(){this.updateSavedState()}),this),this.visibleTab=n.observable(!0),n.computed((function(){var e=g.getEdited();e?(this.allowChangePassword(h.run("ChangePasswordWebclient","isChangePasswordButtonAllowed",[g.collection().length,e])),this.isDefaultAccount(e.bDefault),this.isServerOwner(e.oServer.sOwnerType===Enums.ServerOwnerType.Account)):(this.allowChangePassword(!1),this.isDefaultAccount(!1))}),this),this.isDisableAuthorize=n.observable(u.userAccountsCount()<=1),this.oDefaultAccountHostsSettingsView=s("aBko")}i.extendOwn(v.prototype,d.prototype),v.prototype.ViewTemplate="MailWebclient_Settings_AccountSettingsFormView",v.prototype.onShow=function(){this.oServerPairPropertiesView.fullInit(),this.populate()},v.prototype.getCurrentValues=function(){var e=[this.useToAuthorize(),this.friendlyName(),this.email(),this.incomingLogin(),this.incomingPassword(),this.useThreading(),this.saveRepliesToCurrFolder()],t=this.oServerPairPropertiesView.currentValues();return e.concat(t)},v.prototype.getParametersForSave=function(){var e=g.getEdited(),t=o.trim(this.incomingPassword());return{AccountID:e.id(),UseToAuthorize:this.useToAuthorize(),FriendlyName:this.friendlyName(),Email:o.trim(this.email()),IncomingLogin:o.trim(this.incomingLogin()),IncomingPassword:t===this.sFakePass?"":t,Server:this.oServerPairPropertiesView.getParametersForSave(),UseThreading:this.useThreading(),SaveRepliesToCurrFolder:this.saveRepliesToCurrFolder()}},v.prototype.revert=function(){this.populate()},v.prototype.populate=function(){var e=g.getEdited();this.passwordMightBeIncorrectSubscribtion&&(this.passwordMightBeIncorrectSubscribtion.dispose(),this.passwordMightBeIncorrectSubscribtion=null),e?(this.friendlyName(e.friendlyName()),this.email(e.email()),this.incomingLogin(e.incomingLogin()),this.incomingPassword(this.sFakePass),this.allowSpecifyPassword(e.passwordMightBeIncorrect()),e.passwordMightBeIncorrect()||(this.passwordMightBeIncorrectSubscribtion=e.passwordMightBeIncorrect.subscribe(function(){this.allowSpecifyPassword(e.passwordMightBeIncorrect()),this.passwordMightBeIncorrectSubscribtion.dispose(),this.passwordMightBeIncorrectSubscribtion=null}.bind(this))),this.oServerPairPropertiesView.setServer(e.oServer),this.useToAuthorize(e.useToAuthorize()),this.canBeUsedToAuthorize(e.canBeUsedToAuthorize()),this.useThreading(e.useThreading()),this.saveRepliesToCurrFolder(e.bSaveRepliesToCurrFolder),this.isDisableAuthorize(!!this.useToAuthorize()&&u.userAccountsCount()<=1)):(this.friendlyName(""),this.email(""),this.incomingLogin(""),this.incomingPassword(""),this.allowSpecifyPassword(!1),this.oServerPairPropertiesView.clear(),this.useToAuthorize(!0),this.canBeUsedToAuthorize(!1),this.useThreading(!1),this.isDisableAuthorize(!0)),this.updateSavedState()},v.prototype.remove=function(){if(this.isDisableAuthorize())c.showError(r.i18n("COREWEBCLIENT/ERROR_ACCOUNT_DELETING_DISABLE"),!0);else{var e=g.getEdited();e&&e.remove()}},v.prototype.save=function(){this.isSaving(!0),this.updateSavedState(),f.send("UpdateAccount",this.getParametersForSave(),this.onResponse,this)},v.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result){var s=t.Parameters,i=a.pInt(s.AccountID),o=g.getAccount(i);o&&(a.isNonEmptyString(s.IncomingPassword)&&s.IncomingPassword!==this.sFakePass&&o.passwordMightBeIncorrect(!1),o.updateFromServer(e.Result),this.populate(),c.showReport(r.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS")))}else l.showErrorByCode(e,r.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},v.prototype.changePassword=function(){this.allowChangePassword()&&p.showPopup(m,[{iAccountId:g.editedId(),sModule:b.ServerModuleName,bHasOldPassword:!0}])},e.exports=new v},Huhx:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("Yjhd"),l=s("JFZZ"),h=s("SQrT"),c=s("o0Bx"),u=s("76Kh"),d=s("czxF"),p=s("nQVw"),m=s("jonm"),g=s("4+IO"),f=s("p2hp"),b=s("DM8i");function y(){d.call(this),this.iAccountId=0,this.loading=n.observable(!1),this.newFolderCreating=n.observable(!1),this.incomingLogin=n.observable(""),this.incomingPassword=n.observable(""),this.oIncoming=new b(110,995,"fectcher_add_incoming",r.i18n("MAILWEBCLIENT/LABEL_POP3_SERVER")),this.folder=n.observable(""),this.options=n.observableArray([]),g.folderList.subscribe((function(){this.populateOptions()}),this),this.addNewFolderCommand=a.createCommand(this,this.onAddNewFolderClick),this.leaveMessagesOnServer=n.observable(!1),this.loginIsSelected=n.observable(!1),this.passwordIsSelected=n.observable(!1),this.defaultOptionsAfterRender=a.defaultOptionsAfterRender}i.extendOwn(y.prototype,d.prototype),y.prototype.PopupTemplate="MailWebclient_Settings_CreateFetcherPopup",y.prototype.onOpen=function(e){this.iAccountId=e,this.bShown=!0,this.populateOptions(),this.incomingLogin(""),this.incomingPassword(""),this.oIncoming.clear(),this.folder(""),this.leaveMessagesOnServer(!0)},y.prototype.populateOptions=function(){this.bShown&&this.options(g.folderList().getOptions("",!0,!1,!1))},y.prototype.onClose=function(){this.bShown=!1},y.prototype.save=function(){if(this.isEmptyRequiredFields())h.showError(r.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"));else{var e={AccountId:this.iAccountId,Folder:this.folder(),IncomingServer:this.oIncoming.server(),IncomingPort:this.oIncoming.getIntPort(),IncomingUseSsl:this.oIncoming.ssl(),IncomingLogin:o.trim(this.incomingLogin()),IncomingPassword:o.trim(this.incomingPassword()),LeaveMessagesOnServer:this.leaveMessagesOnServer()};this.loading(!0),c.send(f.FetchersServerModuleName,"CreateFetcher",e,this.onCreateFetcherResponse,this)}},y.prototype.onCreateFetcherResponse=function(e,t){this.loading(!1),e.Result?(m.populateFetchers(),this.closePopup()):l.showErrorByCode(e,r.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},y.prototype.cancelPopup=function(){this.newFolderCreating()||this.closePopup()},y.prototype.isEmptyRequiredFields=function(){switch(""){case this.oIncoming.server():return this.oIncoming.server.focused(!0),!0;case o.trim(this.incomingLogin()):return this.loginIsSelected(!0),!0;case o.trim(this.incomingPassword()):return this.passwordIsSelected(!0),!0;default:return!1}},y.prototype.onAddNewFolderClick=function(){this.newFolderCreating(!0),u.showPopup(p,[i.bind(this.chooseFolderInList,this)])},y.prototype.chooseFolderInList=function(e,t){var s=g.folderList().sDelimiter,o=[];""!==e&&""!==t&&(this.options(g.folderList().getOptions("",!0,!1,!1)),i.each(this.options(),i.bind((function(i){e===i.name&&((o=i.fullName.split(s)).pop(),t===o.join(s)&&this.folder(i.fullName))}),this))),this.newFolderCreating(!1)},e.exports=new y},"Ig+v":function(e,t,s){var i=s("0h2I"),o=s("QaF5");function n(e){this.sName="",this.visible=i.observable(!0),this.baseHash=i.observable(""),this.hash=i.observable(""),this.linkText=i.observable(e),this.isCurrent=i.observable(!1),this.recivedAnim=i.observable(!1).extend({autoResetToFalse:500}),this.unseenCount=i.observable(0),this.allowChangeTitle=i.observable(!1),this.inactiveTitle=i.observable(""),this.excludedHashes=i.observableArray([])}n.prototype.ViewTemplate="CoreWebclient_HeaderItemView",n.prototype.setName=function(e){this.sName=e.toLowerCase(),""===this.baseHash()?(this.hash(o.buildHashFromArray([e.toLowerCase()])),this.baseHash(this.hash())):this.hash(this.baseHash())},e.exports=n},KARm:function(e,t,s){"use strict";var i=s("F/us"),o=s("cyfa");function n(){this.aCollection=[]}n.prototype.parse=function(e){var t=e?e["@Collection"]:[];this.aCollection=[],i.isArray(t)&&(this.aCollection=i.map(t,(function(e){var t=new o;return t.parse(e),t})))},n.prototype.addCollection=function(e){i.each(e,(function(e){i.find(this.aCollection,(function(t){return e.sEmail===t.sEmail}))||this.aCollection.push(e)}),this)},n.prototype.excludeCollection=function(e){i.each(e,(function(e){this.aCollection=i.filter(this.aCollection,(function(t){return e.sEmail.toLowerCase()!==t.sEmail.toLowerCase()}))}),this)},n.prototype.getFirstEmail=function(){return this.aCollection.length>0?this.aCollection[0].getEmail():""},n.prototype.getFirstName=function(){return this.aCollection.length>0?this.aCollection[0].getName():""},n.prototype.getFirstDisplay=function(){return this.aCollection.length>0?this.aCollection[0].getDisplay():""},n.prototype.getDisplay=function(e,t){return i.map(this.aCollection,(function(s){return e&&t===s.sEmail?e:s.getDisplay(e)})).join(", ")},n.prototype.getFull=function(){return i.map(this.aCollection,(function(e){return e.getFull()})).join(", ")},n.prototype.getEmails=function(){return i.map(this.aCollection,(function(e){return e.getEmail()}))},e.exports=n},LC8E:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("AFLV"),a=s("HLSX"),l=s("OgeD"),h=s("hPb3"),c=l.run("SettingsWebclient","getAbstractSettingsFormViewClass"),u=s("jxK9"),d=s("p2hp");function p(){c.call(this,d.ServerModuleName),this.bRtl=h.IsRTL,this.bAllowMailto=d.AllowAppRegisterMailto&&(a.firefox||a.chrome),this.bAllowShowMessagesCountInFolderList=d.AllowShowMessagesCountInFolderList,this.bAllowHorizontalLayout=d.AllowHorizontalLayout,this.mailsPerPageValues=o.observableArray(r.getAdaptedPerPageList(d.MailsPerPage)),this.aLayoutValues=[{text:n.i18n("MAILWEBCLIENT/LABEL_VERT_SPLIT_LAYOUT"),value:!1},{text:n.i18n("MAILWEBCLIENT/LABEL_HORIZ_SPLIT_LAYOUT"),value:!0}],this.mailsPerPage=o.observable(d.MailsPerPage),this.allowAutosaveInDrafts=o.observable(d.AllowAutosaveInDrafts),this.allowChangeInputDirection=o.observable(d.AllowChangeInputDirection),this.showMessagesCountInFolderList=o.observable(d.showMessagesCountInFolderList()),this.horizontalLayout=o.observable(d.HorizontalLayout)}i.extendOwn(p.prototype,c.prototype),p.prototype.ViewTemplate="MailWebclient_Settings_MailSettingsFormView",p.prototype.registerMailto=function(){u.registerMailto()},p.prototype.getCurrentValues=function(){return[this.mailsPerPage(),this.allowAutosaveInDrafts(),this.allowChangeInputDirection(),this.showMessagesCountInFolderList(),this.horizontalLayout()]},p.prototype.revertGlobalValues=function(){this.mailsPerPage(d.MailsPerPage),this.allowAutosaveInDrafts(d.AllowAutosaveInDrafts),this.allowChangeInputDirection(d.AllowChangeInputDirection),this.showMessagesCountInFolderList(d.showMessagesCountInFolderList()),this.horizontalLayout(d.HorizontalLayout)},p.prototype.getParametersForSave=function(){return{MailsPerPage:this.mailsPerPage(),AllowAutosaveInDrafts:this.allowAutosaveInDrafts(),AllowChangeInputDirection:this.allowChangeInputDirection(),ShowMessagesCountInFolderList:this.showMessagesCountInFolderList(),HorizontalLayout:this.horizontalLayout()}},p.prototype.applySavedValues=function(e){e.HorizontalLayout!==d.HorizontalLayout&&window.location.reload(),d.update(e.MailsPerPage,e.AllowAutosaveInDrafts,e.AllowChangeInputDirection,e.ShowMessagesCountInFolderList)},p.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new p},MHRZ:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("HLSX"),l=s("76Kh"),h=s("czxF"),c=s("5H03"),u=s("NTez");function d(){h.call(this),u.call(this),this.minimized=n.observable(!1),this.fPreventBackspace=function(e){var t=e.which===o.ui.keyCode.BACKSPACE,s="INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName,i="DIV"===e.target.tagName&&"true"===o(e.target).attr("contenteditable");!t||s||i||(e.preventDefault(),e.stopPropagation())},this.minimized.subscribe((function(){this.minimized()?this.preventBackspaceOff():this.shown()&&this.preventBackspaceOn()}),this),this.minimizedTitle=n.computed((function(){return this.subject()||r.i18n("MAILWEBCLIENT/HEADING_MINIMIZED_NEW_MESSAGE")}),this)}i.extendOwn(d.prototype,h.prototype),i.extendOwn(d.prototype,u.prototype),d.prototype.PopupTemplate="MailWebclient_ComposePopup",d.prototype.preventBackspaceOn=function(){o(document).on("keydown",this.fPreventBackspace)},d.prototype.preventBackspaceOff=function(){o(document).off("keydown",this.fPreventBackspace)},d.prototype.onClose=function(){this.preventBackspaceOff()},d.prototype.onOpen=function(e){if(1===(e=e||[]).length&&"close"===e[0])this.closePopup();else{var t=3===e.length&&"drafts"===e[0]&&e[2]===this.draftUid(),s=this.minimized();this.maximize(),this.shown()||s?(e.length>0&&!t?this.hasUnsavedChanges()?(this.disableAutosave(!0),l.showPopup(c,[i.bind((function(t){switch(t){case Enums.AnotherMessageComposedAnswer.Discard:this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.SaveAsDraft:this.hasUnsavedChanges()&&this.executeSave(!0,!1),this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.Cancel:}this.disableAutosave(!1)}),this)])):this.onRoute(e):s||this.onRoute(e),this.oHtmlEditor.clearUndoRedo()):this.onRoute(e),this.preventBackspaceOn()}},d.prototype.minimize=function(){this.minimized(!0),this.$popupDom.addClass("minimized")},d.prototype.maximize=function(){this.minimized(!1),this.$popupDom.removeClass("minimized")},d.prototype.saveAndClose=function(){this.hasUnsavedChanges()&&this.saveCommand(),this.closePopup()},d.prototype.cancelPopup=function(){this.hasUnsavedChanges()?this.minimize():this.closePopup()},d.prototype.onEscHandler=function(e){var t=this.oHtmlEditor.hasOpenedPopup(),s=!a.ie&&e.target&&"input"===e.target.tagName.toLowerCase()&&"file"===e.target.type.toLowerCase();s&&e.target.blur(),!l.hasOnlyOneOpenedPopup()||t||s||this.minimize(),t&&this.oHtmlEditor.closeAllPopups()},e.exports=new d},MSV7:function(e,t,s){"use strict";var i=s("F/us"),o=s("czxF"),n=s("jonm"),r=s("vsma"),a=s("VgCI");function l(){o.call(this),this.oIdentitySettingsFormView=new a(this,!0)}i.extendOwn(l.prototype,o.prototype),l.prototype.PopupTemplate="MailWebclient_Settings_CreateIdentityPopup",l.prototype.onOpen=function(e){var t=n.getAccount(e),s=new r;s.accountId(e),s.email(t.email()),this.oIdentitySettingsFormView.onShow(s),this.oIdentitySettingsFormView.populate(),this.oIdentitySettingsFormView.friendlyNameHasFocus(!0)},e.exports=new l},NTez:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("Ol7c"),a=s("QFUI"),l=s("RN+F"),h=s("AFLV"),c=s("Yjhd"),u=s("IAk5"),d=s("HLSX"),p=s("mjrp"),m=s("OgeD"),g=s("QaF5"),f=s("SQrT"),b=s("hPb3"),y=s("ZCBP"),v=s("xcwT"),A=s("76Kh"),F=s("1grR"),S=m.run("FilesWebclient","getSelectFilesPopup"),E=s("4M/5"),I=s("Cq+9"),C=s("jonm"),M=s("o0Bx"),T=s("UN2P"),L=s("4+IO"),w=s("dKfC"),R=s("UvKh"),N=s("p2hp"),D=s("Nfk5"),P=s("XTZw"),O=s("a28q"),x=u.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,U=o("html");function B(){v.call(this,"MailWebclient"),this.browserTitle=n.computed((function(){return C.getEmail()+" - "+l.i18n("MAILWEBCLIENT/HEADING_COMPOSE_BROWSER_TAB")}));var e=this;this.toAddrDom=n.observable(),this.toAddrDom.subscribe((function(){this.initInputosaurus(this.toAddrDom,this.toAddr,this.lockToAddr,"to")}),this),this.ccAddrDom=n.observable(),this.ccAddrDom.subscribe((function(){this.initInputosaurus(this.ccAddrDom,this.ccAddr,this.lockCcAddr,"cc")}),this),this.bccAddrDom=n.observable(),this.bccAddrDom.subscribe((function(){this.initInputosaurus(this.bccAddrDom,this.bccAddr,this.lockBccAddr,"bcc")}),this),this.folderList=L.folderList,this.folderList.subscribe((function(){this.getMessageOnRoute()}),this),this.bNewTab=u.isNewTab(),this.bDemo=b.IsDemo,this.sending=n.observable(!1),this.saving=n.observable(!1),this.oHtmlEditor=new O(!1,this),this.visibleBcc=n.observable(!1),this.visibleBcc.subscribe((function(){U.toggleClass("screen-compose-bcc",this.visibleCc()),i.defer(i.bind((function(){o(this.bccAddrDom()).inputosaurus("resizeInput")}),this))}),this),this.visibleCc=n.observable(!1),this.visibleCc.subscribe((function(){U.toggleClass("screen-compose-cc",this.visibleCc()),i.defer(i.bind((function(){o(this.ccAddrDom()).inputosaurus("resizeInput")}),this))}),this),this.sendReadingConfirmation=n.observable(!1).extend({reversible:!0}),this.composeUploaderButton=n.observable(null),this.composeUploaderButton.subscribe((function(){this.initUploader()}),this),this.composeUploaderDropPlace=n.observable(null),this.composeUploaderBodyDragOver=n.observable(!1),this.composeUploaderDragOver=n.observable(!1),this.allowDragNDrop=n.observable(!1),this.uploaderBodyDragOver=n.computed((function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()}),this),this.uploaderDragOver=n.computed((function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()}),this),this.selectedImportance=n.observable(Enums.Importance.Normal).extend({reversible:!0}),this.senderAccountId=R.senderAccountId,this.senderList=R.senderList,this.visibleFrom=n.computed((function(){return this.senderList().length>1}),this),this.selectedSender=R.selectedSender,this.selectedFetcherOrIdentity=R.selectedFetcherOrIdentity,this.selectedFetcherOrIdentity.subscribe((function(){this.oHtmlEditor.isEditing()||this.oHtmlEditor.clearUndoRedo()}),this),this.signature=n.observable(""),this.prevSignature=n.observable(null),n.computed((function(){var e=I.getClearSignature(this.senderAccountId(),this.selectedFetcherOrIdentity());null===this.prevSignature()?(this.prevSignature(e),this.signature(e)):(this.prevSignature(this.signature()),this.signature(e),this.oHtmlEditor.changeSignatureContent(this.signature(),this.prevSignature()))}),this),this.lockToAddr=n.observable(!1),this.toAddr=n.observable("").extend({reversible:!0}),this.toAddr.subscribe((function(){this.lockToAddr()||(o(this.toAddrDom()).val(this.toAddr()),o(this.toAddrDom()).inputosaurus("refresh"))}),this),this.lockCcAddr=n.observable(!1),this.ccAddr=n.observable("").extend({reversible:!0}),this.ccAddr.subscribe((function(){this.lockCcAddr()||(o(this.ccAddrDom()).val(this.ccAddr()),o(this.ccAddrDom()).inputosaurus("refresh"))}),this),this.lockBccAddr=n.observable(!1),this.bccAddr=n.observable("").extend({reversible:!0}),this.bccAddr.subscribe((function(){this.lockBccAddr()||(o(this.bccAddrDom()).val(this.bccAddr()),o(this.bccAddrDom()).inputosaurus("refresh"))}),this),this.recipientEmails=n.computed((function(){var e=[this.toAddr(),this.ccAddr(),this.bccAddr()].join(",").split(","),t=[];return i.each(e,(function(e){var s=o.trim(e),i=null;""!==s&&(i=r.getEmailParts(s)).email&&t.push(i.email)})),t}),this),this.subject=n.observable("").extend({reversible:!0}),this.plainText=n.observable(!1),this.textBody=n.observable(""),this.textBody.subscribe((function(e){this.oHtmlEditor.setText(this.textBody(),this.plainText()),this.oHtmlEditor.commit()}),this),this.focusedField=n.observable(),this.oHtmlEditor.textFocused.subscribe((function(e){this.oHtmlEditor.textFocused()&&this.focusedField("text")}),this),this.subjectFocused=n.observable(!1),this.subjectFocused.subscribe((function(){this.subjectFocused()&&this.focusedField("subject")}),this),this.templateUid=n.observable(""),this.templateFolderName=n.observable(L.getTemplateFolder()),this.draftUid=n.observable(""),this.draftUid.subscribe((function(){L.editedDraftUid(this.draftUid())}),this),this.draftInfo=n.observableArray([]),this.routeType=n.observable(""),this.routeParams=n.observableArray([]),this.inReplyTo=n.observable(""),this.references=n.observable(""),this.bUploadStatus=!1,this.iUploadAttachmentsTimer=0,this.messageUploadAttachmentsStarted=n.observable(!1),this.messageUploadAttachmentsStarted.subscribe((function(t){window.clearTimeout(e.iUploadAttachmentsTimer),t?e.iUploadAttachmentsTimer=window.setTimeout((function(){e.bUploadStatus=!0,f.showLoading(l.i18n("MAILWEBCLIENT/INFO_ATTACHMENTS_LOADING"))}),4e3):e.bUploadStatus?e.iUploadAttachmentsTimer=window.setTimeout((function(){e.bUploadStatus=!1,f.hideLoading()}),1e3):f.hideLoading()}),this),this.attachments=n.observableArray([]),this.attachmentsChanged=n.observable(!1),this.attachments.subscribe((function(){this.attachmentsChanged(!0)}),this),this.notUploadedAttachments=n.computed((function(){return i.filter(this.attachments(),(function(e){return!e.uploaded()}))}),this),this.allAttachmentsUploaded=n.computed((function(){return 0===this.notUploadedAttachments().length&&!this.messageUploadAttachmentsStarted()}),this),this.notInlineAttachments=n.computed((function(){return i.filter(this.attachments(),(function(e){return!e.linked()}))}),this),this.notInlineAttachments.subscribe((function(){U.toggleClass("screen-compose-attachments",this.notInlineAttachments().length>0)}),this),this.allowStartSending=n.computed((function(){return!this.saving()}),this),this.allowStartSending.subscribe((function(){this.allowStartSending()&&this.requiresPostponedSending()&&(I.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))}),this),this.requiresPostponedSending=n.observable(!1),this.oJua=null,this.isDraftsCleared=n.observable(!1),this.backToListOnSendOrSave=n.observable(!1),this.composeShown=n.computed((function(){return!!this.opened&&this.opened()||!!this.shown&&this.shown()}),this),this.toolbarControllers=n.observableArray([]),this.disableHeadersEdit=n.computed((function(){var e=!1;return i.each(this.toolbarControllers(),(function(t){e=e||!!t.disableHeadersEdit&&t.disableHeadersEdit()})),e}),this),n.computed((function(){var e=!1;i.each(this.toolbarControllers(),(function(t){e=e||!!t.disableBodyEdit&&t.disableBodyEdit()})),this.oHtmlEditor.setDisableEdit(e)}),this),this.draftFolderIsAvailable=n.computed((function(){return!!L.folderList().draftsFolder()}),this),this.disableAutosave=n.observable(!1),N.AllowAutosaveInDrafts&&N.AutoSaveIntervalSeconds>0&&(this.iAutosaveInterval=-1,n.computed((function(){var e=this.draftFolderIsAvailable()&&this.composeShown()&&!this.sending()&&!this.saving()&&!this.disableAutosave()&&!L.disableComposeAutosave();i.each(this.toolbarControllers(),(function(t){e=e&&!(t.disableAutosave&&t.disableAutosave())})),window.clearInterval(this.iAutosaveInterval),e&&(this.iAutosaveInterval=window.setInterval(i.bind(this.executeSave,this,!0),1e3*N.AutoSaveIntervalSeconds))}),this)),this.backToListCommand=c.createCommand(this,this.executeBackToList),this.sendCommand=c.createCommand(this,this.executeSend,this.isEnableSending),this.saveCommand=c.createCommand(this,this.executeSaveCommand,this.isEnableSaving),this.visibleSaveTemplateControl=n.observable(!1),this.saveTemplateCommand=c.createCommand(this,this.executeTemplateSaveCommand,this.isEnableSaving),this.messageFields=n.observable(null),this.bottomPanel=n.observable(null),this.sHotkeysHintsViewTemplate=d.mobileDevice?"":"MailWebclient_Compose_HotkeysHintsView",this.sPopupButtonsViewTemplate=u.isNewTab()?"":"MailWebclient_Compose_PopupButtonsView",this.aHotkeys=[{value:"Ctrl+Enter",action:l.i18n("MAILWEBCLIENT/LABEL_SEND_HOTKEY"),visible:n.observable(!0)},{value:"Ctrl+S",action:l.i18n("MAILWEBCLIENT/LABEL_SAVE_HOTKEY"),visible:this.draftFolderIsAvailable},{value:"Ctrl+Z",action:l.i18n("MAILWEBCLIENT/LABEL_UNDO_HOTKEY"),visible:n.observable(!0)},{value:"Ctrl+Y",action:l.i18n("MAILWEBCLIENT/LABEL_REDO_HOTKEY"),visible:n.observable(!0)},{value:"Ctrl+K",action:l.i18n("MAILWEBCLIENT/LABEL_LINK_HOTKEY"),visible:n.observable(!0)},{value:"Ctrl+B",action:l.i18n("MAILWEBCLIENT/LABEL_BOLD_HOTKEY"),visible:n.observable(!0)},{value:"Ctrl+I",action:l.i18n("MAILWEBCLIENT/LABEL_ITALIC_HOTKEY"),visible:n.observable(!0)},{value:"Ctrl+U",action:l.i18n("MAILWEBCLIENT/LABEL_UNDERLINE_HOTKEY"),visible:n.observable(!0)}],this.bAllowFiles=!!S,this.ignoreHasUnsavedChanges=n.observable(!1),this.changedInPreviousWindow=n.observable(!1),this.hasUnsavedChanges=n.computed((function(){return!this.ignoreHasUnsavedChanges()&&this.isChanged()&&this.isEnableSaving()}),this),this.saveAndCloseTooltip=n.computed((function(){return this.draftFolderIsAvailable()&&this.hasUnsavedChanges()?l.i18n("MAILWEBCLIENT/ACTION_SAVE_CLOSE"):l.i18n("MAILWEBCLIENT/ACTION_CLOSE")}),this),this.splitterDom=n.observable(),this.headersCompressed=n.observable(!1),this.allowCcBccSwitchers=n.computed((function(){return!this.disableHeadersEdit()&&!this.headersCompressed()}),this),this.registerOwnToolbarControllers(),u.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}i.extendOwn(B.prototype,v.prototype),B.prototype.ViewTemplate=u.isNewTab()?"MailWebclient_ComposeScreenView":"MailWebclient_ComposeView",B.prototype.ViewConstructorName="CComposeView",B.prototype.isEnableSending=function(){var e=0===this.toAddr().length&&0===this.ccAddr().length&&0===this.bccAddr().length;return this.folderList()&&0!==this.folderList().iAccountId&&!this.sending()&&!e&&this.allAttachmentsUploaded()},B.prototype.isEnableSaving=function(){var e=this.folderList()&&0!==this.folderList().iAccountId;return this.composeShown()&&e&&!this.sending()&&!this.saving()},B.prototype.initInputosaurus=function(e,t,s,n){e()&&o(e()).length>0&&o(e()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:m.run("ContactsWebclient","getSuggestionsAutocompleteCallback",["all","",!0])||function(){},autoCompleteDeleteItem:m.run("ContactsWebclient","getSuggestionsAutocompleteDeleteHandler")||function(){},autoCompleteAppendTo:o(e()).closest("td"),change:i.bind((function(e){s(!0),this.setRecipient(t,e.target.value),s(!1)}),this),copy:i.bind((function(e){this.inputosaurusBuffer=e}),this),paste:i.bind((function(){var e=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",e}),this),focus:i.bind(this.focusedField,this,n),mobileDevice:d.mobileDevice})},B.prototype.changeHeadersCompressed=function(){this.headersCompressed(!this.headersCompressed())},B.prototype.onBind=function(){m.run("SessionTimeoutWeblient","registerFunction",[i.bind(this.executeSave,this,!1)]),u.isMobile()||this.hotKeysBind()},B.prototype.hotKeysBind=function(){(this.$popupDom||this.$viewDom).on("keydown",o.proxy((function(e){if(e&&e.ctrlKey&&!e.altKey&&!e.shiftKey){var t=e.keyCode,s=this.composeShown()&&(!this.minimized||!this.minimized())&&e&&e.ctrlKey;s&&t===Enums.Key.s?(e.preventDefault(),e.returnValue=!1,this.isEnableSaving()&&this.saveCommand()):s&&t===Enums.Key.Enter&&""!==this.toAddr()&&this.sendCommand()}}),this))},B.prototype.getMessageOnRoute=function(){var e=E.parseCompose(this.routeParams());""!==this.routeType()&&e.MessageFolderName&&e.MessageUid&&L.getMessage(e.MessageFolderName,e.MessageUid,this.onMessageResponse,this)},B.prototype.onShow=function(){var e=this.focusedField();o(this.splitterDom()).trigger("resize"),o(this.bottomPanel()).trigger("resize"),this.oHtmlEditor.init(this.textBody(),this.plainText(),"7"),this.oHtmlEditor.commit(),this.initUploader(),this.backToListOnSendOrSave(!1),this.focusedField(e),U.addClass("screen-compose"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0),this.visibleSaveTemplateControl(L.getCurrentTemplateFolders().length>0)},B.prototype.reset=function(){this.plainText(!1),this.bUploadStatus=!1,window.clearTimeout(this.iUploadAttachmentsTimer),this.messageUploadAttachmentsStarted(!1),this.templateUid(""),this.templateFolderName(L.getTemplateFolder()),this.draftUid(""),this.draftInfo.removeAll(),this.setDataFromMessage(new D),this.isDraftsCleared(!1),this.ignoreHasUnsavedChanges(!1)},B.prototype.onRoute=function(e){var t=E.parseCompose(e);switch(C.changeCurrentAccountByHash(t.AccountHash),this.reset(),this.routeType(t.RouteType),this.routeType()){case Enums.ReplyType.ForwardAsAttach:this.routeParams(e),this.fillDefault(t);case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:case Enums.ReplyType.Resend:case Enums.ReplyType.Forward:case"drafts":this.routeParams(e),0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;case"data":var s=t.Object;if(s){s.to&&this.setRecipient(this.toAddr,s.to),s.subject&&this.subject(s.subject),s.isHtml||this.plainText(!0);var i="<div></div>";s.body&&(console.log("oData.body: ",s.body),i=s.isHtml?"<div>"+s.body+"</div>":s.body,this.textBody(i)),this.triggerToolbarControllersAfterPopulatingMessage(!0,!s.isHtml,i)}break;default:this.routeParams(e),this.fillDefault(t)}},B.prototype.fillDefault=function(e){var t=I.getSignatureText(this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),s=x?x.getComposedMessage(window.name):null,o=e.ToAddr;s?(this.setMessageDataInNewTab(s),this.changedInPreviousWindow()&&i.defer(i.bind(this.executeSave,this,!0))):""!==t&&this.textBody("<br /><br />"+t+"<br />"),o&&(this.setRecipient(this.toAddr,o.to),o.hasMailto&&(this.subject(o.subject),this.setRecipient(this.ccAddr,o.cc),this.setRecipient(this.bccAddr,o.bcc),""!==o.body&&this.textBody("<div>"+o.body+"</div>"))),this.routeType()===Enums.ReplyType.ForwardAsAttach&&e.Object&&this.addMessageAsAttachment(e.Object),"attachments"===this.routeType()&&e.Object&&this.addAttachments(e.Object),i.defer(i.bind((function(){this.focusAfterFilling()}),this)),this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0)},B.prototype.focusToAddr=function(){o(this.toAddrDom()).inputosaurus("focus")},B.prototype.focusCcAddr=function(){o(this.ccAddrDom()).inputosaurus("focus")},B.prototype.focusBccAddr=function(){o(this.bccAddrDom()).inputosaurus("focus")},B.prototype.focusAfterFilling=function(){switch(this.focusedField()){case"to":this.focusToAddr();break;case"cc":this.visibleCc(!0),this.focusCcAddr();break;case"bcc":this.visibleBcc(!0),this.focusBccAddr();break;case"subject":this.subjectFocused(!0);break;case"text":this.oHtmlEditor.setFocus();break;default:0===this.toAddr().length?this.focusToAddr():0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()}},B.prototype.onHide=function(){!i.isFunction(this.closePopup)&&this.hasUnsavedChanges()&&this.executeSave(!0),this.headersCompressed(!1),this.routeParams([]),this.subjectFocused(!1),this.focusedField(""),this.messageUploadAttachmentsStarted(!1),U.removeClass("screen-compose").removeClass("screen-compose-cc").removeClass("screen-compose-bcc").removeClass("screen-compose-attachments"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},B.prototype.setRecipient=function(e,t){e()===t?e.valueHasMutated():e(t)},B.prototype.onMessageResponse=function(e){var t=null;if(null===e)this.setDataFromMessage(new D);else{switch(this.routeType()){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:R.setFetcherOrIdentityByReplyMessage(e),t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.setRecipient(this.bccAddr,t.Bcc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.ForwardAsAttach:t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Forward:R.setFetcherOrIdentityByReplyMessage(e),t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Resend:this.setDataFromMessage(e);break;case"drafts":-1!==o.inArray(e.folder(),L.getCurrentTemplateFolders())?(this.templateUid(e.uid()),this.templateFolderName(e.folder())):this.draftUid(e.uid()),this.setDataFromMessage(e)}this.routeType()!==Enums.ReplyType.ForwardAsAttach&&this.attachments().length>0&&this.requestAttachmentsTempName(),this.routeType("")}this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0),i.defer(i.bind((function(){this.focusAfterFilling()}),this))},B.prototype.setDataFromMessage=function(e){var t="",s=I.getFirstFetcherOrIdentityByRecipientsOrDefault(e.oFrom.aCollection,e.accountId());R.changeSenderAccountId(e.accountId(),s),t=e.isPlain()?e.textRaw():e.getConvertedHtml(),this.draftInfo(e.draftInfo()),this.inReplyTo(e.inReplyTo()),this.references(e.references()),this.setRecipient(this.toAddr,e.oTo.getFull()),this.setRecipient(this.ccAddr,e.oCc.getFull()),this.setRecipient(this.bccAddr,e.oBcc.getFull()),this.subject(e.subject()),this.attachments(e.attachments()),this.plainText(e.isPlain()),this.textBody(t),this.selectedImportance(e.importance()),this.sendReadingConfirmation(""!==e.readingConfirmationAddressee());var i=!!e.folderObject()&&e.folderObject().type()===Enums.FolderTypes.Drafts;this.triggerToolbarControllersAfterPopulatingMessage(i,e.isPlain(),e.textRaw(),e.sensitivity())},B.prototype.triggerToolbarControllersAfterPopulatingMessage=function(e,t,s,o){i.each(this.toolbarControllers(),(function(n){i.isFunction(n.doAfterPopulatingMessage)&&n.doAfterPopulatingMessage({bDraft:e,bPlain:t,sRawText:s,iSensitivity:o})}))},B.prototype.onDataAsAttachmentUpload=function(e,t){var s=t.Parameters,o=e.Result,n=s.Hash,r=i.find(this.attachments(),(function(e){return e.hash()===n}));this.messageUploadAttachmentsStarted(!1),r&&(o&&o.Attachment?r.parseFromUpload(o.Attachment):r.errorFromUpload())},B.prototype.addAttachments=function(e){i.each(e,i.bind((function(e){var t=new P;t.parseFromUpload(e),this.attachments.push(t)}),this))},B.prototype.addFilesAsAttachment=function(e){var t=null,s=[];i.each(e,(function(e){(t=new P).fileName(e.fileName()),t.hash(e.hash()),t.thumbUrlInQueue(e.thumbUrlInQueue()),t.uploadStarted(!0),this.attachments.push(t),s.push(e.hash())}),this),s.length>0&&(this.messageUploadAttachmentsStarted(!0),M.send("Files","GetFilesForUpload",{Hashes:s},this.onFilesUpload,this))},B.prototype.onFilesUpload=function(e,t){var s=t.Parameters,o=e.Result,n=s.Hashes;this.messageUploadAttachmentsStarted(!1),i.isArray(o)?i.each(o,(function(e){var t=i.find(this.attachments(),(function(t){return t.hash()===e.Hash}));t&&(t.parseFromUpload(e),t.hash(e.NewHash))}),this):i.each(n,(function(e){var t=i.find(this.attachments(),(function(t){return t.hash()===e}));t&&t.errorFromUpload()}),this)},B.prototype.addMessageAsAttachment=function(e){var t=new P,s=null;e&&(t.fileName(e.subject()+".eml"),t.uploadStarted(!0),this.attachments.push(t),s={MessageFolder:e.folder(),MessageUid:e.uid(),FileName:t.fileName()},this.messageUploadAttachmentsStarted(!0),T.send("SaveMessageAsTempFile",s,this.onSaveMessageAsTempFile,this))},B.prototype.onSaveMessageAsTempFile=function(e,t){var s=e.Result,o=t.Parameters.FileName,n=null;this.messageUploadAttachmentsStarted(!1),s?(n=i.find(this.attachments(),(function(e){return e.fileName()===o&&e.uploadStarted()})))&&n.parseFromUpload(s,t.Parameters.MessageFolder,t.Parameters.MessageUid):(n=i.find(this.attachments(),(function(e){return e.fileName()===o&&e.uploadStarted()})))&&n.errorFromUpload()},B.prototype.onContactVCardUpload=function(e,t){var s=t.Parameters,o=e.Result,n=null;this.messageUploadAttachmentsStarted(!1),o?(n=i.find(this.attachments(),(function(e){return e.fileName()===o.Name&&e.uploadStarted()})))&&n.parseFromUpload(o):(n=i.find(this.attachments(),(function(e){return e.fileName()===s.Name&&e.uploadStarted()})))&&n.errorFromUpload()},B.prototype.requestAttachmentsTempName=function(){var e=i.map(this.attachments(),(function(e){return e.uploadUid(e.hash()),e.uploadStarted(!0),e.hash()}));e.length>0&&(this.messageUploadAttachmentsStarted(!0),T.send("SaveAttachmentsAsTempFiles",{Attachments:e},this.onMessageUploadAttachmentsResponse,this))},B.prototype.onMessageUploadAttachmentsResponse=function(e,t){var s=t.Parameters.Attachments;this.messageUploadAttachmentsStarted(!1),e.Result?i.each(e.Result,i.bind(this.setAttachTepmNameByHash,this)):(i.each(s,(function(e){var t=i.find(this.attachments(),(function(t){return t.hash()===e}));t&&t.errorFromUpload()}),this),f.showError(l.i18n("MAILWEBCLIENT/ERROR_UPLOAD_FORWARD_ATTACHMENTS")))},B.prototype.setAttachTepmNameByHash=function(e,t){i.each(this.attachments(),(function(s){s.hash()===e&&(s.tempName(t),s.uploadStarted(!1))}))},B.prototype.setMessageDataInNewTab=function(e){this.templateUid(e.templateUid),this.templateFolderName(e.templateFolderName),this.draftInfo(e.draftInfo),this.draftUid(e.draftUid),this.inReplyTo(e.inReplyTo),this.references(e.references),this.setRecipient(this.toAddr,e.toAddr),this.setRecipient(this.ccAddr,e.ccAddr),this.setRecipient(this.bccAddr,e.bccAddr),this.subject(e.subject),this.attachments(i.map(e.attachments,(function(e){var t=new P;return t.parse(e),t}),this)),this.plainText(e.plainText),this.textBody(e.textBody),this.selectedImportance(e.selectedImportance),this.sendReadingConfirmation(e.sendReadingConfirmation),this.changedInPreviousWindow(e.changedInPreviousWindow),i.each(this.toolbarControllers(),(function(t){i.isFunction(t.doAfterApplyingMainTabParameters)&&t.doAfterApplyingMainTabParameters(e)})),R.changeSenderAccountId(e.senderAccountId,e.selectedFetcherOrIdentity),this.focusedField(e.focusedField)},B.prototype.commit=function(e){this.toAddr.commit(),this.ccAddr.commit(),this.bccAddr.commit(),this.subject.commit(),this.selectedImportance.commit(),this.sendReadingConfirmation.commit(),i.each(this.toolbarControllers(),(function(e){i.isFunction(e.commit)&&e.commit()})),this.oHtmlEditor.commit(),this.attachmentsChanged(!1),e||this.changedInPreviousWindow(!1)},B.prototype.isChanged=function(){var e=this.toAddr.changed(),t=this.ccAddr.changed(),s=this.bccAddr.changed(),o=this.subject.changed(),n=this.selectedImportance.changed(),r=this.sendReadingConfirmation.changed(),a=!1,l=this.oHtmlEditor.textChanged(),h=this.attachmentsChanged(),c=this.changedInPreviousWindow();return i.each(this.toolbarControllers(),(function(e){i.isFunction(e.isChanged)&&(a=a||e.isChanged())})),e||t||s||o||n||r||a||l||h||c},B.prototype.executeBackToList=function(){u.isNewTab()?window.close():this.shown&&this.shown()&&g.setPreviousHash(),this.backToListOnSendOrSave(!1)},B.prototype.onFileUploadSelect=function(e,t){var s;return!a.showErrorIfAttachmentSizeLimit(t.FileName,h.pInt(t.Size))&&((s=new P).onUploadSelect(e,t),this.attachments.push(s),!0)},B.prototype.getAttachmentByUid=function(e){return i.find(this.attachments(),(function(t){return t.uploadUid()===e}))},B.prototype.onFileUploadStart=function(e){var t=this.getAttachmentByUid(e);t&&t.onUploadStart()},B.prototype.onFileUploadProgress=function(e,t,s){var i=this.getAttachmentByUid(e);i&&i.onUploadProgress(t,s)},B.prototype.onFileUploadComplete=function(e,t,s){var i=this.getAttachmentByUid(e);i&&i.onUploadComplete(e,t,s)},B.prototype.onFileRemove=function(e){var t=this.getAttachmentByUid(e);this.oJua&&this.oJua.cancel(e),this.attachments.remove(t)},B.prototype.initUploader=function(){this.composeShown()&&this.composeUploaderButton()&&(this.oJua=new p({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),hiddenElementsPosition:b.IsRTL?"right":"left",dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:i.extendOwn({Module:N.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:L.currentAccountId()})}},u.getCommonRequestParameters())}),this.oJua.on("onDragEnter",i.bind(this.composeUploaderDragOver,this,!0)).on("onDragLeave",i.bind(this.composeUploaderDragOver,this,!1)).on("onBodyDragEnter",i.bind(this.composeUploaderBodyDragOver,this,!0)).on("onBodyDragLeave",i.bind(this.composeUploaderBodyDragOver,this,!1)).on("onProgress",i.bind(this.onFileUploadProgress,this)).on("onSelect",i.bind(this.onFileUploadSelect,this)).on("onStart",i.bind(this.onFileUploadStart,this)).on("onComplete",i.bind(this.onFileUploadComplete,this)),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))},B.prototype.getSendSaveParameters=function(e,t){var s=I.convertAttachmentsForSending(this.attachments()),o=null;return i.each(this.oHtmlEditor.getUploadedImagesData(),(function(e){s[e.TempName]=[e.Name,e.CID,"1","1"]})),o={AccountID:this.senderAccountId(),FetcherID:this.selectedFetcherOrIdentity()&&this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",IdentityID:this.selectedFetcherOrIdentity()&&!this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(e),IsHtml:!this.plainText(),Importance:this.selectedImportance(),SendReadingConfirmation:this.sendReadingConfirmation(),Attachments:s,InReplyTo:this.inReplyTo(),References:this.references()},i.each(this.toolbarControllers(),(function(e){i.isFunction(e.doAfterPreparingSendMessageParameters)&&e.doAfterPreparingSendMessageParameters(o)})),""!==this.templateFolderName()&&t&&(o.DraftFolder=this.templateFolderName(),o.DraftUid=this.templateUid()),o},B.prototype.onSendOrSaveMessageResponse=function(e,t){var s=I.onSendOrSaveMessageResponse(e,t,this.requiresPostponedSending()),o=t.Parameters;switch(this.commit(),s.Method){case"SaveMessage":s.Result&&o.DraftUid===this.templateUid()&&o.DraftFolder===this.templateFolderName()?(this.templateUid(h.pString(s.NewUid)),this.composeShown()&&this instanceof B&&g.replaceHashDirectly(E.getComposeFromMessage("drafts",o.DraftFolder,this.templateUid()))):s.Result&&o.DraftUid===this.draftUid()&&(this.draftUid(h.pString(s.NewUid)),this.composeShown()&&this instanceof B&&g.replaceHashDirectly(E.getComposeFromMessage("drafts",o.DraftFolder,this.draftUid()))),this.saving(!1);break;case"SendMessage":s.Result&&this.backToListOnSendOrSave()&&(i.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()),this.sending(!1)}},B.prototype.verifyDataForSending=function(){var e=r.getIncorrectEmailsFromAddressString(this.toAddr()),t=r.getIncorrectEmailsFromAddressString(this.ccAddr()),s=r.getIncorrectEmailsFromAddressString(this.bccAddr()),o=i.union(e,t,s),n=i.map(o,(function(e){return l.encodeHtml(e)})),a=l.i18n("MAILWEBCLIENT/ERROR_INPUT_CORRECT_EMAILS")+n.join(", ");return!(o.length>0)||(A.showPopup(F,[a]),!1)},B.prototype.executeSend=function(e){var t=!1,s=i.bind((function(){this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),I.send("SendMessage",this.getSendSaveParameters(!0),!0,this.onSendOrSaveMessageResponse,this,this.requiresPostponedSending()),this.backToListOnSendOrSave(!0)}),this);this.isEnableSending()&&this.verifyDataForSending()&&(i.each(this.toolbarControllers(),(function(e){i.isFunction(e.doBeforeSend)&&(t=t||e.doBeforeSend(s))})),t||s())},B.prototype.executeSaveCommand=function(){this.draftFolderIsAvailable()&&this.executeSave(!1)},B.prototype.executeTemplateSaveCommand=function(){this.executeSave(!1,!0,!0)},B.prototype.executeSave=function(e,t,s){e=!!e,s=!!s;var o=(t=void 0===t||t)?this.onSendOrSaveMessageResponse:I.onSendOrSaveMessageResponse,n=t?this:I,r=i.bind((function(i){i&&(this.saving(t),I.send("SaveMessage",this.getSendSaveParameters(!1,s),!e,o,n))}),this),a=!1;this.isEnableSaving()&&(e&&!this.isChanged()||(e||i.each(this.toolbarControllers(),(function(e){i.isFunction(e.doBeforeSave)&&(a=a||e.doBeforeSave(r))}),this),a||r(!0)),this.backToListOnSendOrSave(!0))},B.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc()),this.visibleBcc()?this.focusBccAddr():this.focusToAddr()},B.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc()),this.visibleCc()?this.focusCcAddr():this.focusToAddr()},B.prototype.getMessageDataForNewTab=function(){var e,t=i.map(this.attachments(),(function(e){return{"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Attachment",FileName:e.fileName(),TempName:e.tempName(),MimeType:e.mimeType(),MimePartIndex:e.mimePartIndex(),EstimatedSize:e.size(),CID:e.cid(),ContentLocation:e.contentLocation(),IsInline:e.inline(),IsLinked:e.linked(),Hash:e.hash()}}));return e={accountId:this.senderAccountId(),templateUid:this.templateUid(),templateFolderName:this.templateFolderName(),draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),senderAccountId:this.senderAccountId(),selectedFetcherOrIdentity:this.selectedFetcherOrIdentity(),toAddr:this.toAddr(),ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:t,plainText:this.plainText(),textBody:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),sendReadingConfirmation:this.sendReadingConfirmation(),changedInPreviousWindow:this.isChanged(),focusedField:this.focusedField()},i.each(this.toolbarControllers(),(function(t){i.isFunction(t.doAfterPreparingMainTabParameters)&&t.doAfterPreparingMainTabParameters(e)})),e},B.prototype.openInNewWindow=function(){var e,t="id"+Math.random().toString(),s=g.buildHashFromArray(E.getCompose());this.ignoreHasUnsavedChanges(!0),e=this.getMessageDataForNewTab(),this.draftUid().length>0&&!this.isChanged()?(s=g.buildHashFromArray(E.getComposeFromMessage("drafts",L.folderList().draftsFolderFullName(),this.draftUid(),!0)),y.openTab("?message-newtab"+s)):this.templateUid().length>0&&!this.isChanged()?(s=g.buildHashFromArray(E.getComposeFromMessage("drafts",this.templateFolderName(),this.templateUid(),!0)),y.openTab("?message-newtab"+s)):this.isChanged()?(w.passComposedMessage(t,e),y.openTab("?message-newtab"+s,t)):(this.routeParams().length>0&&(s=g.buildHashFromArray(i.union([N.HashModuleName+"-compose"],this.routeParams()))),y.openTab("?message-newtab"+s)),this.commit(),i.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()},B.prototype.onShowFilesPopupClick=function(){this.bAllowFiles&&A.showPopup(S,[i.bind(this.addFilesAsAttachment,this)])},B.prototype.registerOwnToolbarControllers=function(){this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_BackButtonView",sId:"back",bOnlyMobile:!0,backToListCommand:this.backToListCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SendButtonView",sId:"send",bAllowMobile:!0,sendCommand:this.sendCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SaveButtonView",sId:"save",bAllowMobile:!0,visible:this.draftFolderIsAvailable,saveCommand:this.saveCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SaveTemplateButtonView",sId:"save-template",bAllowMobile:!1,visible:this.visibleSaveTemplateControl,saveTemplateCommand:this.saveTemplateCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ImportanceDropdownView",sId:"importance",selectedImportance:this.selectedImportance}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ConfirmationCheckboxView",sId:"confirmation",sendReadingConfirmation:this.sendReadingConfirmation})},B.prototype.registerToolbarController=function(e){var t=u.isMobile()?e.bAllowMobile:!e.bOnlyMobile,s=N.ComposeToolbarOrder.length;t&&(this.toolbarControllers.push(e),this.toolbarControllers(i.sortBy(this.toolbarControllers(),(function(e){var t=i.indexOf(N.ComposeToolbarOrder,e.sId);return-1!==t?t:s}))),i.isFunction(e.assignComposeExtInterface)&&e.assignComposeExtInterface(this.getExtInterface()))},B.prototype.getExtInterface=function(){return{isHtml:i.bind((function(){return!this.plainText()}),this),hasAttachments:i.bind((function(){return this.notInlineAttachments().length>0}),this),getPlainText:i.bind(this.oHtmlEditor.getPlainText,this.oHtmlEditor),getFromEmail:i.bind((function(){return C.getEmail(this.senderAccountId())}),this),getRecipientEmails:i.bind((function(){return this.recipientEmails()}),this),saveSilently:i.bind(this.executeSave,this,!0),setPlainTextMode:i.bind(this.plainText,this,!0),setPlainText:i.bind((function(e){this.textBody(e)}),this),setHtmlTextMode:i.bind(this.plainText,this,!1),setHtmlText:i.bind((function(e){this.textBody(e)}),this),undoHtml:i.bind(this.oHtmlEditor.undoAndClearRedo,this.oHtmlEditor)}},e.exports=B},NV9q:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("3Y+r"),h=s("JFZZ"),c=s("IAk5"),u=s("UN2P"),d=s("p2hp"),p=s("gAbd"),m=s("DM8i");function g(e,t){this.servers=n.observableArray([]),this.serversRetrieved=n.observable(!1),this.serverOptions=n.observableArray([{Name:r.i18n("MAILWEBCLIENT/LABEL_CONFIGURE_SERVER_MANUALLY"),Id:0}]),this.selectedServerId=n.observable(0),this.oLastEditableServer=new p,this.iEditedServerId=0,this.selectedServerId.subscribe((function(){var e=this.selectedServerId(),t=i.find(this.servers(),(function(t){return t.iId===e}));t?(this.oIncoming.isEnabled()&&(this.oLastEditableServer=new p(this.getParametersForSave())),this.setExternalAccessServers(t.bSetExternalAccessServers),this.externalAccessImapServer(t.sExternalAccessImapServer),this.externalAccessImapPort(t.iExternalAccessImapPort),this.externalAccessSmtpServer(t.sExternalAccessSmtpServer),this.externalAccessSmtpPort(t.iExternalAccessSmtpPort),this.tenantId(t.iTenantId),this.name(t.sName),this.oIncoming.set(t.sIncomingServer,t.iIncomingPort,t.bIncomingUseSsl),this.oIncoming.isEnabled(this.bAdminEdit),this.oOutgoing.set(t.sOutgoingServer,t.iOutgoingPort,t.bOutgoingUseSsl),this.oOutgoing.isEnabled(this.bAdminEdit),this.outgoingUseAuth(t.sSmtpAuthType===window.Enums.SmtpAuthType.UseUserCredentials),this.outgoingUseAuth.enable(this.bAdminEdit),this.domains(t.sDomains),this.smtpAuthType(t.sSmtpAuthType),this.smtpLogin(t.sSmtpLogin),this.smtpPassword(t.sSmtpPassword),this.enableSieve(t.bEnableSieve),this.sievePort(t.iSievePort),this.enableThreading(t.bEnableThreading),this.useFullEmailAddressAsLogin(t.bUseFullEmailAddressAsLogin)):(this.setExternalAccessServers(this.oLastEditableServer.bSetExternalAccessServers),this.externalAccessImapServer(this.oLastEditableServer.sExternalAccessImapServer),this.externalAccessImapPort(this.oLastEditableServer.iExternalAccessImapPort),this.externalAccessSmtpServer(this.oLastEditableServer.sExternalAccessSmtpServer),this.externalAccessSmtpPort(this.oLastEditableServer.iExternalAccessSmtpPort),this.tenantId(0),this.name(this.oLastEditableServer.sName),this.oIncoming.set(this.oLastEditableServer.sIncomingServer,this.oLastEditableServer.iIncomingPort,this.oLastEditableServer.bIncomingUseSsl),this.oIncoming.isEnabled(!0),this.oOutgoing.set(this.oLastEditableServer.sOutgoingServer,this.oLastEditableServer.iOutgoingPort,this.oLastEditableServer.bOutgoingUseSsl),this.oOutgoing.isEnabled(!0),this.outgoingUseAuth(this.oLastEditableServer.sSmtpAuthType===window.Enums.SmtpAuthType.UseUserCredentials),this.outgoingUseAuth.enable(!0),this.domains(""),this.smtpAuthType(window.Enums.SmtpAuthType.UseUserCredentials),this.smtpLogin(""),this.smtpPassword(""),this.enableSieve(!1),this.sievePort(4190),this.enableThreading(!0),this.useFullEmailAddressAsLogin(!0)),this.setCurrentValues()}),this),this.tenantId=n.observable(0),this.name=n.observable(""),this.name.focused=n.observable(!1),this.bAdminEdit=t,this.oIncoming=new m(143,993,e+"_incoming",r.i18n("MAILWEBCLIENT/LABEL_IMAP_SERVER"),t?this.name:null),this.oOutgoing=new m(25,465,e+"_outgoing",r.i18n("MAILWEBCLIENT/LABEL_SMTP_SERVER"),this.oIncoming.server),this.outgoingUseAuth=n.observable(!0),this.outgoingUseAuth.enable=n.observable(!0),this.domains=n.observable(""),this.bAllowEditDomains=d.AllowEditDomainsInServer,this.name.focused.subscribe((function(){this.bAllowEditDomains&&!this.name.focused()&&""===this.domains()&&this.domains(this.name())}),this),this.smtpAuthType=n.observable(window.Enums.SmtpAuthType.UseUserCredentials),this.smtpLogin=n.observable(""),this.smtpPassword=n.observable(""),this.enableSieve=n.observable(!1),this.sievePort=n.observable(4190),this.enableThreading=n.observable(!0),this.useFullEmailAddressAsLogin=n.observable(!0),this.currentValues=n.observable(""),this.aRequiredFields=[this.oIncoming.server,this.oIncoming.port,this.oOutgoing.server,this.oOutgoing.port],t&&this.aRequiredFields.unshift(this.name),this.setExternalAccessServers=n.observable(!1),this.externalAccessImapServer=n.observable(this.oIncoming.server()),this.externalAccessImapPort=n.observable(this.oIncoming.port()),this.externalAccessSmtpServer=n.observable(this.oOutgoing.server()),this.externalAccessSmtpPort=n.observable(this.oOutgoing.port()),n.computed((function(){this.setExternalAccessServers()||(this.externalAccessImapServer(this.oIncoming.server()),this.externalAccessImapPort(this.oIncoming.port()),this.externalAccessSmtpServer(this.oOutgoing.server()),this.externalAccessSmtpPort(this.oOutgoing.port()))}),this)}g.prototype.ViewTemplate="MailWebclient_Settings_ServerPairPropertiesView",g.prototype.serverInit=function(e){this.setServer(e?new p:this.oLastEditableServer)},g.prototype.fullInit=function(){this.setServer(this.oLastEditableServer),this.serversRetrieved()||this.requestServers()},g.prototype.setServer=function(e){this.oLastEditableServer=e,this.setServerId(e.iId)},g.prototype.setServerId=function(e){if(this.serversRetrieved()){var t=0===this.selectedServerId();this.selectedServerId(0),this.selectedServerId(e),t&&0===e&&this.selectedServerId.valueHasMutated()}else this.iEditedServerId=e},g.prototype.requestServers=function(){var e=i.isFunction(c.getTenantId)?c.getTenantId():0;this.serversRetrieved(!1),u.send("GetServers",{TenantId:e},(function(e){if(i.isArray(e.Result)){var t=[{Name:r.i18n("MAILWEBCLIENT/LABEL_CONFIGURE_SERVER_MANUALLY"),Id:0}];i.each(e.Result,(function(e){t.push({Name:e.Name,Id:a.pInt(e.EntityId)})})),this.servers(i.map(e.Result,(function(e){return new p(e)}))),this.serverOptions(t),this.serversRetrieved(!0),this.iEditedServerId&&(this.setServerId(this.iEditedServerId),this.iEditedServerId=0)}else h.showErrorByCode(e)}),this)},g.prototype.clear=function(){this.oIncoming.clear(),this.oOutgoing.clear(),this.outgoingUseAuth(!0)},g.prototype.setCurrentValues=function(){var e=this.bAdminEdit?[this.selectedServerId(),this.name()]:[],t=[this.oIncoming.port(),this.oIncoming.server(),this.oIncoming.ssl(),this.oOutgoing.port(),this.oOutgoing.server(),this.oOutgoing.ssl(),this.outgoingUseAuth(),this.domains(),this.smtpAuthType(),this.smtpLogin(),this.smtpPassword(),this.enableSieve(),this.sievePort(),this.enableThreading(),this.useFullEmailAddressAsLogin(),this.setExternalAccessServers(),this.externalAccessImapServer(),this.externalAccessImapPort(),this.externalAccessSmtpServer(),this.externalAccessSmtpPort()];this.currentValues(e.concat(t).join(":"))},g.prototype.getCurrentValues=function(){return this.setCurrentValues(),[this.currentValues()]},g.prototype.getSmtpAuthType=function(){return this.bAdminEdit||this.smtpAuthType()===window.Enums.SmtpAuthType.UseSpecifiedCredentials?this.smtpAuthType():this.outgoingUseAuth()?window.Enums.SmtpAuthType.UseUserCredentials:window.Enums.SmtpAuthType.NoAuthentication},g.prototype.getParametersForSave=function(){var e=this.selectedServerId(),t=this.oLastEditableServer.iId,s=this.getSmtpAuthType(),n={};return 0!==e||i.find(this.servers(),(function(e){return t===e.iId}))||(e=t),n={ServerId:e,Name:this.bAdminEdit?this.name():this.oIncoming.server(),IncomingServer:this.oIncoming.server(),IncomingPort:this.oIncoming.getIntPort(),IncomingUseSsl:this.oIncoming.ssl(),OutgoingServer:this.oOutgoing.server(),OutgoingPort:this.oOutgoing.getIntPort(),OutgoingUseSsl:this.oOutgoing.ssl(),Domains:this.domains(),SmtpAuthType:s,SmtpLogin:s===window.Enums.SmtpAuthType.UseSpecifiedCredentials?o.trim(this.smtpLogin()):"",SmtpPassword:s===window.Enums.SmtpAuthType.UseSpecifiedCredentials?o.trim(this.smtpPassword()):"",EnableSieve:this.enableSieve(),SievePort:this.sievePort(),EnableThreading:this.enableThreading(),UseFullEmailAddressAsLogin:this.useFullEmailAddressAsLogin(),SetExternalAccessServers:this.setExternalAccessServers()},this.setExternalAccessServers()&&(n.ExternalAccessImapServer=this.externalAccessImapServer(),n.ExternalAccessImapPort=this.externalAccessImapPort(),n.ExternalAccessSmtpServer=this.externalAccessSmtpServer(),n.ExternalAccessSmtpPort=this.externalAccessSmtpPort()),n},g.prototype.validateBeforeSave=function(){return l.checkIfFieldsEmpty(this.aRequiredFields,r.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"))},g.prototype.onDomainsClick=function(){this.bAllowEditDomains||(o(".tabsbar .item.admin.domain").removeClass("recivedAnim"),setTimeout((function(){o(".tabsbar .item.admin.domain").addClass("recivedAnim")})))},e.exports=g},Nfk5:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("wd/R"),a=s("RN+F"),l=s("AFLV"),h=s("ZP6a"),c=s("IAk5"),u=s("SQrT"),d=s("KARm"),p=s("5hOJ"),m=s("zu1m"),g=s("jonm"),f=null,b=s("xzvH"),y=s("XTZw");function v(){this.accountId=n.observable(g.currentId()),this.folder=n.observable(""),this.uid=n.observable(""),this.sUniq="",this.subject=n.observable(""),this.emptySubject=n.computed((function(){return""===o.trim(this.subject())}),this),this.subjectForDisplay=n.computed((function(){return this.emptySubject()?a.i18n("MAILWEBCLIENT/LABEL_NO_SUBJECT"):this.subject()}),this),this.messageId=n.observable(""),this.size=n.observable(0),this.friendlySize=n.computed((function(){return a.getFriendlySize(this.size())}),this),this.textSize=n.observable(0),this.oDateModel=new p,this.fullDate=n.observable(""),this.oFrom=new d,this.fullFrom=n.observable(""),this.oTo=new d,this.to=n.observable(""),this.fromOrToText=n.observable(""),this.oCc=new d,this.cc=n.observable(""),this.oBcc=new d,this.bcc=n.observable(""),this.oReplyTo=new d,this.seen=n.observable(!1),this.flagged=n.observable(!1),this.partialFlagged=n.observable(!1),this.answered=n.observable(!1),this.forwarded=n.observable(!1),this.hasAttachments=n.observable(!1),this.hasIcalAttachment=n.observable(!1),this.hasVcardAttachment=n.observable(!1),this.folderObject=n.computed((function(){return this.requireMailCache(),f.getFolderByFullName(this.accountId(),this.folder())}),this),this.threadsAllowed=n.computed((function(){var e=g.getAccount(this.accountId()),t=this.folderObject(),s=t&&(t.type()===Enums.FolderTypes.Drafts||t.type()===Enums.FolderTypes.Spam||t.type()===Enums.FolderTypes.Trash);return e&&e.threadingIsAvailable()&&!s}),this),this.otherSendersAllowed=n.computed((function(){var e=this.folderObject();return e&&e.type()!==Enums.FolderTypes.Drafts&&e.type()!==Enums.FolderTypes.Sent}),this),this.threadPart=n.observable(!1),this.threadPart.subscribe((function(){this.threadPart()&&this.partialFlagged(!1)}),this),this.threadParentUid=n.observable(""),this.threadUids=n.observableArray([]),this.threadCount=n.computed((function(){return this.threadUids().length}),this),this.threadUnreadCount=n.observable(0),this.threadOpened=n.observable(!1),this.threadLoading=n.observable(!1),this.threadLoadingVisible=n.computed((function(){return this.threadsAllowed()&&this.threadOpened()&&this.threadLoading()}),this),this.threadCountVisible=n.computed((function(){return this.threadsAllowed()&&this.threadCount()>0&&!this.threadLoading()}),this),this.threadCountHint=n.computed((function(){return this.threadCount()>0?this.threadOpened()?a.i18n("MAILWEBCLIENT/ACTION_FOLD_THREAD"):this.threadUnreadCount()>0?a.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD_WITH_UNREAD",{},null,this.threadUnreadCount()):a.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD"):""}),this),this.threadCountForLoad=n.observable(5),this.threadNextLoadingVisible=n.observable(!1),this.threadNextLoadingLinkVisible=n.observable(!1),this.threadFunctionLoadNext=null,this.threadShowAnimation=n.observable(!1),this.threadHideAnimation=n.observable(!1),this.importance=n.observable(Enums.Importance.Normal),this.draftInfo=n.observableArray([]),this.hash=n.observable(""),this.sDownloadAsEmlUrl="",this.completelyFilled=n.observable(!1),this.iLastAccessTime=0,this.updateLastAccessTime(),this.checked=n.observable(!1),this.checked.subscribe((function(e){if(this.requireMailCache(),!this.threadOpened()&&f.useThreadingInCurrentList()){var t=f.folderList().getFolderByFullName(this.folder());i.each(this.threadUids(),(function(s){var i=b.get([t.iAccountId,t.fullName(),s]);i&&i.checked(e)}))}}),this),this.selected=n.observable(!1),this.deleted=n.observable(!1),this.truncated=n.observable(!1),this.inReplyTo=n.observable(""),this.references=n.observable(""),this.readingConfirmationAddressee=n.observable(""),this.sensitivity=n.observable(Enums.Sensitivity.Nothing),this.isPlain=n.observable(!1),this.text=n.observable(""),this.textBodyForNewWindow=n.observable(""),this.$text=null,this.rtl=n.observable(!1),this.hasExternals=n.observable(!1),this.isExternalsShown=n.observable(!1),this.isExternalsAlwaysShown=n.observable(!1),this.foundCids=n.observableArray([]),this.attachments=n.observableArray([]),this.safety=n.observable(!1),this.sourceHeaders=n.observable(""),this.date=n.observable(""),this.textRaw=n.observable(""),this.domMessageForPrint=n.observable(null),this.Custom={}}v.prototype.requireMailCache=function(){null===f&&(f=s("4+IO"))},v.prototype.updateLastAccessTime=function(){this.iLastAccessTime=r().unix(),i.each(this.threadUids(),(function(e){var t=b.get([this.accountId(),this.folder(),e]);t&&t.updateLastAccessTime()}),this)},v.prototype.viewMessage=function(e){var t,s=this.getDomText(h.getAppPath());this.textBodyForNewWindow(s.html()),t=o(this.domMessageForPrint()).html(),e&&(o(e.document.body).html(t),e.focus(),i.each(this.attachments(),(function(t){var s=o(e.document.body).find("[data-hash='download-"+t.hash()+"']");t.hasAction("download")?s.on("click",i.bind(t.executeAction,t,"download")):s.hide(),s=o(e.document.body).find("[data-hash='view-"+t.hash()+"']"),t.hasAction("view")?s.on("click",i.bind(t.executeAction,t,"view")):s.hide()}),this))},v.prototype.fillFromOrToText=function(){this.requireMailCache();var e=f.getFolderByFullName(this.accountId(),this.folder()),t=g.getAccount(this.accountId());e.type()===Enums.FolderTypes.Drafts||e.type()===Enums.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay(a.i18n("MAILWEBCLIENT/LABEL_ME_RECIPIENT"),t.email())):this.fromOrToText(this.oFrom.getDisplay(a.i18n("MAILWEBCLIENT/LABEL_ME_SENDER"),t.email()))},v.prototype.changeThreadUids=function(e,t){this.threadUids(e),this.threadLoading(t<Math.min(this.threadUids().length,this.threadCountForLoad()))},v.prototype.showNextLoadingLink=function(e){this.threadNextLoadingLinkVisible()&&(this.threadNextLoadingVisible(!0),this.threadFunctionLoadNext=e)},v.prototype.increaseThreadCountForLoad=function(){this.threadCountForLoad(this.threadCountForLoad()+5),this.requireMailCache(),f.showOpenedThreads(this.folder())},v.prototype.loadNextMessages=function(){this.threadFunctionLoadNext&&(this.threadFunctionLoadNext(),this.threadNextLoadingLinkVisible(!1),this.threadFunctionLoadNext=null)},v.prototype.markAsThreadPart=function(e,t){var s=this;this.threadPart(!0),this.threadParentUid(t),this.threadUids([]),this.threadNextLoadingVisible(!1),this.threadNextLoadingLinkVisible(!0),this.threadFunctionLoadNext=null,this.threadHideAnimation(!1),setTimeout((function(){s.threadShowAnimation(!0)}),e)},v.prototype.parse=function(e,t,s,o){var n="",r="";o&&this.threadPart(s),this.threadPart()||this.threadParentUid(""),"Object/MessageListItem"===e["@Object"]&&(this.seen(!!e.IsSeen),this.flagged(!!e.IsFlagged),this.answered(!!e.IsAnswered),this.forwarded(!!e.IsForwarded),e.Custom&&(this.Custom=e.Custom)),"Object/Message"!==e["@Object"]&&"Object/MessageListItem"!==e["@Object"]||(this.Custom.Sensitivity=e.Sensitivity,this.accountId(t),this.folder(e.Folder),this.uid(l.pString(e.Uid)),this.sUniq=this.accountId()+this.folder()+this.uid(),this.subject(l.pString(e.Subject)),this.messageId(l.pString(e.MessageId)),this.size(e.Size),this.textSize(e.TextSize),this.oDateModel.parse(e.TimeStampInUTC),this.oFrom.parse(e.From),this.oTo.parse(e.To),this.fillFromOrToText(),this.oCc.parse(e.Cc),this.oBcc.parse(e.Bcc),this.oReplyTo.parse(e.ReplyTo),this.fullDate(this.oDateModel.getFullDate()),this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!e.HasAttachments),this.hasIcalAttachment(!!e.HasIcalAttachment),this.hasVcardAttachment(!!e.HasVcardAttachment),"Object/MessageListItem"===e["@Object"]&&o&&this.threadUids(i.map(e.Threads,(function(e){return e.toString()}),this)),this.importance(l.pInt(e.Importance)),Enums.has("Importance",this.importance())||this.importance(Enums.Importance.Normal),this.sensitivity(l.pInt(e.Sensitivity)),Enums.has("Sensitivity",this.sensitivity())||this.sensitivity(Enums.Sensitivity.Nothing),i.isArray(e.DraftInfo)&&this.draftInfo(e.DraftInfo),this.hash(l.pString(e.Hash)),this.sDownloadAsEmlUrl=l.pString(e.DownloadAsEmlUrl),"Object/Message"===e["@Object"]&&(this.truncated(e.Truncated),this.inReplyTo(e.InReplyTo),this.references(e.References),this.readingConfirmationAddressee(l.pString(e.ReadingConfirmationAddressee)),n=l.pString(e.Html),r=l.pString(e.Plain),""!==n?(this.textRaw(e.HtmlRaw),this.text(n),this.isPlain(!1)):(this.textRaw(e.PlainRaw),this.text(""!==r?"<div>"+r+"</div>":""),this.isPlain(!0)),this.$text=null,this.isExternalsShown(!1),this.rtl(e.Rtl),this.hasExternals(!!e.HasExternals),this.foundCids(e.FoundedCIDs),this.parseAttachments(e.Attachments,t),this.safety(e.Safety),this.sourceHeaders(e.Headers),this.aExtend=e.Extend,this.completelyFilled(!0),c.broadcastEvent("MailWebclient::ParseMessage::after",{msg:this})),this.updateMomentDate())},v.prototype.updateMomentDate=function(){this.date(this.oDateModel.getShortDate(r().clone().subtract(1,"days").format("L")===r.unix(this.oDateModel.getTimeStampInUTC()).format("L")))},v.prototype.getDomText=function(e,t){var s=this.$text;return e=e||"",null!==this.$text&&""===e||(this.completelyFilled()?(this.$text=o(this.text()),this.showInlinePictures(e),!0===this.safety()&&this.alwaysShowExternalPicturesForSender(),t&&this.isExternalsShown()&&this.showExternalPictures(),s=this.$text):s=o("")),s.clone()},v.prototype.getConvertedHtml=function(e,t){var s=this.getDomText(e,t);return s.length>0?s.wrap("<p>").parent().html():""},v.prototype.parseAttachments=function(e,t){var s=e?e["@Collection"]:[];this.attachments([]),l.isNonEmptyArray(s)&&this.attachments(i.map(s,(function(e){var t=new y;return t.setMessageData(this.folder(),this.uid()),t.parse(e,this.folder(),this.uid()),t}),this))},v.prototype.parseAddressArray=function(e){var t=[];return i.isArray(e)&&(t=i.map(e,(function(e){var t=new CAddressModel;return t.parse(e),t}))),t},v.prototype.showInlinePictures=function(e){var t=i.map(this.attachments(),(function(e){return{CID:e.cid(),ContentLocation:e.contentLocation(),ViewLink:e.getActionUrl("view")}}));m.showInlinePictures(this.$text,t,this.foundCids(),e)},v.prototype.showExternalPictures=function(){m.showExternalPictures(this.$text),this.isExternalsShown(!0)},v.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())},v.prototype.openThread=function(){if(this.threadCountVisible()){var e=this.folder();this.threadOpened(!this.threadOpened()),this.requireMailCache(),this.threadOpened()?f.showOpenedThreads(e):(f.hideThreads(this),setTimeout((function(){f.showOpenedThreads(e)}),500))}},v.prototype.getAttachmentsHashes=function(){var e=i.filter(this.attachments(),(function(e){return!e.linked()}));return i.map(e,(function(e){return e.hash()}))},v.prototype.onSaveAttachmentsToFilesResponse=function(e,t){var s=t.Parameters,o=0,n=s.Attachments.length;e.Result&&i.each(s.Attachments,(function(t){void 0!==e.Result[t]&&o++})),0===o?u.showError(a.i18n("MAILWEBCLIENT/ERROR_CANT_SAVE_ATTACHMENTS_TO_FILES")):o<n?u.showError(a.i18n("MAILWEBCLIENT/ERROR_SOME_ATTACHMENTS_WERE_NOT_SAVED",{SAVED_COUNT:o,TOTAL_COUNT:n})):u.showReport(a.i18n("MAILWEBCLIENT/REPORT_ATTACHMENTS_SAVED_TO_FILES"))},v.prototype.downloadAllAttachmentsSeparately=function(){i.each(this.attachments(),(function(e){e.linked()||e.executeAction("download")}))},v.prototype.toJSON=function(){return{uid:this.uid(),accountId:this.accountId(),to:this.to(),subject:this.subject(),threadPart:this.threadPart(),threadUids:this.threadUids(),threadOpened:this.threadOpened()}},e.exports=v},Olic:function(e,t,s){"use strict";var i=s("QaF5"),o=s("4M/5"),n={composeMessage:function(){i.setHash(o.getCompose())},composeMessageFromDrafts:function(e,t){var s=o.getComposeFromMessage("drafts",e,t);i.setHash(s)},composeMessageAsReplyOrForward:function(e,t,s){var n=o.getComposeFromMessage(e,t,s);i.setHash(n)},composeMessageToAddresses:function(e){var t=o.getComposeWithToField(e);i.setHash(t)},composeMessageWithData:function(e){var t=o.getComposeWithData(e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)},composeMessageWithEml:function(e){var t=o.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)},composeMessageWithAttachments:function(e){var t=o.getComposeWithObject("attachments",e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)}};e.exports=n},QFUI:function(e,t,s){"use strict";var i,o,n=s("RN+F"),r=s("76Kh"),a=s("1grR"),l=s("hPb3"),h={};h.getDownloadLink=function(e,t,s){return t.length>0?"?/Download/"+e+"/DownloadFile/"+t+"/"+(s?"0/"+s:""):""},h.getIframeWrappwer=function(e,t){return"?/Raw/Iframe/"+e+"/"+window.encodeURIComponent(t)+"/"},h.thumbQueue=(i={},o={},function(e,t,s){t&&s?!(e in o)||o[e]>0?(e in o||(o[e]=2,i[e]=[]),o[e]--,s(t)):i[e].push({imageSrc:t,imageSrcObserver:s,messageUid:e}):i[e]&&i[e].length&&(i[e][0].imageSrcObserver(i[e][0].imageSrc),i[e].shift())}),h.showErrorIfAttachmentSizeLimit=function(e,t){var s=n.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE_DETAILED",{FILENAME:e,MAXSIZE:n.getFriendlySize(l.AttachmentSizeLimit)});return l.AttachmentSizeLimit>0&&t>l.AttachmentSizeLimit&&(r.showPopup(a,[s]),!0)},e.exports=h},QYtA:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("Yjhd"),l=s("JFZZ"),h=s("IAk5"),c=s("OgeD"),u=s("76Kh"),d=s("nQVw"),p=s("boka"),m=c.run("ImportExportMailPlugin","getImportExportPopup"),g=s("jonm"),f=s("UN2P"),b=s("4+IO"),y=s("p2hp");function v(){this.bAllowTemplateFolders=y.AllowTemplateFolders,this.highlighted=n.observable(!1).extend({autoResetToFalse:500}),this.collection=n.observableArray(b.editedFolderList().collection()),this.oCollSubscription=b.editedFolderList().collection.subscribe((function(e){this.collection(e)}),this),this.totalMessageCount=n.observable(0),this.enableButtons=n.computed((function(){return b.editedFolderList().initialized()}),this),b.editedFolderList.subscribe((function(e){this.collection(e.collection()),this.setTotalMessageCount(),this.oCollSubscription.dispose(),this.oCollSubscription=e.collection.subscribe((function(e){this.collection(e)}),this)}),this),this.addNewFolderCommand=a.createCommand(this,this.addNewFolder,this.enableButtons),this.setSystemFoldersCommand=a.createCommand(this,this.setSystemFolders,this.enableButtons),this.showMovedWithMouseItem=n.computed((function(){return!h.isMobile()}),this),this.allowImportExport=n.observable(c.isModuleEnabled("ImportExportMailPlugin")),h.subscribeEvent("MailWebclient::AttemptDeleteNonemptyFolder",i.bind((function(){this.highlighted(!0)}),this)),h.broadcastEvent("MailWebclient::ConstructView::after",{Name:"CAccountFoldersPaneView",View:this}),this.afterMove=i.debounce(i.bind(this.folderListOrderUpdate,this),3e3)}s("z1kJ"),v.prototype.ViewTemplate="MailWebclient_Settings_AccountFoldersPaneView",v.prototype.folderListOrderUpdate=function(){var e=b.editedFolderList().repopulateLinedCollection(),t={AccountID:g.editedId(),FolderList:i.compact(i.map(e,(function(e){if(!e.bVirtual)return e.fullName()})))};f.send("UpdateFoldersOrder",t,(function(e){e.Result||(l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_CHANGE_FOLDERS_ORDER")),b.getFolderList(g.editedId()))}),this)},v.prototype.hide=function(e){var t=g.editedId();i.delay((function(){b.getFolderList(t)}),3e3),o.isFunction(e)&&e()},v.prototype.show=function(){this.setTotalMessageCount()},v.prototype.setTotalMessageCount=function(){var e=b.editedFolderList();0===e.iAccountId?this.totalMessageCount(0):(this.totalMessageCount(e.getTotalMessageCount()),e.countsCompletelyFilled()||(e.countsCompletelyFilledSubscribtion&&(e.countsCompletelyFilledSubscribtion.dispose(),e.countsCompletelyFilledSubscribtion=null),e.countsCompletelyFilledSubscribtion=e.countsCompletelyFilled.subscribe((function(){e.countsCompletelyFilled()&&(this.totalMessageCount(e.getTotalMessageCount()),e.countsCompletelyFilledSubscribtion.dispose(),e.countsCompletelyFilledSubscribtion=null)}),this)))},v.prototype.addNewFolder=function(){u.showPopup(d)},v.prototype.setSystemFolders=function(){u.showPopup(p)},v.prototype.importExport=function(){this.allowImportExport()&&u.showPopup(m,[{}])},e.exports=new v},RAWM:function(e,t,s){"use strict";function i(e,t,i){e.AllowChangeMailQuotaOnMailServer&&t.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){s.e(26).then(function(){e(s("U5fS"))}.bind(null,s)).catch(s.oe)},e.HashModuleName+"-quota",i.i18n("MAILWEBCLIENT/LABEL_SETTINGS_TAB")])}e.exports=function(e){s("jO9F");var t=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("IAk5"),a=s("OgeD"),l=s("p2hp"),h=r.getUserRole()===Enums.UserRole.SuperAdmin,c=null,u=null,d=null;if(l.init(e),!a.isModuleAvailable(l.ServerModuleName))return null;if(c=s("jonm"),h)return{start:function(e){e.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){s.e(26).then(function(){e(s("Jjhw"))}.bind(null,s)).catch(s.oe)},l.HashModuleName+"-servers",n.i18n("MAILWEBCLIENT/LABEL_SERVERS_SETTINGS_TAB")]),e.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){s.e(26).then(function(){e(s("xIpW"))}.bind(null,s)).catch(s.oe)},l.HashModuleName,n.i18n("MAILWEBCLIENT/LABEL_SETTINGS_TAB")]),i(l,e,n)},getAccountList:function(){return c},disableEditDomainsInServer:function(){l.disableEditDomainsInServer()}};if(r.isUserNormalOrTenant()){var p=s("4+IO");if(p.init(),r.isNewTab()){var m=function(){if(null===u){var e=s("NTez");u=new e}return u};return{start:function(){s("ZmX0")},getScreens:function(){var e={};return e[l.HashModuleName+"-view"]=function(){return s("BOSG")},e[l.HashModuleName+"-compose"]=function(){return m()},e},registerComposeToolbarController:function(e){m().registerToolbarController(e)},getComposeMessageWithData:function(){return s("h1OO").composeMessageWithData},getComposeMessageToAddresses:function(){return s("h1OO").composeMessageToAddresses},getComposeMessageWithAttachments:function(){return s("h1OO").composeMessageWithAttachments},getSearchMessagesInCurrentFolder:function(){var e=window.opener&&window.opener.MainTabMailMethods;return!!e&&t.bind(e.searchMessagesInCurrentFolder,e)}}}var g={enableModule:o.observable(l.AllowAddAccounts||c.hasAccount()),getComposeMessageToAddresses:function(){return s("h1OO").composeMessageToAddresses},getComposeMessageWithData:function(){return s("h1OO").composeMessageWithData},getComposeMessageWithAttachments:function(){return s("h1OO").composeMessageWithAttachments},getPrefetcher:function(){return s("cPXi")},registerComposeToolbarController:function(e){s("MHRZ").registerToolbarController(e)},getSearchMessagesInInbox:function(){return t.bind(p.searchMessagesInInbox,p)},getFolderHash:function(e){return p.getFolderHash(e)},getSearchMessagesInCurrentFolder:function(){return t.bind(p.searchMessagesInCurrentFolder,p)},getAllAccountsFullEmails:function(){return c.getAllFullEmails()},getAccountList:function(){return c},setCustomRouting:function(e,t,i,o,n,r){var a=s("QaF5"),h=s("4M/5");a.setHash(h.getMailbox(e,t,i,o,n,l.MessagesSortBy.DefaultSortBy,l.MessagesSortBy.DefaultSortOrder,r))}};return r.isMobile()||(g=t.extend(g,{start:function(e){var n=s("RN+F"),a=s("HLSX"),h=s("jxK9");if(s("ZmX0"),s("dRar"),l.AllowAppRegisterMailto&&h.registerMailto(a.firefox),l.AllowAddAccounts||c.hasAccount()){e.run("SettingsWebclient","registerSettingsTab",[function(){return s("LC8E")},l.HashModuleName,n.i18n("MAILWEBCLIENT/LABEL_SETTINGS_TAB")]);var u=l.AllowMultiAccounts?n.i18n("MAILWEBCLIENT/LABEL_ACCOUNTS_SETTINGS_TAB"):n.i18n("MAILWEBCLIENT/LABEL_ACCOUNT_SETTINGS_TAB");e.run("SettingsWebclient","registerSettingsTab",[function(){return s("9z2M")},l.HashModuleName+"-accounts",u])}o.computed((function(){var e=t.filter(c.collection(),(function(e){return e.useToAuthorize()})),s=t.map(e,(function(e){return e.email()}));l.userMailAccountsCount(e.length),l.mailAccountsEmails(s)}),this),r.getUserRole()===Enums.UserRole.TenantAdmin&&i(l,e,n)},getScreens:function(){var e={};return e[l.HashModuleName]=function(){return new(s("qu3M"))},e},getHeaderItem:function(){return null===d&&(d=s("2tUx")),{item:d,name:l.HashModuleName}},getMobileSyncSettingsView:function(){return s("aBko")}})),g}return null}},SQkM:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("AFLV"),a=s("SQrT"),l=s("OgeD").run("SettingsWebclient","getAbstractSettingsFormViewClass"),h=s("jonm"),c=s("UN2P"),u=s("4+IO"),d=s("p2hp"),p=s("Aqrs"),m=s("SbmC");function g(){l.call(this,d.ServerModuleName),this.bShown=!1,this.foldersOptions=o.observableArray([]),u.editedFolderList.subscribe((function(){this.bShown&&this.populate()}),this),this.loading=o.observable(!0),this.collection=o.observableArray([]),this.fieldOptions=[{text:n.i18n("MAILWEBCLIENT/LABEL_FROM"),value:0},{text:n.i18n("MAILWEBCLIENT/LABEL_TO"),value:1},{text:n.i18n("MAILWEBCLIENT/LABEL_SUBJECT"),value:2}],this.conditionOptions=[{text:n.i18n("MAILWEBCLIENT/LABEL_CONTAINING"),value:0},{text:n.i18n("MAILWEBCLIENT/LABEL_EQUAL_TO"),value:1},{text:n.i18n("MAILWEBCLIENT/LABEL_NOT_CONTAINING"),value:2}],this.actionOptions=[{text:n.i18n("MAILWEBCLIENT/LABEL_MOVE_FILTER_ACTION"),value:3},{text:n.i18n("MAILWEBCLIENT/LABEL_DELETE_FILTER_ACTION"),value:1}],this.phaseArray=[""],i.each(n.i18n("MAILWEBCLIENT/INFO_FILTER").split(/,{0,1}\s/),(function(e){var t=this.phaseArray.length-1;"%"===e.substr(0,1)||"%"===this.phaseArray[t].substr(-1,1)?this.phaseArray.push(e):this.phaseArray[t]+=" "+e}),this),this.firstState=null}i.extendOwn(g.prototype,l.prototype),g.prototype.ViewTemplate="MailWebclient_Settings_AccountFiltersSettingsFormView",g.prototype.onShow=function(){this.populate()},g.prototype.onHide=function(){this.bShown=!1},g.prototype.populate=function(){var e=u.editedFolderList(),t=[];e.iAccountId===h.editedId()?(t=e.getOptions(n.i18n("MAILWEBCLIENT/LABEL_FOLDER_NOT_SELECTED"),!0,!0,!1,!0),this.foldersOptions(t),this.populateFilters()):(this.loading(!0),this.collection([]))},g.prototype.revert=function(){i.each(this.collection(),(function(e){e.revert()}))},g.prototype.commit=function(){i.each(this.collection(),(function(e){e.commit()}))},g.prototype.getCurrentValues=function(){return i.map(this.collection(),(function(e){return e.toString()}),this)},g.prototype.getParametersForSave=function(){var e=i.map(this.collection(),(function(e){return{Enable:e.enable()?"1":"0",Field:e.field(),Filter:e.filter(),Condition:e.condition(),Action:e.action(),FolderFullName:e.folder()}}));return{AccountID:h.editedId(),Filters:e}},g.prototype.save=function(){i.some(this.collection(),(function(e){return""===e.filter()||"3"===r.pString(e.action())&&""===e.folder()}))?a.showError(n.i18n("MAILWEBCLIENT/ERROR_FILTER_FIELDS_EMPTY")):(this.isSaving(!0),this.commit(),this.updateSavedState(),c.send("UpdateFilters",this.getParametersForSave(),this.onAccountSieveFiltersUpdateResponse,this))},g.prototype.populateFilters=function(){var e=h.getEdited();e&&(null!==e.filters()?(this.loading(!1),this.collection(e.filters().collection()),this.updateSavedState()):(this.loading(!0),this.collection([]),c.send("GetFilters",{AccountID:e.id()},this.onGetFiltersResponse,this)))},g.prototype.deleteFilter=function(e){this.collection.remove(e)},g.prototype.addFilter=function(){var e=new p(h.editedId());this.collection.push(e)},g.prototype.displayFilterPart=function(e,t){return t+("%FIELD%"===e?"Field":"%CONDITION%"===e?"Condition":"%STRING%"===e?"String":"%ACTION%"===e?"Action":"%FOLDER%"===e?"Folder":"%DEPENDED"===e.substr(0,9)?"DependedText":"Text")},g.prototype.getDependedText=function(e){return(e=r.pString(e))&&(e=e.replace(/%/g,"").split("=")[1]||""),e},g.prototype.getDependedField=function(e,t){return(e=r.pString(e))&&(e=(e=e.replace(/[=](.*)/g,"").split("-")[1]||"").toLowerCase()),!!t[e]&&t[e]()},g.prototype.onGetFiltersResponse=function(e,t){var s=t.Parameters,i=r.pInt(s.AccountID),o=h.getAccount(i),l=new m;this.loading(!1),e&&e.Result&&o?(l.parse(i,e.Result),o.filters(l),i===h.editedId()&&this.populateFilters()):a.showError(n.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},g.prototype.onAccountSieveFiltersUpdateResponse=function(e,t){this.isSaving(!1),t&&t.Method?e&&e.Result?a.showReport(n.i18n("MAILWEBCLIENT/REPORT_FILTERS_UPDATE_SUCCESS")):a.showError(n.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED")):a.showError(n.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},e.exports=new g},SbmC:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("Aqrs");function r(){this.iAccountId=0,this.collection=o.observableArray([])}r.prototype.parse=function(e,t){var s=0,o=t.length,r=null;if(this.iAccountId=e,i.isArray(t))for(o=t.length;s<o;s++)(r=new n(e)).parse(t[s]),this.collection.push(r)},e.exports=r},TCxV:function(e,t,s){"use strict";var i=s("76Kh"),o=s("4M/5"),n={};function r(){return s("MHRZ")}n.composeMessage=function(){i.showPopup(r())},n.composeMessageFromDrafts=function(e,t){var s=o.getComposeFromMessage("drafts",e,t);s.shift(),i.showPopup(r(),[s])},n.composeMessageAsReplyOrForward=function(e,t,s){var n=o.getComposeFromMessage(e,t,s);n.shift(),i.showPopup(r(),[n])},n.composeMessageToAddresses=function(e){var t=o.getComposeWithToField(e);t.shift(),i.showPopup(r(),[t])},n.composeMessageWithData=function(e){var t=o.getComposeWithData(e);t.shift(),i.showPopup(r(),[t])},n.composeMessageWithEml=function(e){var t=o.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),i.showPopup(r(),[t])},n.composeMessageWithAttachments=function(e){var t=o.getComposeWithObject("attachments",e);t.shift(),i.showPopup(r(),[t])},n.closeComposePopup=function(){i.showPopup(r(),[["close"]])},e.exports=n},TKFr:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("wd/R"),a=[],l=[],h=n.observable(r().date());window.setInterval((function(){i.each(a,(function(e){e()})),h(r().date())}),6e4),h.subscribe((function(){i.each(l,(function(e){e()}))}),this),e.exports={registerEveryMinuteFunction:function(e){o.isFunction(e)&&a.push(e)},registerDayOfMonthFunction:function(e){o.isFunction(e)&&l.push(e)}}},UN2P:function(e,t,s){"use strict";var i=s("F/us"),o=s("AFLV"),n=s("o0Bx"),r=s("p2hp");n.registerAbortRequestHandler(r.ServerModuleName,(function(e,t){var s=e.Parameters,i=t.Parameters;switch(e.Method){case"MoveMessages":case"DeleteMessages":return"GetMessage"===t.Method||"GetMessages"===t.Method&&i.Folder===s.Folder;case"GetMessages":case"SetMessagesSeen":case"SetMessageFlagged":return"GetMessages"===t.Method&&i.Folder===s.Folder;case"SetAllMessagesSeen":return("GetMessages"===t.Method||"GetMessages"===t.Method)&&i.Folder===s.Folder;case"ClearFolder":return"GetRelevantFoldersInformation"===t.Method||"GetMessages"===t.Method&&i.Folder===s.Folder;case"GetRelevantFoldersInformation":return"GetRelevantFoldersInformation"===t.Method&&s.AccountID===i.AccountID;case"GetMessagesFlags":return"GetMessagesFlags"===t.Method}return!1})),e.exports={getOpenedRequest:function(e){n.getOpenedRequest("Mail",e)},hasOpenedRequests:function(e){n.hasOpenedRequests("Mail",e)},registerOnAllRequestsClosedHandler:n.registerOnAllRequestsClosedHandler,send:function(e,t,a,l){var h=s("4+IO"),c="GetMessagesBodies"===e?1e5:void 0;t&&!t.AccountID&&(t.AccountID=h.currentAccountId()),n.send(r.ServerModuleName,e,t,(function(e,t){if(!e.Result&&4002===e.ErrorCode){var n=s("jonm"),r=o.pInt(t.Parameters.AccountID);n.getAccount(r).passwordMightBeIncorrect(!0)}i.isFunction(a)&&a.apply(l,[e,t])}),null,c)}}},UvKh:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("AFLV"),r=s("Cq+9"),a=s("jonm");function l(){this.senderList=o.observableArray([]),this.senderAccountId=o.observable(a.currentId()),this.selectedFetcherOrIdentity=o.observable(null),this.lockSelectedSender=o.observable(!1),this.selectedSender=o.observable(""),this.selectedSender.subscribe((function(){if(!this.lockSelectedSender()){var e=a.getAccount(this.senderAccountId()),t=this.selectedSender(),s=null;n.isNonEmptyString(t)&&(0===t.indexOf("fetcher")?(t=t.replace("fetcher",""),s=i.find(e.fetchers(),(function(e){return e.id()===n.pInt(t)}))):s=i.find(e.identities(),(function(e){return e.id()===n.pInt(t)}))),s&&this.selectedFetcherOrIdentity(s)}}),this)}l.prototype.changeSelectedSender=function(e){if(e){var t=n.pString(e.id());e.FETCHER&&(t="fetcher"+t),i.find(this.senderList(),(function(e){return e.id===t}))&&(this.lockSelectedSender(!0),this.selectedSender(t),this.selectedFetcherOrIdentity(e),this.lockSelectedSender(!1))}},l.prototype.changeSenderAccountId=function(e,t){var s=!1;this.senderAccountId()!==e&&(a.hasAccountWithId(e)?(this.senderAccountId(e),s=!0):a.hasAccountWithId(this.senderAccountId())||(this.senderAccountId(a.currentId()),s=!0)),(s||0===this.senderList().length)&&(this.fillSenderList(t),s=!0),!s&&t&&this.changeSelectedSender(t)},l.prototype.fillSenderList=function(e){var t=[],s=a.getAccount(this.senderAccountId());s&&(i.isArray(s.identities())&&i.each(s.identities(),(function(e){t.push({fullEmail:e.fullEmail(),id:n.pString(e.id())})}),this),s.identitiesSubscribtion&&s.identitiesSubscribtion.dispose(),s.identitiesSubscribtion=s.identities.subscribe((function(){this.fillSenderList(e),this.changeSelectedSender(s.getDefaultIdentity())}),this),i.each(s.fetchers(),(function(e){var s=e.fullEmail();e.isEnabled()&&e.isOutgoingEnabled()&&s.length>0&&t.push({fullEmail:s,id:"fetcher"+e.id()})}),this),s.fetchersSubscribtion&&s.fetchersSubscribtion.dispose(),s.fetchersSubscribtion=s.fetchers.subscribe((function(){this.fillSenderList(e)}),this)),this.senderList(t),this.changeSelectedSender(e)},l.prototype.setFetcherOrIdentityByReplyMessage=function(e){var t=e.oTo.aCollection.concat(e.oCc.aCollection),s=r.getFirstFetcherOrIdentityByRecipientsOrDefault(t,e.accountId());s&&this.changeSelectedSender(s)},e.exports=new l},VNFZ:function(e,t,s){"use strict";var i=s("AFLV");function o(){this.iAccountId=0,this.enable=!1,this.subject="",this.message=""}o.prototype.parse=function(e,t){this.iAccountId=e,this.enable=!!t.Enable,this.subject=i.pString(t.Subject),this.message=i.pString(t.Message)},e.exports=o},VO44:function(e,t,s){"use strict";var i=s("0h2I"),o=s("RN+F"),n=s("OgeD"),r=s("QaF5"),a=s("SQrT"),l=s("hPb3"),h=s("76Kh"),c=s("nQVw"),u=s("jonm"),d=s("4+IO"),p=s("p2hp");function m(){this.folderList=d.folderList,this.manageFoldersHash=i.computed((function(){if(n.isModuleEnabled("SettingsWebclient")){var e=u.getCurrent();if(e)return r.buildHashFromArray(["settings","mail-accounts","account",e.hash(),"folders"])}return"#"}),this),this.quotaProc=i.observable(-1),this.quotaDesc=i.observable(""),l.ShowQuotaBar&&i.computed((function(){d.quotaChangeTrigger();var e=u.getCurrent(),t=e?e.quota():0,s=e?e.usedSpace():0,i=0<t?Math.ceil(s/t*100):-1;return i=100<i?100:i,this.quotaProc(i),this.quotaDesc(-1<i?o.i18n("COREWEBCLIENT/INFO_QUOTA",{PROC:i,QUOTA:o.getFriendlySize(1024*t)}):""),l.QuotaWarningPerc>0&&-1!==i&&l.QuotaWarningPerc>100-i&&a.showError(o.i18n("COREWEBCLIENT/WARNING_QUOTA_ALMOST_REACHED"),!0),!0}),this),this.visibleNewFolderButton=i.computed((function(){return p.AllowAddNewFolderOnMainScreen&&this.folderList().collection().length>0}),this)}m.prototype.ViewTemplate="MailWebclient_FoldersView",m.prototype.addNewFolder=function(){h.showPopup(c)},e.exports=m},VgCI:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("Yjhd"),h=s("JFZZ"),c=s("OgeD"),u=s("SQrT"),d=c.run("SettingsWebclient","getAbstractSettingsFormViewClass"),p=s("jonm"),m=s("UN2P"),g=s("p2hp");function f(e,t){d.call(this,g.ServerModuleName),this.identity=n.observable(null),this.oParent=e,this.bCreate=t,this.disableCheckbox=n.observable(!1),this.isDefault=n.observable(!1),this.email=n.observable(""),this.emailList=n.observableArray([]),this.selectedEmail=n.observable(""),this.disableEditEmail=n.observable(g.OnlyUserEmailsInIdentities),this.disableRemoveIdentity=n.observable(t),this.friendlyName=n.observable(""),this.friendlyNameHasFocus=n.observable(!1)}i.extendOwn(f.prototype,d.prototype),f.prototype.ViewTemplate="MailWebclient_Settings_IdentitySettingsFormView",f.prototype.ViewConstructorName="CIdentitySettingsFormView",f.prototype.onShow=function(e){this.identity(e&&!e.FETCHER?e:null),this.populate()},f.prototype.getCurrentValues=function(){return[this.friendlyName(),this.email()]},f.prototype.getParametersForSave=function(){if(this.identity()){var e={AccountID:this.identity().accountId(),Default:this.isDefault(),FriendlyName:this.friendlyName(),AccountPart:this.identity().bAccountPart};return this.identity().bAccountPart||(i.extendOwn(e,{Email:this.emailList().length>0?o.trim(this.selectedEmail()):o.trim(this.email())}),this.bCreate||(e.EntityId=this.identity().id())),e}return{}},f.prototype.save=function(){""===o.trim(this.email())?u.showError(l.i18n("MAILWEBCLIENT/ERROR_IDENTITY_FIELDS_BLANK")):(this.isSaving(!0),this.updateSavedState(),m.send(this.bCreate?"CreateIdentity":"UpdateIdentity",this.getParametersForSave(),this.onResponse,this))},f.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result){var s=t.Parameters,o=a.pInt(s.AccountID),n=0<o?p.getAccount(o):null;p.populateIdentities((function(){var t=p.getCurrent().identities(),s=i.find(t,(function(t){return t.id()===e.Result}));s&&c.run("SettingsWebclient","setAddHash",[["identity",s.hash()]])})),this.bCreate&&i.isFunction(this.oParent.closePopup)&&this.oParent.closePopup(),s.AccountPart&&n&&n.updateFriendlyName(s.FriendlyName),this.disableCheckbox(this.isDefault()),u.showReport(r.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))}else h.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_IDENTITY_ADDING"))},f.prototype.populate=function(){var e=this.identity();if(e){if(this.isDefault(e.isDefault()),this.email(e.email()),this.disableEditEmail(g.OnlyUserEmailsInIdentities||e.bAccountPart),this.disableRemoveIdentity(this.bCreate||e.bAccountPart),this.emailList([]),g.OnlyUserEmailsInIdentities&&!e.bAccountPart){var t=[],s=p.getAccount(e.accountId());s&&(t=s.aExtend.Aliases),a.isNonEmptyArray(t)&&(this.emailList(i.clone(t)),this.emailList.unshift(e.email()),this.selectedEmail(e.email()))}this.friendlyName(e.friendlyName()),this.disableCheckbox(e.isDefault()),setTimeout(function(){this.updateSavedState()}.bind(this),1)}},f.prototype.remove=function(){if(this.identity()&&!this.identity().bAccountPart){var e={AccountID:this.identity().accountId(),EntityId:this.identity().id()};m.send("DeleteIdentity",e,this.onAccountIdentityDeleteResponse,this),!this.bCreate&&i.isFunction(this.oParent.onRemoveIdentity)&&this.oParent.onRemoveIdentity()}},f.prototype.onAccountIdentityDeleteResponse=function(e,t){e.Result||h.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_IDENTITY_DELETING")),p.populateIdentities()},f.prototype.cancel=function(){i.isFunction(this.oParent.cancelPopup)&&this.oParent.cancelPopup()},e.exports=f},"XJC/":function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("AFLV"),a=s("JFZZ"),l=s("OgeD"),h=s("SQrT"),c=l.run("SettingsWebclient","getAbstractSettingsFormViewClass"),u=s("jonm"),d=s("UN2P"),p=s("p2hp"),m=s("VNFZ");function g(){c.call(this,p.ServerModuleName),this.enable=o.observable(!1),this.subject=o.observable(""),this.message=o.observable(""),u.editedId.subscribe((function(){this.bShown&&this.populate()}),this)}i.extendOwn(g.prototype,c.prototype),g.prototype.ViewTemplate="MailWebclient_Settings_AccountAutoresponderSettingsFormView",g.prototype.getCurrentValues=function(){return[this.enable(),this.subject(),this.message()]},g.prototype.onShow=function(){this.populate()},g.prototype.revert=function(){this.populate()},g.prototype.getParametersForSave=function(){return{AccountID:u.editedId(),Enable:this.enable(),Subject:this.subject(),Message:this.message()}},g.prototype.applySavedValues=function(e){var t=u.getEdited().autoresponder();t&&(t.enable=e.Enable,t.subject=e.Subject,t.message=e.Message)},g.prototype.save=function(){this.isSaving(!0),this.updateSavedState(),d.send("UpdateAutoresponder",this.getParametersForSave(),this.onResponse,this)},g.prototype.onResponse=function(e,t){if(this.isSaving(!1),!1===e.Result)a.showErrorByCode(e,n.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"));else{var s=t.Parameters;this.applySavedValues(s),h.showReport(n.i18n("MAILWEBCLIENT/REPORT_AUTORESPONDER_UPDATE_SUCCESS"))}},g.prototype.populate=function(){var e=u.getEdited();e&&(null!==e.autoresponder()?(this.enable(e.autoresponder().enable),this.subject(e.autoresponder().subject),this.message(e.autoresponder().message)):d.send("GetAutoresponder",{AccountID:e.id()},this.onGetAutoresponderResponse,this)),this.updateSavedState()},g.prototype.onGetAutoresponderResponse=function(e,t){if(e&&e.Result){var s=t.Parameters,i=r.pInt(s.AccountID),o=u.getAccount(i),n=new m;o&&(n.parse(i,e.Result),o.autoresponder(n),i===u.editedId()&&this.populate())}},e.exports=new g},XTZw:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("IAk5"),h=s("ZCBP"),c=s("cGGv"),u=s("UN2P");function d(){this.folderName=n.observable(""),this.messageUid=n.observable(""),this.cid=n.observable(""),this.contentLocation=n.observable(""),this.inline=n.observable(!1),this.linked=n.observable(!1),this.mimePartIndex=n.observable(""),this.messagePart=n.observable(null),c.call(this),this.content=n.observable(""),this.isMessageType=n.computed((function(){return this.mimeType(),this.mimePartIndex(),"message/rfc822"===this.mimeType()}),this)}i.extendOwn(d.prototype,c.prototype),d.prototype.getNewInstance=function(){return new d},d.prototype.getCopy=function(){var e=new d;return e.copyProperties(this),e},d.prototype.copyProperties=function(e){this.fileName(e.fileName()),this.tempName(e.tempName()),this.size(e.size()),this.hash(e.hash()),this.mimeType(e.mimeType()),this.cid(e.cid()),this.contentLocation(e.contentLocation()),this.inline(e.inline()),this.linked(e.linked()),this.thumbnailSrc(e.thumbnailSrc()),this.thumbnailLoaded(e.thumbnailLoaded()),this.statusText(e.statusText()),this.uploaded(e.uploaded()),this.oActionsData=e.oActionsData,this.actions(e.actions()),this.thumbUrlInQueue(e.thumbUrlInQueue())},d.prototype.additionalParse=function(e){this.content(a.pString(e.Content)),this.mimePartIndex(a.pString(e.MimePartIndex)),this.isMessageType()&&""===this.mimePartIndex()&&this.actions(i.without(this.actions(),"view")),this.cid(a.pString(e.CID)),this.contentLocation(a.pString(e.ContentLocation)),this.inline(!!e.IsInline),this.linked(!!e.IsLinked),l.broadcastEvent("MailWebclient::ParseFile::after",this)},d.prototype.setMessageData=function(e,t){this.folderName(e),this.messageUid(t)},d.prototype.onGetMessageResponse=function(e,t){var i=t.Parameters,o=(e=e.Result,new(s("Nfk5")));e&&this.oNewWindow&&(o.parse(e,i.AccountID,!1,!0),this.messagePart(o),this.messagePart().viewMessage(this.oNewWindow),this.oNewWindow=void 0)},d.prototype.viewFile=function(){this.isMessageType()?this.viewMessageFile():this.viewCommonFile()},d.prototype.viewMessageFile=function(){var e=null,t='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+r.i18n("COREWEBCLIENT/INFO_LOADING")+"</div>";(e=h.open("",this.fileName()))&&(this.messagePart()?this.messagePart().viewMessage(e):(o(e.document.body).html(t),this.oNewWindow=e,u.send("GetMessage",{Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()},this.onGetMessageResponse,this)),e.focus())},d.prototype.fillDataAfterUploadComplete=function(e,t){this.cid(a.pString(t)),e&&e.Result&&e.Result.Attachment&&(this.tempName(a.pString(e.Result.Attachment.TempName)),this.mimeType(a.pString(e.Result.Attachment.MimeType)),this.size(a.pInt(e.Result.Attachment.Size)),this.hash(a.pString(e.Result.Attachment.Hash)),this.parseActions(e.Result.Attachment))},d.prototype.parseFromUpload=function(e,t,s){this.setMessageData(t,s),this.fileName(a.pString(e.Name)),this.tempName(e.TempName?a.pString(e.TempName):this.fileName()),this.mimeType(a.pString(e.MimeType)),this.size(a.pInt(e.Size)),this.hash(a.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),this.uploadStarted(!1)},d.prototype.parseActions=function(e){this.thumbUrlInQueue(""!==a.pString(e.ThumbnailUrl)?a.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(e),this.isMessageType()?""!==this.folderName()&&""!==this.messageUid()?(this.hasAction("view")||this.actions.unshift("view"),this.otherTemplates.push({name:"MailWebclient_PrintMessageView",data:this.messagePart})):this.actions(i.without(this.actions(),"view")):this.commonExcludeActions()},d.prototype.errorFromUpload=function(){this.uploaded(!0),this.uploadError(!0),this.uploadStarted(!1),this.statusText(r.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"))},e.exports=d},YOyf:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("3Y+r"),h=s("JFZZ"),c=s("czxF"),u=s("76Kh"),d=s("3AgX"),p=s("OgeD"),m=s("jonm"),g=s("UN2P"),f=s("2ug6"),b=s("gAbd");function y(){c.call(this),this.loading=n.observable(!1),this.friendlyName=n.observable(""),this.email=n.observable(""),this.email.focused=n.observable(!1),this.password=n.observable(""),this.password.focused=n.observable(!1),this.aRequiredFields=[this.email,this.password]}i.extendOwn(y.prototype,c.prototype),y.prototype.PopupTemplate="MailWebclient_Settings_CreateAccountShortFormPopup",y.prototype.init=function(){this.friendlyName(""),this.email(""),this.password("")},y.prototype.onOpen=function(e){this.fCallback=e,this.init(),this.focusFieldToEdit()},y.prototype.focusFieldToEdit=function(){var e=i.find(this.aRequiredFields,(function(e){return""===e()}));e?e.focused(!0):this.aRequiredFields.length>0&&this.aRequiredFields[0].focused(!0)},y.prototype.onClose=function(){this.init()},y.prototype.save=function(){if(l.checkIfFieldsEmpty(this.aRequiredFields,r.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"))){var e={Domain:o.trim(this.email()).split("@")[1],AllowWildcardDomain:!0};this.loading(!0),g.send("GetMailServerByDomain",e,this.onGetMailServerByDomain,this)}else this.loading(!1)},y.prototype.onGetMailServerByDomain=function(e,t){var s=null;if(e.Result&&void 0!==e.Result.Server&&void 0!==e.Result.FoundWithWildcard)if(e.Result.FoundWithWildcard){var n=o.trim(this.email()).split("@")[1],r=m.getDefault()?m.getDefault().email():"";n===o.trim(r).split("@")[1]&&(s=new b(e.Result.Server))}else s=new b(e.Result.Server);if(s){var a={FriendlyName:this.friendlyName(),Email:o.trim(this.email()),IncomingLogin:o.trim(this.email()),IncomingPassword:o.trim(this.password()),Server:{ServerId:s.iId}};g.send("CreateAccount",a,this.onAccountCreateResponse,this)}else this.loading(!1),u.showPopup(d,[i.bind((function(e){var t=m.getAccount(e);t&&this.editAccount(t.hash())}),this),this.friendlyName(),o.trim(this.email()),o.trim(this.password())]),this.closePopup()},y.prototype.onAccountCreateResponse=function(e,t){if(this.loading(!1),e.Result){var s=a.pInt(e.Result.AccountID),i=new f(e.Result);m.addAccount(i),m.populateIdentities(),m.changeEditedAccount(s),1===m.collection().length&&m.changeCurrentAccount(s),this.fCallback&&this.fCallback(s),this.closePopup()}else h.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_CREATE_ACCOUNT"))},y.prototype.editAccount=function(e){p.run("SettingsWebclient","setAddHash",[["account",e]])},e.exports=new y},ZmX0:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("OgeD").run("MailWebclient","getComposeMessageToAddresses");o.isFunction(r)&&(n.bindingHandlers.makeLinkComposeMailTo={update:function(e,t,s,i,n){var a=o(e),l=t();a.show(),a.hasClass("button")||a.addClass("link"),a.click((function(){r(l)}))}}),n.bindingHandlers.moveToFolderFilter={init:function(e,t,s,n,r){var a=o(e),l=t(),h=o(e).find(l.container),c=i.isArray(l.options)?l.options:l.options(),u=l.value?l.value():"";i.find(c,(function(e){return e[l.optionsValue]===u}))||(u="",l.value("")),a.removeClass("expand"),h.empty(),i.each(c,(function(e){var t=o('<span class="item"></span>').text(e[l.optionsText]).data("value",e[l.optionsValue]);u===e[l.optionsValue]&&t.addClass("selected"),e.jq=t,h.append(t)})),h.on("click",".item",(function(){var e=o(this).data("value");l.value(e)})),a.click((function(){a.toggleClass("expand"),a.hasClass("expand")&&i.defer((function(){o(document).one("click",(function(){a.removeClass("expand")}))}))}))},update:function(e,t){var s=o(e),n=t(),r=i.isArray(n.options)?n.options:n.options(),a=n.value?n.value():"",l=i.find(r,(function(e){return e[n.optionsValue]===a})),h=s.find(".link");i.each(r,(function(e){e.jq&&e.jq.toggleClass("selected",a===e[n.optionsValue])})),l&&h.text(o.trim(l[n.optionsText]))}}},a28q:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("Ol7c"),a=s("RN+F"),l=s("AFLV"),h=s("IAk5"),c=s("HLSX"),u=s("mjrp"),d=s("hPb3"),p=s("76Kh"),m=s("1grR"),g=s("XTZw"),f=s("sWkr"),b=s("4+IO"),y=s("p2hp"),v=s("jDNX");function A(e,t){this.oParent=t,this.creaId="creaId"+Math.random().toString().replace(".",""),this.textFocused=n.observable(!1),this.workareaDom=n.observable(),this.uploaderAreaDom=n.observable(),this.editorUploaderBodyDragOver=n.observable(!1),this.htmlEditorDom=n.observable(),this.toolbarDom=n.observable(),this.colorPickerDropdownDom=n.observable(),this.insertLinkDropdownDom=n.observable(),this.insertImageDropdownDom=n.observable(),this.isFWBold=n.observable(!1),this.isFSItalic=n.observable(!1),this.isTDUnderline=n.observable(!1),this.isTDStrikeThrough=n.observable(!1),this.isEnumeration=n.observable(!1),this.isBullets=n.observable(!1),this.isEnable=n.observable(!0),this.isEnable.subscribe((function(){this.oCrea&&this.oCrea.setEditable(this.isEnable())}),this),this.bInsertImageAsBase64=e,this.bAllowFileUpload=!(e&&void 0===window.File),this.bAllowInsertImage=y.AllowInsertImage,this.lockFontSubscribing=n.observable(!1),this.bAllowImageDragAndDrop=!c.ie10AndAbove,this.aFonts=["Arial","Arial Black","Courier New","Tahoma","Times New Roman","Verdana"],this.sDefaultFont=y.DefaultFontName,this.correctFontFromSettings(),this.selectedFont=n.observable(""),this.selectedFont.subscribe((function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontName(this.selectedFont())}),this),this.iDefaultSize=y.DefaultFontSize,this.selectedSize=n.observable(0),this.selectedSize.subscribe((function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontSize(this.selectedSize())}),this),this.visibleInsertLinkPopup=n.observable(!1),this.linkForInsert=n.observable(""),this.linkFocused=n.observable(!1),this.visibleLinkPopup=n.observable(!1),this.linkPopupDom=n.observable(null),this.linkHrefDom=n.observable(null),this.linkHref=n.observable(""),this.visibleLinkHref=n.observable(!1),this.visibleImagePopup=n.observable(!1),this.visibleImagePopup.subscribe((function(){this.onImageOut()}),this),this.imagePopupTop=n.observable(0),this.imagePopupLeft=n.observable(0),this.imageSelected=n.observable(!1),this.tooltipText=n.observable(""),this.tooltipPopupTop=n.observable(0),this.tooltipPopupLeft=n.observable(0),this.visibleInsertImagePopup=n.observable(!1),this.imageUploaderButton=n.observable(null),this.aUploadedImagesData=[],this.imagePathFromWeb=n.observable(""),this.visibleFontColorPopup=n.observable(!1),this.oFontColorPickerView=new v(a.i18n("MAILWEBCLIENT/LABEL_TEXT_COLOR"),this.setTextColorFromPopup,this),this.oBackColorPickerView=new v(a.i18n("MAILWEBCLIENT/LABEL_BACKGROUND_COLOR"),this.setBackColorFromPopup,this),this.inactive=n.observable(!1),this.sPlaceholderText="",this.bAllowChangeInputDirection=d.IsRTL||y.AllowChangeInputDirection,this.disableEdit=n.observable(!1),this.textChanged=n.observable(!1),this.actualTextСhanged=n.observable(!1)}A.prototype.ViewTemplate="MailWebclient_HtmlEditorView",A.prototype.setInactive=function(e){this.inactive(e),this.inactive()?this.setPlaceholder():this.removePlaceholder()},A.prototype.setPlaceholder=function(){var e=this.removeAllTags(this.getText());""!==e&&"&nbsp;"!==e||(this.setText("<span>"+this.sPlaceholderText+"</span>"),this.oCrea&&this.oCrea.setBlur())},A.prototype.removePlaceholder=function(){(this.oCrea?this.removeAllTags(this.oCrea.getText(!1)):"")===this.sPlaceholderText&&(this.setText(""),this.oCrea&&this.oCrea.setFocus(!0))},A.prototype.hasOpenedPopup=function(){return this.visibleInsertLinkPopup()||this.visibleLinkPopup()||this.visibleImagePopup()||this.visibleInsertImagePopup()||this.visibleFontColorPopup()},A.prototype.setDisableEdit=function(e){this.disableEdit(!!e)},A.prototype.correctFontFromSettings=function(){var e=this.sDefaultFont,t=!1;i.each(this.aFonts,(function(s){s.toLowerCase()===e.toLowerCase()&&(e=s,t=!0)})),t?this.sDefaultFont=e:this.aFonts.push(e)},A.prototype.showLinkPopup=function(e){var t=o(this.workareaDom()),s=t.closest(".panel.compose"),i=t.position(),n=e.position(),r=e.height(),a=Math.round(n.left+i.left),l=Math.round(n.top+r+i.top);this.linkHref(e.attr("href")||e.text()),o(this.linkPopupDom()).css({left:a,top:l}),o(this.linkHrefDom()).css({left:a,top:l}),c.firefox||1!==s.length||o(this.linkPopupDom()).css({"max-width":s.width()-a-40+"px","white-space":"pre-line","word-wrap":"break-word"}),this.visibleLinkPopup(!0)},A.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)},A.prototype.showChangeLink=function(){this.visibleLinkHref(!0),this.hideLinkPopup()},A.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref()),this.hideChangeLink()},A.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)},A.prototype.showImagePopup=function(e,t){var s=o(this.workareaDom()),i=s.position(),n=s.offset();this.imagePopupLeft(Math.round(t.pageX+i.left-n.left)),this.imagePopupTop(Math.round(t.pageY+i.top-n.top)),this.visibleImagePopup(!0)},A.prototype.hideImagePopup=function(){this.visibleImagePopup(!1)},A.prototype.resizeImage=function(e){var t={width:"auto",height:"auto"};switch(e){case Enums.HtmlEditorImageSizes.Small:t.width="300px";break;case Enums.HtmlEditorImageSizes.Medium:t.width="600px";break;case Enums.HtmlEditorImageSizes.Large:t.width="1200px";break;case Enums.HtmlEditorImageSizes.Original:t.width="auto"}this.oCrea.changeCurrentImage(t),this.visibleImagePopup(!1)},A.prototype.onImageOver=function(e){if("IMG"===e.target.nodeName&&!this.visibleImagePopup()){this.imageSelected(!0),this.tooltipText(a.i18n("MAILWEBCLIENT/ACTION_CLICK_TO_EDIT_IMAGE"));var t=this,s=o(this.workareaDom());s.bind("mousemove.image",(function(e){var i=s.position(),o=s.offset();t.tooltipPopupTop(Math.round(e.pageY+i.top-o.top)),t.tooltipPopupLeft(Math.round(e.pageX+i.left-o.left))}))}return!0},A.prototype.onImageOut=function(e){this.imageSelected()&&(this.imageSelected(!1),o(this.workareaDom()).unbind("mousemove.image"));return!0},A.prototype.commit=function(){this.textChanged(!1)},A.prototype.init=function(e,t,s,n){this.sPlaceholderText=n||"",this.oCrea?(this.oCrea.$container=o("#"+this.oCrea.oOptions.creaId),0===this.oCrea.$container.children().length&&(this.oCrea.start(this.isEnable()),this.initEditorUploader())):(o(document.body).on("click",i.bind((function(e){0===o(e.target).parents("span.dropdown_helper").length&&this.closeAllPopups(!0)}),this)),this.initEditorUploader(),this.oCrea=new f({creaId:this.creaId,fontNameArray:this.aFonts,defaultFontName:this.sDefaultFont,defaultFontSize:this.iDefaultSize,alwaysTryUseImageWhilePasting:y.AlwaysTryUseImageWhilePasting,isRtl:d.IsRTL,enableDrop:!1,onChange:i.bind((function(){this.textChanged(!0),this.actualTextСhanged.valueHasMutated()}),this),onCursorMove:i.bind(this.setFontValuesFromText,this),onFocus:i.bind(this.onCreaFocus,this),onBlur:i.bind(this.onCreaBlur,this),onUrlIn:i.bind(this.showLinkPopup,this),onUrlOut:i.bind(this.hideLinkPopup,this),onImageSelect:i.bind(this.showImagePopup,this),onImageBlur:i.bind(this.hideImagePopup,this),onItemOver:c.mobileDevice||h.isMobile()?null:i.bind(this.onImageOver,this),onItemOut:c.mobileDevice||h.isMobile()?null:i.bind(this.onImageOut,this),openInsertLinkDialog:i.bind(this.insertLink,this),onUrlClicked:!0}),this.oCrea.start(this.isEnable())),this.oCrea.setTabIndex(s),this.clearUndoRedo(),this.setText(e,t),this.setFontValuesFromText(),this.aUploadedImagesData=[],this.selectedFont(this.sDefaultFont),this.selectedSize(this.iDefaultSize)},A.prototype.isInitialized=function(){return!!this.oCrea},A.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus(!1)},A.prototype.changeSignatureContent=function(e,t){this.oCrea&&this.oCrea.changeSignatureContent(e,t)},A.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0),this.isFWBold(this.oCrea.getIsBold()),this.isFSItalic(this.oCrea.getIsItalic()),this.isTDUnderline(this.oCrea.getIsUnderline()),this.isTDStrikeThrough(this.oCrea.getIsStrikeThrough()),this.isEnumeration(this.oCrea.getIsEnumeration()),this.isBullets(this.oCrea.getIsBullets()),this.selectedFont(this.oCrea.getFontName()),this.selectedSize(this.oCrea.getFontSizeInNumber().toString()),this.lockFontSubscribing(!1)},A.prototype.isUndoAvailable=function(){return!!this.oCrea&&this.oCrea.isUndoAvailable()},A.prototype.getPlainText=function(){return this.oCrea?this.oCrea.getPlainText():""},A.prototype.getText=function(e){var t=this.oCrea?this.oCrea.getText(e):"";return""!==this.sPlaceholderText&&this.removeAllTags(t)===this.sPlaceholderText?"":t},A.prototype.setText=function(e,t){this.oCrea&&(t?this.oCrea.setPlainText(e):this.oCrea.setText(e),this.inactive()&&""===e&&this.setPlaceholder())},A.prototype.undoAndClearRedo=function(){this.oCrea&&(this.oCrea.undo(),this.oCrea.clearRedo())},A.prototype.clearUndoRedo=function(){this.oCrea&&this.oCrea.clearUndoRedo()},A.prototype.isEditing=function(){return!!this.oCrea&&this.oCrea.bEditing},A.prototype.removeAllTags=function(e){return e.replace(/<style>.*<\/style>/g,"").replace(/<[^>]*>/g,"")},A.prototype.onCreaFocus=function(){this.oCrea&&(this.closeAllPopups(),this.textFocused(!0))},A.prototype.onCreaBlur=function(){this.oCrea&&this.textFocused(!1)},A.prototype.onEscHandler=function(){p.hasOpenedMaximizedPopups()||this.closeAllPopups()},A.prototype.closeAllPopups=function(e){(e=!!e)||this.visibleLinkPopup(!1),this.visibleInsertLinkPopup(!1),this.visibleImagePopup(!1),this.visibleInsertImagePopup(!1),this.visibleFontColorPopup(!1)},A.prototype.insertHtml=function(e){this.oCrea&&(this.oCrea.isFocused()||this.oCrea.setFocus(!0),this.oCrea.insertHtml(e,!1))},A.prototype.insertLink=function(e,t){this.inactive()||this.visibleInsertLinkPopup()||(t&&i.isFunction(t.stopPropagation)&&t.stopPropagation(),this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))},A.prototype.insertLinkFromPopup=function(e,t){return this.linkForInsert().length>0&&(r.isCorrectEmail(this.linkForInsert())?this.oCrea.insertEmailLink(this.linkForInsert()):this.oCrea.insertLink(this.linkForInsert())),this.closeInsertLinkPopup(e,t),!1},A.prototype.closeInsertLinkPopup=function(e,t){this.visibleInsertLinkPopup(!1),t&&t.stopPropagation()},A.prototype.textColor=function(e,t){this.inactive()||(this.closeAllPopups(),this.visibleFontColorPopup()||(t.stopPropagation(),this.visibleFontColorPopup(!0),this.oFontColorPickerView.onShow(),this.oBackColorPickerView.onShow()))},A.prototype.colorToHex=function(e){if("#"===e.substr(0,1))return e;for(var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),s=l.pInt(t[2]),i=l.pInt(t[3]),o=(l.pInt(t[4])|i<<8|s<<16).toString(16);o.length<6;)o="0"+o;return t[1]+"#"+o},A.prototype.setTextColorFromPopup=function(e){this.oCrea.textColor(this.colorToHex(e)),this.closeAllPopups()},A.prototype.setBackColorFromPopup=function(e){this.oCrea.backgroundColor(this.colorToHex(e)),this.closeAllPopups()},A.prototype.insertImage=function(e,t){return this.inactive()||!y.AllowInsertImage||this.visibleInsertImagePopup()||(t.stopPropagation(),this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader()),!0},A.prototype.insertWebImageFromPopup=function(e,t){y.AllowInsertImage&&this.imagePathFromWeb().length>0&&this.oCrea.insertImage(this.imagePathFromWeb()),this.closeInsertImagePopup(e,t)},A.prototype.insertComputerImageFromPopup=function(e,t){var s,i=new g;i.parse(t),s=i.getActionUrl("view"),y.AllowInsertImage&&s.length>0&&this.oCrea.insertImage(s)&&(o(this.oCrea.$editableArea).find('img[src="'+s+'"]').attr("data-x-src-cid",e),t.CID=e,this.aUploadedImagesData.push(t)),this.closeInsertImagePopup()},A.prototype.getUploadedImagesData=function(){return this.aUploadedImagesData},A.prototype.closeInsertImagePopup=function(e,t){this.visibleInsertImagePopup(!1),t&&t.stopPropagation()},A.prototype.initUploader=function(){this.imageUploaderButton()&&(this.oJua=new u({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),hiddenElementsPosition:d.IsRTL?"right":"left",disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:i.extendOwn({Module:y.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:b.currentAccountId()})}},h.getCommonRequestParameters())}),this.bInsertImageAsBase64?this.oJua.on("onSelect",i.bind(this.onEditorDrop,this)):this.oJua.on("onSelect",i.bind(this.onFileUploadSelect,this)).on("onComplete",i.bind(this.onFileUploadComplete,this)))},A.prototype.initEditorUploader=function(){if(y.AllowInsertImage&&this.uploaderAreaDom()){var e=null,t=null;this.oParent&&this.oParent.composeUploaderDragOver&&this.oParent.onFileUploadProgress&&this.oParent.onFileUploadStart&&this.oParent.onFileUploadComplete?(e=i.bind((function(){this.editorUploaderBodyDragOver(!0),this.oParent.composeUploaderDragOver(!0)}),this),t=i.bind((function(){this.editorUploaderBodyDragOver(!1),this.oParent.composeUploaderDragOver(!1)}),this),this.editorUploader=new u({action:"?/Api/",name:"jua-uploader",queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop,hidden:i.extendOwn({Module:y.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:b.currentAccountId()})}},h.getCommonRequestParameters())}),this.editorUploader.on("onDragEnter",i.bind(this.oParent.composeUploaderDragOver,this.oParent,!0)).on("onDragLeave",i.bind(this.oParent.composeUploaderDragOver,this.oParent,!1)).on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onProgress",i.bind(this.oParent.onFileUploadProgress,this.oParent)).on("onSelect",i.bind(this.onEditorDrop,this)).on("onStart",i.bind(this.oParent.onFileUploadStart,this.oParent)).on("onComplete",i.bind(this.oParent.onFileUploadComplete,this.oParent))):(e=i.bind(this.editorUploaderBodyDragOver,this,!0),t=i.bind(this.editorUploaderBodyDragOver,this,!1),this.editorUploader=new u({queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop}),this.editorUploader.on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onSelect",i.bind(this.onEditorDrop,this)))}},A.prototype.isDragAndDropSupported=function(){return!!this.editorUploader&&this.editorUploader.isDragAndDropSupported()},A.prototype.onEditorDrop=function(e,t){var s=null,i=null,o=this,n=!1,r=Math.random().toString(),l="";if(t&&t.File&&"string"==typeof t.File.type)if(y.AllowInsertImage&&0===t.File.type.indexOf("image/"))i=t.File,y.ImageUploadSizeLimit>0&&i.size>y.ImageUploadSizeLimit?p.showPopup(m,[a.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE")]):(s=new window.FileReader,(n=this.oCrea.isFocused())||this.oCrea.setFocus(!0),l=i.name+"_"+r,this.oCrea.insertHtml('<img id="'+l+'" src="./static/styles/images/wait.gif" />',!0),n||this.oCrea.fixFirefoxCursorBug(),s.onload=function(e){o.oCrea.changeImageSource(l,e.target.result)},s.readAsDataURL(i));else{if(this.oParent&&this.oParent.onFileUploadSelect)return this.oParent.onFileUploadSelect(e,t),!0;c.ie10AndAbove||p.showPopup(m,[a.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")])}return!1},A.prototype.isFileImage=function(e){if("string"==typeof e.Type)return-1!==e.Type.indexOf("image");var t=e.FileName.lastIndexOf("."),s=e.FileName.substr(t+1);return-1!==o.inArray(s,["jpg","jpeg","gif","tif","tiff","png"])},A.prototype.onFileUploadSelect=function(e,t){return this.isFileImage(t)?(this.closeInsertImagePopup(),!0):(p.showPopup(m,[a.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")]),!1)},A.prototype.onFileUploadComplete=function(e,t,s){var i="";s&&s.Result?s.Result.Error?(i="size"===s.Result.Error?a.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):a.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"),p.showPopup(m,[i])):(this.oCrea.setFocus(!0),this.insertComputerImageFromPopup(e,s.Result.Attachment)):p.showPopup(m,[a.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN")])},A.prototype.undo=function(){return this.inactive()||this.oCrea.undo(),!1},A.prototype.redo=function(){return this.inactive()||this.oCrea.redo(),!1},A.prototype.bold=function(){return this.inactive()||(this.oCrea.bold(),this.isFWBold(!this.isFWBold())),!1},A.prototype.italic=function(){return this.inactive()||(this.oCrea.italic(),this.isFSItalic(!this.isFSItalic())),!1},A.prototype.underline=function(){return this.inactive()||(this.oCrea.underline(),this.isTDUnderline(!this.isTDUnderline())),!1},A.prototype.strikeThrough=function(){return this.inactive()||(this.oCrea.strikeThrough(),this.isTDStrikeThrough(!this.isTDStrikeThrough())),!1},A.prototype.numbering=function(){return this.inactive()||(this.oCrea.numbering(),this.isBullets(!1),this.isEnumeration(!this.isEnumeration())),!1},A.prototype.bullets=function(){return this.inactive()||(this.oCrea.bullets(),this.isEnumeration(!1),this.isBullets(!this.isBullets())),!1},A.prototype.removeFormat=function(){return this.inactive()||this.oCrea.removeFormat(),!1},A.prototype.setRtlDirection=function(){return this.inactive()||this.oCrea.setRtlDirection(),!1},A.prototype.setLtrDirection=function(){return this.inactive()||this.oCrea.setLtrDirection(),!1},e.exports=A},aBko:function(e,t,s){"use strict";var i=s("0h2I"),o=s("IAk5"),n=s("hPb3"),r=s("jonm");function a(){this.defaultAccount=r.getDefault(),this.visible=i.observable(!!this.defaultAccount&&this.defaultAccount.oServer.bSetExternalAccessServers),this.externalAccessImapServer=i.observable(this.visible()?this.defaultAccount.oServer.sExternalAccessImapServer:""),this.externalAccessImapPort=i.observable(this.visible()?this.defaultAccount.oServer.iExternalAccessImapPort:143),this.externalAccessSmtpServer=i.observable(this.visible()?this.defaultAccount.oServer.sExternalAccessSmtpServer:""),this.externalAccessSmtpPort=i.observable(this.visible()?this.defaultAccount.oServer.iExternalAccessSmtpPort:25),this.credentialsHintText=o.mobileCredentialsHintText,this.bDemo=n.IsDemo}a.prototype.ViewTemplate="MailWebclient_DefaultAccountHostsSettingsView",e.exports=new a},bBfe:function(e,t,s){"use strict";var i=s("0h2I"),o=s("Ol7c"),n=s("AFLV"),r=s("Yjhd");function a(){this.FETCHER=!0,this.id=i.observable(0),this.accountId=i.observable(0),this.hash=i.computed((function(){return r.getHash(this.accountId()+"fetcher"+this.id())}),this),this.isEnabled=i.observable(!1),this.isLocked=i.observable(!1).extend({autoResetToFalse:1e3}),this.email=i.observable(""),this.userName=i.observable(""),this.folder=i.observable(""),this.useSignature=i.observable(!1),this.signature=i.observable(""),this.incomingServer=i.observable(""),this.incomingPort=i.observable(0),this.incomingUseSsl=i.observable(!1),this.incomingLogin=i.observable(""),this.leaveMessagesOnServer=i.observable(""),this.isOutgoingEnabled=i.observable(!1),this.outgoingServer=i.observable(""),this.outgoingPort=i.observable(0),this.outgoingUseSsl=i.observable(!1),this.outgoingUseAuth=i.observable(!1),this.iCheckIntervalMinutes=0,this.fullEmail=i.computed((function(){return o.getFullEmail(this.userName(),this.email())}),this)}a.prototype.parse=function(e){this.id(n.pInt(e.EntityId)),this.accountId(n.pInt(e.IdAccount)),this.isEnabled(!!e.IsEnabled),this.isLocked(!!e.IsLocked),this.email(n.pString(e.Email)),this.userName(n.pString(e.Name)),this.folder(n.pString(e.Folder)),this.useSignature(!!e.UseSignature),this.signature(n.pString(e.Signature)),this.incomingServer(n.pString(e.IncomingServer)),this.incomingPort(n.pInt(e.IncomingPort)),this.incomingUseSsl(!!e.IncomingUseSsl),this.incomingLogin(n.pString(e.IncomingLogin)),this.leaveMessagesOnServer(!!e.LeaveMessagesOnServer),this.isOutgoingEnabled(!!e.IsOutgoingEnabled),this.outgoingServer(n.pString(e.OutgoingServer)),this.outgoingPort(n.pInt(e.OutgoingPort)),this.outgoingUseSsl(!!e.OutgoingUseSsl),this.outgoingUseAuth(!!e.OutgoingUseAuth),this.iCheckIntervalMinutes=n.pInt(e.CheckInterval,0)},e.exports=a},boka:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("RN+F"),r=s("Yjhd"),a=s("JFZZ"),l=s("czxF"),h=s("jonm"),c=s("UN2P"),u=s("4+IO"),d=s("p2hp");function p(){l.call(this),this.folders=u.editedFolderList,this.sentFolderFullName=o.observable(""),this.draftsFolderFullName=o.observable(""),this.spamFolderFullName=o.observable(""),this.trashFolderFullName=o.observable(""),this.options=o.observableArray([]),this.defaultOptionsAfterRender=r.defaultOptionsAfterRender,this.bAllowSpamFolderEditing=d.AllowSpamFolder}i.extendOwn(p.prototype,l.prototype),p.prototype.PopupTemplate="MailWebclient_Settings_SetSystemFoldersPopup",p.prototype.onOpen=function(){var e=u.editedFolderList();this.options(e.getOptions(n.i18n("MAILWEBCLIENT/LABEL_NO_FOLDER_USAGE_ASSIGNED"),!1,!1,!1)),this.sentFolderFullName(e.sentFolderFullName()),this.draftsFolderFullName(e.draftsFolderFullName()),d.AllowSpamFolder&&this.spamFolderFullName(e.spamFolderFullName()),this.trashFolderFullName(e.trashFolderFullName())},p.prototype.onResponseFoldersSetupSystem=function(e,t){!1===e.Result&&(a.showErrorByCode(e,n.i18n("MAILWEBCLIENT/ERROR_SETUP_SPECIAL_FOLDERS")),u.getFolderList(h.editedId()))},p.prototype.apply=function(){var e=u.editedFolderList(),t=!1,s=null;this.sentFolderFullName()!==e.sentFolderFullName()&&(e.sentFolderFullName(this.sentFolderFullName()),t=!0),this.draftsFolderFullName()!==e.draftsFolderFullName()&&(e.draftsFolderFullName(this.draftsFolderFullName()),t=!0),d.AllowSpamFolder&&this.spamFolderFullName()!==e.spamFolderFullName()&&(e.spamFolderFullName(this.spamFolderFullName()),t=!0),this.trashFolderFullName()!==e.trashFolderFullName()&&(e.trashFolderFullName(this.trashFolderFullName()),t=!0),t&&(s={AccountID:h.editedId(),Sent:e.sentFolderFullName(),Drafts:e.draftsFolderFullName(),Trash:e.trashFolderFullName(),Spam:e.spamFolderFullName()},c.send("SetupSystemFolders",s,this.onResponseFoldersSetupSystem,this)),this.closePopup()},e.exports=new p},cGGv:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("IAk5"),a=s("QFUI"),l=s("RN+F"),h=s("AFLV"),c=s("ZP6a"),u=s("Yjhd"),d=s("ZCBP"),p=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"],m=[];function g(){this.id=n.observable(""),this.index=n.observable(0),this.fileName=n.observable(""),this.tempName=n.observable(""),this.displayName=n.observable(""),this.extension=n.observable(""),this.fileName.subscribe((function(e){this.id(e),this.displayName(e),this.extension(u.getFileExtension(e))}),this),this.size=n.observable(0),this.friendlySize=n.computed((function(){return this.size()>0?l.getFriendlySize(this.size()):""}),this),this.hash=n.observable(""),this.thumbUrlInQueue=n.observable(""),this.thumbUrlInQueueSubscribtion=this.thumbUrlInQueue.subscribe((function(){this.getInThumbQueue()}),this),this.thumbnailSrc=n.observable(""),this.thumbnailLoaded=n.observable(!1),this.thumbnailSessionUid=n.observable(""),this.mimeType=n.observable(""),this.uploadUid=n.observable(""),this.uploaded=n.observable(!1),this.uploadError=n.observable(!1),this.downloading=n.observable(!1),this.isViewMimeType=n.computed((function(){return-1!==o.inArray(this.mimeType(),p)}),this),this.bHasHtmlEmbed=!1,this.otherTemplates=n.observableArray([]),this.visibleCancelButton=n.observable(!0),this.statusText=n.observable(""),this.statusTooltip=n.computed((function(){return this.uploadError()?this.statusText():""}),this),this.progressPercent=n.observable(0),this.visibleProgress=n.observable(!1),this.uploadStarted=n.observable(!1),this.uploadStarted.subscribe((function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))}),this),this.downloading.subscribe((function(){this.downloading()?this.visibleProgress(!0):(this.visibleProgress(!1),this.progressPercent(0))}),this),this.allowDrag=n.observable(!1),this.allowUpload=n.observable(!1),this.allowPublicLink=n.observable(!1),this.bIsSecure=n.observable(!1),this.isShared=n.observable(!1),this.sHeaderText="",this.oActionsData={view:{Text:l.i18n("COREWEBCLIENT/ACTION_VIEW_FILE"),Handler:i.bind((function(){this.viewFile()}),this)},download:{Text:l.i18n("COREWEBCLIENT/ACTION_DOWNLOAD_FILE"),Handler:i.bind((function(){this.downloadFile()}),this),Tooltip:n.computed((function(){var e=l.i18n("COREWEBCLIENT/INFO_CLICK_TO_DOWNLOAD_FILE",{FILENAME:this.fileName(),SIZE:this.friendlySize()});return""===this.friendlySize()&&(e=e.replace(" ()","")),e}),this)}},this.allowActions=n.observable(!0),this.iconAction=n.observable("download"),this.cssClasses=n.computed((function(){return this.getCommonClasses().join(" ")}),this),this.actions=n.observableArray([]),this.firstAction=n.computed((function(){return this.actions().length>1?this.actions()[0]:""}),this),this.secondAction=n.computed((function(){return 1===this.actions().length?this.actions()[0]:this.actions().length>1?this.actions()[1]:""}),this),this.subFiles=n.observableArray([]),this.subFilesExpanded=n.observable(!1)}o("html").hasClass("pdf")&&(p.push("application/pdf"),p.push("application/x-pdf")),g.prototype.addAction=function(e,t,s){t?this.actions.unshift(e):this.actions.push(e),this.actions(i.compact(this.actions())),s&&(this.oActionsData[e]=s)},g.prototype.removeAction=function(e){this.actions(i.without(this.actions(),e))},g.prototype.getMainAction=function(){return this.actions()[0]},g.prototype.hasAction=function(e){return-1!==i.indexOf(this.actions(),e)},g.prototype.getActionText=function(e){return this.hasAction(e)&&this.oActionsData[e]&&("string"==typeof this.oActionsData[e].Text||i.isFunction(this.oActionsData[e].Text))?i.isFunction(this.oActionsData[e].Text)?this.oActionsData[e].Text():this.oActionsData[e].Text:""},g.prototype.getActionUrl=function(e){return this.hasAction(e)&&this.oActionsData[e]&&this.oActionsData[e].Url||""},g.prototype.executeAction=function(e){this.hasAction(e)&&this.oActionsData[e]&&i.isFunction(this.oActionsData[e].Handler)&&this.oActionsData[e].Handler()},g.prototype.getTooltip=function(e){var t=this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Tooltip:"";return"string"==typeof t?t:i.isFunction(t)?t():""},g.prototype.getCommonClasses=function(){var e=[];return(this.allowUpload()&&!this.uploaded()||this.downloading())&&e.push("incomplete"),this.uploadError()?e.push("fail"):e.push("success"),e},g.prototype.parse=function(e){this.fileName(h.pString(e.FileName)),this.tempName(h.pString(e.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.mimeType(h.pString(e.MimeType)),this.size(e.EstimatedSize?h.pInt(e.EstimatedSize):h.pInt(e.SizeInBytes)),this.hash(h.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),o.isFunction(this.additionalParse)&&this.additionalParse(e)},g.prototype.parseActions=function(e){this.thumbUrlInQueue(""!==h.pString(e.ThumbnailUrl)?h.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(e),this.commonExcludeActions()},g.prototype.commonExcludeActions=function(){this.isViewSupported()||this.actions(i.without(this.actions(),"view"))},g.prototype.commonParseActions=function(e){i.each(e.Actions,(function(e,t){this.oActionsData[t]||(this.oActionsData[t]={}),this.oActionsData[t].Url=h.pString(e.url),this.actions.push(t)}),this)},g.addViewExtensions=function(e){i.isArray(e)&&(m=i.union(m,e))},g.prototype.isViewSupported=function(){return-1!==o.inArray(this.mimeType(),p)||-1!==o.inArray(this.extension(),m)},g.prototype.getInThumbQueue=function(){""===this.thumbUrlInQueue()||this.linked&&(!this.linked||this.linked())||(this.thumbnailSessionUid(Date.now().toString()),a.thumbQueue(this.thumbnailSessionUid(),this.thumbUrlInQueue(),this.thumbnailSrc))},g.prototype.downloadFile=function(){var e=this.getActionUrl("download"),t={File:this,CancelDownload:!1};e.length>0&&"#"!==e&&(r.broadcastEvent("AbstractFileModel::FileDownload::before",t),t.CancelDownload||(i.isFunction(t.CustomDownloadHandler)?t.CustomDownloadHandler():c.downloadByUrl(e)))},g.prototype.viewFile=function(e,t){u.calmEvent(t),this.viewCommonFile()},g.prototype.viewCommonFile=function(e){var t=null,s=null;h.isNonEmptyString(e)||(e=c.getAppPath()+this.getActionUrl("view")),e.length>0&&"#"!==e&&(s={sUrl:e,index:this.index(),bBreakView:!1},r.broadcastEvent("AbstractFileModel::FileView::before",s),s.bBreakView||(t=d.open(e,e,!1))&&t.focus())},g.prototype.eventDragStart=function(e,t){var s=t.originalEvent||t;return e&&s&&s.dataTransfer&&s.dataTransfer.setData&&s.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},g.prototype.generateTransferDownloadUrl=function(){var e=this.getActionUrl("download");return"http"!==e.substr(0,4)&&(e=c.getAppPath()+e),this.mimeType()+":"+this.fileName()+":"+e},g.prototype.onUploadSelect=function(e,t,s){s||(this.fileName(h.pString(t.FileName)),this.mimeType(h.pString(t.Type)),this.size(h.pInt(t.Size))),this.uploadUid(e),this.uploaded(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},g.prototype.onUploadStart=function(){this.visibleProgress(!0)},g.prototype.onUploadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(!0))},g.prototype.onDownloadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(this.progressPercent()<100))},g.prototype.onUploadComplete=function(e,t,s){var i,o=!(t&&s&&!s.ErrorCode&&s.Result&&!s.Result.Error),n=s&&s.ErrorCode&&s.ErrorCode===Enums.Errors.CanNotUploadFileLimit?l.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):l.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN");this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(o),this.statusText(o?n:l.i18n("COREWEBCLIENT/REPORT_UPLOAD_COMPLETE")),o||(this.fillDataAfterUploadComplete(s,e),setTimeout((i=this,function(){i.statusText("")}),3e3))},g.prototype.fillDataAfterUploadComplete=function(e,t){},g.prototype.onImageLoad=function(e,t){""===this.thumbUrlInQueue()||this.thumbnailLoaded()||(this.thumbnailLoaded(!0),a.thumbQueue(this.thumbnailSessionUid()))},g.prototype.stopDownloading=function(){this.downloading(!1)},g.prototype.startDownloading=function(){this.downloading(!0)},e.exports=g},cPXi:function(e,t,s){"use strict";var i=s("F/us"),o=s("IAk5"),n=s("hPb3"),r=s("jonm"),a=s("UN2P"),l=s("p2hp"),h=s("4+IO"),c=(s("xzvH"),{}),u=!1;c.prefetchFetchersIdentities=function(){return!(o.isNewTab()||u||!l.AllowFetchers&&!l.AllowIdentities)&&(r.populateFetchersIdentities(),u=!0,!0)},c.prefetchAccountFilters=function(){var e=r.getCurrent(),t=!1;return e&&e.allowFilters()&&!e.filters()&&(e.requestFilters(),t=!0),t},c.prefetchMessageList=function(e,t,s,i){var o,n={page:t,search:s,filters:i},r=e.hasListBeenRequested(n);return o=h.requestMessageList(e.fullName(),n.page,n.search,n.filters,l.MessagesSortBy.DefaultSortBy,l.MessagesSortBy.DefaultSortOrder,!1,!1,r),!r&&!!o&&o.RequestStarted},c.prefetchStarredMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,s=!1;return t&&(s=this.prefetchMessageList(t,1,"",Enums.FolderFilter.Flagged)),s},c.prefetchUnseenMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,s=!1;return t&&(s=this.prefetchMessageList(t,1,"",Enums.FolderFilter.Unseen)),s},c.prefetchNextPage=function(e){var t=h.uidList(),s=i.indexOf(t.collection(),e),o=Math.ceil(s/l.MailsPerPage)+1;this.startPagePrefetch(o-1)},c.prefetchPrevPage=function(e){var t=h.uidList(),s=i.indexOf(t.collection(),e),o=Math.ceil((s+1)/l.MailsPerPage)+1;this.startPagePrefetch(o)},c.startPagePrefetch=function(e){var t=h.folderList().currentFolder(),s=h.uidList(),i=(e-1)*l.MailsPerPage,o=e>0&&i<s.resultCount(),n=!1;return t&&!t.hasChanges()&&o&&(n=this.prefetchMessageList(t,e,s.search(),"")),n},c.startOtherFoldersPrefetch=function(){var e=h.folderList(),t=e.currentFolderFullName(),s=h.getNamesOfFoldersToRefresh(),o=e?[e.inboxFolderFullName(),e.sentFolderFullName(),e.draftsFolderFullName(),e.spamFolderFullName()]:[],n=s.length<5?this.getOtherFolderNames(5-s.length):[],r=i.uniq(i.compact(i.union(o,s,n))),a=!1;return i.each(r,i.bind((function(s){a||t===s||(a=this.startFolderPrefetch(e.getFolderByFullName(s)))}),this)),a},c.getOtherFolderNames=function(e){var t=h.folderList().inboxFolder(),s=t?t.subfolders():[],o=i.filter(h.folderList().collection(),(function(e){return!e.isSystem()}),this),n=i.first(i.union(s,o),e);return i.map(n,(function(e){return e.fullName()}))},c.startFolderPrefetch=function(e){var t=!1;return e&&(t=this.prefetchMessageList(e,1,"","")),t},c.startThreadListPrefetch=function(){var e=[],t=h.getCurrentFolder();return i.each(h.messages(),(function(s){s.threadCount()>0&&i.each(s.threadUids(),(function(s){t.hasThreadUidBeenRequested(s)||e.push(s)}))}),this),e.length>0&&(e=e.slice(0,l.MailsPerPage),t.addRequestedThreadUids(e),t.loadThreadMessages(e),!0)},c.startMessagesPrefetch=function(){var e=h.currentAccountId(),t=h.getCurrentFolder(),s=t?t.fullName():"",o=0,n=l.MaxMessagesBodiesSizeToPrefetch,r=[],c=null,u=function(e){var s=!e.deleted()&&!e.completelyFilled(),a=!i.find(r,(function(t){return t===e.uid()}),this),h=!t.hasUidBeenRequested(e.uid()),c=e.textSize()<l.MessageBodyTruncationThreshold?e.textSize():l.MessageBodyTruncationThreshold;o<n&&s&&a&&h&&(r.push(e.uid()),o+=c+2048)};return!!(t&&t.selected()&&(i.each(h.messages(),u),t.doForAllMessages(u),r.length>0))&&(t.addRequestedUids(r),c={AccountID:e,Folder:s,Uids:r,MessageBodyTruncationThreshold:l.MessageBodyTruncationThreshold},a.send("GetMessagesBodies",c,this.onGetMessagesBodiesResponse,this),!0)},c.onGetMessagesBodiesResponse=function(e,t){var s=t.Parameters,o=h.getFolderByFullName(s.AccountID,s.Folder);i.isArray(e.Result)&&i.each(e.Result,(function(e){o.parseAndCacheMessage(e,!1,!1)}))},c.prefetchAccountQuota=function(){var e=r.getCurrent(),t=e&&!e.quotaRecieved();return!(!n.ShowQuotaBar||!t)&&(e.updateQuotaParams(),!0)},e.exports={startMin:function(){var e=!1;return(e=c.prefetchFetchersIdentities())||(e=c.prefetchAccountFilters()),e||(e=c.prefetchStarredMessageList()),e||(e=c.prefetchAccountQuota()),e},startAll:function(){var e=!1;return(e=c.prefetchFetchersIdentities())||(e=c.prefetchAccountFilters()),e||(e=c.startMessagesPrefetch()),e||(e=c.startThreadListPrefetch()),e||(e=c.prefetchStarredMessageList()),e||(e=c.startPagePrefetch(h.page()+1)),e||(e=c.startPagePrefetch(h.page()-1)),e||(e=c.prefetchUnseenMessageList()),e||(e=c.prefetchAccountQuota()),e||(e=c.startOtherFoldersPrefetch()),e},prefetchStarredMessageList:function(){c.prefetchStarredMessageList()},startFolderPrefetch:function(e){c.startFolderPrefetch(e)},prefetchNextPage:function(e){c.prefetchNextPage(e)},prefetchPrevPage:function(e){c.prefetchPrevPage(e)}}},cyfa:function(e,t,s){"use strict";var i=s("0h2I"),o=s("Ol7c"),n=s("AFLV");function r(){this.sName="",this.sEmail="",this.sDisplay="",this.sFull="",this.loaded=i.observable(!1),this.found=i.observable(!1)}r.prototype.parse=function(e){null!==e&&(this.sName=n.pString(e.DisplayName),this.sEmail=n.pString(e.Email),this.sDisplay=this.sName.length>0?this.sName:this.sEmail,this.sFull=o.getFullEmail(this.sName,this.sEmail))},r.prototype.getEmail=function(){return this.sEmail},r.prototype.getName=function(){return this.sName},r.prototype.getDisplay=function(){return this.sDisplay},r.prototype.getFull=function(){return this.sFull},e.exports=r},dKfC:function(e,t,s){"use strict";var i=s("IAk5"),o=s("SQrT"),n=s("QaF5"),r=s("jxK9"),a=s("jonm"),l=s("4+IO"),h=[],c=[];if(i.isNewTab()){var u={getEditedDraftUid:function(){return l.editedDraftUid()}};window.SlaveTabMailMethods=u,e.exports={}}else{var d={showReport:function(e){o.showReport(e)},getAccountList:function(){return a},getFolderListItems:function(){return l.oFolderListItems},getUidList:function(){return l.uidList()},getComposedMessageAccountId:function(e){var t=h[e];return t?t.accountId:0},getComposedMessage:function(e){var t=h[e];return delete h[e],t},removeOneMessageFromCacheForFolder:function(e,t,s){l.removeOneMessageFromCacheForFolder(e,t,s)},replaceHashWithoutMessageUid:function(e){n.replaceHashWithoutMessageUid(e)},startMessagesLoadingWhenDraftSaving:function(e,t){l.startMessagesLoadingWhenDraftSaving(e,t)},removeMessagesFromCacheForFolder:function(e,t){l.removeMessagesFromCacheForFolder(e,t)},searchMessagesInCurrentFolder:function(e){l.searchMessagesInCurrentFolder(e)},getReplyData:function(e){var t=c[e];return delete c[e],t},deleteMessage:function(e,t){r.deleteMessages([e],t)}};window.MainTabMailMethods=d,e.exports={passReplyData:function(e,t){c[e]=t},passComposedMessage:function(e,t){h[e]=t}}}},dRar:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn");s("0h2I").bindingHandlers.highlighter={init:function(e,t,s,n,r){var a,l=o(e),h=t(),c=h.valueObserver?h.valueObserver:null,u=h.highlighterValueObserver?h.highlighterValueObserver:null,d=h.highlightTrigger?h.highlightTrigger:null,p=["from:","to:","subject:","text:","email:","has:","date:","text:","body:"],m=(a="",o.each(p,(function(e,t){a=e?a+"|\\b"+t:a+"\\b"+t})),new RegExp("("+a+")","g")),g=function(e){return e.replace(/\xC2\xA0/g," ").replace(/\xA0/g," ").replace(/[\s]+/g," ")},f=-1,b=window.navigator.language||window.navigator.userLanguage,y=!i.include(["zh","zh-TW","zh-CN","zh-HK","zh-SG","zh-MO","ja","ja-JP","ko","ko-KR","vi","vi-VN","th","th-TH"],b);function v(t){if(y){var s=0,n=l.text().split(m),r=[];i.each(n,(function(e){var t=e.split("");i.any(p,(function(t){return t===e}))?i.each(t,(function(e){r.push(o(e.replace(/(.)/,'<span class="search_highlight">$&</span>')))})):i.each(t,(function(e){" "===e?r.push(document.createTextNode(" ")):r.push(document.createTextNode(e))}))})),l.is(":focus")?(s=function(e){var t=null,s={},i={},n=0;return window.getSelection&&document.createRange?(t=window.getSelection()).rangeCount>0&&((i=(s=t.getRangeAt(0)).cloneRange()).selectNodeContents(e),i.setEnd(s.startContainer,s.startOffset),n=i.toString().length,o(e).html().length<n&&(n=0)):document.selection&&document.body.createTextRange&&(s=document.selection.createRange(),(i=document.body.createTextRange()).moveToElementText(e),"function"==typeof i.setEndPoint&&i.setEndPoint("EndToStart",s),n=i.text.length),n}(e),l.empty().append(r),function(e,t){var s,i,o;if(!e)return!1;if(document.createRange)(s=document.createRange()).selectNodeContents(e),s.setStart(e,t),s.setEnd(e,t),(i=window.getSelection()).removeAllRanges(),i.addRange(s);else{if(e.createTextRange)return(o=e.createTextRange()).collapse(!0),o.moveEnd(t),o.moveStart(t),o.select(),!0;if(e.setSelectionRange)return e.setSelectionRange(t,t),!0}}(e,s)):l.empty().append(r)}}o(e).on("keydown",(function(e){return e.keyCode!==Enums.Key.Enter})).on("keyup",(function(e){var t=[Enums.Key.Left,Enums.Key.Right,Enums.Key.Home,Enums.Key.End],s=-1!==o.inArray(e.keyCode,t);return e.keyCode===Enums.Key.Shift||e.keyCode===Enums.Key.Alt||e.keyCode===Enums.Key.Ctrl||e.keyCode===Enums.Key.Dash||e.keyCode===Enums.Key.Apostrophe||e.keyCode===Enums.Key.Six&&e.shiftKey||s||(e.ctrlKey||f===Enums.Key.Ctrl)&&e.keyCode===Enums.Key.a||(c(g(l.text())),v(!1)),f=e.keyCode,!0})).on("paste",(function(e){if(document.queryCommandSupported("insertText")){e.preventDefault();var t="";e.clipboardData||e.originalEvent.clipboardData?t=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(t=window.clipboardData.getData("Text")),document.execCommand("insertText",!1,t)}setTimeout((function(){c(g(l.text())),v(!1)}),0)})),setTimeout((function(){v(!0)}),0),d.notifySubscribers(),d.subscribe((function(e){setTimeout((function(){v()}),0)}),this),u.subscribe((function(){var e=l.text(),t=c();e.replace(" "," ")!==t.replace(" "," ")&&l.text(t)}),this)}}},fIp0:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("Yjhd"),a=s("IAk5");function l(e,t){this.bShown=!1,this.currentPage=n.observable(1),this.count=n.observable(e),this.perPage=n.observable(t),this.firstPage=n.observable(1),this.lastPage=n.observable(1),this.pagesCount=n.computed((function(){var e=this.perPage()>0?Math.ceil(this.count()/this.perPage()):0;return e>0?e:1}),this),n.computed((function(){var e=20,t=4,s=this.pagesCount(),i=this.currentPage(),o=i,n=i;if(s>1)for(;e--,1<o&&(o--,t--),0!==t&&(s>n&&(n++,t--),0!==t)&&0!==e;);this.firstPage(o),this.lastPage(n)}),this),this.visibleFirst=n.computed((function(){return this.firstPage()>1}),this),this.visibleLast=n.computed((function(){return this.lastPage()<this.pagesCount()}),this),this.clickPage=i.bind(this.clickPage,this),this.pages=n.computed((function(){var e=this.firstPage(),t=[];if(this.firstPage()<this.lastPage())for(;e<=this.lastPage();e++)t.push({number:e,current:e===this.currentPage(),clickFunc:this.clickPage});return t}),this),a.isMobile()||this.hotKeysBind()}l.prototype.ViewTemplate="CoreWebclient_PageSwitcherView",l.prototype.hotKeysBind=function(){o(document).on("keydown",o.proxy((function(e){if(this.bShown&&!r.isTextFieldFocused()){var t=e.keyCode;e.ctrlKey&&t===Enums.Key.Left?this.clickPreviousPage():e.ctrlKey&&t===Enums.Key.Right&&this.clickNextPage()}}),this))},l.prototype.hide=function(){this.bShown=!1},l.prototype.show=function(){this.bShown=!0},l.prototype.clear=function(){this.currentPage(1),this.count(0)},l.prototype.setCount=function(e){this.count(e),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},l.prototype.setPage=function(e,t){this.perPage(t),e>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(e)},l.prototype.clickPage=function(e){var t=e.number;t<1&&(t=1),t>this.pagesCount()&&(t=this.pagesCount()),this.currentPage(t)},l.prototype.clickFirstPage=function(){this.currentPage(1)},l.prototype.clickPreviousPage=function(){var e=this.currentPage()-1;e<1&&(e=1),this.currentPage(e)},l.prototype.clickNextPage=function(){var e=this.currentPage()+1;e>this.pagesCount()&&(e=this.pagesCount()),this.currentPage(e)},l.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},e.exports=l},gAbd:function(e,t,s){"use strict";var i=s("AFLV");e.exports=function(e){this.iId=e?i.pInt(e.EntityId)||i.pInt(e.ServerId):0,this.iTenantId=e?i.pInt(e.TenantId):0,this.sName=e?i.pString(e.Name):"",this.sIncomingServer=e?i.pString(e.IncomingServer):"",this.iIncomingPort=e?i.pInt(e.IncomingPort):143,this.bIncomingUseSsl=!!e&&!!e.IncomingUseSsl,this.sOutgoingServer=e?i.pString(e.OutgoingServer):"",this.iOutgoingPort=e?i.pInt(e.OutgoingPort):25,this.bOutgoingUseSsl=!!e&&!!e.OutgoingUseSsl,this.sDomains=e?i.pString(e.Domains):"",this.sSmtpAuthType=e?i.pString(e.SmtpAuthType):window.Enums.SmtpAuthType.UseUserCredentials,this.sSmtpLogin=e?i.pString(e.SmtpLogin):"",this.sSmtpPassword=e?i.pString(e.SmtpPassword):"",this.bEnableSieve=!!e&&!!e.EnableSieve,this.iSievePort=e&&e.SievePort?i.pInt(e.SievePort):4190,this.bEnableThreading=!!e&&!!e.EnableThreading,this.bUseFullEmailAddressAsLogin=!e||!!e.UseFullEmailAddressAsLogin,this.bSetExternalAccessServers=i.pBool(e&&e.SetExternalAccessServers,!1),this.sExternalAccessImapServer=i.pString(e&&e.ExternalAccessImapServer,""),this.iExternalAccessImapPort=i.pInt(e&&e.ExternalAccessImapPort,143),this.sExternalAccessSmtpServer=i.pString(e&&e.ExternalAccessSmtpServer,""),this.iExternalAccessSmtpPort=i.pInt(e&&e.ExternalAccessSmtpPort,25),this.bAllowToDelete=i.pBool(e&&e.AllowToDelete,!0),this.bAllowEditDomains=i.pBool(e&&e.AllowEditDomains,!0),this.sOwnerType=e?i.pString(e.OwnerType):""}},h1OO:function(e,t,s){"use strict";var i=s("IAk5"),o=i.isMobile()||i.isNewTab()?s("Olic"):s("TCxV");e.exports=o},jDNX:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("EVdn");function r(e,t,s){this.aGreyColors=["rgb(0, 0, 0)","rgb(68, 68, 68)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(204, 204, 204)","rgb(238, 238, 238)","rgb(243, 243, 243)","rgb(255, 255, 255)"],this.aBrightColors=["rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],this.aColorLines=[["rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)"],["rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]],this.caption=e,this.pickHandler=t,this.pickContext=s,this.colorPickerDom=o.observable(null)}r.prototype.ViewTemplate="MailWebclient_ColorPickerView",r.prototype.onShow=function(){n(this.colorPickerDom()).find("span.color-item").on("click",i.bind((function(e){e.stopPropagation(),this.setColorFromPopup(n(e.target).data("color"))}),this))},r.prototype.setColorFromPopup=function(e){this.pickHandler.call(this.pickContext,e)},e.exports=r},jO9F:function(e,t,s){"use strict";var i=s("F/us"),o={FolderFilter:{Flagged:"flagged",Unseen:"unseen"},FolderTypes:{Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,Template:8,System:9,User:10},SortOrder:{Asc:0,Desc:1},Importance:{Low:5,Normal:3,High:1},Sensitivity:{Nothing:0,Confidential:1,Private:2,Personal:3},AnotherMessageComposedAnswer:{Discard:"Discard",SaveAsDraft:"SaveAsDraft",Cancel:"Cancel"},ReplyType:{Reply:"reply",ReplyAll:"reply-all",Resend:"resend",Forward:"forward",ForwardAsAttach:"eml"},HtmlEditorImageSizes:{Small:"small",Medium:"medium",Large:"large",Original:"original"},UseSignature:{Off:"0",On:"1"},MailErrors:{CannotMoveMessageQuota:4008},ServerOwnerType:{Account:"account",Tenant:"tenant",SuperAdmin:"superadmin"}};void 0===window.Enums&&(window.Enums={}),i.extendOwn(window.Enums,o)},jonm:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("AFLV"),r=s("IAk5").isNewTab()&&window.opener?window.opener.MainTabMailMethods:null,a=s("QaF5"),l=s("o0Bx"),h=s("UN2P"),c=s("4M/5"),u=s("p2hp"),d=s("2ug6"),p=s("bBfe"),m=s("vsma");function g(){this.collection=o.observableArray([])}g.prototype.getAccountByHash=function(e){return i.find(this.collection(),(function(t){return t.hash()===e}),this)},g.prototype.changeCurrentAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.currentId()&&this.changeCurrentAccount(t.id(),!1)},g.prototype.changeCurrentAccount=function(e,t){var s=this.getCurrent(),i=this.getAccount(e);i&&this.currentId()!==e?(s&&s.isCurrent(!1),this.currentId(e),i.isCurrent(!0)):s||this.currentId(0),t&&a.setHash(c.getMailbox())},g.prototype.changeEditedAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.editedId()&&this.changeEditedAccount(t.id())},g.prototype.changeEditedAccount=function(e){var t=this.getEdited(),s=this.getAccount(e);s&&this.editedId()!==e?(t&&t.isEdited(!1),this.editedId(e),s.isEdited(!0)):t||this.editedId(0)},g.prototype.getDefaultFriendlyName=function(){var e=this.getCurrent(),t=i.find(e&&e.identities()||[],(function(e){return e.isDefault()}))||e;return t?t.friendlyName()||t.email():""},g.prototype.getIdentityByHash=function(e){var t=null;return i.each(this.collection(),(function(s){t||(t=i.find(s.identities()||[],(function(t){return t.hash()===e})))}),this),t},g.prototype.getFetcherByHash=function(e){var t=null;return i.each(this.collection(),(function(s){t||(t=i.find(s.fetchers(),(function(t){return t.hash()===e})))}),this),t},g.prototype.parse=function(e){i.isArray(e)&&(this.collection(i.map(e,(function(e){return new d(e)}))),this.initObservables(this.collection().length>0?this.collection()[0].id():0))},g.prototype.initObservables=function(e){var t=this.getAccount(e);t&&(t.isCurrent(!0),t.isEdited(!0)),this.currentId=o.observable(e),this.editedId=o.observable(e)},g.prototype.hasAccount=function(){return this.collection().length>0},g.prototype.getAccount=function(e){return i.find(this.collection(),(function(t){return t.id()===e}),this)},g.prototype.getDefault=function(){return i.find(this.collection(),(function(e){return e.bDefault}),this)},g.prototype.getCurrent=function(){return this.getAccount(this.currentId())},g.prototype.getEdited=function(){return this.getAccount(this.editedId())},g.prototype.getEmail=function(e){e=e||this.currentId();var t="",s=this.getAccount(e);return s&&(t=s.email()),t},g.prototype.addAccount=function(e){this.collection.push(e)},g.prototype.deleteAccount=function(e){this.collection.remove((function(t){return t.id()===e}));var t=this.collection().length>0?this.collection()[0].id():0;this.changeCurrentAccount(t,!1),this.changeEditedAccount(t)},g.prototype.hasAccountWithId=function(e){return!!i.find(this.collection(),(function(t){return t.id()===e}),this)},g.prototype.populateFetchersIdentities=function(){this.populateFetchers(),this.populateIdentities()},g.prototype.populateFetchers=function(){u.AllowFetchers&&l.send(u.FetchersServerModuleName,"GetFetchers",{AccountID:this.editedId()},this.onGetFetchersResponse,this)},g.prototype.onGetFetchersResponse=function(e,t){var s={};n.isNonEmptyArray(e.Result)&&i.each(e.Result,(function(e){var t=new p;t.parse(e),s[t.accountId()]||(s[t.accountId()]=[]),s[t.accountId()].push(t)})),i.each(this.collection(),(function(e){var t=n.isNonEmptyArray(s[e.id()])?s[e.id()]:[];e.fetchers(t)}),this)},g.prototype.populateIdentities=function(e){u.AllowIdentities&&this.collection().length>=1&&h.send("GetIdentities",null,(function(t,s){this.onGetIdentitiesResponse(t,s),i.isFunction(e)&&e()}),this)},g.prototype.onGetIdentitiesResponse=function(e,t){var s={};n.isNonEmptyArray(e.Result)&&i.each(e.Result,(function(e){var t,i=new m;i.parse(e),t=i.accountId(),s[t]||(s[t]=[]),s[t].push(i)})),i.each(this.collection(),(function(e){var t=s[e.id()],o=new m;n.isNonEmptyArray(t)||(t=[]),o.parse({"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Identity",AccountPart:!0,Default:!i.find(t,(function(e){return e.isDefault()})),Email:e.email(),FriendlyName:e.friendlyName(),IdAccount:e.id(),EntityId:1e5*e.id(),Signature:e.signature(),UseSignature:e.useSignature()}),t.unshift(o),e.identities(t)}))},g.prototype.populateIdentitiesFromSourceAccount=function(e){e&&i.each(this.collection(),(function(t){var s=e.getAccount(t.id());s&&(t.fetchers(s.fetchers()),t.identities(s.identities()),t.signature(s.signature()),t.useSignature(s.useSignature()))}))},g.prototype.getAccountsEmails=function(){return i.uniq(i.map(this.collection(),(function(e){return e.email()})))},g.prototype.getAllFullEmails=function(){var e=[];return i.each(this.collection(),(function(t){t&&(n.isNonEmptyArray(t.identities())?i.each(t.identities(),(function(t){e.push(t.fullEmail())})):e.push(t.fullEmail()),i.each(t.fetchers(),(function(t){t.isEnabled()&&t.isOutgoingEnabled()&&""!==t.fullEmail()&&e.push(t.fullEmail())})))})),e},g.prototype.getCurrentFetchersAndFiltersFolderNames=function(){var e=this.getCurrent(),t=[];return e&&(e.filters()&&i.each(e.filters().collection(),(function(e){t.push(e.folder())}),this),i.each(e.fetchers(),(function(e){t.push(e.folder())}),this)),t},g.prototype.getAttendee=function(e){var t=[],s="";return i.each(this.collection(),(function(e){t=e.isCurrent()?i.union([e.email()],e.getFetchersIdentitiesEmails(),t):i.union(t,[e.email()],e.getFetchersIdentitiesEmails())})),t=i.uniq(t),i.each(t,i.bind((function(t){""===s&&(i.find(e,(function(e){return e===t}))===t&&(s=t))}),this)),s};var f=new g;window.auroraAppData.Mail&&i.isArray(window.auroraAppData.Mail.Accounts)?f.parse(window.auroraAppData.Mail.Accounts):f.parse([]),r&&f.populateIdentitiesFromSourceAccount(r.getAccountList()),e.exports=f},jxK9:function(e,t,s){"use strict";var i=s("EVdn"),o=s("RN+F"),n=s("ZP6a"),r=s("gcBV"),a=s("hPb3"),l=s("76Kh"),h=s("20Ah"),c=s("4+IO"),u={deleteMessages:function(e,t){i.isFunction(t)||(t=function(){});var s=c.folderList(),n=s.currentFolderFullName(),r=s.trashFolder(),a=r&&n===r.fullName(),u=s.spamFolder(),d=function(s){s&&(c.deleteMessages(e),t())};u&&n===u.fullName()?(c.deleteMessages(e),t()):a?l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_DELETE_MESSAGES_PLURAL",{},null,e.length),d,"",o.i18n("COREWEBCLIENT/ACTION_DELETE")]):r?(c.moveMessagesToFolder(r.fullName(),e),t()):r||l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),d])},registerMailto:function(e){!window.navigator||!i.isFunction(window.navigator.registerProtocolHandler)||e&&!0===r.getData("MailtoAsked")||(window.navigator.registerProtocolHandler("mailto",n.getAppPath()+"#mail/compose/to/%s",""!==a.SiteName?a.SiteName:"WebMail"),r.setData("MailtoAsked",!0))}};e.exports=u},kwPS:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("AFLV"),a=s("Yjhd"),l=s("IAk5"),h=s("HLSX"),c=s("76Kh");function u(e,t,s,a,h,c,u,d,p,m,g){this.fSelectCallback=t||function(){},this.fDeleteCallback=s||function(){},this.fDblClickCallback=!l.isMobile()&&a?a:function(){},this.fEnterCallback=h||function(){},this.bResetCheckedOnClick=!!u,this.bCheckOnSelect=!!d,this.bUnselectOnCtrl=!!p,this.bDisableMultiplySelection=!!m,this.bChangeOnSelect=void 0===g||!!g,this.useKeyboardKeys=n.observable(!1),this.list=n.observableArray([]),e&&e.subscribe&&e.subscribe((function(e){this.list(e)}),this),this.multiplyLineFactor=c,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Up,this.KeyRight=Enums.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe((function(e){this.iFactor=0<e?e:1}),this):this.iFactor=r.pInt(this.multiplyLineFactor),this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Left,this.KeyRight=Enums.Key.Right,o("html").hasClass("rtl")&&(this.KeyLeft=Enums.Key.Right,this.KeyRight=Enums.Key.Left)),this.sActionSelector="",this.sSelectabelSelector="",this.sCheckboxSelector="";var f=this;this.listChecked=n.computed({read:function(){return i.filter(this.list(),(function(e){var t=e.checked(),s=e.selected();return t||f.bCheckOnSelect&&s}))},write:function(e){e=!!e,i.each(this.list(),(function(t){t.checked(e)})),this.list.valueHasMutated()},owner:this}),this.checkAll=n.computed({read:function(){return 0<this.listChecked().length},write:function(e){this.listChecked(!!e)},owner:this}),this.selectorHook=n.observable(null),this.selectorHook.subscribe((function(){var e=this.selectorHook();e&&i.isFunction(e.selected)&&e.selected(!1)}),this,"beforeChange"),this.selectorHook.subscribe((function(e){e&&e.selected(!0)}),this),this.itemSelected=n.computed({read:this.selectorHook,write:function(e){this.selectorHook(e),e&&(f.scrollToSelected(),this.oLast=e)},owner:this}),this.list.subscribe((function(e){if(i.isArray(e)){var t=this.itemSelected();t&&(i.find(e,(function(e){return t===e}))||this.itemSelected(null))}else this.itemSelected(null)}),this),this.listCheckedOrSelected=n.computed({read:function(){var e=this.itemSelected(),t=this.listChecked();return 0<t.length?t:e?[e]:[]},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=n.computed({read:function(){var e=[],t=this.itemSelected(),s=this.listChecked();return s&&(e=s.slice(0)),t&&-1===i.indexOf(s,t)&&e.push(t),e},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=n.computed((function(){var e=this.list().length,t=this.listChecked().length;return 0<e&&0<t&&e>t}),this),this.onKeydownBound=i.bind(this.onKeydown,this)}u.prototype.iTimer=0,u.prototype.bResetCheckedOnClick=!1,u.prototype.bCheckOnSelect=!1,u.prototype.bUnselectOnCtrl=!1,u.prototype.bDisableMultiplySelection=!1,u.prototype.getLastOrSelected=function(){var e=0,t=null;return i.each(this.list(),(function(s){s.checked()&&e++,s.selected()&&(t=s)})),0===e&&t?t:this.oLast},u.prototype.initOnApplyBindings=function(e,t,s,i,r){o(document).on("keydown",this.onKeydownBound),this.oListScope=i,this.oScrollScope=r,this.sActionSelector=e,this.sSelectabelSelector=t,this.sCheckboxSelector=s;var a=this,l=function(e,t,s){var i=0,o=0,n=null,r=!1,l=!1,h=[],c=!1;if(t=t||null,s&&s.shiftKey&&null!==t&&null!==e&&t!==e)for(h=a.list(),c=t.checked(),i=0,o=h.length;i<o;i++)r=!1,(n=h[i])!==e&&n!==t||(r=!0),r&&(l=!l),(l||r)&&n.checked(c);t&&(a.oLast=t)};o(this.oListScope).on("dblclick",e,(function(e){var t=n.dataFor(this);!t||!e||e.ctrlKey||e.altKey||e.shiftKey||a.onDblClick(t)})),h.mobileDevice&&o(this.oListScope).on("touchstart",e,(function(e){if(e){var t=e.timeStamp,s=t-(o(this).data("lastTouch")||t),i=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches.length:0;o(this).data("lastTouch",t),!s||s>250||i>1||(e.preventDefault(),o(this).trigger("dblclick"))}})),o(this.oListScope).on("click",e,(function(e){var t=!0,s=null,i=a.getLastOrSelected(),o=n.dataFor(this);o&&e&&(e.shiftKey?(t=!1,a.bDisableMultiplySelection||(null===a.oLast&&(a.oLast=o),o.checked(!o.checked()),l(i,o,e))):e.ctrlKey&&(t=!1,a.bDisableMultiplySelection||(a.oLast=o,!(s=a.itemSelected())||s.checked()||o.checked()||s.checked(!0),a.bUnselectOnCtrl&&o===a.itemSelected()?(o.checked(!o.selected()),a.itemSelected(null)):o.checked(!o.checked()))),t&&a.selectionFunc(o))})),o(this.oListScope).on("click",s,(function(e){var t=n.dataFor(this);t&&e&&!a.bDisableMultiplySelection&&(e.shiftKey?(null===a.oLast&&(a.oLast=t),l(a.getLastOrSelected(),t,e)):a.oLast=t),e&&e.stopPropagation&&e.stopPropagation()})),o(this.oListScope).on("dblclick",s,(function(e){e&&e.stopPropagation&&e.stopPropagation()}))},u.prototype.getResultSelection=function(e,t){var s=this,n=!1,r=!1,a=null,l=this.iFactor,h=!!this.multiplyLineFactor,c=0,u=0,d=[];if(!e&&-1<o.inArray(t,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]))(d=this.list())&&0<d.length&&(-1<o.inArray(t,[this.KeyDown,this.KeyRight,Enums.Key.PageUp,Enums.Key.Home])?a=d[0]:-1<o.inArray(t,[this.KeyUp,this.KeyLeft,Enums.Key.PageDown,Enums.Key.End])&&(a=d[d.length-1]));else if(e&&0<(u=(d=this.list())?d.length:0))if(Enums.Key.Home===t||Enums.Key.PageUp===t||Enums.Key.End===t||Enums.Key.PageDown===t||h&&(Enums.Key.Left===t||Enums.Key.Right===t)||!h&&(Enums.Key.Up===t||Enums.Key.Down===t))i.each(d,(function(i){if(!n)switch(t){case s.KeyUp:case s.KeyLeft:e===i?n=!0:a=i;break;case Enums.Key.Home:case Enums.Key.PageUp:a=i,n=!0;break;case s.KeyDown:case s.KeyRight:r?(a=i,n=!0):e===i&&(r=!0);break;case Enums.Key.End:case Enums.Key.PageDown:a=i}}));else if(h&&this.KeyDown===t){for(;c<u;c++)if(e===d[c]){u-1<(c+=l)&&(c-=l),a=d[c];break}}else if(h&&this.KeyUp===t)for(c=u;c>=0;c--)if(e===d[c]){0>(c-=l)&&(c+=l),a=d[c];break}return a},u.prototype.shiftClickResult=function(e,t,s){if(t){var n=!!this.multiplyLineFactor,r=!1,a=!1;-1<o.inArray(s,n?[Enums.Key.Left,Enums.Key.Right]:[Enums.Key.Up,Enums.Key.Down])?t.checked(!t.checked()):-1<o.inArray(s,n?[Enums.Key.Up,Enums.Key.Down,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]:[Enums.Key.Left,Enums.Key.Right,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End])&&(a=!t.checked(),i.each(this.list(),(function(s){var i=!1;s!==e&&t!==s||(r=!r,i=!0),(r||i)&&(s.checked(a),i=!1)})),n&&e&&(s===Enums.Key.Up||s===Enums.Key.Down)&&e.checked(!e.checked()))}},u.prototype.clickNewSelectPosition=function(e,t){var s=this.itemSelected(),i=this.getResultSelection(s,e);i&&(t&&this.shiftClickResult(i,s,e),this.selectionFunc(i))},u.prototype.onKeydown=function(e){var t=!0,s=0;return this.useKeyboardKeys()&&e&&!a.isTextFieldFocused()&&!c.hasOpenedMaximizedPopups()&&(s=e.keyCode,e.ctrlKey||this.KeyUp!==s&&this.KeyDown!==s&&this.KeyLeft!==s&&this.KeyRight!==s&&Enums.Key.PageUp!==s&&Enums.Key.PageDown!==s&&Enums.Key.Home!==s&&Enums.Key.End!==s?Enums.Key.Del!==s||e.ctrlKey||e.shiftKey?Enums.Key.Enter===s?0<this.list().length&&!e.ctrlKey&&(this.onEnter(this.itemSelected()),t=!1):!e.ctrlKey||e.altKey||e.shiftKey||Enums.Key.a!==s||(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),t=!1):0<this.list().length&&(this.onDelete(),t=!1):(this.clickNewSelectPosition(s,e.shiftKey),t=!1)),t},u.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected())},u.prototype.onEnter=function(e){this.fEnterCallback.call(this,e)},u.prototype.selectionFunc=function(e){this.bChangeOnSelect&&this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.bChangeOnSelect&&this.itemSelected(e),this.fSelectCallback.call(this,e)},u.prototype.onDblClick=function(e){this.fDblClickCallback.call(this,e)},u.prototype.koCheckAll=function(){return n.computed({read:this.checkAll,write:this.checkAll,owner:this})},u.prototype.koCheckAllIncomplete=function(){return n.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},u.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var e=o(this.sSelectabelSelector,this.oScrollScope),t=e.position(),s=this.oScrollScope.height(),i=e.outerHeight();return!(!t||!(t.top<0||t.top+i>s))&&(t.top<0?this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+t.top-20):this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+t.top-s+i+20),!0)},e.exports=u},lPfU:function(e,t,s){"use strict";var i=s("F/us"),o=s("0h2I"),n=s("xzvH"),r=s("p2hp");function a(){this.iAccountId=0,this.sFullName="",this.search=o.observable(""),this.filters=o.observable(""),this.sortBy=o.observable(r.MessagesSortBy.DefaultSortBy),this.sortOrder=o.observable(r.MessagesSortBy.DefaultSortOrder),this.resultCount=o.observable(-1),this.collection=o.observableArray([]),this.threadUids={}}a.prototype.addThreadUids=function(e,t){-1!==i.indexOf(this.collection(),e)&&(this.threadUids[e]=t)},a.prototype.setUidsAndCount=function(e){"Collection/MessageCollection"===e["@Object"]&&(i.each(e.Uids,(function(t,s){this.collection()[s+e.Offset]=t.toString()}),this),this.resultCount(e.MessageResultCount))},a.prototype.getUidsForOffset=function(e){for(var t=0,s=this.collection().length,i="",o=0,a=[],l=null;t<s;t++)t>=e&&o<r.MailsPerPage&&(i=this.collection()[t],((l=n.get([this.iAccountId,this.sFullName,i]))&&!l.deleted()||void 0===i)&&(o++,void 0!==i&&a.push(i)));return a},a.prototype.deleteUids=function(e){for(var t=0,s=this.collection().length,o="",n=[],r=0;t<s;t++)o=this.collection()[t],-1===i.indexOf(e,o)?n.push(o):r++;this.collection(n),this.resultCount(this.resultCount()-r)},a.prototype.clearData=function(){this.resultCount(-1),this.collection([]),this.threadUids={}},e.exports=a},mjrp:function(e,t,s){"use strict";var i=s("EVdn"),o=s("F/us"),n=s("0h2I"),r=s("w+bY"),a=s("AFLV"),l=s("IAk5"),h=20;function c(e){return void 0===e}function u(e){0<e&&clearTimeout(e),e=0}function d(e){return(e=e&&(e.originalEvent?e.originalEvent:e)||window.event).dataTransfer?e:null}function p(e,t,s){return e&&t&&!c(e[t])?e[t]:s}function m(e,t,s){e[t]=s}function g(){return"jua-uid-"+function(e){var t="",s="0123456789abcdefghijklmnopqrstuvwxyz";for(e=c(e)?32:a.pInt(e);t.length<e;)t+=s.substr(Math.round(Math.random()*s.length),1);return t}(16)+"-"+(new Date).getTime().toString()}function f(e,t){return{FileName:c(e.fileName)?c(e.name)?null:e.name:e.fileName,Size:c(e.fileSize)?c(e.size)?null:e.size:e.fileSize,Type:c(e.type)?null:e.type,Folder:c(t)?"":t,File:e}}function b(e,t,s,i,o,n){var r=0,l=0,u=0,d=null,p=null,m=!1,g=!1,b=function(e,t,s,l){if(e&&!c(e.name))if(t=t||"",e.isFile)e.file((function(e){!m||0<=--o?s(f(e,t)):m&&!g&&0>o&&n&&(g=!0,n(r))}));else if(i&&e.isDirectory&&e.createReader){var h=e.createReader(),u=0,d=0;h&&h.readEntries&&h.readEntries((function(i){if(i&&a.isNonEmptyArray(i))for(u=0,d=i.length;u<d;u++)b(i[u],t+e.name+"/",s,l)}))}};if(i=!!c(i)||!!i,s=!c(s)&&!!s,o=c(o)?h:a.pInt(o),r=o,m=0<o,e=e&&0<e.length?e:null)for(u=0,l=e.length;u<l;u++)(d=e[u])&&(s?"file"===d.kind&&d.webkitGetAsEntry&&(p=d.webkitGetAsEntry())&&b(p,"",t,n):!m||0<=--o?t(f(d)):m&&!g&&0>o&&n&&(g=!0,n(r)))}function y(e,t,s,i){var o=e&&e.files&&0<e.files.length?e.files:null;o?b(o,t,!1,!1,s,i):t({FileName:e.value.split("\\").pop().split("/").pop(),Size:null,Type:null,Folder:"",File:null})}function v(e){var t=!1;if(e&&e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.length)for(var s=0,i=e.dataTransfer.types.length;s<i;s++)if("files"===e.dataTransfer.types[s].toLowerCase()){t=!0;break}return t}function A(){return i('<label style="position: absolute; background-color:#fff; right: 0px; top: 0px; left: 0px; bottom: 0px; margin: 0px; padding: 0px; cursor: pointer;"></label>').css({opacity:0})}function F(e,t,s,o){e=c(e)?"":e.toString();var n=function(e,t){return""!==t&&(t=' accept="'+t+'"'),i('<input type="file" tabindex="-1" hidefocus="hidefocus" style="position: absolute; '+e+': -9999px;"'+t+" />")}(s=c(s)?"left":s.toString(),o=c(o)?"":o.toString());return 0<e.length&&n.attr("name",e),(c(t)||t)&&n.prop("multiple",!0),n}function S(e,t){return a.pString(o.isFunction(e)?e.apply(null,o.isArray(t)?t:[]):e)}function E(e,t){this.oXhrs={},this.oUids={},this.oJua=e,this.oOptions=t}function I(e,t){this.oUids={},this.oForms={},this.oJua=e,this.oOptions=t}function C(e){e=c(e)?{}:e;var t=this;t.bEnableDnD=!0,t.bEnableButton=!0,t.oEvents={onDialog:null,onSelect:null,onStart:null,onComplete:null,onCompleteAll:null,onProgress:null,onDragEnter:null,onDragLeave:null,onDrop:null,onBodyDragEnter:null,onBodyDragLeave:null,onLimitReached:null},t.oOptions=o.extend({action:"",name:"",hidden:{},queueSize:10,clickElement:!1,dragAndDropElement:!1,dragAndDropBodyElement:!1,disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!1,disableMultiple:!1,disableDocumentDropPrevent:!1,disableAutoUploadOnDrop:!1,multipleSizeLimit:50,hiddenElementsPosition:"left"},e),t.oQueue=r(a.pInt(p(t.oOptions,"queueSize",10))),t.runEvent("onCompleteAll")&&t.oQueue.await((function(){t.runEvent("onCompleteAll")})),t.oDriver=t.isAjaxUploaderSupported()&&!p(t.oOptions,"disableAjaxUpload",!1)?new E(t,t.oOptions):new I(t,t.oOptions),t.oClickElement=p(t.oOptions,"clickElement",null),t.oClickElement&&(i(t.oClickElement).css({position:"relative",overflow:"hidden"}),"inline"===i(this.oClickElement).css("display")&&i(this.oClickElement).css("display","inline-block"),this.oDriver.generateNewInput(this.oClickElement)),this.oDriver.isDragAndDropSupported()&&p(this.oOptions,"dragAndDropElement",!1)&&!p(this.oOptions,"disableAjaxUpload",!1)?function(e){var t=i(document),s=i(p(e.oOptions,"dragAndDropBodyElement",!1)||t),o=p(e.oOptions,"dragAndDropElement",!1);o&&(p(e.oOptions,"disableDocumentDropPrevent",!1)||t.on("dragover",(function(t){if(e.bEnableDnD&&t&&(t=d(t))&&t.dataTransfer&&v(t))try{t.dataTransfer.dropEffect="none",t.preventDefault()}catch(e){}})),s&&s[0]&&s.on("dragover",(function(t){e.bEnableDnD&&t&&u(e.iDocTimer)})).on("dragenter",(function(t){e.bEnableDnD&&t&&(t=d(t))&&v(t)&&(u(e.iDocTimer),t.preventDefault(),e.runEvent("onBodyDragEnter",[t]))})).on("dragleave",(function(t){e.bEnableDnD&&t&&(t=d(t))&&(u(e.iDocTimer),e.iDocTimer=setTimeout((function(){e.runEvent("onBodyDragLeave",[t])}),200))})).on("drop",(function(t){if(e.bEnableDnD&&t&&(t=d(t))){var s=v(t);return s&&t.preventDefault(),e.runEvent("onBodyDragLeave",[t]),!s}return!1})),i(o).bind("dragenter",(function(t){e.bEnableDnD&&t&&(t=d(t))&&v(t)&&(u(e.iDocTimer),t.preventDefault(),e.runEvent("onDragEnter",[o,t]))})).bind("dragover",(function(t){if(e.bEnableDnD&&t&&(t=d(t))&&t.dataTransfer&&v(t))try{var i=t.dataTransfer.effectAllowed;u(e.iDocTimer),t.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",t.stopPropagation(),t.preventDefault(),s.trigger("dragover",t)}catch(e){}})).bind("dragleave",(function(t){if(e.bEnableDnD&&t){if(t=d(t)){var s=document.elementFromPoint?document.elementFromPoint(t.clientX,t.clientY):null;if(s&&(n=s,r=!1,(i=this)&&n&&(r=i===n||(i.contains?i.contains(n):!!n.compareDocumentPosition&&!!(8&n.compareDocumentPosition(i)))),r))return;u(e.iDocTimer),e.runEvent("onDragLeave",[o,t])}}else var i,n,r})).bind("drop",(function(t){e.bEnableDnD&&t&&(t=d(t))&&v(t)&&(t.preventDefault(),function(e,t,s,i,o){var n=null,r=null;(e=d(e))&&((n=(e.dataTransfer?p(e.dataTransfer,"items",null):null)||p(e,"items",null))&&0<n.length&&n[0]&&n[0].webkitGetAsEntry?b(n,t,!0,o,s,i):v(e)&&(r=p(e,"files",null)||(e.dataTransfer?p(e.dataTransfer,"files",null):null))&&0<r.length&&b(r,t,!1,!1,s,i))}(t,(function(s){s&&(p(e.oOptions,"disableAutoUploadOnDrop",!1)?e.runEvent("onDrop",[s,t,function(){e.addNewFile(s),u(e.iDocTimer)}]):(e.runEvent("onDrop",[s,t]),e.addNewFile(s),u(e.iDocTimer)))}),p(e.oOptions,"multipleSizeLimit",h),e.getEvent("onLimitReached"),!p(e.oOptions,"disableFolderDragAndDrop",!0))),e.runEvent("onDragLeave",[t])})))}(t):t.bEnableDnD=!1,m(t,"on",t.on),m(t,"cancel",t.cancel),m(t,"isDragAndDropSupported",t.isDragAndDropSupported),m(t,"isAjaxUploaderSupported",t.isAjaxUploaderSupported),m(t,"setDragAndDropEnabledStatus",t.setDragAndDropEnabledStatus)}E.prototype.oXhrs={},E.prototype.oUids={},E.prototype.oJua=null,E.prototype.oOptions={},E.prototype.isDragAndDropSupported=function(){return!0},E.prototype.regTaskUid=function(e){this.oUids[e]=!0},E.prototype.uploadTask=function(e,t,s,n,r,a,l){if(!1===this.oUids[e]||!t||!t.File)return n(null,e),!1;try{var h=this,u=new XMLHttpRequest,d=new FormData,m=p(this.oOptions,"action",""),g=o.clone(p(this.oOptions,"hidden",{})),f=this.oJua.getEvent("onStart"),b=this.oJua.getEvent("onComplete"),y=this.oJua.getEvent("onProgress");return u.open("POST",m,!0),u.setRequestHeader("Authorization","Bearer "+i.cookie("AuthToken")),u.setRequestHeader("X-Client","WebClient"),y&&u.upload&&(u.upload.onprogress=function(s){s&&s.lengthComputable&&!c(s.loaded)&&!c(s.total)&&(void 0===l?y(e,s.loaded,s.total):y(e,l+s.loaded>t.Size?t.Size:l+s.loaded,t.Size))}),u.onreadystatechange=function(){if(4===u.readyState&&200===u.status){if(b&&!r){var t=!1,s=null;try{s=i.parseJSON(u.responseText),t=!0}catch(e){s=null}b(e,t,s)}c(h.oXhrs[e])||(h.oXhrs[e]=null),n(a?u.responseText:null,e)}else 4===u.readyState&&(b(e,!1,null),n(null,e))},f&&f(e),d.append("jua-post-type","ajax"),d.append(p(this.oOptions,"name","juaFile"),t.File,t.FileName),s=o.extend(s,t.Hidden||{}),g.Parameters=JSON.stringify(s),i.each(g,(function(e,s){d.append(e,S(s,[t]))})),u.send(d),this.oXhrs[e]=u,!0}catch(e){window.console&&window.console.error(e)}return n(null,e),!1},E.prototype.generateNewInput=function(e){var t=this,s=null,o=null;e&&(o=F("",!p(this.oOptions,"disableMultiple",!1),p(this.oOptions,"hiddenElementsPosition","left"),p(this.oOptions,"accept","")),(s=A()).append(o),i(e).append(s),o.on("click",(function(e){if(t.oJua.bEnableButton){var s=t.oJua.getEvent("onDialog");s&&s()}else e.preventDefault()})).on("change",(function(){y(this,(function(i){t.oJua.addNewFile(i),t.generateNewInput(e),setTimeout((function(){s.remove()}),10)}),p(t.oOptions,"multipleSizeLimit",h),t.oJua.getEvent("onLimitReached"))})))},E.prototype.cancel=function(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){}this.oXhrs[e]=null}},I.prototype.oUids={},I.prototype.oForms={},I.prototype.oJua=null,I.prototype.oOptions={},I.prototype.isDragAndDropSupported=function(){return!1},I.prototype.regTaskUid=function(e){this.oUids[e]=!0},I.prototype.uploadTask=function(e,t,s,n,r,a,l){if(!1===this.oUids[e])return n(null,e),!1;var h=this.oForms[e],c=o.clone(p(this.oOptions,"hidden",{})),u=this.oJua.getEvent("onStart"),d=this.oJua.getEvent("onComplete");return h?(h.append(i('<input type="hidden" />').attr("name","jua-post-type").val("iframe")),s=o.extend(s,t.Hidden||{}),c.Parameters=JSON.stringify(s),i.each(c,(function(e,s){h.append(i('<input type="hidden" />').attr("name",e).val(S(s,[t])))})),h.trigger("submit"),u&&u(e),h.find("iframe").on("load",(function(t){var s=!1,o=null,r={};if(d){try{o=this.contentDocument?this.contentDocument:this.contentWindow.document,r=i.parseJSON(o.body.innerHTML),s=!0}catch(e){r={}}d(e,s,r)}n(null,e),window.setTimeout((function(){h.remove()}),100)}))):n(null,e),!0},I.prototype.generateNewInput=function(e){var t=this,s="",o=null,n=null,r=p(this.oOptions,"action",""),a=null,l=p(this.oOptions,"hiddenElementsPosition","left");e&&(s=g(),o=F(p(this.oOptions,"name","juaFile"),!p(this.oOptions,"disableMultiple",!1),p(this.oOptions,"hiddenElementsPosition","left"),p(this.oOptions,"accept","")),a=i('<form action="'+r+'" target="iframe-'+s+'"  method="POST" enctype="multipart/form-data" style="display: block; cursor: pointer;"></form>'),n=i('<iframe name="iframe-'+s+'" tabindex="-1" src="javascript:void(0);"  style="position: absolute; top: -1000px; '+l+': -1000px; cursor: pointer;" />').css({opacity:0}),a.append(A().append(o)).append(n),i(e).append(a),this.oForms[s]=a,o.on("click",(function(e){if(t.oJua.bEnableButton){var s=t.oJua.getEvent("onDialog");s&&s()}else e.preventDefault()})).on("change",(function(){y(this,(function(i){if(i){var o=p(t.oOptions,"hiddenElementsPosition","left");a.css({position:"absolute",top:-1e3}),a.css(o,-1e3),t.oJua.addFile(s,i),t.generateNewInput(e)}}),p(t.oOptions,"multipleSizeLimit",h),t.oJua.getEvent("onLimitReached"))})))},I.prototype.cancel=function(e){this.oUids[e]=!1,this.oForms[e]&&(this.oForms[e].remove(),this.oForms[e]=!1)},C.prototype.bEnableDnD=!0,C.prototype.iDocTimer=0,C.prototype.oOptions={},C.prototype.oEvents={},C.prototype.oQueue=null,C.prototype.oDriver=null,C.prototype.on=function(e,t){return this.oEvents[e]=t,this},C.prototype.runEvent=function(e,t){this.oEvents[e]&&this.oEvents[e].apply(null,t||[])},C.prototype.getEvent=function(e){return this.oEvents[e]||null},C.prototype.cancel=function(e){this.oDriver.cancel(e)},C.prototype.isAjaxUploaderSupported=function(){return(e=document.createElement("input")).type="file",!!("XMLHttpRequest"in window&&"multiple"in e&&"FormData"in window&&(new XMLHttpRequest).upload);var e},C.prototype.setDragAndDropEnabledStatus=function(e){this.bEnableDnD=!!e},C.prototype.isDragAndDropSupported=function(){return this.oDriver.isDragAndDropSupported()},C.prototype.addNewFile=function(e){this.addFile(g(),e)},C.prototype.addFile=function(e,t){var s=this.getEvent("onSelect"),r=null,a=p(this.oOptions,"hidden",{}),h=this.getEvent("onComplete"),u=o.bind((function(e,t){var s,i,o=p(this.oOptions,"hidden",{}),n=JSON.parse(S(o.Parameters,[t]));this.oDriver.regTaskUid(e),this.oQueue.defer((s=this.oDriver.uploadTask,i=this.oDriver,function(){return s.apply(c(i)?null:i,Array.prototype.slice.call(arguments))}),e,t,n)}),this),d=this.getEvent("onCancel");if(!t||s&&!1===s(e,t))this.oDriver.cancel(e);else{r=o.bind((function(e,t,s,o,n,a){var c;c=function(t,o){var n=null;try{n=i.parseJSON(t)}catch(e){}n&&n.Result&&!n.Result.Error&&!n.ErrorCode?s(e,r):n&&n.Result&&n.Result.Error?(l.broadcastEvent("Jua::FileUploadingError"),h(o,!1,{ErrorCode:n.Result.Error})):n&&n.ErrorCode?(l.broadcastEvent("Jua::FileUploadingError"),h(o,!1,{ErrorCode:n.ErrorCode})):(l.broadcastEvent("Jua::FileUploadingError"),h(o,!1))};var u=p(this.oOptions,"hidden",{}),d=JSON.parse(S(u.Parameters,[t]));this.oDriver.regTaskUid(e),this.oDriver.uploadTask(e,t,d,c,o<n,!0,a)}),this);var m=n.observable(!0),g=JSON.parse(S(a.Parameters,[t]));l.broadcastEvent("Jua::FileUpload::isUploadAvailable",{isUploadAvailable:m,sModuleName:a.Module,sUid:e,oFileInfo:t}),m()?!1===l.broadcastEvent("Jua::FileUpload::before",{sUid:e,oFileInfo:t,fOnChunkReadyCallback:r,sModuleName:a.Module,fRegularUploadFileCallback:u,fCancelFunction:d,sStorageType:g.Type})&&u(e,t):o.isFunction(d)&&d(e)}},C.prototype.setOption=function(e,t){this.oOptions[e]=t},e.exports=C},nKlx:function(e,t,s){"use strict";var i=s("RN+F"),o={getMonthNamesArray:function(){for(var e=i.i18n("COREWEBCLIENT/LIST_MONTH_NAMES").split(" "),t=e.length;t<12;t++)e[t]="";return e},daysInMonth:function(e,t){return 0<e&&13>e&&0<t?new Date(t,e,0).getDate():31}};e.exports=o},nQVw:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("Yjhd"),l=s("JFZZ"),h=s("czxF"),c=s("jonm"),u=s("UN2P"),d=s("4+IO");function p(){h.call(this),this.isCreating=n.observable(!1),d.folderListLoading.subscribe((function(){!(-1!==d.folderListLoading.indexOf(d.editedFolderList().iAccountId))&&this.isCreating()&&(o.isFunction(this.fCallback)&&this.fCallback(this.folderName(),this.parentFolder()),this.isCreating(!1),this.closePopup())}),this),this.options=n.observableArray([]),this.parentFolder=n.observable(""),this.folderName=n.observable(""),this.folderNameFocus=n.observable(!1),this.fCallback=null,this.defaultOptionsAfterRender=a.defaultOptionsAfterRender}i.extendOwn(p.prototype,h.prototype),p.prototype.PopupTemplate="MailWebclient_Settings_CreateFolderPopup",p.prototype.onOpen=function(e){this.options(d.editedFolderList().getOptions(r.i18n("MAILWEBCLIENT/LABEL_NO_PARENT_FOLDER"),!0,!1,!0)),this.fCallback=e,this.folderName(""),this.folderNameFocus(!0)},p.prototype.create=function(){var e=""===this.parentFolder()?d.editedFolderList().sNamespaceFolder:this.parentFolder(),t={AccountID:c.editedId(),FolderNameInUtf8:this.folderName(),FolderParentFullNameRaw:e,Delimiter:d.editedFolderList().sDelimiter};this.folderNameFocus(!1),this.isCreating(!0),u.send("CreateFolder",t,this.onCreateFolderResponse,this)},p.prototype.onCreateFolderResponse=function(e,t){e.Result?d.getFolderList(c.editedId()):(this.isCreating(!1),l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_CREATE_FOLDER")))},p.prototype.cancelPopup=function(){this.isCreating()||(o.isFunction(this.fCallback)&&this.fCallback("",""),this.closePopup())},e.exports=new p},oROo:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("nKlx"),a=s("RN+F"),l=s("AFLV"),h=s("JFZZ"),c=s("IAk5"),u=s("HLSX"),d=s("mjrp"),p=s("kwPS"),m=s("OgeD"),g=s("QaF5"),f=s("SQrT"),b=s("fIp0"),y=s("h1OO"),v=s("4M/5"),A=s("jxK9"),F=s("jonm"),S=s("4+IO"),E=s("p2hp");function I(e){this.bVisibleSortByTool=E.MessagesSortBy.Allow&&E.MessagesSortBy.List.length>0,this.sSortBy=E.MessagesSortBy.DefaultSortBy,this.iSortOrder=E.MessagesSortBy.DefaultSortOrder,this.aSortList=[],i.each(E.MessagesSortBy.List,function(e){this.aSortList.push({sText:a.i18n("MAILWEBCLIENT/"+e.LangConst),sSortBy:e.SortBy,sortOrder:n.observable(E.MessagesSortBy.DefaultSortBy),selected:n.observable(e.SortBy===E.MessagesSortBy.DefaultSortOrder)})}.bind(this)),this.uploaderArea=n.observable(null),this.bDragActive=n.observable(!1),this.bDragActiveComp=n.computed((function(){return this.bDragActive()}),this),this.openMessageInNewWindowBound=e,this.isFocused=n.observable(!1),this.messagesContainer=n.observable(null),this.searchInput=n.observable(""),this.searchInputFrom=n.observable(""),this.searchInputTo=n.observable(""),this.searchInputSubject=n.observable(""),this.searchInputText=n.observable(""),this.searchSpan=n.observable(""),this.highlightTrigger=n.observable(""),this.currentMessage=S.currentMessage,this.currentMessage.subscribe((function(){this.isFocused(!1),this.selector.itemSelected(this.currentMessage())}),this),this.folderList=S.folderList,this.folderList.subscribe(this.onFolderListSubscribe,this),this.folderFullName=n.observable(""),this.folderType=n.observable(Enums.FolderTypes.User),this.filters=n.observable(""),this.uidList=S.uidList,this.uidList.subscribe((function(){this.uidList().searchCountSubscription&&(this.uidList().searchCountSubscription.dispose(),this.uidList().searchCountSubscription=void 0),this.uidList().searchCountSubscription=this.uidList().resultCount.subscribe((function(){this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())}),this),this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())}),this),this.useThreading=n.computed((function(){var e=F.getCurrent(),t=this.folderList().currentFolder(),s=t&&t.withoutThreads(),i=""===this.uidList().search()&&""===this.uidList().filters();return e&&e.threadingIsAvailable()&&!s&&i}),this),this.collection=S.messages,this._search=n.observable(""),this.search=n.computed({read:function(){return o.trim(this._search())},write:this._search,owner:this}),this.isEmptyList=n.computed((function(){return 0===this.collection().length}),this),this.isNotEmptyList=n.computed((function(){return 0!==this.collection().length}),this),this.isSearch=n.computed((function(){return this.search().length>0}),this),this.isUnseenFilter=n.computed((function(){return this.filters()===Enums.FolderFilter.Unseen}),this),this.isLoading=S.messagesLoading,this.isError=S.messagesLoadingError,this.visibleInfoLoading=n.computed((function(){return!this.isSearch()&&this.isLoading()}),this),this.visibleInfoSearchLoading=n.computed((function(){return this.isSearch()&&this.isLoading()}),this),this.visibleInfoSearchList=n.computed((function(){return this.isSearch()&&!this.isUnseenFilter()&&!this.isLoading()&&!this.isEmptyList()}),this),this.visibleInfoMessageListEmpty=n.computed((function(){return!this.isLoading()&&!this.isSearch()&&""===this.filters()&&this.isEmptyList()&&!this.isError()}),this),this.visibleInfoStarredFolderEmpty=n.computed((function(){return!this.isLoading()&&!this.isSearch()&&this.filters()===Enums.FolderFilter.Flagged&&this.isEmptyList()&&!this.isError()}),this),this.visibleInfoSearchEmpty=n.computed((function(){return this.isSearch()&&!this.isUnseenFilter()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()}),this),this.visibleInfoMessageListError=n.computed((function(){return!this.isSearch()&&this.isError()}),this),this.visibleInfoSearchError=n.computed((function(){return this.isSearch()&&this.isError()}),this),this.visibleInfoUnseenFilterList=n.computed((function(){return this.isUnseenFilter()&&(this.isLoading()||!this.isEmptyList())}),this),this.visibleInfoUnseenFilterEmpty=n.computed((function(){return this.isUnseenFilter()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()}),this),this.searchText=n.computed((function(){return a.i18n("MAILWEBCLIENT/INFO_SEARCH_RESULT",{SEARCH:this.calculateSearchStringForDescription(),FOLDER:this.folderList().currentFolder()?a.encodeHtml(this.folderList().currentFolder().displayName()):""})}),this),this.unseenFilterText=n.computed((function(){return""===this.search()?a.i18n("MAILWEBCLIENT/INFO_UNREAD_MESSAGES",{FOLDER:this.folderList().currentFolder()?a.encodeHtml(this.folderList().currentFolder().displayName()):""}):a.i18n("MAILWEBCLIENT/INFO_UNREAD_MESSAGES_SEARCH_RESULT",{SEARCH:this.calculateSearchStringForDescription(),FOLDER:this.folderList().currentFolder()?a.encodeHtml(this.folderList().currentFolder().displayName()):""})}),this),this.unseenFilterEmptyText=n.computed((function(){return""===this.search()?a.i18n("MAILWEBCLIENT/INFO_NO_UNREAD_MESSAGES"):a.i18n("MAILWEBCLIENT/INFO_NO_UNREAD_MESSAGES_FOUND")}),this),this.isEnableGroupOperations=n.observable(!1).extend({throttle:250}),this.selector=new p(this.collection,i.bind(this.routeForMessage,this),i.bind(this.onDeletePress,this),i.bind(this.onMessageDblClick,this),i.bind(this.onEnterPress,this),null,!1,!1,!1,!1,!1),this.checkedUids=n.computed((function(){var e=this.selector.listChecked(),t=i.map(e,(function(e){return e.uid()})),s=S.folderList().currentFolder(),o=s?s.getThreadCheckedUidsFromList(e):[];return i.union(t,o)}),this),this.checkedOrSelectedUids=n.computed((function(){var e=this.checkedUids();return 0===e.length&&S.currentMessage()&&i.isFunction(S.currentMessage().deleted)&&!S.currentMessage().deleted()&&(e=[S.currentMessage().uid()]),e}),this),n.computed((function(){this.isEnableGroupOperations(0<this.selector.listCheckedOrSelected().length)}),this),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.pageSwitcherLocked=n.observable(!1),this.oPageSwitcher=new b(0,E.MailsPerPage),this.oPageSwitcher.currentPage.subscribe((function(e){var t=this.folderList().currentFolderFullName(),s=!c.isMobile()&&this.currentMessage()?this.currentMessage().uid():"",i=this.search();this.pageSwitcherLocked()||this.changeRoutingForMessageList(t,e,s,i,this.filters(),this.sSortBy,this.iSortOrder)}),this),this.currentPage=n.observable(0),u.firefox||u.ie?this.listChangedThrottle=n.observable(!1).extend({throttle:10}):this.listChangedThrottle=n.observable(!1),this.firstCompleteCollection=n.observable(!0),this.collection.subscribe((function(){this.collection().length>0&&(l.isNonEmptyArray(this.aRouteParams)?(this.onRoute(this.aRouteParams),this.aRouteParams=[]):this.firstCompleteCollection(!1))}),this),this.listChanged=n.computed((function(){return[this.firstCompleteCollection(),S.currentAccountId(),this.folderFullName(),this.filters(),this.search(),this.oPageSwitcher.currentPage()]}),this),this.listChanged.subscribe((function(){this.listChangedThrottle(!this.listChangedThrottle())}),this),this.bAdvancedSearch=n.observable(!1),this.searchAttachmentsCheckbox=n.observable(!1),this.searchAttachments=n.observable(""),this.searchAttachments.subscribe((function(e){this.searchAttachmentsCheckbox(!!e)}),this),this.searchAttachmentsFocus=n.observable(!1),this.searchFromFocus=n.observable(!1),this.searchSubjectFocus=n.observable(!1),this.searchToFocus=n.observable(!1),this.searchTextFocus=n.observable(!1),this.searchTrigger=n.observable(null),this.searchDateStartFocus=n.observable(!1),this.searchDateEndFocus=n.observable(!1),this.searchDateStartDom=n.observable(null),this.searchDateStart=n.observable(""),this.searchDateEndDom=n.observable(null),this.searchDateEnd=n.observable(""),this.dateFormatDatePicker="yy.mm.dd",this.attachmentsPlaceholder=n.computed((function(){return a.i18n("MAILWEBCLIENT/LABEL_HAS_ATTACHMENTS")}),this),i.delay(i.bind((function(){this.createDatePickerObject(this.searchDateStartDom(),this.searchDateStart),this.createDatePickerObject(this.searchDateEndDom(),this.searchDateEnd)}),this),1e3),this.customMessageItemViewTemplate=n.observable(""),c.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this,MailCache:S})}s("Vn+K"),I.prototype.ViewTemplate="MailWebclient_MessagesView",I.prototype.ViewConstructorName="CMessageListView",I.prototype.addNewAccount=function(){c.Api.createMailAccount(F.getEmail())},I.prototype.createDatePickerObject=function(e,t){o(e).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:r.getMonthNamesArray(),dayNamesMin:a.i18n("COREWEBCLIENT/LIST_DAY_NAMES_MIN").split(" "),nextText:"",prevText:"",firstDay:l.pInt(m.run("CalendarWebclient","getWeekStartsOn")),showOn:"focus",dateFormat:this.dateFormatDatePicker,onClose:function(e){n.isObservable(t)&&t(e)}}),o(e).mousedown((function(){o("#ui-datepicker-div").toggle()}))},I.prototype.changeRoutingForMessageList=function(e,t,s,i,o,n,r){g.setHash(v.getMailbox(e,t,s,i,o,n,r))&&i.length>0&&this.search()===i&&this.listChangedThrottle(!this.listChangedThrottle())},I.prototype.onEnterPress=function(e){e.threadNextLoadingVisible()?e.loadNextMessages():e.openThread()},I.prototype.onMessageDblClick=function(e){if(!this.isSavingDraft(e)){var t=this.folderList().getFolderByFullName(e.folder()),s=-1!==o.inArray(e.folder(),S.getCurrentTemplateFolders()),i={Message:e,Cancel:!1};c.broadcastEvent("MailWebclient::MessageDblClick::before",i),i.Cancel||(t.type()===Enums.FolderTypes.Drafts||s?y.composeMessageFromDrafts(e.folder(),e.uid()):this.openMessageInNewWindowBound(e))}},I.prototype.onFolderListSubscribe=function(){this.setCurrentFolder(),this.requestMessageList()},I.prototype.onShow=function(e){this.selector.useKeyboardKeys(!0),this.oPageSwitcher.show(),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},I.prototype.onHide=function(e){this.selector.useKeyboardKeys(!1),this.oPageSwitcher.hide(),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},I.prototype.onRoute=function(e){var t=this.folderList().inboxFolder(),s=t?t.fullName():"",o=v.parseMailbox(e,s),n=""===this.folderFullName()?s:this.folderFullName(),r=this.currentPage()!==o.Page||n!==o.Folder||this.filters()!==o.Filters||o.Filters===Enums.FolderFilter.Unseen&&S.waitForUnseenMessages()||this.search()!==o.Search||this.sSortBy!==o.SortBy||this.iSortOrder!==o.SortOrder,a=E.MailsPerPage!==this.oPageSwitcher.perPage();this.pageSwitcherLocked(!0),n!==o.Folder||this.search()!==o.Search||this.filters()!==o.Filters?this.oPageSwitcher.clear():this.oPageSwitcher.setPage(o.Page,E.MailsPerPage),this.pageSwitcherLocked(!1),o.Page!==this.oPageSwitcher.currentPage()&&(0===this.folderList().iAccountId?this.aRouteParams=e:g.replaceHash(v.getMailbox(o.Folder,this.oPageSwitcher.currentPage(),o.Uid,o.Search,o.Filters))),this.currentPage(this.oPageSwitcher.currentPage()),this.folderFullName(o.Folder),this.filters(o.Filters),this.search(o.Search),this.searchInput(this.search()),this.searchSpan.notifySubscribers(),this.sSortBy=o.SortBy,this.iSortOrder=o.SortOrder,i.each(this.aSortList,function(e){e.sSortBy===this.sSortBy?(e.selected(!0),e.sortOrder(this.iSortOrder)):e.selected(!1)}.bind(this)),this.setCurrentFolder(),(r||a||0===this.collection().length)&&(o.Filters===Enums.FolderFilter.Unseen&&S.waitForUnseenMessages(!0),this.requestMessageList()),this.highlightTrigger.notifySubscribers(!0)},I.prototype.setCurrentFolder=function(){this.folderList().setCurrentFolder(this.folderFullName(),this.filters()),this.folderType(S.folderList().currentFolderType())},I.prototype.requestMessageList=function(){var e=this.folderList().currentFolderFullName(),t=this.oPageSwitcher.currentPage();e.length>0?S.changeCurrentMessageList(e,t,this.search(),this.filters(),this.sSortBy,this.iSortOrder):S.checkCurrentFolderList()},I.prototype.calculateSearchStringFromAdvancedForm=function(){var e=this.searchInputFrom(),t=this.searchInputTo(),s=this.searchInputSubject(),i=this.searchInputText(),n=this.searchAttachmentsCheckbox(),r=this.searchDateStart(),a=this.searchDateEnd(),l=[],h=function(e){return(-1<(e=o.trim(e).replace(/"/g,'\\"')).indexOf(" ")||-1<e.indexOf('"'))&&(e='"'+e+'"'),e};return""!==e&&l.push("from:"+h(e)),""!==t&&l.push("to:"+h(t)),""!==s&&l.push("subject:"+h(s)),""!==i&&l.push("text:"+h(i)),n&&l.push("has:attachments"),""===r&&""===a||l.push("date:"+h(r)+"/"+h(a)),l.join(" ")},I.prototype.onSearchClick=function(){var e=this.folderList().currentFolderFullName(),t=this.searchInput();this.bAdvancedSearch()&&(t=this.calculateSearchStringFromAdvancedForm(),this.searchInput(t),this.bAdvancedSearch(!1)),this.changeRoutingForMessageList(e,1,"",t,this.filters())},I.prototype.onRetryClick=function(){this.requestMessageList()},I.prototype.onClearSearchClick=function(){var e=this.folderList().currentFolderFullName(),t=this.currentMessage()?this.currentMessage().uid():"";this.clearAdvancedSearch(),this.changeRoutingForMessageList(e,1,t,"",this.filters(),this.sSortBy,this.iSortOrder)},I.prototype.onClearFilterClick=function(){var e=this.folderList().currentFolderFullName(),t=this.currentMessage()?this.currentMessage().uid():"";this.clearAdvancedSearch(),this.changeRoutingForMessageList(e,1,t,"","",this.sSortBy,this.iSortOrder)},I.prototype.onStopSearchClick=function(){this.onClearSearchClick()},I.prototype.isSavingDraft=function(e){return this.folderList().currentFolder().type()===Enums.FolderTypes.Drafts&&e.uid()===S.savingDraftUid()},I.prototype.routeForMessage=function(e){if(null!==e&&!this.isSavingDraft(e)){var t=this.folderList().currentFolder(),s=this.folderList().currentFolderFullName(),i=this.oPageSwitcher.currentPage(),o=e.uid(),n=this.search();""!==o&&(c.isMobile()&&t.type()===Enums.FolderTypes.Drafts?g.setHash(v.getComposeFromMessage("drafts",e.folder(),e.uid())):(this.changeRoutingForMessageList(s,i,o,n,this.filters(),this.sSortBy,this.iSortOrder),c.isMobile()&&S.currentMessage()&&o===S.currentMessage().uid()&&S.currentMessage.valueHasMutated()))}},I.prototype.onBind=function(e){var t=this,s=i.bind((function(e){e&&e.stopPropagation&&e.stopPropagation()}),this);o(".message_list",e).on("click",(function(){t.isFocused(!1)})).on("click",".message_sub_list .item .flag",(function(e){t.onFlagClick(n.dataFor(this)),e&&e.stopPropagation&&e.stopPropagation()})).on("dblclick",".message_sub_list .item .flag",s).on("click",".message_sub_list .item .thread-pin",s).on("dblclick",".message_sub_list .item .thread-pin",s),this.selector.initOnApplyBindings(".message_sub_list .item",".message_sub_list .item.selected",".message_sub_list .item .custom_checkbox",o(".message_list",e),o(".message_list_scroll.scroll-inner",e)),this.initUploader()},I.prototype.onFlagClick=function(e){this.isSavingDraft(e)||S.executeGroupOperation("SetMessageFlagged",[e.uid()],"flagged",!e.flagged())},I.prototype.executeMarkAsRead=function(){S.executeGroupOperation("SetMessagesSeen",this.checkedOrSelectedUids(),"seen",!0)},I.prototype.executeMarkAsUnread=function(){S.executeGroupOperation("SetMessagesSeen",this.checkedOrSelectedUids(),"seen",!1)},I.prototype.executeMarkAllRead=function(){S.executeGroupOperation("SetAllMessagesSeen",[],"seen",!0)},I.prototype.executeMoveToFolder=function(e){S.moveMessagesToFolder(e,this.checkedOrSelectedUids())},I.prototype.executeCopyToFolder=function(e){S.copyMessagesToFolder(e,this.checkedOrSelectedUids())},I.prototype.onDeletePress=function(e){var t=i.map(e,(function(e){return e.uid()}));t.length>0&&this.deleteMessages(t)},I.prototype.executeDelete=function(){this.deleteMessages(this.checkedOrSelectedUids())},I.prototype.deleteMessages=function(e){var t="",s=null;1===e.length&&S.currentMessage()&&e[0]===S.currentMessage().uid()&&""===(t=S.prevMessageUid())&&(t=S.nextMessageUid()),e.length>0&&A.deleteMessages(e,function(){""!==t&&(s=i.find(this.collection(),(function(e){return e.uid()===t})))&&this.routeForMessage(s)}.bind(this))},I.prototype.executeSpam=function(){var e=this.folderList().spamFolderFullName();this.folderList().currentFolderFullName()!==e&&S.moveMessagesToFolder(e,this.checkedOrSelectedUids())},I.prototype.executeNotSpam=function(){var e=this.folderList().inboxFolder();e&&this.folderList().currentFolderFullName()!==e.fullName()&&S.moveMessagesToFolder(e.fullName(),this.checkedOrSelectedUids())},I.prototype.executeSort=function(e){i.each(this.aSortList,function(t){if(t.sSortBy===e){t.selected()&&t.sortOrder(t.sortOrder()===Enums.SortOrder.Asc?Enums.SortOrder.Desc:Enums.SortOrder.Asc),t.selected(!0);var s=this.folderList().currentFolderFullName(),i=this.oPageSwitcher.currentPage(),o=this.search();this.changeRoutingForMessageList(s,i,"",o,this.filters(),t.sSortBy,t.sortOrder())}else t.selected(!1)}.bind(this))},I.prototype.clearAdvancedSearch=function(){this.searchInputFrom(""),this.searchInputTo(""),this.searchInputSubject(""),this.searchInputText(""),this.bAdvancedSearch(!1),this.searchAttachmentsCheckbox(!1),this.searchAttachments(""),this.searchDateStart(""),this.searchDateEnd("")},I.prototype.onAdvancedSearchClick=function(){this.bAdvancedSearch(!this.bAdvancedSearch())},I.prototype.calculateSearchStringForDescription=function(){return'<span class="part">'+a.encodeHtml(this.search())+"</span>"},I.prototype.initUploader=function(){var e=this;this.uploaderArea()&&(this.oJua=new d({action:"?/Api/",name:"jua-uploader",queueSize:2,dragAndDropElement:this.uploaderArea(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:i.extendOwn({Module:E.ServerModuleName,Method:"UploadMessage",Parameters:function(){return JSON.stringify({AccountID:S.currentAccountId(),Folder:e.folderFullName()})}},c.getCommonRequestParameters())}),this.oJua.on("onDrop",i.bind(this.onFileDrop,this)).on("onComplete",i.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",i.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",i.bind(this.bDragActive,this,!1)))},I.prototype.onFileDrop=function(e){e&&e.File&&e.File.type&&0===e.File.type.indexOf("message/")||f.showError(a.i18n("MAILWEBCLIENT/ERROR_FILE_NOT_EML"))},I.prototype.onFileUploadComplete=function(e,t,s){t&&s&&!s.ErrorCode?S.executeCheckMail(!0):h.showErrorByCode(s||{},a.i18n("COREWEBCLIENT/ERROR_UPLOAD_FILE"))},e.exports=I},"oj+D":function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("JFZZ"),l=s("OgeD"),h=s("SQrT"),c=s("o0Bx"),u=l.run("SettingsWebclient","getAbstractSettingsFormViewClass"),d=s("jonm"),p=s("p2hp"),m=s("DM8i");function g(){u.call(this,p.ServerModuleName),this.fetcher=n.observable(null),this.idFetcher=n.observable(null),this.isEnabled=n.observable(!0),this.email=n.observable(""),this.userName=n.observable(""),this.isOutgoingEnabled=n.observable(!1),this.focusEmail=n.observable(!1),this.oOutgoing=new m(25,465,"fetcher_edit_outgoing",r.i18n("MAILWEBCLIENT/LABEL_SMTP_SERVER")),this.outgoingUseAuth=n.observable(!1),this.isAllEnabled=n.computed((function(){return this.isEnabled()&&this.isOutgoingEnabled()}),this),this.isAllEnabled.subscribe((function(){this.oOutgoing.isEnabled(this.isAllEnabled())}),this),this.oOutgoing.isEnabled(this.isAllEnabled()),this.firstState=null}i.extendOwn(g.prototype,u.prototype),g.prototype.ViewTemplate="MailWebclient_Settings_FetcherOutgoingSettingsFormView",g.prototype.onShow=function(e){this.fetcher(e&&e.FETCHER?e:null),this.populate()},g.prototype.getCurrentValues=function(){return[this.isOutgoingEnabled(),this.oOutgoing.server(),this.oOutgoing.port(),this.oOutgoing.ssl(),this.outgoingUseAuth(),this.userName(),this.email()]},g.prototype.getParametersForSave=function(){return this.fetcher()?{FetcherId:this.idFetcher(),IsOutgoingEnabled:this.isOutgoingEnabled(),Email:o.trim(this.email()),Name:this.userName(),OutgoingServer:this.oOutgoing.server(),OutgoingPort:this.oOutgoing.getIntPort(),OutgoingUseSsl:this.oOutgoing.ssl(),OutgoingUseAuth:this.outgoingUseAuth()}:{}},g.prototype.save=function(){this.isEnabled()&&(this.isEmptyRequiredFields()?h.showError(r.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY")):(this.isSaving(!0),this.updateSavedState(),c.send(p.FetchersServerModuleName,"UpdateFetcherSmtpSettings",this.getParametersForSave(),this.onResponse,this)))},g.prototype.onResponse=function(e,t){this.isSaving(!1),e.Result?(d.populateFetchers(),h.showReport(r.i18n("MAILWEBCLIENT/REPORT_SUCCESSFULLY_SAVED"))):a.showErrorByCode(e,r.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},g.prototype.populate=function(){var e=this.fetcher();e&&(this.fetcher(e),this.idFetcher(e.id()),this.isEnabled(e.isEnabled()),this.email(e.email()),this.userName(e.userName()),this.isOutgoingEnabled(e.isOutgoingEnabled()),this.oOutgoing.set(e.outgoingServer(),e.outgoingPort(),e.outgoingUseSsl()),this.outgoingUseAuth(e.outgoingUseAuth()),this.updateSavedState())},g.prototype.isEmptyRequiredFields=function(){if(this.isOutgoingEnabled()){if(this.outgoingUseAuth()&&this.isOutgoingEnabled()&&""===this.oOutgoing.server())return this.oOutgoing.server.focused(!0),!0;if(this.outgoingUseAuth()&&""===o.trim(this.email()))return this.focusEmail(!0),!0}return!1},e.exports=new g},p2hp:function(e,t,s){"use strict";var i=s("0h2I"),o=s("F/us"),n=s("AFLV"),r=s("IAk5");e.exports={ServerModuleName:"Mail",HashModuleName:"mail",FetchersServerModuleName:"MtaConnector",EnableMultiTenant:!1,AllowAddAccounts:!1,AllowAutosaveInDrafts:!0,AllowChangeMailQuotaOnMailServer:!1,AllowDefaultAccountForUser:!0,AllowEditDomainsInServer:!0,AllowFetchers:!1,AllowIdentities:!1,OnlyUserEmailsInIdentities:!1,AllowInsertImage:!0,AllowMultiAccounts:!1,AutoSaveIntervalSeconds:60,AllowTemplateFolders:!1,AllowAlwaysRefreshFolders:!1,AutocreateMailAccountOnNewUserFirstLogin:!1,IgnoreImapSubscription:!1,ImageUploadSizeLimit:0,AllowAppRegisterMailto:!1,AllowChangeInputDirection:!0,FoldersExpandedByDefault:!1,AllowSpamFolder:!0,AllowAddNewFolderOnMainScreen:!1,ComposeToolbarOrder:["back","send","save","importance","MailSensitivity","confirmation","OpenPgp"],DefaultFontName:"Tahoma",DefaultFontSize:3,AlwaysTryUseImageWhilePasting:!0,JoinReplyPrefixes:!0,MailsPerPage:20,MaxMessagesBodiesSizeToPrefetch:5e4,MessageBodyTruncationThreshold:65e4,MessagesSortBy:{},ShowEmailAsTabName:!0,AllowShowMessagesCountInFolderList:!1,showMessagesCountInFolderList:i.observable(!1),AllowSearchMessagesBySubject:!1,PrefixesToRemoveBeforeSearchMessagesBySubject:[],AllowHorizontalLayout:!1,HorizontalLayout:!1,HorizontalLayoutByDefault:!1,userMailAccountsCount:i.observable(0),mailAccountsEmails:i.observableArray([]),init:function(e){var t=e.Core,s=e[this.ServerModuleName],i=e.MailWebclient,a=e[this.FetchersServerModuleName];if(o.isEmpty(t)||(this.EnableMultiTenant=n.pBool(t.EnableMultiTenant,this.EnableMultiTenant)),!o.isEmpty(s)){this.AllowAddAccounts=n.pBool(s.AllowAddAccounts,this.AllowAddAccounts),this.AllowAutosaveInDrafts=n.pBool(s.AllowAutosaveInDrafts,this.AllowAutosaveInDrafts),this.AllowChangeMailQuotaOnMailServer=n.pBool(s.AllowChangeMailQuotaOnMailServer,this.AllowChangeMailQuotaOnMailServer),this.AllowDefaultAccountForUser=n.pBool(s.AllowDefaultAccountForUser,this.AllowDefaultAccountForUser),this.AllowEditDomainsInServer=n.pBool(s.AllowEditDomainsInServer,this.AllowEditDomainsInServer),this.AllowIdentities=n.pBool(s.AllowIdentities,this.AllowIdentities),this.OnlyUserEmailsInIdentities=n.pBool(s.OnlyUserEmailsInIdentities,this.OnlyUserEmailsInIdentities),this.AllowInsertImage=n.pBool(s.AllowInsertImage,this.AllowInsertImage),this.AllowMultiAccounts=n.pBool(s.AllowMultiAccounts,this.AllowMultiAccounts),this.AutoSaveIntervalSeconds=n.pNonNegativeInt(s.AutoSaveIntervalSeconds,this.AutoSaveIntervalSeconds),this.AllowTemplateFolders=n.pBool(s.AllowTemplateFolders,this.AllowTemplateFolders),this.AllowAlwaysRefreshFolders=n.pBool(s.AllowAlwaysRefreshFolders,this.AllowAlwaysRefreshFolders),this.AutocreateMailAccountOnNewUserFirstLogin=n.pBool(s.AutocreateMailAccountOnNewUserFirstLogin,this.AutocreateMailAccountOnNewUserFirstLogin),this.IgnoreImapSubscription=n.pBool(s.IgnoreImapSubscription,this.IgnoreImapSubscription),this.ImageUploadSizeLimit=n.pNonNegativeInt(s.ImageUploadSizeLimit,this.ImageUploadSizeLimit),window.Enums.SmtpAuthType=n.pObject(s.SmtpAuthType),this.MessagesSortBy=o.clone(n.pObject(s.MessagesSortBy,this.MessagesSortBy)),this.MessagesSortBy.Allow=n.pBool(this.MessagesSortBy.Allow,!1),this.MessagesSortBy.List=n.pArray(this.MessagesSortBy.List,[]),this.MessagesSortBy.DefaultSortBy=n.pString(this.MessagesSortBy.DefaultSortBy,"arrival");var l=n.pString(this.MessagesSortBy.DefaultSortOrder,"desc");this.MessagesSortBy.DefaultSortOrder="desc"===l?Enums.SortOrder.Desc:Enums.SortOrder.Asc}o.isEmpty(i)||(this.AllowAppRegisterMailto=n.pBool(i.AllowAppRegisterMailto,this.AllowAppRegisterMailto),this.AllowChangeInputDirection=n.pBool(i.AllowChangeInputDirection,this.AllowChangeInputDirection),this.FoldersExpandedByDefault=n.pBool(i.FoldersExpandedByDefault,this.FoldersExpandedByDefault),this.AllowSpamFolder=n.pBool(i.AllowSpamFolder,this.AllowSpamFolder),this.AllowAddNewFolderOnMainScreen=n.pBool(i.AllowAddNewFolderOnMainScreen,this.AllowAddNewFolderOnMainScreen),this.ComposeToolbarOrder=n.pArray(i.ComposeToolbarOrder,this.ComposeToolbarOrder),this.DefaultFontName=n.pString(i.DefaultFontName,this.DefaultFontName),this.DefaultFontSize=n.pPositiveInt(i.DefaultFontSize,this.DefaultFontSize),this.AlwaysTryUseImageWhilePasting=n.pBool(i.AlwaysTryUseImageWhilePasting,this.AlwaysTryUseImageWhilePasting),this.JoinReplyPrefixes=n.pBool(i.JoinReplyPrefixes,this.JoinReplyPrefixes),this.MailsPerPage=n.pPositiveInt(i.MailsPerPage,this.MailsPerPage),this.MaxMessagesBodiesSizeToPrefetch=n.pNonNegativeInt(i.MaxMessagesBodiesSizeToPrefetch,this.MaxMessagesBodiesSizeToPrefetch),this.MessageBodyTruncationThreshold=n.pNonNegativeInt(i.MessageBodyTruncationThreshold,this.MessageBodyTruncationThreshold),this.ShowEmailAsTabName=n.pBool(i.ShowEmailAsTabName,this.ShowEmailAsTabName),this.AllowShowMessagesCountInFolderList=n.pBool(i.AllowShowMessagesCountInFolderList,this.AllowShowMessagesCountInFolderList),this.showMessagesCountInFolderList(n.pBool(i.ShowMessagesCountInFolderList,this.showMessagesCountInFolderList())),this.AllowSearchMessagesBySubject=n.pBool(i.AllowSearchMessagesBySubject,this.AllowSearchMessagesBySubject),this.PrefixesToRemoveBeforeSearchMessagesBySubject=n.pArray(i.PrefixesToRemoveBeforeSearchMessagesBySubject,this.PrefixesToRemoveBeforeSearchMessagesBySubject),this.AllowHorizontalLayout=n.pBool(i.AllowHorizontalLayout,this.AllowHorizontalLayout),this.HorizontalLayout=this.AllowHorizontalLayout&&n.pBool(i.HorizontalLayout,this.HorizontalLayout),this.HorizontalLayoutByDefault=this.AllowHorizontalLayout&&n.pBool(i.HorizontalLayoutByDefault,this.HorizontalLayoutByDefault)),o.isEmpty(a)||(this.AllowFetchers=n.pBool(a.AllowFetchers,this.AllowFetchers)),r.registerUserAccountsCount(this.userMailAccountsCount),r.registerAccountsWithPass(this.mailAccountsEmails)},update:function(e,t,s,i){this.AllowAutosaveInDrafts=n.pBool(t,this.AllowAutosaveInDrafts),this.AllowChangeInputDirection=n.pBool(s,this.AllowChangeInputDirection),this.MailsPerPage=n.pPositiveInt(e,this.MailsPerPage),this.showMessagesCountInFolderList(n.pBool(i,this.showMessagesCountInFolderList()))},updateAdmin:function(e,t,s){this.AutocreateMailAccountOnNewUserFirstLogin=n.pBool(e,this.AutocreateMailAccountOnNewUserFirstLogin),this.AllowAddAccounts=n.pBool(t,this.AllowAddAccounts),this.HorizontalLayoutByDefault=n.pBool(s,this.HorizontalLayoutByDefault)},disableEditDomainsInServer:function(){this.AllowEditDomainsInServer=!1}}},qGK3:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("wd/R"),a=s("Yjhd"),l=s("RN+F"),h=s("AFLV"),c=s("UN2P"),u=s("JFZZ"),d=s("IAk5"),p=s("QaF5"),m=s("gcBV"),g=s("76Kh"),f=s("20Ah"),b=s("4M/5"),y=s("jonm"),v=null,A=s("xzvH"),F=s("p2hp"),S=s("Nfk5"),E=s("lPfU");function I(e){this.iAccountId=e,this.bNamespace=!1,this.iDisplayedLevel=0,this.bIgnoreImapSubscription=F.IgnoreImapSubscription,this.bAllowTemplateFolders=F.AllowTemplateFolders,this.isTemplateStorage=n.observable(!1),this.bAllowAlwaysRefreshFolders=F.AllowAlwaysRefreshFolders,this.isAlwaysRefresh=n.observable(!1),this.sDelimiter="",this.bExists=!0,this.sUidNext="",this.sHash="",this.messageCount=n.observable(0),this.unseenMessageCount=n.observable(0),this.iRealUnseenMessageCount=0,this.hasExtendedInfo=n.observable(!1),this.fullName=n.observable(""),this.fullNameHash=n.observable(""),this.bSelectable=!0,this.subscribed=n.observable(!0),this.name=n.observable(""),this.nameForEdit=n.observable(""),this.subfolders=n.observableArray([]),this.subfoldersMessagesCount=n.observable(0),this.type=n.observable(Enums.FolderTypes.User),this.bVirtual=!1,this.selected=n.observable(!1),this.expanded=n.observable(!1),this.recivedAnim=n.observable(!1).extend({autoResetToFalse:500}),this.edited=n.observable(!1),this.aMessagesDictionaryUids=[],this.oUids={},this.aResponseHandlers=[],this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.hasChanges=n.observable(!1),this.oRelevantInformationLastMoment=null,this.bSubscribtionsInitialized=!1}I.prototype.requireMailCache=function(){null===v&&(v=s("4+IO"))},I.prototype.setDisplayedLevel=function(e){this.iDisplayedLevel=e},I.prototype.getDisplayedLevel=function(){return this.iDisplayedLevel},I.prototype.getMessageByUid=function(e){return A.get([this.iAccountId,this.fullName(),e])},I.prototype.removeMessageFromDict=function(e){A.remove([this.iAccountId,this.fullName(),e]),this.aMessagesDictionaryUids=i.without(this.aMessagesDictionaryUids,e),this.aRequestedUids=i.without(this.aRequestedUids,e),this.aRequestedThreadUids=i.without(this.aRequestedThreadUids,e)},I.prototype.updateLastAccessTime=function(e){i.each(e,(function(e){var t=this.getMessageByUid(e);t&&t.updateLastAccessTime()}),this)},I.prototype.doForAllMessages=function(e){var t=[];i.each(this.aMessagesDictionaryUids,(function(s){var i=this.getMessageByUid(s);i?e(i):t.push(s)}),this),t.length>0&&(this.aMessagesDictionaryUids=i.difference(this.aMessagesDictionaryUids,t),this.aRequestedUids=i.difference(this.aRequestedUids,t),this.aRequestedThreadUids=i.difference(this.aRequestedThreadUids,t))},I.prototype.getFlaggedMessageUids=function(){var e=[];return this.doForAllMessages((function(t){t.flagged()&&e.push(t.uid())})),e},I.prototype.setMessageUnflaggedByUid=function(e){var t=this.getMessageByUid(e);t&&t.flagged(!1)},I.prototype.hideThreadMessages=function(e){i.each(e.threadUids(),(function(e){var t=this.getMessageByUid(e);t&&(t.deleted()||(t.threadShowAnimation(!1),t.threadHideAnimation(!0),setTimeout((function(){t.threadHideAnimation(!1)}),1e3)))}),this)},I.prototype.getThreadMessages=function(e){var t=[],s=[],o=[],n=0,r=null;return i.each(e.threadUids(),(function(i){if(n<e.threadCountForLoad()){var a=this.getMessageByUid(i);a?a.deleted()||(a.markAsThreadPart(50,e.uid()),t.push(a),o.push(a.uid()),n++,r=a):(s.push(i),o.push(i),n++)}else o.push(i)}),this),e.threadLoading()||this.loadThreadMessages(s),e.changeThreadUids(o,t.length),r&&t.length<e.threadUids().length&&r.showNextLoadingLink(i.bind(e.increaseThreadCountForLoad,e)),this.addThreadUidsToUidLists(e.uid(),e.threadUids()),t},I.prototype.computeThreadData=function(e){var t=0,s=!1,n=[],r=[],a=e.oFrom.getFirstEmail();i.each(e.threadUids(),(function(e){var i=this.getMessageByUid(e),h="";i&&!i.deleted()&&(i.seen()||t++,i.flagged()&&(s=!0),(h=i.oFrom.getFirstEmail())!==a&&-1===o.inArray(h,r)&&(r.push(h),h===y.getEmail()?n.push(l.i18n("MAILWEBCLIENT/LABEL_ME_SENDER")):n.push(i.oFrom.getFirstDisplay())))}),this),e.threadUnreadCount(t),e.partialFlagged(s)},I.prototype.addThreadUidsToUidLists=function(e,t){i.each(this.oUids,(function(s){s.addThreadUids(e,t)}))},I.prototype.loadThreadMessages=function(e){if(e.length>0){var t={Folder:this.fullName(),Uids:e};c.send("GetMessagesByUids",t,this.onGetMessagesByUidsResponse,this)}},I.prototype.getThreadCheckedUidsFromList=function(e){var t=this,s=[];return i.each(e,(function(e){e.threadCount()>0&&!e.threadOpened()&&i.each(e.threadUids(),(function(e){var i=t.getMessageByUid(e);i&&!i.deleted()&&i.checked()&&s.push(e)}))})),s},I.prototype.parseAndCacheMessage=function(e,t,s){var o=e.Uid.toString(),n=!1,r=this.getMessageByUid(o);return r||(n=!0,r=new S),r.parse(e,this.iAccountId,t,s),this.type()===Enums.FolderTypes.Inbox&&n&&r.flagged()&&(this.requireMailCache(),v.increaseStarredCount()),A.set([this.iAccountId,this.fullName(),o],r),n&&(this.aRequestedUids=i.without(this.aRequestedUids,o),this.aRequestedThreadUids=i.without(this.aRequestedThreadUids,o),-1===i.indexOf(this.aMessagesDictionaryUids,o)&&this.aMessagesDictionaryUids.push(o)),r},I.prototype.onGetMessagesByUidsResponse=function(e,t){var s=e.Result;s&&"Collection/MessageCollection"===s["@Object"]&&(i.each(s["@Collection"],(function(e){this.parseAndCacheMessage(e,!0,!0)}),this),this.requireMailCache(),v.showOpenedThreads(this.fullName()))},I.prototype.addRequestedUids=function(e){this.aRequestedUids=i.union(this.aRequestedUids,e)},I.prototype.hasUidBeenRequested=function(e){return-1!==i.indexOf(this.aRequestedUids,e)},I.prototype.addRequestedThreadUids=function(e){this.aRequestedThreadUids=i.union(this.aRequestedThreadUids,e)},I.prototype.hasThreadUidBeenRequested=function(e){return-1!==i.indexOf(this.aRequestedThreadUids,e)},I.prototype.hasListBeenRequested=function(e){var t=i.where(this.requestedLists,e).length>0;return t||this.requestedLists.push(e),t},I.prototype.markMessageReplied=function(e,t){var s=this.getMessageByUid(e);if(s)switch(t){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:s.answered(!0);break;case Enums.ReplyType.Forward:case Enums.ReplyType.ForwardAsAttach:s.forwarded(!0)}},I.prototype.removeAllMessages=function(){var e=this.oUids,t=this.aMessagesDictionaryUids;this.aMessagesDictionaryUids=[],this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.oUids={},this.messageCount(0),this.unseenMessageCount(0),this.iRealUnseenMessageCount=0,this.getUidList("","",F.MessagesSortBy.DefaultSortBy,F.MessagesSortBy.DefaultSortOrder).resultCount(0),v.currentMessage()&&v.currentMessage().accountId()===this.iAccountId&&v.currentMessage().folder()===this.fullName()&&(a.log("removeAllMessages, the current message is in the list to remove",v.currentMessage()?{accountId:v.currentMessage().accountId(),folder:v.currentMessage().folder(),uid:v.currentMessage().uid()}:null),t=i.without(t,v.currentMessage().uid())),i.each(t,(function(e){this.removeMessageFromDict(e)}),this),t=null,i.each(e,(function(e){e.clearData()})),e=null},I.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.aRequestedThreadUids=[],this.hasChanges(!1))},I.prototype.removeFlaggedMessageListsFromCache=function(){i.each(this.oUids,(function(e){e.filters()===Enums.FolderFilter.Flagged&&e.clearData()}),this)},I.prototype.removeUnseenMessageListsFromCache=function(){i.each(this.oUids,(function(e){e.filters()===Enums.FolderFilter.Unseen&&e.clearData()}),this)},I.prototype.setRelevantInformation=function(e,t,s,i,o){var n=this.hasExtendedInfo()&&(this.sHash!==t||this.iRealUnseenMessageCount!==i||this.unseenMessageCount()!==i);return this.sHash=t,this.iRealUnseenMessageCount=i,this.hasExtendedInfo()&&o||(this.sUidNext=e,this.messageCount(s),this.unseenMessageCount(i),0===i&&this.unseenMessageCount.valueHasMutated()),this.hasExtendedInfo(!0),n&&this.markHasChanges(),this.oRelevantInformationLastMoment=r(),n},I.prototype.increaseCountIfHasNotInfo=function(){this.hasExtendedInfo()||this.messageCount(this.messageCount()+1)},I.prototype.markHasChanges=function(){this.hasChanges(!0)},I.prototype.addMessagesCountsDiff=function(e,t){var s=this.messageCount()+e,i=this.unseenMessageCount()+t;s<0&&(s=0),this.messageCount(s),i<0&&(i=0),i>s&&(i=s),this.unseenMessageCount(i)},I.prototype.markDeletedByUids=function(e){var t=0,s=0;return i.each(e,(function(e){var i=this.getMessageByUid(e);i&&(t++,i.seen()||s++,i.deleted(!0))}),this),this.addMessagesCountsDiff(-t,-s),{MinusDiff:t,UnseenMinusDiff:s}},I.prototype.revertDeleted=function(e){var t=0,s=0;return i.each(e,(function(e){var i=this.getMessageByUid(e);i&&i.deleted()&&(t++,i.seen()||s++,i.deleted(!1))}),this),this.addMessagesCountsDiff(t,s),{PlusDiff:t,UnseenPlusDiff:s}},I.prototype.commitDeleted=function(e){i.each(e,i.bind((function(e){v.currentMessage()&&v.currentMessage().accountId()===this.iAccountId&&v.currentMessage().folder()===this.fullName()&&v.currentMessage().uid()===e?a.log("commitDeleted, the current message is to remove",v.currentMessage()?{accountId:v.currentMessage().accountId(),folder:v.currentMessage().folder(),uid:v.currentMessage().uid()}:null):this.removeMessageFromDict(e),this.aMessagesDictionaryUids=i.without(this.aMessagesDictionaryUids,e),this.aRequestedUids=i.without(this.aRequestedUids,e),this.aRequestedThreadUids=i.without(this.aRequestedThreadUids,e)}),this)),i.each(this.oUids,(function(t){t.deleteUids(e)}))},I.prototype.getUidList=function(e,t,s,i){var o=JSON.stringify([e,t,s,i]),n=null;return void 0===this.oUids[o]&&((n=new E).iAccountId=this.iAccountId,n.sFullName=this.fullName(),n.search(e),n.filters(t),n.sortBy(s),n.sortOrder(i),this.oUids[o]=n),this.oUids[o]},I.prototype.initStarredFolder=function(e,t){this.bVirtual=!0,this.setDisplayedLevel(e),this.fullName(t),this.name(l.i18n("MAILWEBCLIENT/LABEL_FOLDER_STARRED")),this.type(Enums.FolderTypes.Starred),this.initSubscriptions(""),this.initComputedFields(!0)},I.prototype.parse=function(e,t,s){var o="",n=Enums.FolderTypes.User,r=m.getData("folderAccordion")||[];return"Object/Folder"===e["@Object"]?(o=h.pString(e.Name),this.name(o),this.nameForEdit(o),this.fullName(h.pString(e.FullNameRaw)),this.fullNameHash(h.pString(e.FullNameHash)),this.sDelimiter=e.Delimiter,n=h.pInt(e.Type),F.AllowTemplateFolders||n!==Enums.FolderTypes.Template||(n=Enums.FolderTypes.User),(F.AllowSpamFolder||n!==Enums.FolderTypes.Spam)&&this.type(n),this.isTemplateStorage(this.type()===Enums.FolderTypes.Template),this.bNamespace=s===this.fullName(),this.isAlwaysRefresh(F.AllowAlwaysRefreshFolders&&!!e.AlwaysRefresh),this.subscribed(!!F.IgnoreImapSubscription||e.IsSubscribed),this.bSelectable=e.IsSelectable,this.bExists=e.Exists,e.Extended&&this.setRelevantInformation(e.Extended.UidNext.toString(),e.Extended.Hash,e.Extended.MessageCount,e.Extended.MessageUnseenCount,!1),i.find(r,(function(e){return e===this.name()}),this)&&this.expanded(!0),this.initSubscriptions(t),this.initComputedFields(),d.broadcastEvent("MailWebclient::ParseFolder::after",this),e.SubFolders):null},I.prototype.initSubscriptions=function(e){this.bSubscribtionsInitialized||(this.requireMailCache(),this.unseenMessageCount.subscribe((function(){i.delay(i.bind((function(){v.countMessages(this)}),this),1e3)}),this),this.subscribed.subscribe((function(){if(e){var t=v.folderList().getFolderByFullName(e);t&&v.countMessages(t)}}),this),this.edited.subscribe((function(e){!1===e&&this.nameForEdit(this.name())}),this),this.hasChanges.subscribe((function(){this.requestedLists=[]}),this),this.bSubscribtionsInitialized=!0)},I.prototype.initComputedFields=function(){this.routingHash=n.computed((function(){return this.bVirtual?p.buildHashFromArray(b.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Flagged)):p.buildHashFromArray(b.getMailbox(this.fullName()))}),this),this.isSystem=n.computed((function(){return this.type()!==Enums.FolderTypes.User}),this),this.withoutThreads=n.computed((function(){return this.type()===Enums.FolderTypes.Drafts||this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash}),this),this.enableEmptyFolder=n.computed((function(){return(this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash)&&this.messageCount()>0}),this),this.virtualEmpty=n.computed((function(){return this.bVirtual&&0===this.messageCount()}),this),this.hasSubscribedSubfolders=n.computed((function(){return i.any(this.subfolders(),(function(e){return e.subscribed()}))}),this),this.canExpand=n.computed((function(){return!this.bNamespace&&this.hasSubscribedSubfolders()}),this),this.unseenMessagesCountToShow=n.computed((function(){return!d.isMobile()&&this.canExpand()?this.unseenMessageCount()+this.subfoldersMessagesCount():this.unseenMessageCount()}),this),this.showUnseenMessagesCount=n.computed((function(){return this.unseenMessagesCountToShow()>0&&this.type()!==Enums.FolderTypes.Drafts}),this),this.showMessagesCount=n.computed((function(){return this.messageCount()>0&&(this.type()===Enums.FolderTypes.Drafts||F.AllowShowMessagesCountInFolderList&&F.showMessagesCountInFolderList())}),this),this.visible=n.computed((function(){return this.subscribed()||this.isSystem()||this.hasSubscribedSubfolders()}),this),this.canBeSelected=n.computed((function(){return this.bExists&&this.bSelectable&&this.subscribed()}),this),this.canSubscribe=n.computed((function(){return!F.IgnoreImapSubscription&&!this.isSystem()&&this.bExists&&this.bSelectable}),this),this.canDelete=n.computed((function(){return!this.isSystem()&&this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length}),this),this.canRename=this.canSubscribe,this.visibleTemplateTrigger=n.computed((function(){return F.AllowTemplateFolders&&(this.bSelectable&&!this.isSystem()||this.isTemplateStorage())}),this),this.templateButtonHint=n.computed((function(){return this.visibleTemplateTrigger()?this.isTemplateStorage()?l.i18n("MAILWEBCLIENT/ACTION_TURN_TEMPLATE_FOLDER_OFF"):l.i18n("MAILWEBCLIENT/ACTION_TURN_TEMPLATE_FOLDER_ON"):""}),this),this.alwaysRefreshButtonHint=n.computed((function(){return F.AllowAlwaysRefreshFolders?this.isAlwaysRefresh()?l.i18n("MAILWEBCLIENT/ACTION_TURN_ALWAYS_REFRESH_OFF"):l.i18n("MAILWEBCLIENT/ACTION_TURN_ALWAYS_REFRESH_ON"):""}),this),this.subscribeButtonHint=n.computed((function(){return this.canSubscribe()?this.subscribed()?l.i18n("MAILWEBCLIENT/ACTION_HIDE_FOLDER"):l.i18n("MAILWEBCLIENT/ACTION_SHOW_FOLDER"):""}),this),this.deleteButtonHint=n.computed((function(){return this.canDelete()?l.i18n("MAILWEBCLIENT/ACTION_DELETE_FOLDER"):""}),this),this.usedAs=n.computed((function(){switch(this.type()){case Enums.FolderTypes.Inbox:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_INBOX");case Enums.FolderTypes.Sent:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_SENT");case Enums.FolderTypes.Drafts:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_DRAFTS");case Enums.FolderTypes.Trash:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_TRASH");case Enums.FolderTypes.Spam:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_SPAM")}return""}),this),this.displayName=n.computed((function(){switch(this.type()){case Enums.FolderTypes.Inbox:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_INBOX");case Enums.FolderTypes.Sent:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_SENT");case Enums.FolderTypes.Drafts:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_DRAFTS");case Enums.FolderTypes.Trash:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_TRASH");case Enums.FolderTypes.Spam:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_SPAM")}return this.name()}),this)},I.prototype.onGetMessageResponse=function(e,t){var s=e.Result,i=t.Parameters,o=null,n=s?s.Uid.toString():i.Uid.toString(),r=this.getMessageByUid(n),a=!!r&&r.selected(),h=!1;s?r=this.parseAndCacheMessage(s,!1,!1):(a&&(u.showErrorByCode(e,l.i18n("COREWEBCLIENT/ERROR_UNKNOWN")),p.replaceHashWithoutMessageUid(n)),r=null,h=!0),(o=this.aResponseHandlers[n])&&(o.handler.call(o.context,r,n,h?e:null),delete this.aResponseHandlers[n])},I.prototype.getCompletelyFilledMessage=function(e,t,s){var i=this.getMessageByUid(e),o={AccountID:i?i.accountId():0,Folder:this.fullName(),Uid:e,MessageBodyTruncationThreshold:F.MessageBodyTruncationThreshold};e.length>0&&(i&&i.completelyFilled()&&!i.truncated()?t&&s&&t.call(s,i,e):(t&&s&&(this.aResponseHandlers[e]={handler:t,context:s}),c.send("GetMessage",o,this.onGetMessageResponse,this)))},I.prototype.showExternalPictures=function(e){var t=this.getMessageByUid(e);void 0!==t&&t.showExternalPictures()},I.prototype.alwaysShowExternalPicturesForSender=function(e){this.doForAllMessages((function(t){var s=t.oFrom.aCollection;s.length>0&&s[0].sEmail===e&&t.alwaysShowExternalPicturesForSender()}))},I.prototype.executeGroupOperation=function(e,t,s){var o=0;this.doForAllMessages((function(n){t.length>0?i.each(t,(function(t){n.uid()===t&&n[e]()!==s&&(n[e](s),o++)})):n[e](s)})),0===t.length&&(o=s?this.unseenMessageCount():this.messageCount()-this.unseenMessageCount()),"seen"===e&&o>0&&(s?this.addMessagesCountsDiff(0,-o):this.addMessagesCountsDiff(0,o),this.markHasChanges())},I.prototype.emptyFolder=function(){var e=l.i18n("MAILWEBCLIENT/CONFIRM_EMPTY_FOLDER"),t=i.bind(this.clearFolder,this);this.enableEmptyFolder()&&g.showPopup(f,[e,t])},I.prototype.clearFolder=function(e){this.enableEmptyFolder()&&e&&(c.send("ClearFolder",{Folder:this.fullName()}),this.requireMailCache(),v.onClearFolder(this),this.removeAllMessages())},I.prototype.onAccordion=function(e,t){var s=!this.expanded(),o=m.getData("folderAccordion")||[];s?o.push(this.name()):o=i.reject(o,(function(e){return e===this.name()}),this),m.setData("folderAccordion",o),this.expanded(s),this.requireMailCache(),v.countMessages(this),t&&t.stopPropagation()},I.prototype.executeUnseenFilter=function(){return this.unseenMessagesCountToShow()>this.unseenMessageCount()&&this.onAccordion(),!(this.unseenMessageCount()>0)||(this.requireMailCache(),v.waitForUnseenMessages(!0),p.setHash(b.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Unseen))&&v.changeCurrentMessageList(this.fullName(),1,"",Enums.FolderFilter.Unseen,F.MessagesSortBy.DefaultSortBy,F.MessagesSortBy.DefaultSortOrder),!1)},I.prototype.onDeleteClick=function(){var e=l.i18n("MAILWEBCLIENT/CONFIRM_DELETE_FOLDER"),t=i.bind(this.deleteAfterConfirm,this);this.canDelete()?g.showPopup(f,[e,t]):d.broadcastEvent("MailWebclient::AttemptDeleteNonemptyFolder")},I.prototype.deleteAfterConfirm=function(e){if(e){var t=v.editedFolderList(),s=this.fullName(),i=function(e){return s===e.fullName()||(e.subfolders.remove(i),!1)};t.collection.remove(i),c.send("DeleteFolder",{AccountID:y.editedId(),Folder:this.fullName()},(function(e){e.Result||(u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_DELETE_FOLDER")),v.getFolderList(y.editedId()))}),this)}},I.prototype.onSubscribeClick=function(){if(this.canSubscribe()){var e={AccountID:y.editedId(),Folder:this.fullName(),SetAction:!this.subscribed()};this.subscribed(!this.subscribed()),c.send("SubscribeFolder",e,(function(e){e.Result||(this.subscribed()?u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_SUBSCRIBE_FOLDER")):u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_UNSUBSCRIBE_FOLDER")),v.getFolderList(y.editedId()))}),this)}},I.prototype.afterMove=function(e){i.each(e,(function(e){i.isFunction(e.afterMove)&&e.afterMove()}))},I.prototype.cancelNameEdit=function(){this.edited(!1)},I.prototype.applyNameEdit=function(){if(this.name()!==this.nameForEdit()){var e={AccountID:y.editedId(),PrevFolderFullNameRaw:this.fullName(),NewFolderNameInUtf8:this.nameForEdit()};c.send("RenameFolder",e,i.bind(this.onResponseFolderRename,this),this),this.name(this.nameForEdit())}this.edited(!1)},I.prototype.onResponseFolderRename=function(e,t){if(e&&e.Result){if(e&&e.Result&&e.Result.FullName){v.editedFolderList().renameFolder(this.fullName(),e.Result.FullName,e.Result.FullNameHash)}}else u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_RENAME_FOLDER")),v.getFolderList(y.editedId())},I.prototype.triggerTemplateState=function(){if(this.visibleTemplateTrigger()){this.isTemplateStorage()?(this.type(Enums.FolderTypes.User),this.isTemplateStorage(!1)):(this.type(Enums.FolderTypes.Template),this.isTemplateStorage(!0)),v.changeTemplateFolder(this.fullName(),this.isTemplateStorage());var e={FolderFullName:this.fullName(),SetTemplate:this.isTemplateStorage()};c.send("SetTemplateFolderType",e,this.onSetTemplateFolderType,this)}},I.prototype.onSetTemplateFolderType=function(e){e.Result||(u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_SETUP_SPECIAL_FOLDERS")),v.getFolderList(y.editedId()))},I.prototype.triggerAlwaysRefreshState=function(){if(F.AllowAlwaysRefreshFolders){this.isAlwaysRefresh(!this.isAlwaysRefresh());var e={AccountID:this.iAccountId,FolderFullName:this.fullName(),AlwaysRefresh:this.isAlwaysRefresh()};c.send("SetAlwaysRefreshFolder",e,this.onSetAlwaysRefreshFolder,this)}},I.prototype.onSetAlwaysRefreshFolder=function(e){e.Result||(u.showErrorByCode(e),v.getFolderList(y.editedId()))},e.exports=I},qu3M:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("AFLV"),l=s("Yjhd"),h=s("IAk5"),c=s("QaF5"),u=s("ZCBP"),d=s("xcwT"),p=s("h1OO"),m=s("4M/5"),g=s("jonm"),f=s("4+IO"),b=s("p2hp"),y=s("VO44"),v=s("oROo"),A=s("BOSG");function F(){d.call(this,"MailWebclient"),h.broadcastEvent("MailWebclient::ConstructView::before",{Name:this.ViewConstructorName,View:this,MailCache:f}),this.browserTitle=n.computed((function(){return g.getEmail()+" - "+r.i18n("MAILWEBCLIENT/HEADING_BROWSER_TAB")})),this.folderList=f.folderList,this.domFoldersMoveTo=n.observable(null),this.openMessageInNewWindowBound=i.bind(this.openMessageInNewWindow,this),this.oFolderList=new y,this.oMessageList=new v(this.openMessageInNewWindowBound),this.oBaseMessagePaneView=A,this.messagePane=n.observable(this.oBaseMessagePaneView),this.messagePane().openMessageInNewWindowBound=this.openMessageInNewWindowBound,this.messagePane.subscribe((function(){this.bindMessagePane()}),this),this.isEnableGroupOperations=this.oMessageList.isEnableGroupOperations,this.composeLink=n.observable(c.buildHashFromArray(m.getCompose())),this.sCustomBigButtonModule="",this.fCustomBigButtonHandler=null,this.customBigButtonText=n.observable(""),this.bigButtonCommand=l.createCommand(this,(function(){i.isFunction(this.fCustomBigButtonHandler)?this.fCustomBigButtonHandler():this.executeCompose()})),this.bigButtonText=n.computed((function(){return""!==this.customBigButtonText()?this.customBigButtonText():r.i18n("MAILWEBCLIENT/ACTION_NEW_MESSAGE")}),this),this.checkMailCommand=l.createCommand(this,this.executeCheckMail),this.checkMailIndicator=n.observable(!0).extend({throttle:50}),n.computed((function(){this.checkMailIndicator(f.checkMailStarted()||f.messagesLoading())}),this),this.customModulesDisabledMark=n.observableArray([]),this.visibleMarkTool=n.computed((function(){return!a.isNonEmptyArray(this.customModulesDisabledMark())}),this),this.markAsReadCommand=l.createCommand(this.oMessageList,this.oMessageList.executeMarkAsRead,this.isEnableGroupOperations),this.markAsUnreadCommand=l.createCommand(this.oMessageList,this.oMessageList.executeMarkAsUnread,this.isEnableGroupOperations),this.markAllReadCommand=l.createCommand(this.oMessageList,this.oMessageList.executeMarkAllRead),this.customModulesDisabledMove=n.observableArray([]),this.visibleMoveTool=n.computed((function(){return!a.isNonEmptyArray(this.customModulesDisabledMove())}),this),this.moveToFolderCommand=l.createCommand(this,(function(){}),this.isEnableGroupOperations),this.deleteCommand=l.createCommand(this.oMessageList,this.oMessageList.executeDelete,this.isEnableGroupOperations),this.selectedCount=n.computed((function(){return this.oMessageList.checkedUids().length}),this),this.emptyTrashCommand=l.createCommand(f,f.executeEmptyTrash,this.oMessageList.isNotEmptyList),this.emptySpamCommand=l.createCommand(f,f.executeEmptySpam,this.oMessageList.isNotEmptyList),this.spamCommand=l.createCommand(this.oMessageList,this.oMessageList.executeSpam,this.isEnableGroupOperations),this.notSpamCommand=l.createCommand(this.oMessageList,this.oMessageList.executeNotSpam,this.isEnableGroupOperations),this.isVisibleReplyTool=n.computed((function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==Enums.FolderTypes.Drafts&&this.folderList().currentFolderType()!==Enums.FolderTypes.Sent}),this),this.isVisibleForwardTool=n.computed((function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==Enums.FolderTypes.Drafts}),this),this.isSpamFolder=n.computed((function(){return this.folderList().currentFolderType()===Enums.FolderTypes.Spam}),this),this.customModulesDisabledSpam=n.observableArray([]),this.allowedSpamAction=n.computed((function(){return b.AllowSpamFolder&&this.folderList().spamFolder()&&!this.isSpamFolder()&&!a.isNonEmptyArray(this.customModulesDisabledSpam())}),this),this.allowedNotSpamAction=n.computed((function(){return b.AllowSpamFolder&&this.isSpamFolder()}),this),this.isTrashFolder=n.computed((function(){return this.folderList().currentFolderType()===Enums.FolderTypes.Trash}),this),this.jqPanelHelper=null,b.HorizontalLayout&&o("html").addClass("layout-horiz-split"),h.subscribeEvent("CoreWebclient::GetDebugInfo",i.bind((function(e){e.Info.push("checkMailStarted: "+f.checkMailStarted()+", messagesLoading: "+f.messagesLoading())}),this)),h.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}i.extendOwn(F.prototype,d.prototype),F.prototype.ViewTemplate=b.HorizontalLayout?"MailWebclient_MailHorizontalLayoutView":"MailWebclient_MailView",F.prototype.ViewConstructorName="CMailView",F.prototype.hasUnsavedChanges=function(){return this.messagePane()&&i.isFunction(this.messagePane().hasUnsavedChanges)&&this.messagePane().hasUnsavedChanges()},F.prototype.discardChanges=function(){this.messagePane()&&i.isFunction(this.messagePane().discardChanges)&&this.messagePane().discardChanges()},F.prototype.setCustomPreviewPane=function(e,t){this.messagePane().__customModuleName!==e&&(i.isFunction(this.messagePane().onHide)&&this.messagePane().onHide(),t.__customModuleName=e,this.messagePane(t),i.isFunction(this.messagePane().onShow)&&this.messagePane().onShow())},F.prototype.removeCustomPreviewPane=function(e){this.messagePane().__customModuleName===e&&(i.isFunction(this.messagePane().onHide)&&this.messagePane().onHide(),this.messagePane(this.oBaseMessagePaneView),i.isFunction(this.messagePane().onShow)&&this.messagePane().onShow())},F.prototype.setCustomBigButton=function(e,t,s){this.sCustomBigButtonModule=e,this.fCustomBigButtonHandler=t,this.customBigButtonText(s)},F.prototype.removeCustomBigButton=function(e){this.sCustomBigButtonModule===e&&(this.sCustomBigButtonModule="",this.fCustomBigButtonHandler=null,this.customBigButtonText(""))},F.prototype.resetDisabledTools=function(e,t){-1!==o.inArray("spam",t)?this.customModulesDisabledSpam(i.union(this.customModulesDisabledSpam(),[e])):this.customModulesDisabledSpam(i.without(this.customModulesDisabledSpam(),e)),-1!==o.inArray("move",t)?this.customModulesDisabledMove(i.union(this.customModulesDisabledMove(),[e])):this.customModulesDisabledMove(i.without(this.customModulesDisabledMove(),e)),-1!==o.inArray("mark",t)?this.customModulesDisabledMark(i.union(this.customModulesDisabledMark(),[e])):this.customModulesDisabledMark(i.without(this.customModulesDisabledMark(),e))},F.prototype.executeCompose=function(){p.composeMessage()},F.prototype.executeCheckMail=function(){f.checkMessageFlags(),f.executeCheckMail(!0)},F.prototype.openMessageInNewWindow=function(e){if(e){var t=e.folder(),s=e.uid(),o="";this.folderList().getFolderByFullName(t).type()===Enums.FolderTypes.Drafts?o=c.buildHashFromArray(m.getComposeFromMessage("drafts",t,s)):(o=c.buildHashFromArray(m.getViewMessage(t,s)),i.isFunction(this.messagePane().passReplyDataToNewTab)&&this.messagePane().passReplyDataToNewTab(e.sUniq)),u.openTab("?message-newtab"+o)}},F.prototype.resizeDblClick=function(e,t){t.preventDefault(),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,l.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=o(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[600,"max"])},F.prototype.onRoute=function(e){if(g.hasAccount()){var t=m.parseMailbox(e);g.changeCurrentAccountByHash(t.AccountHash),this.oMessageList.onRoute(e),i.isFunction(this.messagePane().onRoute)&&this.messagePane().onRoute(e,t),t.MailtoCompose&&(p.composeMessageToAddresses(e[2]),c.replaceHash(m.getMailbox()))}else c.replaceHash(["settings","mail-accounts","account","create"])},F.prototype.onShow=function(){this.oMessageList.onShow(),i.isFunction(this.messagePane().onShow)&&this.messagePane().onShow()},F.prototype.onHide=function(){this.oMessageList.onHide(),i.isFunction(this.messagePane().onHide)&&this.messagePane().onHide()},F.prototype.bindMessagePane=function(){i.isFunction(this.messagePane().onBind)&&(this.messagePane().onBind(this.$viewDom),this.messagePane().__bound=!0)},F.prototype.onBind=function(){var e=this.folderList,t=this.oMessageList;this.oMessageList.onBind(this.$viewDom),this.bindMessagePane(),o(this.domFoldersMoveTo()).on("click","span.folder",(function(s){var i=o(this).data("folder");e().currentFolderFullName()!==i&&(s.ctrlKey?t.executeCopyToFolder(i):t.executeMoveToFolder(i))})),h.isMobile()||this.hotKeysBind()},F.prototype.hotKeysBind=function(){o(document).on("keydown",o.proxy((function(e){var t=e.keyCode,s=e&&!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!l.isTextFieldFocused()&&this.shown(),i=this.oMessageList,o=i.collection()[0],n=o&&f.currentMessage()&&o.uid()===f.currentMessage().uid();s&&t===Enums.Key.s||s&&n&&t===Enums.Key.Up?(e.preventDefault(),this.searchFocus()):i.isFocused()&&e&&t===Enums.Key.Down&&o?(e.preventDefault(),i.isFocused(!1),i.routeForMessage(o)):s&&t===Enums.Key.n&&(this.executeCompose(),e.preventDefault())}),this))},F.prototype.routeMessageView=function(e,t){c.setHash(m.getMailbox(e,this.oMessageList.oPageSwitcher.currentPage(),t))},F.prototype.dragAndDropHelper=function(e,t){e&&e.checked(!0);var s=l.draggableItems(),i=this.oMessageList.checkedOrSelectedUids(),n=i.length;return s.data("p7-message-list-folder",this.folderList().currentFolderFullName()),s.data("p7-message-list-uids",i),o(".count-text",s).text(r.i18n("MAILWEBCLIENT/LABEL_DRAG_MESSAGES_PLURAL",{COUNT:t?"+ "+n:n},null,n)),s},F.prototype.messagesDrop=function(e,t,s){if(e){var i=s&&s.helper?s.helper:null,o=i?i.data("p7-message-list-folder"):"",n=i?i.data("p7-message-list-uids"):null;""!==o&&null!==n&&(l.uiDropHelperAnim(t,s),t.ctrlKey?this.oMessageList.executeCopyToFolder(e.fullName()):this.oMessageList.executeMoveToFolder(e.fullName()),this.uncheckMessages())}},F.prototype.searchFocus=function(){this.oMessageList.selector.useKeyboardKeys()&&!l.isTextFieldFocused()&&this.oMessageList.isFocused(!0)},F.prototype.onVolumerClick=function(e,t){t.stopPropagation()},F.prototype.uncheckMessages=function(){i.each(f.messages(),(function(e){e.checked(!1)}))},e.exports=F},sWkr:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("AFLV"),r=s("HLSX");function a(e){this.oOptions=i.extend({creaId:"creaId",fontNameArray:["Tahoma"],defaultFontName:"Tahoma",defaultFontSize:3,alwaysTryUseImageWhilePasting:!0,dropableArea:null,isRtl:!1,onChange:function(){},onCursorMove:function(){},onFocus:function(){},onBlur:function(){},onUrlIn:function(){},onUrlOut:function(){},onImageSelect:function(){},onImageBlur:function(){},onItemOver:null,onItemOut:null,openInsertLinkDialog:function(){},onUrlClicked:!1},void 0===e?{}:e)}a.prototype.oOptions={},a.prototype.$container=null,a.prototype.$editableArea=null,a.prototype.aEditableAreaHtml=[],a.prototype.iUndoRedoPosition=0,a.prototype.bEditable=!1,a.prototype.bFocused=!1,a.prototype.bEditing=!1,a.prototype.aSizes=[{inNumber:1,inPixels:10},{inNumber:2,inPixels:13},{inNumber:3,inPixels:16},{inNumber:4,inPixels:18},{inNumber:5,inPixels:24},{inNumber:6,inPixels:32},{inNumber:7,inPixels:48}],a.prototype.bInUrl=!1,a.prototype.oCurrLink=null,a.prototype.oCurrImage=null,a.prototype.bInImage=!1,a.prototype.sBasicFontName="",a.prototype.sBasicFontSize="",a.prototype.sBasicDirection="",a.prototype.start=function(e){function t(e){return/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e)}function s(e){return!!e.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)}this.aRanges=null,this.$container=o("#"+this.oOptions.creaId),this.$editableArea=o("<div></div>").addClass("crea-content-editable").prop("contentEditable","true").appendTo(this.$container);var n=this;this.$editableArea.on("focus",(function(){n.bFocused=!0})),this.$editableArea.on("blur",(function(){n.bFocused=!1})),this.$editableArea.on("click","img",(function(e){var t=o(this);n.bInImage=!0,n.oCurrImage=t,n.oOptions.onImageSelect(t,e),e.stopPropagation()})),this.$editableArea.on("click",(function(e){n.bInImage=!1,n.oCurrImage=null,n.oOptions.onImageBlur()})),null!==n.oOptions.onItemOver&&this.$editableArea.on("mouseover",(function(e){n.oOptions.onItemOver(e)})),null!==n.oOptions.onItemOver&&this.$editableArea.on("mouseout",(function(e){n.oOptions.onItemOut(e)})),this.$editableArea.on("cut paste",(function(){n.bEditing=!0,n.editableSave(),i.defer((function(){n.editableSave()}))})),this.$editableArea.on("paste",(function(e){if((e=e.originalEvent||e).clipboardData){var i,o=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("text/html");n.oOptions.alwaysTryUseImageWhilePasting&&n.pasteImage(e)?e.preventDefault():t(o)?(e.preventDefault(),n.execCom("insertHTML",'<a href="'+o+'">'+o+"</a>")):s(o)?(e.preventDefault(),n.execCom("insertHTML",'<a href="mailto:'+o+'">'+o+"</a>")):""!==r&&(e.preventDefault(),3===(i=r.split(/<!--StartFragment-->|<!--EndFragment-->/gi)).length&&(r=i[1]),r=n.replacePToBr(r),n.execCom("insertHTML",r))}})),this.$editableArea.on("keydown",(function(e){var i=e.keyCode||e.which||e.charCode||0,o=e.ctrlKey||e.metaKey,r=e.altKey,a=e.shiftKey,l="";if(n.bEditing=!0,a&&o&&i===Enums.Key.z||o&&i===Enums.Key.y)e.preventDefault(),n.editableRedo();else if(o&&!r&&i===Enums.Key.z)e.preventDefault(),n.editableUndo();else if(!o||i!==Enums.Key.k&&i!==Enums.Key.b&&i!==Enums.Key.i&&i!==Enums.Key.u)r||a||o||i!==Enums.Key.Del&&i!==Enums.Key.Backspace||n.editableSave();else switch(e.preventDefault(),i){case Enums.Key.k:t(l=n.getSelectedText())?n.insertLink(l):s(l)?n.insertLink("mailto:"+l):n.oOptions.openInsertLinkDialog();break;case Enums.Key.b:n.bold();break;case Enums.Key.i:n.italic();break;case Enums.Key.u:n.underline()}})),this.$editableArea.on("keyup",(function(e){var t=e.keyCode||e.which||e.charCode||0,s=e.ctrlKey||e.metaKey,i=e.altKey,o=e.shiftKey;i||o||s||(t===Enums.Key.Space||t===Enums.Key.Enter||t===Enums.Key.Del||t===Enums.Key.Backspace?n.editableSave():n.oOptions.onChange())})),this.initContentEditable(),this.setEditable(e)},a.prototype.clearUndoRedo=function(){this.aEditableAreaHtml=[],this.iUndoRedoPosition=0,this.bEditing=!1},a.prototype.isUndoAvailable=function(){return this.iUndoRedoPosition>0},a.prototype.clearRedo=function(){this.aEditableAreaHtml=this.aEditableAreaHtml.slice(0,this.iUndoRedoPosition+1)},a.prototype.editableSave=function(){var e=this.$editableArea.html(),t=i.last(this.aEditableAreaHtml);e!==(t?t[0]:"")&&(this.clearRedo(),this.aEditableAreaHtml.push([e,this.getCaretPos(this.$editableArea[0])]),this.iUndoRedoPosition=this.aEditableAreaHtml.length-1,this.oOptions.onChange())},a.prototype.editableUndo=function(){var e=this.$editableArea.html(),t=this.aEditableAreaHtml[this.iUndoRedoPosition];e!==(t?t[0]:"")&&this.editableSave(),this.iUndoRedoPosition>0&&(this.iUndoRedoPosition--,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition][1]))},a.prototype.editableRedo=function(){this.iUndoRedoPosition<this.aEditableAreaHtml.length-1&&(this.iUndoRedoPosition++,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition]?this.aEditableAreaHtml[this.iUndoRedoPosition][1]:{}))},a.prototype.getCaretPos=function(e){var t=null,s={},i={},o=0,n={};return window.getSelection&&document.createRange?(t=window.getSelection()).rangeCount>0&&((i=(s=t.getRangeAt(0)).cloneRange()).selectNodeContents(e),i.setEnd(s.startContainer,s.startOffset),n={start:o=i.toString().length,end:o+s.toString().length}):document.selection&&document.body.createTextRange&&(s=document.selection.createRange(),(i=document.body.createTextRange()).moveToElementText(e),"function"==typeof i.setEndPoint&&i.setEndPoint("EndToStart",s),n={start:o=i.text.length,end:o+s.text.length}),n},a.prototype.setCaretPos=function(e,t){if(window.getSelection&&document.createRange){var s=[e],i={},o={},n=!1,r=!1,a=0,l=0,h=0,c=document.createRange();for(c.setStart(e,0),c.collapse(!0),i=s.pop();!r&&i;){if(3===i.nodeType)l=a+i.length,!n&&t.start>=a&&t.start<=l&&(c.setStart(i,t.start-a),n=!0),n&&t.end>=a&&t.end<=l&&(c.setEnd(i,t.end-a),r=!0),a=l;else for(h=i.childNodes.length;h--;)s.push(i.childNodes[h]);i=s.pop()}(o=window.getSelection()).removeAllRanges(),o.addRange(c)}else if(document.selection&&document.body.createTextRange){var u=document.body.createTextRange();u.moveToElementText(e),u.collapse(!0),u.moveEnd("character",t.end),u.moveStart("character",t.start),u.select()}},a.prototype.setTabIndex=function(e){e&&this.$editableArea.attr("tabindex",e)},a.prototype.initContentEditable=function(){this.$editableArea.bind({mousemove:i.bind(this.storeSelectionPosition,this),mouseup:i.bind(this.onCursorMove,this),keydown:i.bind(this.onButtonPressed,this),keyup:i.bind(this.onCursorMove,this),click:i.bind(this.onClickWith,this),focus:this.oOptions.onFocus,blur:this.oOptions.onBlur}),window.File&&window.FileReader&&window.FileList&&this.oOptions.enableDrop&&this.$editableArea.bind({dragover:i.bind(this.onDragOver,this),dragleave:i.bind(this.onDragLeave,this),drop:i.bind(this.onFileSelect,this)});var e=this,t=i.debounce((function(){e.oCurrLink=null,e.bInUrl=!1,e.oOptions.onUrlOut()}),300);o("html, body").on("scroll",t)},a.prototype.onCursorMove=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),13===t&&this.breakQuotes(e),17===t&&this.$editableArea.find("a").css("cursor","inherit"),8===t&&this.uniteWithNextQuote(e),46===t&&r.chrome&&this.uniteWithPrevQuote(e),this.storeSelectionPosition(),this.oOptions.onCursorMove()},a.prototype.onClickWith=function(e){e.ctrlKey&&"A"===e.target.nodeName&&window.open(e.target.href,"_blank"),this.checkAnchorNode()},a.prototype.onButtonPressed=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),17===t&&this.$editableArea.find("a").css("cursor","pointer")},a.prototype.onFileSelect=function(e){if(e=(e&&e.originalEvent?e.originalEvent:e)||window.event){e.stopPropagation(),e.preventDefault();var t=null,s=null,i=e.files||(e.dataTransfer?e.dataTransfer.files:null),o=this;i&&1===i.length&&this.checkIsImage(i[0])&&(s=i[0],(t=new window.FileReader).onload=function(e){o.insertImage(e.target.result)},t.readAsDataURL(s))}},a.prototype.onDragLeave=function(){this.$editableArea.removeClass("editorDragOver")},a.prototype.onDragOver=function(e){e.stopPropagation(),e.preventDefault(),this.$editableArea.addClass("editorDragOver")},a.prototype.pasteImage=function(e){var t=e.clipboardData&&e.clipboardData.items,s=this,o=!1;return window.File&&window.FileReader&&window.FileList&&t&&i.each(t,(function(e){if(s.checkIsImage(e)&&e.getAsFile){var t=null,i=e.getAsFile();i&&((t=new window.FileReader).onload=function(e){s.insertImage(e.target.result)},t.readAsDataURL(i),o=!0)}})),o},a.prototype.checkIsImage=function(e){return e&&e.type&&0===e.type.indexOf("image/")},a.prototype.setPlainText=function(e){"string"!=typeof e&&(e=""),this.$editableArea&&(this.editableSave(),this.$editableArea.empty().text(e).css("white-space","pre"),this.editableSave())},a.prototype.setText=function(e){if("string"!=typeof e&&(e=""),this.$editableArea){0===e.length&&(e="<br />");var t=o(e),s=o(e),i=s.children(),n=i.first(),r=1===s.length&&"font-wrapper"===s.data("crea"),a=1===s.length&&1===i.length&&"body"===s.data("xDivType")&&"font-wrapper"===n.data("crea");r?(this.setBasicStyles(s.css("font-family"),s.css("font-size"),s.css("direction")),t=s.contents()):a?(this.setBasicStyles(n.css("font-family"),n.css("font-size"),n.css("direction")),t=n.contents()):this.setBasicStyles(this.oOptions.defaultFontName,this.convertFontSizeToPixels(this.oOptions.defaultFontSize),this.oOptions.isRtl?"rtl":"ltr"),this.$editableArea.empty().append(t).css("white-space","normal"),this.clearUndoRedo(),this.editableSave()}},a.prototype.setBasicStyles=function(e,t,s){this.sBasicFontName=e,this.sBasicFontSize=t,this.sBasicDirection=s,this.$editableArea.css({"font-family":this.getFontNameWithFamily(this.sBasicFontName),"font-size":this.sBasicFontSize,direction:this.sBasicDirection})},a.prototype.replacePToBr=function(e){return e.replace(/<\/p>/gi,"<br />").replace(/<p [^>]*>/gi,"").replace(/<p>/gi,"")},a.prototype.getPlainText=function(){var e="";return this.$editableArea&&(e=this.$editableArea.html().replace(/([^>]{1})<div>/gi,"$1\n").replace(/<style[^>]*>[^<]*<\/style>/gi,"\n").replace(/<br *\/{0,1}>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<\/div>/gi,"\n").replace(/<a [^>]*href="([^"]*?)"[^>]*>(.*?)<\/a>/gi,"$2 ($1)").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"')),e},a.prototype.getText=function(e){var t="";return this.$editableArea&&this.$editableArea.length>0&&(e&&this.$editableArea.find('div[data-anchor="signature"]').removeAttr("data-anchor"),t=this.$editableArea.html(),t=this.replacePToBr(t),t='<div data-crea="font-wrapper" style="font-family: '+this.getFontNameWithFamily(this.sBasicFontName)+"; font-size: "+this.sBasicFontSize+"; direction: "+this.sBasicDirection+'">'+t+"</div>"),t},a.prototype.changeSignatureContent=function(e,t){var s,i,n,r,a,l,h,c=this.$editableArea.find('div[data-anchor="signature"]'),u=o(e).closest('div[data-crea="font-wrapper"]'),d=o(t).closest('div[data-crea="font-wrapper"]');if(c.length>0)n=c.html(),""===t?c.html(n+e):-1!==n.indexOf(t)?c.html(n.replace(t,e)):-1!==n.indexOf(e)||(s=0===u.length||0===d.length?t:d.html(),i=0===u.length||0===d.length?e:u.html(),-1!==n.indexOf(s)?c.html(n.replace(s,e)):-1!==n.indexOf(i)||c.html(n+e));else{l=t;try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=o("")}if(0===r.length&&d.length>0){l=d.html();try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=o("")}}r.length>0&&(a=(r=o(r[0])).closest("blockquote")),a&&0===a.length?r.html(r.html().replace(l,e)):(h=(c=this.$editableArea.find('div[data-anchor="reply-title"]')).length>0?o(c[0]).closest("blockquote"):c,(0===c.length||h.length>0)&&(c=this.$editableArea.find("blockquote")),c.length>0?o(c[0]).before(o('<br /><div data-anchor="signature">'+e+"</div><br />")):this.$editableArea.append(o('<br /><div data-anchor="signature">'+e+"</div><br />")))}this.editableSave()},a.prototype.isFocused=function(){return this.bFocused},a.prototype.setFocus=function(e){var t=this.$editableArea.contents(),s=null,n="";this.$editableArea.focus(),e&&i.isArray(this.aRanges)&&this.aRanges.length>0?this.restoreSelectionPosition():t.length>0&&(3===t[0].nodeType?s=o(t[0]):(s=o(document.createTextNode("")),o(t[0]).before(s)),n=s.text(),this.setCursorPosition(s[0],n.length))},a.prototype.setBlur=function(){this.$editableArea.blur()},a.prototype.setEditable=function(e){e?this.enableContentEditable():this.disableContentEditable()},a.prototype.disableContentEditable=function(){this.bEditable=!1,this.$editableArea.prop("contentEditable","false")},a.prototype.enableContentEditable=function(){this.$editableArea.prop("contentEditable","true"),setTimeout(i.bind((function(){this.bEditable=!0}),this),0)},a.prototype.fixFirefoxCursorBug=function(){r.firefox&&(this.disableContentEditable(),setTimeout(i.bind((function(){this.enableContentEditable()}),this),0))},a.prototype.setRtlDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"rtl")},a.prototype.setLtrDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"ltr")},a.prototype.pasteHtmlAtCaret=function(e){var t,s;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(s=t.getRangeAt(0)).deleteContents();var i=document.createElement("div");i.innerHTML=e;for(var o,n,r=document.createDocumentFragment();o=i.firstChild;)n=r.appendChild(o);s.insertNode(r),n&&((s=s.cloneRange()).setStartAfter(n),s.collapse(!0),t.removeAllRanges(),t.addRange(s))}}else document.selection&&"Control"!==document.selection.type&&(s=document.selection.createRange())&&s.pasteHTML&&s.pasteHTML(e)},a.prototype.execCom=function(e,t,s){var i,o=!1;return this.bEditable&&(this.editableSave(),r.opera&&this.restoreSelectionPosition(),"insertHTML"===e&&r.ie?this.pasteHtmlAtCaret(t):o=void 0===t?window.document.execCommand(e):window.document.execCommand(e,!1,t),r.chrome&&(this.storeSelectionPosition(),"insertHTML"===e&&this.aRanges.length>0&&((i=this.aRanges[0]).setEnd(i.startContainer,i.startOffset),this.restoreSelectionPosition())),s||this.editableSave()),o},a.prototype.insertHtml=function(e,t){this.execCom("insertHTML",e,t)},a.prototype.changeImageSource=function(e,t){this.$editableArea.find('img[id="'+e+'"]').attr("src",t),this.editableSave()},a.prototype.insertEmailLink=function(e){this.restoreSelectionPosition(),""===this.getSelectedText()?this.execCom("insertHTML",'<a href="mailto:'+e+'">'+e+"</a>"):this.insertLink("mailto:"+e)},a.prototype.insertLink=function(e){if(e=this.normaliseURL(e),this.restoreSelectionPosition(e),""===this.getSelectedText()&&r.ie)this.execCom("insertHTML",'<a href="'+e+'">'+e+"</a>");else{var t=r.ie8AndBelow?"CreateLink":"createlink";this.execCom(t,e)}this.changeFocusLink(e)},a.prototype.removeLink=function(){var e=r.ie8AndBelow?"Unlink":"unlink";this.execCom(e)},a.prototype.insertImage=function(e){var t=r.ie8AndBelow?"InsertImage":"insertimage";return this.isFocused()?this.restoreSelectionPosition():this.setFocus(!0),this.execCom(t,e)},a.prototype.numbering=function(){this.execCom("InsertOrderedList")},a.prototype.bullets=function(){this.execCom("InsertUnorderedList")},a.prototype.horizontalLine=function(){this.execCom("InsertHorizontalRule")},a.prototype.getFontNameWithFamily=function(e){var t="";switch(e){case"Arial":case"Arial Black":case"Tahoma":case"Verdana":t=", sans-serif";break;case"Courier New":t=", monospace";break;case"Times New Roman":t=", serif"}return e+t},a.prototype.fontName=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontName",this.getFontNameWithFamily(e)),t&&this.setBasicStyles(e,this.sBasicFontSize,this.sBasicDirection)},a.prototype.fontSize=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontSize",e),t&&this.setBasicStyles(this.sBasicFontName,this.convertFontSizeToPixels(e),this.sBasicDirection)},a.prototype.bold=function(){this.execCom("Bold"),this.$editableArea.focus()},a.prototype.italic=function(){this.execCom("Italic"),this.$editableArea.focus()},a.prototype.underline=function(){this.execCom("Underline"),this.$editableArea.focus()},a.prototype.strikeThrough=function(){this.execCom("StrikeThrough"),this.$editableArea.focus()},a.prototype.undo=function(){this.editableUndo()},a.prototype.redo=function(){this.editableRedo()},a.prototype.alignLeft=function(){this.execCom("JustifyLeft")},a.prototype.center=function(){this.execCom("JustifyCenter")},a.prototype.alignRight=function(){this.execCom("JustifyRight")},a.prototype.justify=function(){this.execCom("JustifyFull")},a.prototype.textColor=function(e){this.execCom("ForeColor",e),this.$editableArea.focus()},a.prototype.backgroundColor=function(e){var t=r.ie?"BackColor":"hilitecolor";this.execCom(t,e),this.$editableArea.focus()},a.prototype.removeFormat=function(){this.execCom("removeformat"),this.$editableArea.focus()},a.prototype.getFontName=function(){if(this.bEditable){var e=window.document.queryCommandValue("FontName"),t=this.sBasicFontName,s="";"string"==typeof e&&(e=e.replace(/'/g,""),o.each(this.oOptions.fontNameArray,(function(t,i){(e.indexOf(i)>-1||e.indexOf(i.toLowerCase())>-1)&&(s=i)})),""!==s&&(t=s))}return t},a.prototype.getIsBold=function(){if(this.bEditable)var e=window.document.queryCommandState("bold");return e},a.prototype.getIsItalic=function(){if(this.bEditable)var e=window.document.queryCommandState("italic");return e},a.prototype.getIsUnderline=function(){if(this.bEditable)var e=window.document.queryCommandState("underline");return e},a.prototype.getIsEnumeration=function(){if(this.bEditable)var e=window.document.queryCommandState("insertOrderedList");return e},a.prototype.getIsBullets=function(){if(this.bEditable)var e=window.document.queryCommandState("insertUnorderedList");return e},a.prototype.getIsStrikeThrough=function(){if(this.bEditable)var e=window.document.queryCommandState("StrikeThrough");return e},a.prototype.convertFontSizeToPixels=function(e){var t=0;return o.each(this.aSizes,(function(s,i){0===t&&e<=i.inNumber&&(t=i.inPixels)})),t+"px"},a.prototype.convertFontSizeToNumber=function(e){var t=n.pInt(e),s=0;return t>0&&o.each(this.aSizes,(function(e,i){0===s&&t<=i.inPixels&&(s=i.inNumber)})),s},a.prototype.getFontSizeInNumber=function(){var e="",t=0;return this.bEditable&&(e=window.document.queryCommandValue("FontSize"),t=n.pInt(e)),(isNaN(t)||t<=0)&&(t=this.convertFontSizeToNumber(this.sBasicFontSize)),t},a.prototype.changeLink=function(e){var t=this.normaliseURL(e),s=o(this.oCurrLink);this.oCurrLink&&(s.attr("href")===s.text()&&s.text(t),"A"===this.oCurrLink.tagName?s.attr("href",t):s.parent().attr("href",t),this.oCurrLink=null,this.bInUrl=!1)},a.prototype.removeCurrentLink=function(){if(this.oCurrLink&&document.createRange&&window.getSelection){var e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.oCurrLink),t.removeAllRanges(),t.addRange(e),this.removeLink(),this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()}},a.prototype.changeFocusLink=function(e){var t=null,s=null;r.firefox&&window.getSelection&&(s=(t=window.getSelection()).focusNode?t.focusNode.parentElement:null)&&"A"===s.tagName&&o(s).attr("href",e)},a.prototype.removeCurrentImage=function(){this.oCurrImage&&(this.oCurrImage.remove(),this.oCurrImage=null,this.bInImage=!1,this.oOptions.onImageBlur()),this.setFocus(!0)},a.prototype.changeCurrentImage=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;o.each(e,(function(e,s){t.css(e,s)}))}this.setFocus(!0)},a.prototype.showImageTooltip=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;o.each(e,(function(e,s){t.css(e,s)}))}},a.prototype.normaliseURL=function(e){return-1!==e.search(/^https?:\/\/|^mailto:|^tel:/g)?e:"http://"+e},a.prototype.getSelectedText=function(){var e="",t=null;return window.getSelection&&(t=window.getSelection()).rangeCount>0&&(e=t.getRangeAt(0).toString()),e},a.prototype.storeSelectionPosition=function(){var e=this.getSelectionRanges();i.isArray(e)&&e.length>0&&(this.aRanges=e)},a.prototype.editableIsActive=function(){return!(!o(document.activeElement).hasClass("crea-content-editable")&&!o(document.activeElement).children().first().hasClass("crea-content-editable"))},a.prototype.getSelectionRanges=function(){var e=[];if(window.getSelection&&this.editableIsActive())for(var t=window.getSelection(),s=null,i=0,o=t.rangeCount;i<o;i++)s=t.getRangeAt(i),e.push(s);return e},a.prototype.checkAnchorNode=function(){if(window.getSelection&&this.editableIsActive()){var e=window.getSelection(),t=null;e.anchorNode&&(e.anchorNode.parentElement||e.anchorNode.parentNode)&&("A"===(t=e.anchorNode.parentElement||e.anchorNode.parentNode).tagName||"A"===t.parentNode.tagName||"A"===t.parentElement.tagName?this.bInUrl&&t===this.oCurrLink?this.bInUrl&&t===this.oCurrLink&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()):(this.oCurrLink=t,this.bInUrl=!0,this.oOptions.onUrlIn(o(t))):this.bInUrl&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()))}},a.prototype.restoreSelectionPosition=function(e){var t,s=null,o=null,n=null;t=this.setSelectionRanges(this.aRanges),window.getSelection&&i.isArray(this.aRanges)&&(e=void 0!==e?e:"",r.firefox&&""===t&&""!==e&&(window.getSelection&&window.getSelection().getRangeAt?(s=window.getSelection()).getRangeAt&&s.rangeCount>0&&(n=(o=s.getRangeAt(0)).createContextualFragment(e),o.insertNode(n)):document.selection&&document.selection.createRange&&document.selection.createRange().pasteHTML(e)))},a.prototype.setSelectionRanges=function(e){var t=null,s=null,o=0,n=0,a="";if(window.getSelection&&i.isArray(e))for(n=e.length,t=window.getSelection(),r.ie10AndAbove||t.removeAllRanges();o<n;o++)(s=e[o])&&(t.addRange(s),a+=""+s);return a},a.prototype.uniteWithNextQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,s=t?this.getLastBlockQuote(t):null,i=s?o(s).next():null,n=i&&i.length>0&&"BLOCKQUOTE"===i[0].tagName?i[0]:null,r=[],a=0,l=0,h=null;if(s&&n){for(o("<br />").appendTo(s),l=(r=o(n).contents()).length,a=0;a<l;a++)h=r[a],o(h).appendTo(s);o(n).remove()}},a.prototype.uniteWithPrevQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,s=t?this.getLastBlockQuote(t):null;this.getPrevAndUnite(s),this.getPrevAndUnite(s)},a.prototype.getPrevAndUnite=function(e){var t=e?o(e).prev():null,s=t&&t.length>0&&"BLOCKQUOTE"===t[0].tagName?t[0]:null,i=[],n=0,r=null;if(e&&s){for(o("<br />").prependTo(e),n=(i=o(s).contents()).length-1;n>0;n--)r=i[n],o(r).prependTo(e);o(s).remove()}},a.prototype.getLastBlockQuote=function(e){for(var t=e,s=null;t&&t.parentNode;)"BLOCKQUOTE"===t.tagName&&(s=t),t=t.parentNode;return s},a.prototype.breakQuotes=function(e){var t=window.getSelection?window.getSelection():null,s=t?t.focusNode:null,i=s?this.getLastBlockQuote(s):null;s&&i&&this.breakBlocks(s,i,t.focusOffset)},a.prototype.setCursorPosition=function(e,t){if(document.createRange&&window.getSelection){var s=document.createRange(),i=window.getSelection();i.removeAllRanges(),s.setStart(e,t),s.setEnd(e,t),s.collapse(!0),i.addRange(s),this.aRanges=[s]}},a.prototype.cloneNode=function(e){var t=null,s="";try{t=o(e).clone()}catch(i){s=e.tagName,t=o("<"+s+"></"+s+">")}return t},a.prototype.breakBlocks=function(e,t,s){for(var i=e,n=null,r=[],a=0,l=0,h=null,c=!0,u=null,d=null,p=null,m=null,g=!0,f=null;g&&i.parentNode;){for(p=u,m=d,u=this.cloneNode(i).empty(),d=this.cloneNode(i).empty(),l=(r=o(i).contents()).length,c=!0,null===n&&(n=r[s]),0===l&&(u=null),a=0;a<l;a++)(h=r[a])===n?(null===p?a===s&&"BR"===h.tagName||o(h).appendTo(d):(p.html().length>0&&p.appendTo(u),m.appendTo(d)),c=!1):c?o(h).appendTo(u):o(h).appendTo(d);t===i&&(g=!1),n=i,i=i.parentNode}null!==u&&null!==d&&(u.insertBefore(o(t)),f=o("<span>&nbsp;</span>").insertBefore(o(t)),o("<br>").insertBefore(o(t)),d.insertBefore(o(t)),o(t).remove(),this.setCursorPosition(f[0],0))},e.exports=a},vsma:function(e,t,s){"use strict";var i=s("0h2I"),o=s("Ol7c"),n=s("AFLV"),r=s("Yjhd");function a(){this.bAccountPart=!1,this.isDefault=i.observable(!1),this.email=i.observable(""),this.friendlyName=i.observable(""),this.fullEmail=i.computed((function(){return o.getFullEmail(this.friendlyName(),this.email())}),this),this.accountId=i.observable(-1),this.id=i.observable(-1),this.signature=i.observable(""),this.useSignature=i.observable(!1),this.hash=i.computed((function(){return r.getHash(this.accountId()+"identity"+this.id())}),this)}a.prototype.parse=function(e){"Object/Aurora\\Modules\\Mail\\Classes\\Identity"===e["@Object"]&&(this.bAccountPart=!!e.AccountPart,this.isDefault(!!e.Default),this.email(n.pString(e.Email)),this.friendlyName(n.pString(e.FriendlyName)),this.accountId(n.pInt(e.IdAccount)),this.id(n.pInt(e.EntityId)),this.signature(n.pString(e.Signature)),this.useSignature(!!e.UseSignature))},e.exports=a},"w+bY":function(e,t,s){var i;!function(){function o(e){function t(){for(;a=c<h.length&&e>u;){var t=c++,i=h[t],o=r.call(i,1);o.push(s(t)),++u,i[0].apply(null,o)}}function s(e){return function(s,o){--u,null==p&&(null!=s?(p=s,c=d=NaN,i()):(h[e]=o,--d?a||t():i()))}}function i(){null!=p?m(p):l?m(p,h):m.apply(null,[p].concat(h))}var o,a,l,h=[],c=0,u=0,d=0,p=null,m=n;return e||(e=1/0),o={defer:function(){return p||(h.push(arguments),++d,t()),o},await:function(e){return m=e,l=!1,d||i(),o},awaitAll:function(e){return m=e,l=!0,d||i(),o}}}function n(){}var r=[].slice;o.version="1.0.7",void 0===(i=function(){return o}.call(t,s,t,e))||(e.exports=i)}()},xzvH:function(e,t,s){"use strict";var i=30,o=s("F/us"),n=s("wd/R"),r=s("Yjhd"),a=s("p2hp"),l=null;function h(){this.oMessages={},setInterval(this.checkAndClear.bind(this),6e4*i)}h.prototype.get=function(e){var t=JSON.stringify(e);return this.oMessages[t]},h.prototype.set=function(e,t){var s=JSON.stringify(e);this.oMessages[s]=t},h.prototype.requireMailCache=function(){null===l&&(l=s("4+IO"))},h.prototype.checkAndClear=function(){this.requireMailCache();var e=l.getCurrentFolder();if(!e&&l.folderList()&&(e=l.folderList().inboxFolder()),e&&!(n().diff(e.oRelevantInformationLastMoment)>6e4*i)){var t=o.size(this.oMessages),s=n().add(-4,"hours").unix(),h=8*a.MailsPerPage+700;t>h&&(r.log("checkAndClear",t,a.MailsPerPage,h),o.each(l.messages(),(function(e){e.updateLastAccessTime()})),l.currentMessage()&&l.currentMessage().updateLastAccessTime(),o.each(this.oMessages,function(e,t){0!==e.iLastAccessTime&&e.iLastAccessTime<s&&r.destroyObjectWithObservables(this.oMessages,t)}.bind(this)),r.log("checkAndClear",o.size(this.oMessages)))}},h.prototype.remove=function(e){var t=JSON.stringify(e);r.destroyObjectWithObservables(this.oMessages,t)},h.prototype.updateMomentDates=function(){o.each(this.oMessages,(function(e){e.updateMomentDate()}),this)},e.exports=new h},z1kJ:function(e,t,s){var i,o,n;o=[s("0h2I"),s("EVdn"),s("NvoQ"),s("chtW"),s("kCXG")],void 0===(n="function"==typeof(i=function(e,t){var s="ko_sortItem",i="ko_sourceIndex",o="ko_sortList",n=e.utils.unwrapObservable,r=e.utils.domData.get,a=e.utils.domData.set,l=t.ui&&t.ui.version,h=l&&l.indexOf("1.6.")&&l.indexOf("1.7.")&&(l.indexOf("1.8.")||"1.8.24"===l),c=function(t,i){e.utils.arrayForEach(t,(function(e){1===e.nodeType&&(a(e,s,i),a(e,"ko_parentList",r(e.parentNode,o)))}))},u=function(t,s){var i,o={},r=n(t())||{};return r.data?(o[s]=r.data,o.name=r.template):o[s]=t(),e.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions","nodes"],(function(t){r.hasOwnProperty(t)?o[t]=r[t]:e.bindingHandlers.sortable.hasOwnProperty(t)&&(o[t]=e.bindingHandlers.sortable[t])})),"foreach"===s&&(o.afterRender?(i=o.afterRender,o.afterRender=function(e,t){c.call(t,e,t),i.call(t,e,t)}):o.afterRender=c),o},d=function(e,t){var s=n(t);if(s)for(var i=0;i<e;i++)s[i]&&n(s[i]._destroy)&&e++;return e};e.bindingHandlers.sortable={init:function(l,c,p,m,g){var f,b,y=t(l),v=n(c())||{},A=u(c,"foreach"),F={};!function(s,i){var o,n;i?(n=document.getElementById(i))&&(o=new e.templateSources.domElement(n)).text(t.trim(o.text())):t(s).contents().each((function(){this&&1!==this.nodeType&&s.removeChild(this)}))}(l,A.name),t.extend(!0,F,e.bindingHandlers.sortable),v.options&&F.options&&(e.utils.extend(F.options,v.options),delete v.options),e.utils.extend(F,v),F.connectClass&&(e.isObservable(F.allowDrop)||"function"==typeof F.allowDrop)?e.computed({read:function(){var t=n(F.allowDrop),s="function"==typeof t?t.call(this,A.foreach):t;e.utils.toggleDomNodeCssClass(l,F.connectClass,s)},disposeWhenNodeIsRemoved:l},this):e.utils.toggleDomNodeCssClass(l,F.connectClass,F.allowDrop),e.bindingHandlers.template.init(l,(function(){return A}),p,m,g),f=F.options.start,b=F.options.update,F.options.helper||(F.options.helper=function(e,s){return s.is("tr")&&s.children().each((function(){t(this).width(t(this).width())})),s});var S=setTimeout((function(){var c,u=F.options.receive;y.sortable(e.utils.extend(F.options,{start:function(t,s){var o=s.item[0];a(o,i,e.utils.arrayIndexOf(s.item.parent().children(),o)),s.item.find("input:focus").change(),f&&f.apply(this,arguments)},receive:function(e,t){"function"==typeof u&&u.call(this,e,t),(c=r(t.item[0],"ko_dragItem"))&&(c.clone&&(c=c.clone()),F.dragged&&(c=F.dragged.call(this,c,e,t)||c))},update:function(l,u){var p,m,g,f,y,v=u.item[0],S=u.item.parent()[0],E=r(v,s)||c;if(E||t(v).remove(),c=null,E&&this===S||!h&&t.contains(this,S)){if(p=r(v,"ko_parentList"),g=r(v,i),m=r(v.parentNode,o),f=e.utils.arrayIndexOf(u.item.parent().children(),v),A.includeDestroyed||(g=d(g,p),f=d(f,m)),(F.beforeMove||F.afterMove)&&(y={item:E,sourceParent:p,sourceParentNode:p&&u.sender||v.parentNode,sourceIndex:g,targetParent:m,targetIndex:f,cancelDrop:!1},F.beforeMove&&F.beforeMove.call(this,y,l,u)),p?t(p===m?this:u.sender||this).sortable("cancel"):t(v).remove(),y&&y.cancelDrop)return;if(F.hasOwnProperty("strategyMove")&&!1!==F.strategyMove){if(f>=0)if(p)if(p!==m)p.splice(g,1),m.splice(f,0,E),a(v,s,null),u.item.remove();else{var I=n(p);p.valueWillMutate&&p.valueWillMutate(),I.splice(g,1),I.splice(f,0,E),p.valueHasMutated&&p.valueHasMutated()}else m.splice(f,0,E),a(v,s,null),u.item.remove()}else f>=0&&(p&&(p.splice(g,1),e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),e.options&&e.options.deferUpdates&&e.tasks.runEarly()),m.splice(f,0,E)),a(v,s,null);e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),F.afterMove&&F.afterMove.call(this,y,l,u)}b&&b.apply(this,arguments)},connectWith:!!F.connectClass&&"."+F.connectClass})),void 0!==F.isEnabled&&e.computed({read:function(){y.sortable(n(F.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:l})}),0);return e.utils.domNodeDisposal.addDisposeCallback(l,(function(){(y.data("ui-sortable")||y.data("sortable"))&&y.sortable("destroy"),e.utils.toggleDomNodeCssClass(l,F.connectClass,!1),clearTimeout(S)})),{controlsDescendantBindings:!0}},update:function(t,s,i,n,r){var l=u(s,"foreach");a(t,o,l.foreach),e.bindingHandlers.template.update(t,(function(){return l}),i,n,r)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}},e.bindingHandlers.draggable={init:function(s,i,o,r,l){var h=n(i())||{},c=h.options||{},d=e.utils.extend({},e.bindingHandlers.draggable.options),p=u(i,"data"),m=h.connectClass||e.bindingHandlers.draggable.connectClass,g=void 0!==h.isEnabled?h.isEnabled:e.bindingHandlers.draggable.isEnabled;return h="data"in h?h.data:h,a(s,"ko_dragItem",h),e.utils.extend(d,c),d.connectToSortable=!!m&&"."+m,t(s).draggable(d),void 0!==g&&e.computed({read:function(){t(s).draggable(n(g)?"enable":"disable")},disposeWhenNodeIsRemoved:s}),e.utils.domNodeDisposal.addDisposeCallback(s,(function(){t(s).draggable("destroy")})),e.bindingHandlers.template.init(s,(function(){return p}),o,r,l)},update:function(t,s,i,o,n){var r=u(s,"data");return e.bindingHandlers.template.update(t,(function(){return r}),i,o,n)},connectClass:e.bindingHandlers.sortable.connectClass,options:{helper:"clone"}},e.bindingHandlers.droppable={init:function(i,o,a,l,h){var c=n(o())||{},u=c.options||{},d=e.utils.extend({},e.bindingHandlers.droppable.options),p=void 0!==c.isEnabled?c.isEnabled:e.bindingHandlers.droppable.isEnabled;e.utils.extend(d,u),c="data"in c?c.data:o(),d.drop=function(e,t){var i=r(t.draggable[0],"ko_dragItem")||r(t.draggable[0],s);c(i)},t(i).droppable(d),void 0!==p&&e.computed({read:function(){t(i).droppable(n(p)?"enable":"disable")},disposeWhenNodeIsRemoved:i}),e.utils.domNodeDisposal.addDisposeCallback(i,(function(){t(i).droppable("destroy")}))},options:{accept:"*"}}})?i.apply(t,o):i)||(e.exports=n)},zDln:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("0h2I"),r=s("RN+F"),a=s("Yjhd"),l=s("JFZZ"),h=s("OgeD"),c=s("SQrT"),u=s("o0Bx"),d=s("76Kh"),p=s("20Ah"),m=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),g=s("jonm"),f=s("4+IO"),b=s("p2hp"),y=s("DM8i");function v(e){m.call(this,b.ServerModuleName),this.oParent=e,this.bShown=!1,this.fetcher=n.observable(null),this.idFetcher=n.observable(null),this.isEnabled=n.observable(!0),this.incomingLogin=n.observable(""),this.sFakePass="******",this.incomingPassword=n.observable(this.sFakePass),this.oIncoming=new y(110,995,"fetcher_edit_incoming",r.i18n("MAILWEBCLIENT/LABEL_POP3_SERVER")),this.sFetcherFolder="",this.folder=n.observable(""),this.options=n.observableArray([]),f.folderList.subscribe((function(){this.populateOptions()}),this),this.leaveMessagesOnServer=n.observable(!1),this.passwordIsSelected=n.observable(!1),this.defaultOptionsAfterRender=a.defaultOptionsAfterRender,this.fetcherIntervalHint=n.computed((function(){var e=this.fetcher()?this.fetcher().iCheckIntervalMinutes:0;return 0!==e?r.i18n("MAILWEBCLIENT/INFO_POP3_FETCHER_PLURAL",{INTERVAL:e},null,e):""}),this)}i.extendOwn(v.prototype,m.prototype),v.prototype.ViewTemplate="MailWebclient_Settings_FetcherIncomingSettingsFormView",v.prototype.onShow=function(e){this.fetcher(e&&e.FETCHER?e:null),this.populateOptions(),this.populate()},v.prototype.hide=function(e){this.bShown=!1,e()},v.prototype.populateOptions=function(){this.bShown&&(this.options(f.folderList().getOptions("",!0,!1,!1)),this.sFetcherFolder!==this.folder()&&(this.folder(this.sFetcherFolder),this.updateSavedState()))},v.prototype.getCurrentValues=function(){return[this.isEnabled(),this.oIncoming.server(),this.oIncoming.port(),this.oIncoming.ssl(),this.incomingPassword(),this.folder(),this.leaveMessagesOnServer()]},v.prototype.getParametersForSave=function(){if(this.fetcher()){var e=o.trim(this.incomingPassword()),t={FetcherId:this.idFetcher(),IsEnabled:this.isEnabled(),Folder:this.folder(),IncomingServer:this.oIncoming.server(),IncomingPort:this.oIncoming.getIntPort(),IncomingUseSsl:this.oIncoming.ssl(),LeaveMessagesOnServer:this.leaveMessagesOnServer()};return""!==e&&e!==this.sFakePass&&(t.IncomingPassword=e),t}return{}},v.prototype.save=function(){this.isEmptyRequiredFields()?c.showError(r.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY")):(this.isSaving(!0),this.updateSavedState(),u.send(b.FetchersServerModuleName,"UpdateFetcher",this.getParametersForSave(),this.onResponse,this))},v.prototype.onResponse=function(e,t){this.isSaving(!1),e.Result?(g.populateFetchers(),c.showReport(r.i18n("MAILWEBCLIENT/REPORT_SUCCESSFULLY_SAVED"))):l.showErrorByCode(e,r.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},v.prototype.populate=function(){var e=this.fetcher();e&&(this.sFetcherFolder=e.folder(),this.idFetcher(e.id()),this.isEnabled(e.isEnabled()),this.folder(e.folder()),this.oIncoming.set(e.incomingServer(),e.incomingPort(),e.incomingUseSsl()),this.incomingLogin(e.incomingLogin()),this.incomingPassword(this.sFakePass),this.leaveMessagesOnServer(e.leaveMessagesOnServer()),this.updateSavedState())},v.prototype.isEmptyRequiredFields=function(){return""===this.oIncoming.server()?(this.oIncoming.server.focused(!0),!0):""===o.trim(this.incomingPassword())&&(this.passwordIsSelected(!0),!0)},v.prototype.remove=function(){var e=this.fetcher(),t=function(t){if(t){var s={FetcherId:e.id()};u.send(b.FetchersServerModuleName,"DeleteFetcher",s,this.onAccountDeleteFetcherResponse,this),this.oParent&&i.isFunction(this.oParent.onRemoveFetcher)&&this.oParent.onRemoveFetcher()}}.bind(this);e&&d.showPopup(p,[r.i18n("MAILWEBCLIENT/CONFIRM_REMOVE_FETCHER"),t,e.incomingLogin()])},v.prototype.onAccountDeleteFetcherResponse=function(e,t){e.Result||l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_FETCHER_DELETING")),g.populateFetchers()},e.exports=v},zu1m:function(e,t,s){"use strict";var i=s("F/us"),o=s("EVdn"),n=s("AFLV"),r={};r.showInlinePictures=function(e,t,s,n){var r=function(e){return i.find(t,(function(t){return t.CID===e}))};"string"!=typeof n&&(n=""),s.length>0&&(o("[data-x-src-cid]",e).each((function(){var e=o(this).attr("data-x-src-cid"),t=r(e);t&&t.ViewLink.length>0&&o(this).attr("src",n+t.ViewLink)})),o("[data-x-style-cid]",e).each((function(){var e="",t=o(this).attr("data-x-style-cid-name"),s=o(this).attr("data-x-style-cid"),i=r(s);i&&i.ViewLink.length>0&&""!==t&&(e=""===(e=o.trim(o(this).attr("style")))?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+t+": url('"+i.ViewLink+"')"))}))),o("[data-x-src-location]",e).each((function(){var e,s=o(this).attr("data-x-src-location"),a=(e=s,i.find(t,(function(t){return t.ContentLocation===e})));a||(a=r(s)),a&&a.ViewLink.length>0&&o(this).attr("src",n+a.ViewLink)}))},r.showExternalPictures=function(e){o("[data-x-src]",e).each((function(){o(this).attr("src",o(this).attr("data-x-src")).removeAttr("data-x-src")})),o("[data-x-style-url]",e).each((function(){var e=o.trim(o(this).attr("style"));e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+o(this).attr("data-x-style-url")).removeAttr("data-x-style-url")}))},r.joinReplyPrefixesInSubject=function(e,t,s){var r=[t.toUpperCase()],a=[s.toUpperCase()],l=i.union(r,a).join("|"),h="",c=e.split(":"),u=[],d="";return i.each(c,(function(e){if(0===d.length){var h=o.trim(e.toUpperCase()),c=-1!==i.indexOf(r,h),p=-1!==i.indexOf(a,h),m=1,g=u.length>0?u[u.length-1]:null;if(!c&&!p){var f=new window.RegExp("^\\s?("+l+")\\s?[\\[\\(]([\\d]+)[\\]\\)]$","gi").exec(h);f&&3===f.length&&(c=-1!==i.indexOf(r,f[1].toUpperCase()),p=-1!==i.indexOf(a,f[1].toUpperCase()),m=n.pInt(f[2]))}c?g&&g.prefix===t?g.count+=m:u.push({prefix:t,count:m}):p?g&&g.prefix===s?g.count+=m:u.push({prefix:s,count:m}):d=e}else d+=":"+e})),i.each(u,(function(e){1===e.count?h+=e.prefix+": ":h+=e.prefix+"["+e.count+"]: "})),h+=o.trim(d)},e.exports=r}}]);